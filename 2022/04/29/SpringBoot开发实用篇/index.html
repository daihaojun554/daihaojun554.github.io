<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="SpringBoot开发实用篇"><meta name="keywords" content="SpringBoot,开发使用篇,整合第三方技术"><meta name="author" content="DaiHaojun"><meta name="copyright" content="DaiHaojun"><title>SpringBoot开发实用篇 | myblog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '6.1.0'
} </script><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="myblog" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87"><span class="toc-number">1.</span> <span class="toc-text">SpringBoot开发实用篇</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">目录：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E7%83%AD%E9%83%A8%E7%BD%B2"><span class="toc-number">3.</span> <span class="toc-text">一、热部署</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1%E3%80%81%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0SpringBoot%E7%9A%84%E7%83%AD%E9%83%A8%E7%BD%B2"><span class="toc-number">3.1.</span> <span class="toc-text">1.1、如何添加SpringBoot的热部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2%E3%80%81%E8%87%AA%E5%8A%A8%E5%90%AF%E5%8A%A8%E7%83%AD%E9%83%A8%E7%BD%B2"><span class="toc-number">3.2.</span> <span class="toc-text">1.2、自动启动热部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3%E3%80%81%E5%A6%82%E4%BD%95%E5%85%B3%E9%97%AD%E7%83%AD%E9%83%A8%E7%BD%B2%EF%BC%9F"><span class="toc-number">3.3.</span> <span class="toc-text">1.3、如何关闭热部署？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E9%85%8D%E7%BD%AE%E9%AB%98%E7%BA%A7"><span class="toc-number">4.</span> <span class="toc-text">二、配置高级</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1%E3%80%81-ConfigurationProperties"><span class="toc-number">4.1.</span> <span class="toc-text">2.1、@ConfigurationProperties</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2%E3%80%81%E6%9D%BE%E6%95%A3%E7%BB%91%E5%AE%9A"><span class="toc-number">4.2.</span> <span class="toc-text">2.2、松散绑定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3%E3%80%81%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4%E7%9A%84%E5%8D%95%E4%BD%8D%E9%97%AE%E9%A2%98"><span class="toc-number">4.3.</span> <span class="toc-text">2.3、超时时间的单位问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4%E3%80%81%E5%AD%98%E5%82%A8%E7%9A%84%E5%8D%95%E4%BD%8D"><span class="toc-number">4.4.</span> <span class="toc-text">2.4、存储的单位</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5%E3%80%81%E6%95%B0%E6%8D%AE%E7%9A%84%E6%A0%BC%E5%BC%8F%E6%A0%A1%E9%AA%8C"><span class="toc-number">4.5.</span> <span class="toc-text">2.5、数据的格式校验</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-number">5.</span> <span class="toc-text">三、测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1%E3%80%81-%E7%BB%99%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E6%B7%BB%E5%8A%A0%E5%B1%9E%E6%80%A7"><span class="toc-number">5.1.</span> <span class="toc-text">3.1、 给测试环境添加属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2%E3%80%81%E5%8A%A0%E8%BD%BD%E6%B5%8B%E8%AF%95%E7%9A%84%E4%B8%93%E7%94%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">5.2.</span> <span class="toc-text">3.2、加载测试的专用配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3%E3%80%81%E8%A1%A8%E7%8E%B0%E5%B1%82%E7%9A%84%E6%B5%8B%E8%AF%95"><span class="toc-number">5.3.</span> <span class="toc-text">3.3、表现层的测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1%E3%80%81%E5%8F%91%E9%80%81%E8%99%9A%E6%8B%9F%E8%AF%B7%E6%B1%82"><span class="toc-number">5.3.1.</span> <span class="toc-text">3.3.1、发送虚拟请求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4%E3%80%81%E5%A6%82%E4%BD%95%E8%AE%A9%E6%95%B0%E6%8D%AE%E5%B1%82%E6%B5%8B%E8%AF%95%E4%BA%8B%E5%8A%A1%E5%9B%9E%E6%BB%9A"><span class="toc-number">5.4.</span> <span class="toc-text">3.4、如何让数据层测试事务回滚</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5%E3%80%81%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%E8%AE%BE%E7%BD%AE%E9%9A%8F%E6%9C%BA%E6%95%B0%E6%8D%AE"><span class="toc-number">5.5.</span> <span class="toc-text">3.5、测试用例设置随机数据</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%95%B0%E6%8D%AE%E5%B1%82%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">6.</span> <span class="toc-text">四、数据层解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1%E3%80%81SQL"><span class="toc-number">6.1.</span> <span class="toc-text">4.1、SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1%E3%80%81hikari"><span class="toc-number">6.1.1.</span> <span class="toc-text">4.1.1、hikari</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2%E3%80%81JdbcTemplate"><span class="toc-number">6.1.2.</span> <span class="toc-text">4.1.2、JdbcTemplate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-3%E3%80%81SpringBoot%E7%9A%84%E5%86%85%E7%BD%AE%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">6.1.3.</span> <span class="toc-text">4.1.3、SpringBoot的内置的数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-3-1%E3%80%81H2"><span class="toc-number">6.1.3.1.</span> <span class="toc-text">4.1.3.1、H2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2%E3%80%81NoSQL"><span class="toc-number">6.2.</span> <span class="toc-text">4.2、NoSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1%E3%80%81Redis"><span class="toc-number">6.2.1.</span> <span class="toc-text">4.2.1、Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2%E3%80%81SpringBoot%E6%95%B4%E5%90%88Redis"><span class="toc-number">6.2.2.</span> <span class="toc-text">4.2.2、SpringBoot整合Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3%E3%80%81Mongodb"><span class="toc-number">6.2.3.</span> <span class="toc-text">4.2.3、Mongodb</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4%E3%80%81Studio3T"><span class="toc-number">6.2.4.</span> <span class="toc-text">4.2.4、Studio3T</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-5%E3%80%81SpringBoot%E6%95%B4%E5%90%88mongodb"><span class="toc-number">6.2.5.</span> <span class="toc-text">4.2.5、SpringBoot整合mongodb</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-6%E3%80%81Elasticseach-ES"><span class="toc-number">6.2.6.</span> <span class="toc-text">4.2.6、Elasticseach(ES)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-received-plaintext-http-traffic-on-an-https-channel-closing-connection-Netty4HttpChannel"><span class="toc-number">6.2.6.1.</span> <span class="toc-text">1.received plaintext http traffic on an https channel, closing connection Netty4HttpChannel</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-elasticsearch-%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81"><span class="toc-number">6.2.6.2.</span> <span class="toc-text">2.elasticsearch 账号密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E8%AE%BE%E7%BD%AE%E5%86%85%E5%AD%98%E5%A4%A7%E5%B0%8F"><span class="toc-number">6.2.6.3.</span> <span class="toc-text">3. 设置内存大小</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81IK%E5%88%86%E8%AF%8D%E5%99%A8-es-%EF%BC%88%E6%8F%92%E4%BB%B6%EF%BC%89"><span class="toc-number">6.2.6.4.</span> <span class="toc-text">4、IK分词器 es （插件）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E5%88%9B%E5%BB%BA-x2F-%E6%9F%A5%E8%AF%A2-x2F-%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">6.2.6.5.</span> <span class="toc-text">5、创建&#x2F;查询&#x2F;删除索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E5%88%9B%E5%BB%BA%E6%96%87%E6%A1%A3"><span class="toc-number">6.2.6.6.</span> <span class="toc-text">6、创建文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E3%80%81%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3"><span class="toc-number">6.2.6.7.</span> <span class="toc-text">7、查询文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8%E3%80%81%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">6.2.6.8.</span> <span class="toc-text">8、删除文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1%E3%80%81%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3%EF%BC%88%E5%85%A8%E9%87%8F%E4%BF%AE%E6%94%B9"><span class="toc-number">6.2.6.9.</span> <span class="toc-text">9.1、修改文档（全量修改)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2%E3%80%81%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3%EF%BC%88%E9%83%A8%E5%88%86%E4%BF%AE%E6%94%B9"><span class="toc-number">6.2.6.10.</span> <span class="toc-text">9.2、修改文档（部分修改)</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%95%B4%E5%90%88%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8A%80%E6%9C%AF"><span class="toc-number">7.</span> <span class="toc-text">五、整合第三方技术</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%EF%BC%9A"><span class="toc-number">7.1.</span> <span class="toc-text">缓存：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1%E3%80%81%E7%BC%93%E5%AD%98"><span class="toc-number">7.1.1.</span> <span class="toc-text">5.1、缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2%E3%80%81%E7%BC%93%E5%AD%98%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E6%89%8B%E6%9C%BA%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">7.1.2.</span> <span class="toc-text">5.2、缓存使用案例——手机验证码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3%E3%80%81%E5%8F%98%E6%9B%B4%E7%BC%93%E5%AD%98%E4%BE%9B%E5%BA%94%E5%95%86Ehcache"><span class="toc-number">7.1.3.</span> <span class="toc-text">5.3、变更缓存供应商Ehcache</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4%E3%80%81%E5%8F%98%E6%9B%B4%E7%BC%93%E5%AD%98%E4%BE%9B%E5%BA%94%E5%95%86Redis"><span class="toc-number">7.1.4.</span> <span class="toc-text">5.4、变更缓存供应商Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5%E3%80%81%E5%8F%98%E6%9B%B4%E7%BC%93%E5%AD%98%E4%BE%9B%E5%BA%94%E5%95%86%E4%B8%BAMemcached"><span class="toc-number">7.1.5.</span> <span class="toc-text">5.5、变更缓存供应商为Memcached</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-1%E3%80%81memcached%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%80%89%E6%8B%A9"><span class="toc-number">7.1.5.1.</span> <span class="toc-text">5.5.1、memcached客户端选择</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6%E3%80%81%E7%BC%93%E5%AD%98%E4%BE%9B%E5%BA%94%E5%95%86%E5%8F%98%E6%9B%B4-jetcache"><span class="toc-number">7.1.6.</span> <span class="toc-text">5.6、缓存供应商变更 jetcache</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-1%E3%80%81%E6%95%B4%E5%90%88jetcache"><span class="toc-number">7.1.6.1.</span> <span class="toc-text">5.6.1、整合jetcache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-2%E3%80%81%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8jetcache"><span class="toc-number">7.1.6.2.</span> <span class="toc-text">5.6.2、如何使用jetcache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-3%E3%80%81jetcache%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%A1%88"><span class="toc-number">7.1.6.3.</span> <span class="toc-text">5.6.3、jetcache本地方案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-4%E3%80%81%E5%9C%A8%E6%96%B9%E6%B3%95%E4%B8%8A%E5%8A%A0%E4%B8%8A%E7%BC%93%E5%AD%98"><span class="toc-number">7.1.6.4.</span> <span class="toc-text">5.6.4、在方法上加上缓存</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7%E3%80%81%E5%8F%98%E6%9B%B4%E7%BC%93%E5%AD%98%E4%B8%BAj2cache-%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-number">7.1.7.</span> <span class="toc-text">5.7、变更缓存为j2cache(多级缓存)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1"><span class="toc-number">7.2.</span> <span class="toc-text">任务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-8%E3%80%81SpringBoot%E6%95%B4%E5%90%88Quartz"><span class="toc-number">7.2.1.</span> <span class="toc-text">5.8、SpringBoot整合Quartz</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-9%E3%80%81springboot%E6%95%B4%E5%90%88Task"><span class="toc-number">7.2.2.</span> <span class="toc-text">5.9、springboot整合Task</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%82%AE%E4%BB%B6"><span class="toc-number">7.3.</span> <span class="toc-text">邮件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-10%E3%80%81Springboot%E6%95%B4%E5%90%88JavaMail"><span class="toc-number">7.3.1.</span> <span class="toc-text">5.10、Springboot整合JavaMail</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E6%99%AE%E9%80%9A%E7%9A%84%E9%82%AE%E7%AE%B1"><span class="toc-number">7.3.1.1.</span> <span class="toc-text">发送普通的邮箱</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E5%B8%A6%E9%99%84%E4%BB%B6%E7%9A%84%E9%82%AE%E7%AE%B1"><span class="toc-number">7.3.1.2.</span> <span class="toc-text">发送带附件的邮箱</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%88%E6%81%AF"><span class="toc-number">7.4.</span> <span class="toc-text">消息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E6%A1%88%E4%BE%8B%EF%BC%9A%E7%9F%AD%E4%BF%A1%E9%80%9A%E7%9F%A5"><span class="toc-number">7.4.1.</span> <span class="toc-text">小案例：短信通知</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#activeMQ"><span class="toc-number">7.4.2.</span> <span class="toc-text">activeMQ:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-11%E3%80%81SpringBoot%E6%95%B4%E5%90%88activeamq"><span class="toc-number">7.4.3.</span> <span class="toc-text">5.11、SpringBoot整合activeamq</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-12%E3%80%81SpringBoot%E6%95%B4%E5%90%88RabbitMq"><span class="toc-number">7.4.4.</span> <span class="toc-text">5.12、SpringBoot整合RabbitMq</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B4%E8%BF%9E%E6%A8%A1%E5%BC%8F"><span class="toc-number">7.4.4.1.</span> <span class="toc-text">直连模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#topic%E6%A8%A1%E5%BC%8F"><span class="toc-number">7.4.4.2.</span> <span class="toc-text">topic模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-13%E3%80%81SpringBoot%E6%95%B4%E5%90%88RocketMQ"><span class="toc-number">7.4.5.</span> <span class="toc-text">5.13、SpringBoot整合RocketMQ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-14%E3%80%81SpringBoot%E6%95%B4%E5%90%88Kafka"><span class="toc-number">7.4.6.</span> <span class="toc-text">5.14、SpringBoot整合Kafka</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%91%E6%8E%A7"><span class="toc-number">7.5.</span> <span class="toc-text">监控</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-15%E3%80%81%E5%8F%AF%E8%A7%86%E5%8C%96%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0"><span class="toc-number">7.5.1.</span> <span class="toc-text">5.15、可视化监控平台</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AB%AF%E7%82%B9%E4%BF%A1%E6%81%AF"><span class="toc-number">7.5.2.</span> <span class="toc-text">自定义端点信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%81%A5%E5%BA%B7%E7%B1%BB%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="toc-number">7.5.2.1.</span> <span class="toc-text">健康类的信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E7%9A%84%E4%BF%A1%E6%81%AFmeterRegist"><span class="toc-number">7.5.2.2.</span> <span class="toc-text">性能的信息meterRegist</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E7%AB%AF%E7%82%B9"><span class="toc-number">7.5.2.3.</span> <span class="toc-text">自定义的端点</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">DaiHaojun</div><div class="author-info__description text-center">记录学习日常</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">25</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">36</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">myblog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">SpringBoot开发实用篇</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-04-28</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="SpringBoot开发实用篇"><a href="#SpringBoot开发实用篇" class="headerlink" title="SpringBoot开发实用篇"></a>SpringBoot开发实用篇</h1><h1 id="目录："><a href="#目录：" class="headerlink" title="目录："></a>目录：</h1><ul>
<li>热部署</li>
<li>配置高级</li>
<li>测试</li>
<li>数据层解决方案</li>
<li>整合第三方技术</li>
<li>监控</li>
</ul>
<h1 id="一、热部署"><a href="#一、热部署" class="headerlink" title="一、热部署"></a>一、热部署</h1><h2 id="1-1、如何添加SpringBoot的热部署"><a href="#1-1、如何添加SpringBoot的热部署" class="headerlink" title="1.1、如何添加SpringBoot的热部署"></a>1.1、如何添加SpringBoot的热部署</h2><p>在pom.xml中加入这个：</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220428220941318.png" alt="image-20220428220941318"></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>激活热部署:ctrl+F9 (build project)</p>
<p>1．开启开发者工具后启用热部署</p>
<p>2．使用构建项目操作启动热部署（ Ctrl+F9)</p>
<p>3．热部署仅仅加载当前开发者自定义开发的资源，不加载jar资源</p>
<h2 id="1-2、自动启动热部署"><a href="#1-2、自动启动热部署" class="headerlink" title="1.2、自动启动热部署"></a>1.2、自动启动热部署</h2><p>热部署只在开发环境下有用。实际上线的情况不可能改代码</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220428222714897.png" alt="image-20220428222714897"></p>
<p>勾上</p>
<p>然后ctrl+ alt+ shift +&#x2F;</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220428223310440.png" alt="image-20220428223310440"></p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220428223210427.png" alt="image-20220428223210427"></p>
<p>whenapprunning勾上</p>
<p>激活方式: ldea失去焦点5秒后启动热部署</p>
<p>热部署的范围：</p>
<p>默认不触发重启的目录列表<br>&#x2F;META-INF &#x2F; maven<br>&#x2F;META-INF&#x2F;resources<br>&#x2F;resources<br>&#x2F;static<br>&#x2F;public<br>&#x2F;templates</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220428225317272.png" alt="image-20220428225317272"></p>
<p>这个就是表示的哪些文件不参与热部署，可以自己配置</p>
<h2 id="1-3、如何关闭热部署？"><a href="#1-3、如何关闭热部署？" class="headerlink" title="1.3、如何关闭热部署？"></a>1.3、如何关闭热部署？</h2><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430170058256.png" alt="image-20220430170058256"></p>
<p>设置为false</p>
<h1 id="二、配置高级"><a href="#二、配置高级" class="headerlink" title="二、配置高级"></a>二、配置高级</h1><h2 id="2-1、-ConfigurationProperties"><a href="#2-1、-ConfigurationProperties" class="headerlink" title="2.1、@ConfigurationProperties"></a>2.1、@ConfigurationProperties</h2><p><strong><code>@ConfigurationProperties</code></strong></p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430171339307.png" alt="image-20220430171339307"></p>
<p>定义一个配置类，然后在配置文件里给它赋值</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430171415829.png" alt="image-20220430171415829"></p>
<p>启动容器的时候就能够得到这些值</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430171447144.png" alt="image-20220430171447144"></p>
<p>当要整合第三方的对象的时候就这样假设要定一个druid对象</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;datasource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> DruidDataSource <span class="title function_">dataSource</span><span class="params">()</span>&#123;</span><br><span class="line">   <span class="type">DruidDataSource</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">   <span class="keyword">return</span> ds;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">datasource:</span></span><br><span class="line">  <span class="attr">driverClassName:</span> <span class="string">com.dhj.Driver</span></span><br></pre></td></tr></table></figure>

<p>这样就可以拿到值了</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430172526039.png" alt="image-20220430172526039"></p>
<p><strong><code>@EnableConfigurationProperties</code></strong><br><code>@EnableConfigurationProperties</code>注解可以将使用@ConfigurationProperties注解对应的类加入Spring容器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(ServerConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;servers&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerConfig</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-2、松散绑定"><a href="#2-2、松散绑定" class="headerlink" title="2.2、松散绑定"></a>2.2、松散绑定</h2><p>在配置文件中名称可以 很宽松</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430174214017.png" alt="image-20220430174214017"></p>
<p>这里的每一种都可以匹配到</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430174244867.png" alt="image-20220430174244867"></p>
<p>但是<code>@Value</code>中不支持这种宽松绑定</p>
<h2 id="2-3、超时时间的单位问题"><a href="#2-3、超时时间的单位问题" class="headerlink" title="2.3、超时时间的单位问题"></a>2.3、超时时间的单位问题</h2><p>像上面的timeout这个没有单位，不明确，实际上是毫秒</p>
<p>jdk8以后提供了一个专门的时间类</p>
<table>
<thead>
<tr>
<th>ServerConfig(ipAddress&#x3D;192.168.0.3, port&#x3D;2345, timeout&#x3D;-1, serverOutTime&#x3D;PT0.003S)</th>
</tr>
</thead>
</table>
<p>默认是秒，你也可以自己换<br><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430175454337.png" alt="image-20220430175454337"></p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430175401848.png" alt="image-20220430175401848"></p>
<table>
<thead>
<tr>
<th>ServerConfig(ipAddress&#x3D;192.168.0.3, port&#x3D;2345, timeout&#x3D;-1, serverOutTime&#x3D;PT72H)</th>
</tr>
</thead>
</table>
<h2 id="2-4、存储的单位"><a href="#2-4、存储的单位" class="headerlink" title="2.4、存储的单位"></a>2.4、存储的单位</h2><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430175657308.png" alt="image-20220430175657308"></p>
<table>
<thead>
<tr>
<th>ServerConfig(ipAddress&#x3D;192.168.0.3, port&#x3D;2345, timeout&#x3D;-1, serverOutTime&#x3D;PT72H,dataSize&#x3D;10B)</th>
</tr>
</thead>
</table>
<p>默认是byte</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430175911607.png" alt="image-20220430175911607"></p>
<p>同样也可自己设置有mb，gb，tb，kb…</p>
<table>
<thead>
<tr>
<th>ServerConfig(ipAddress&#x3D;192.168.0.3, port&#x3D;2345, timeout&#x3D;-1, serverOutTime&#x3D;PT72H, dataSize&#x3D;10485760B)</th>
</tr>
</thead>
</table>
<p>但是显示的是b</p>
<p>也可在配置文件中直接把单位配上</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430180202689.png" alt="image-20220430180202689"></p>
<h2 id="2-5、数据的格式校验"><a href="#2-5、数据的格式校验" class="headerlink" title="2.5、数据的格式校验"></a>2.5、数据的格式校验</h2><p>开启数据校验有助于系统安全性，J2EE规范中JSR303规范定义了一组有关数据校验相关的API</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430180516280.png" alt="image-20220430180516280"></p>
<p>仓库搜索validation(验证的意思)</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--1、导入jsr303校验--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.validation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>validation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;servers&quot;)</span></span><br><span class="line"><span class="comment">//2、开启校验，这里只是开启了校验但是没有指定校验的规则</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String ipAddress;</span><br><span class="line">    <span class="comment">//3、在bean的具体字段上规定校验的规则</span></span><br><span class="line">    <span class="meta">@Max(value = 8888,message = &quot;最大值不能超过8888&quot;)</span></span><br><span class="line">    <span class="meta">@Min(value = 202,message = &quot;最小值不能低于202&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> timeout;</span><br><span class="line">    <span class="meta">@DurationUnit(ChronoUnit.DAYS)</span></span><br><span class="line">    <span class="keyword">private</span> Duration serverOutTime;</span><br><span class="line">    <span class="meta">@DataSizeUnit(DataUnit.MEGABYTES)</span></span><br><span class="line">    <span class="keyword">private</span> DataSize dataSize;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><strong>Description:<br><br>The Bean Validation API is on the classpath but no implementation could be found<br><br>Action:<br><br>Add an implementation, such as Hibernate Validator, to the classpath</strong></th>
</tr>
</thead>
</table>
<p>报错</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.hibernate.validator/hibernate-validator --&gt;</span></span><br><span class="line">&lt;-- 使用hibernate的校验框架 实现校验--&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate.validator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>okl！这样就可以实现校验了 这个里有很多的校验规则</p>
<p><strong>注意yml文件中对于数字的定义支持进制书写格式，如需使用字符串请使用引号明确标注</strong></p>
<h1 id="三、测试"><a href="#三、测试" class="headerlink" title="三、测试"></a>三、测试</h1><h2 id="3-1、-给测试环境添加属性"><a href="#3-1、-给测试环境添加属性" class="headerlink" title="3.1、 给测试环境添加属性"></a>3.1、 给测试环境添加属性</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(properties = &quot;test.prop=value1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PropertiesAndArgsTest</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;test.prop&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testProperties</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(msg);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>properties这个属性，可以设置临时的属性写法是”key&#x3D;value”</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(args = &#123;&quot;--test.prop=value2&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PropertiesAndArgsTest</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;test.prop&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testProperties</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(msg);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>args属性可以加上一些临时的属性写法是 “–name&#x3D;value”</p>
<p> <strong>args的优先级很高</strong></p>
<h2 id="3-2、加载测试的专用配置"><a href="#3-2、加载测试的专用配置" class="headerlink" title="3.2、加载测试的专用配置"></a>3.2、加载测试的专用配置</h2><p>使用<code>@Import</code>注解可以加载当前测试的专用配置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@Import(MsgConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CongurationTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> String Msg;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(Msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MsgConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">msg</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;bean Msg&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-3、表现层的测试"><a href="#3-3、表现层的测试" class="headerlink" title="3.3、表现层的测试"></a>3.3、表现层的测试</h2><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220501174536397.png" alt="image-20220501174536397"></p>
<p>在测试类中写上这个</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220501174612496.png" alt="image-20220501174612496"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-1、发送虚拟请求"><a href="#3-3-1、发送虚拟请求" class="headerlink" title="3.3.1、发送虚拟请求"></a>3.3.1、发送虚拟请求</h3><p>1、先写一个controller</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getById</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getByid is running&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;springboot&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要用springboot提供的虚拟调用</p>
<p>2、先开启虚拟mvc的调用</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220501175251070.png" alt="image-20220501175251070"></p>
<p>3、模拟请求</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//注入虚拟MVC调用对象</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWeb</span><span class="params">(<span class="meta">@Autowired</span> MockMvc mvc)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//模拟虚拟请求，访问当前的books</span></span><br><span class="line">        <span class="type">MockHttpServletRequestBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> MockMvcRequestBuilders.get(<span class="string">&quot;/books&quot;</span>);</span><br><span class="line">        <span class="comment">//发送请求</span></span><br><span class="line">        mvc.perform(builder);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220501175948997.png" alt="image-20220501175948997"></p>
<p>4、验证</p>
<ul>
<li>验证状态的匹配</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testStatue</span><span class="params">(<span class="meta">@Autowired</span> MockMvc mvc)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//模拟</span></span><br><span class="line">    <span class="type">MockHttpServletRequestBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> MockMvcRequestBuilders.get(<span class="string">&quot;/books&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">ResultActions</span> <span class="variable">perform</span> <span class="operator">=</span> mvc.perform(builder);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设定预期值，与真实值比较</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义本次的预期值</span></span><br><span class="line">    <span class="type">StatusResultMatchers</span> <span class="variable">status</span> <span class="operator">=</span> MockMvcResultMatchers.status();</span><br><span class="line"></span><br><span class="line">    <span class="type">ResultMatcher</span> <span class="variable">ok</span> <span class="operator">=</span> status.isOk();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加预期值与真实值比较</span></span><br><span class="line">    perform.andExpect(ok);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>验证响应体的匹配</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testBody</span><span class="params">(<span class="meta">@Autowired</span> MockMvc mvc)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//模拟</span></span><br><span class="line">    <span class="type">MockHttpServletRequestBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> MockMvcRequestBuilders.get(<span class="string">&quot;/books&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">ResultActions</span> <span class="variable">perform</span> <span class="operator">=</span> mvc.perform(builder);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设定预期值，与真实值比较</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义本次的预期值</span></span><br><span class="line">    <span class="type">ContentResultMatchers</span> <span class="variable">content</span> <span class="operator">=</span> MockMvcResultMatchers.content();</span><br><span class="line"></span><br><span class="line">    <span class="type">ResultMatcher</span> <span class="variable">ok</span> <span class="operator">=</span> content.string(<span class="string">&quot;springboot1&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加预期值与真实值比较</span></span><br><span class="line">    perform.andExpect(ok);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>验证json的匹配</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testJson</span><span class="params">(<span class="meta">@Autowired</span> MockMvc mvc)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//模拟</span></span><br><span class="line">    <span class="type">MockHttpServletRequestBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> MockMvcRequestBuilders.get(<span class="string">&quot;/books&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">ResultActions</span> <span class="variable">perform</span> <span class="operator">=</span> mvc.perform(builder);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设定预期值，与真实值比较</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义本次的预期值</span></span><br><span class="line">    <span class="type">ContentResultMatchers</span> <span class="variable">content</span> <span class="operator">=</span> MockMvcResultMatchers.content();</span><br><span class="line"></span><br><span class="line">    <span class="type">ResultMatcher</span> <span class="variable">ok</span> <span class="operator">=</span> content.json(<span class="string">&quot;&#123;\&quot;id\&quot;:1,\&quot;name\&quot;:\&quot;springboot\&quot;,\&quot;type\&quot;:\&quot;springboot\&quot;,\&quot;desc\&quot;:\&quot;springboot\&quot;&#125;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加预期值与真实值比较</span></span><br><span class="line">    perform.andExpect(ok);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>……还可以测试很多东西</p>
<h2 id="3-4、如何让数据层测试事务回滚"><a href="#3-4、如何让数据层测试事务回滚" class="headerlink" title="3.4、如何让数据层测试事务回滚"></a>3.4、如何让数据层测试事务回滚</h2><p>为测试用例添加事务，SpringBoot会对测试用例对应的事务提交操作进行回滚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DaoTest</span> &#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> BookService bookService;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果想在测试用例中提交事务，可以通过<code>@Rollback</code>注解设置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Rol1back(false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DaoTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> BookService bookService;</span><br><span class="line">    <span class="comment">//.....</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="3-5、测试用例设置随机数据"><a href="#3-5、测试用例设置随机数据" class="headerlink" title="3.5、测试用例设置随机数据"></a>3.5、测试用例设置随机数据</h2><p>在yml中设置：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">testcase:</span></span><br><span class="line">  <span class="attr">book:</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">$&#123;random.int&#125;</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">$&#123;random.value&#125;</span></span><br><span class="line">    <span class="attr">uuid:</span> <span class="string">$&#123;random.uuid&#125;</span></span><br><span class="line">    <span class="attr">publishTime:</span> <span class="string">$&#123;random.long&#125;</span></span><br></pre></td></tr></table></figure>

<p>再次创建一个实体类来进行封装</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;testcase.book&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookCase</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String uuid;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> publishTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>进行测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> BookCase bookCase;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testBookCase</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(bookCase);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220501193609388.png" alt="image-20220501193609388"></p>
<p>ok!</p>
<h1 id="四、数据层解决方案"><a href="#四、数据层解决方案" class="headerlink" title="四、数据层解决方案"></a>四、数据层解决方案</h1><h2 id="4-1、SQL"><a href="#4-1、SQL" class="headerlink" title="4.1、SQL"></a>4.1、SQL</h2><h3 id="4-1-1、hikari"><a href="#4-1-1、hikari" class="headerlink" title="4.1.1、hikari"></a>4.1.1、hikari</h3><ul>
<li>当我们的springboot不配置任何数据源的时候，默认使用**<code>HikariDatasource</code>**数据源</li>
<li>当我们的springboot是web环境的时候，springboot里的tomcat提供Datasource</li>
</ul>
<p>配置hikari的时候配置的文件这么写：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost/springboot-ssmp?useSSL=false&amp;characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<p><strong>url一定要写在hikari上面</strong></p>
<h3 id="4-1-2、JdbcTemplate"><a href="#4-1-2、JdbcTemplate" class="headerlink" title="4.1.2、JdbcTemplate"></a>4.1.2、JdbcTemplate</h3><ul>
<li>首先要加一个springboot-starter-jdbc的依赖</li>
</ul>
  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>  他这是自己的jdbc模板类</p>
<p>  然后怎么用呢，</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ApplicationTests</span> &#123;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">JdbcTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="comment">//第一步加载jdbcTemplate对象</span></span><br><span class="line"><span class="comment">//    jdbcTemplate.update(&quot;sql&quot;);</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from tb_book where id = 1&quot;</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//定义它的行的映射</span></span><br><span class="line">      RowMapper&lt;Book&gt; rm = <span class="keyword">new</span> <span class="title class_">RowMapper</span>&lt;Book&gt;() &#123;</span><br><span class="line">         <span class="meta">@Override</span></span><br><span class="line">         <span class="keyword">public</span> Book <span class="title function_">mapRow</span><span class="params">(ResultSet rs, <span class="type">int</span> rowNum)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">            <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">b_name</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;b_name&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">b_type</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;b_type&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">b_desc</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;b_desc&quot;</span>);</span><br><span class="line">            book.setId(id);</span><br><span class="line">            book.setBDesc(b_desc);</span><br><span class="line">            book.setBName(b_name);</span><br><span class="line">            book.setBType(b_type);</span><br><span class="line">            <span class="keyword">return</span> book;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      List&lt;Book&gt; query = jdbcTemplate.query(sql, rm);</span><br><span class="line">      System.out.println(query);</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * JdbcTemplate的插入测试</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">JdbcTemplateSave</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="type">String</span>  <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into tb_book (b_name,b_type,b_desc) values(&#x27;iambig&#x27;,&#x27;iambig&#x27;,&#x27;iambig&#x27;)&quot;</span>;</span><br><span class="line">		jdbcTemplate.execute(sql);</span><br><span class="line">	&#125;    </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220502204512585.png" alt="image-20220502204512585"></p>
<h3 id="4-1-3、SpringBoot的内置的数据库"><a href="#4-1-3、SpringBoot的内置的数据库" class="headerlink" title="4.1.3、SpringBoot的内置的数据库"></a>4.1.3、SpringBoot的内置的数据库</h3><p>SpringBoot提供了3种内嵌数据库供开发者选择，提高开发测试效率</p>
<ul>
<li>H2</li>
<li>HSQL</li>
<li>Derby</li>
</ul>
<p>​			   内存级的数据库</p>
<h4 id="4-1-3-1、H2"><a href="#4-1-3-1、H2" class="headerlink" title="4.1.3.1、H2"></a>4.1.3.1、H2</h4><p>导入两个坐标</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.h2database/h2 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>…</p>
<p>然后再yml中配置</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置一个控制台可视化h2</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">h2:</span></span><br><span class="line">    <span class="attr">console:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/h2</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:h2:~/test</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">sa</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">org.h2.Driver</span></span><br></pre></td></tr></table></figure>

<p>然后访问这个路径：</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220502211748161.png" alt="image-20220502211748161"></p>
<p>输入账号密码就可以去可视化的界面了</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220502211921383.png" alt="image-20220502211921383"></p>
<h2 id="4-2、NoSQL"><a href="#4-2、NoSQL" class="headerlink" title="4.2、NoSQL"></a>4.2、NoSQL</h2><p>市面上的常见的NoSQL</p>
<ul>
<li>Redis</li>
<li>Mongo</li>
<li>ES</li>
</ul>
<h3 id="4-2-1、Redis"><a href="#4-2-1、Redis" class="headerlink" title="4.2.1、Redis"></a>4.2.1、Redis</h3><p>Redis是一款key-value存储结构的内存级NoSQL数据库</p>
<ul>
<li>支持集群</li>
<li>支持持久化</li>
<li>支持多种数据存储格式</li>
</ul>
<p>安装Redis</p>
<p><a target="_blank" rel="noopener" href="https://github.com/tporadowski/redis/releases">https://github.com/tporadowski/redis/releases</a></p>
<p>…</p>
<p>使用：</p>
<p>打开一个 <strong>cmd</strong> 窗口 使用 cd 命令切换目录到 D:\dayly\Redis-x64-5.0.14.1 运行：</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">redis-server.exe redis.windows.conf</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220503124509459.png" alt="image-20220503124509459"></p>
<p>然后再客户端里连再起一个cmd</p>
<p>输入</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">redis-cli.exe</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220503124637858.png" alt="image-20220503124637858"></p>
<h3 id="4-2-2、SpringBoot整合Redis"><a href="#4-2-2、SpringBoot整合Redis" class="headerlink" title="4.2.2、SpringBoot整合Redis"></a>4.2.2、SpringBoot整合Redis</h3><ol>
<li>SpringBoot整合Redis</li>
</ol>
<ul>
<li>导入redis对应的starter配置</li>
</ul>
  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>写配置文件</li>
</ul>
  <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br></pre></td></tr></table></figure>

<ul>
<li>提供操作Redis接口对象RedisTemplate</li>
</ul>
<p>  <img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220503131333012.png" alt="image-20220503131333012"></p>
<ul>
<li>ops*:获取各种数据类型操作接口</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setRedis</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="type">ValueOperations</span> <span class="variable">ops</span> <span class="operator">=</span> redisTemplate.opsForValue();</span><br><span class="line">   ops.set(<span class="string">&quot;age&quot;</span>,<span class="number">41</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">getRedis</span><span class="params">()</span>&#123;</span><br><span class="line">   <span class="type">ValueOperations</span> <span class="variable">ops</span> <span class="operator">=</span> redisTemplate.opsForValue();</span><br><span class="line">   <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> (<span class="type">int</span>) ops.get(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">   System.out.println(age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">hsetRedis</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="type">HashOperations</span> <span class="variable">ops</span> <span class="operator">=</span> redisTemplate.opsForHash();</span><br><span class="line">   ops.put(<span class="string">&quot;info&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;dhj&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">hgetRedis</span><span class="params">()</span>&#123;</span><br><span class="line">   <span class="type">HashOperations</span> <span class="variable">ops</span> <span class="operator">=</span> redisTemplate.opsForHash();</span><br><span class="line">   <span class="type">String</span>  <span class="variable">o</span> <span class="operator">=</span> (String) ops.get(<span class="string">&quot;info&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">   System.out.println(o);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还有个专门的<code>StringRedisTemplate</code>对象专门操作字符串的</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate StringRedisTemplate;</span><br></pre></td></tr></table></figure>

<p>SpringBoot整合Redis客户端选择</p>
<ul>
<li>jedis</li>
<li>lettuce （默认)</li>
</ul>
<h3 id="4-2-3、Mongodb"><a href="#4-2-3、Mongodb" class="headerlink" title="4.2.3、Mongodb"></a>4.2.3、Mongodb</h3><p>安装：</p>
<p><a target="_blank" rel="noopener" href="https://www.mongodb.com/try/download/community">https://www.mongodb.com/try/download/community</a></p>
<p>然后解压到一个文件夹 创建一个data文件夹 然后在data中创建一个db的文件夹</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220504005221436.png" alt="image-20220504005221436"></p>
<p>然后cmd中输入  </p>
<p>这个是初始化的过程</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mongod --dbpath=..\data\db</span><br></pre></td></tr></table></figure>



<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220504005505384.png" alt="image-20220504005505384"></p>
<p>然后结束 再开启一次 就相当于起了服务</p>
<p>然后可以通过客户端来连接mongo 启动了服务之后</p>
<p>在bin目录下的cmd中输入</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mongo</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220504010055414.png" alt="image-20220504010055414"></p>
<p>这就相当于连接成功了。但是操作麻烦建议用可视化的工具</p>
<h3 id="4-2-4、Studio3T"><a href="#4-2-4、Studio3T" class="headerlink" title="4.2.4、Studio3T"></a>4.2.4、Studio3T</h3><p>是一款叫<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=mongodb&spm=1001.2101.3001.7020">mongodb</a> 可视化工具</p>
<p>Studio 3T下载地址：<a target="_blank" rel="noopener" href="https://studio3t.com/download-thank-you/?OS=win64">https://studio3t.com/download-thank-you/?OS=win64</a></p>
<p>这里的数据库叫database 然后表叫做<strong>Collections</strong></p>
<p>创建一个集合然后增删改查的操作</p>
<p>增：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db.book.insert(&#123;name:&quot;雾都孤儿&quot;,type:&quot;小说&quot;,desc:&quot;讲述了...&quot;&#125;)</span><br><span class="line"></span><br><span class="line">db.book.save(&#123;name:&quot;雾都孤儿2&quot;,type:&quot;小说2&quot;,desc:&quot;讲述了...2&quot;&#125;)</span><br></pre></td></tr></table></figure>



<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220504140303392.png" alt="image-20220504140303392"></p>
<p>删：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db.book.remove(&#123;desc:&quot;讲述了...2&quot;&#125;)</span><br></pre></td></tr></table></figure>



<p>改：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db.book.update(&#123;name:&quot;雾都孤儿2&quot;&#125;,&#123;name:&quot;雾都孤儿3&quot;,type:&quot;小说3&quot;,desc:&quot;讲述了...3&quot;&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220504140706596.png" alt="image-20220504140706596"></p>
<p>查：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db.getCollection(&quot;book&quot;).find(&#123;条件&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="4-2-5、SpringBoot整合mongodb"><a href="#4-2-5、SpringBoot整合mongodb" class="headerlink" title="4.2.5、SpringBoot整合mongodb"></a>4.2.5、SpringBoot整合mongodb</h3><ul>
<li>导入起步依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>写配置文件</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">mongodb:</span></span><br><span class="line">      <span class="attr">database:</span> <span class="string">springboot</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">mongodb://localhost</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">       book.setId(<span class="number">2</span>);</span><br><span class="line">       book.setType(<span class="string">&quot;故事&quot;</span>);</span><br><span class="line">       book.setName(<span class="string">&quot;一千零一夜&quot;</span>);</span><br><span class="line">       book.setDesc(<span class="string">&quot;好听的故事&quot;</span>);</span><br><span class="line">       mongoTemplate.save(book);</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">testFindAll</span><span class="params">()</span>&#123;</span><br><span class="line">            List&lt;Book&gt; all = mongoTemplate.findAll(Book.class);</span><br><span class="line">            System.out.println(all);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220504143013236.png" alt="image-20220504143013236"></p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220504143547088.png" alt="image-20220504143547088"></p>
<h3 id="4-2-6、Elasticseach-ES"><a href="#4-2-6、Elasticseach-ES" class="headerlink" title="4.2.6、Elasticseach(ES)"></a>4.2.6、Elasticseach(ES)</h3><ul>
<li>分布式的全文搜索引擎</li>
</ul>
<p>特点：</p>
<p>倒排索引</p>
<p>搜索的时候，先将你的关键字进行分词，每一个分出来的词，进行对应着一些id，每个id对应着一部分数据 </p>
<p>​			</p>
<p>Windows版ES下载<br><a target="_blank" rel="noopener" href="https://www.elastic.co/cn/downloads/elasticsearch">https://www.elastic.co/cn/downloads/elasticsearch</a></p>
<h4 id="1-received-plaintext-http-traffic-on-an-https-channel-closing-connection-Netty4HttpChannel"><a href="#1-received-plaintext-http-traffic-on-an-https-channel-closing-connection-Netty4HttpChannel" class="headerlink" title="1.received plaintext http traffic on an https channel, closing connection Netty4HttpChannel"></a><strong>1.received plaintext http traffic on an https channel, closing connection Netty4HttpChannel</strong></h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">received plaintext http traffic on an https channel, closing connection Netty4HttpChannel</span><br><span class="line">&#123;localAddress=/[0:0:0:0:0:0:0:1]:9200, remoteAddress=/[0:0:0:0:0:0:0:1]:55367&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决</strong></p>
<p>是因为开启了 <strong>SSL</strong>认证。<br>在 <strong>ES&#x2F;config&#x2F;elasticsearch.yml</strong> 文件中把 <code>xpack.security.http.ssl:enabled</code> 设置成 <code>false</code> 即可</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Enable encryption for HTTP API client connections, such as Kibana, Logstash, and Agents</span></span><br><span class="line"></span><br><span class="line"><span class="attr">xpack.security.http.ssl:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">keystore.path:</span> <span class="string">certs/http.p12</span></span><br></pre></td></tr></table></figure>

<h4 id="2-elasticsearch-账号密码"><a href="#2-elasticsearch-账号密码" class="headerlink" title="2.elasticsearch 账号密码"></a><strong>2.elasticsearch 账号密码</strong></h4><p>​    windows 下直接启动 <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=ElasticSearch&spm=1001.2101.3001.7020">ElasticSearch</a> ，见到 started 为成功启动，访问 htttp:&#x2F;&#x2F;localhost:9200 需要输入密码，是因为开启了密码验证模式。<br>找了一轮没看到有账号密码，干脆就设置免密登录就好。</p>
<p><strong>解决</strong></p>
<p>找到 <code>elasticsearch.yml</code> 文件， 把 <code>xpack.security.enabled</code> 属性设置为 <code>false</code> 即可。</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Enable security features</span></span><br><span class="line">xpack.security.<span class="symbol">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h4 id="3-设置内存大小"><a href="#3-设置内存大小" class="headerlink" title="3. 设置内存大小"></a>3. 设置内存大小</h4><p>ES 的内存是自己调节的。在 <code>config/jvm.options</code> 文件中直接设置就好(追加):</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-Xms512m</span></span><br><span class="line"><span class="deletion">-Xmx2048m</span></span><br></pre></td></tr></table></figure>

<h4 id="4、IK分词器-es-（插件）"><a href="#4、IK分词器-es-（插件）" class="headerlink" title="4、IK分词器 es （插件）"></a>4、IK分词器 es （插件）</h4><p>下载: <a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik/releases">https://github.com/medcl/elasticsearch-analysis-ik/releases</a></p>
<p>解压到<strong>plugins</strong>下</p>
<h4 id="5、创建-x2F-查询-x2F-删除索引"><a href="#5、创建-x2F-查询-x2F-删除索引" class="headerlink" title="5、创建&#x2F;查询&#x2F;删除索引"></a>5、创建&#x2F;查询&#x2F;删除索引</h4><p>PUT<br><a target="_blank" rel="noopener" href="http://localhost:9200/books">http://localhost:9200/books</a></p>
<p>GET<br><a target="_blank" rel="noopener" href="http://localhost:9200/books">http://localhost:9200/books</a></p>
<p>DELETE</p>
<p><a target="_blank" rel="noopener" href="http://localhost:9200/books">http://localhost:9200/books</a></p>
<h4 id="6、创建文档"><a href="#6、创建文档" class="headerlink" title="6、创建文档"></a>6、创建文档</h4><p>POST<br><a target="_blank" rel="noopener" href="http://localhost:9200/books/">http://localhost:9200/books/</a> _doc<br>#使用系统生成id<br>POST<br><a target="_blank" rel="noopener" href="http://localhost:9200/books/">http://localhost:9200/books/</a> _create&#x2F;1<br>#使用指定id,<br>POST<br><a target="_blank" rel="noopener" href="http://localhost:9200/books/">http://localhost:9200/books/</a> _doc&#x2F;1<br>#使用指定id，不存在创建，存在更新（版本递增)</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span><span class="string">&quot;springboot&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span><span class="string">&quot;springboot&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span> <span class="punctuation">:</span><span class="string">&quot;springboot&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="7、查询文档"><a href="#7、查询文档" class="headerlink" title="7、查询文档"></a>7、查询文档</h4><p>GET<br><a target="_blank" rel="noopener" href="http://localhost:9200/books/">http://localhost:9200/books/</a> _doc&#x2F;1<br>#查询单个文档</p>
<p>GET<br><a target="_blank" rel="noopener" href="http://localhost:9200/books/search">http://localhost:9200/books/search</a><br>#查询全部文档</p>
<p>条件查询<br>GET<br><a target="_blank" rel="noopener" href="http://localhost:9200/books/">http://localhost:9200/books/</a> _search?q&#x3D;name:springboot</p>
<h4 id="8、删除文档"><a href="#8、删除文档" class="headerlink" title="8、删除文档"></a>8、删除文档</h4><p>DELETE<br><a target="_blank" rel="noopener" href="http://localhost:9200/books/">http://localhost:9200/books/</a> _doc&#x2F;1</p>
<h4 id="9-1、修改文档（全量修改"><a href="#9-1、修改文档（全量修改" class="headerlink" title="9.1、修改文档（全量修改)"></a>9.1、修改文档（全量修改)</h4><p>PUT<br><a target="_blank" rel="noopener" href="http://localhost:9200/books/">http://localhost:9200/books/</a> _doc&#x2F;1</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span><span class="string">&quot;springboot&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span><span class="string">&quot;springboot&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;springboot&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="9-2、修改文档（部分修改"><a href="#9-2、修改文档（部分修改" class="headerlink" title="9.2、修改文档（部分修改)"></a>9.2、修改文档（部分修改)</h4><p>POST</p>
<p><a target="_blank" rel="noopener" href="http://localhost:9200/books/">http://localhost:9200/books/</a> _update(_doc)&#x2F;1</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;doc&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span><span class="string">&quot;springboot&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="五、整合第三方技术"><a href="#五、整合第三方技术" class="headerlink" title="五、整合第三方技术"></a>五、整合第三方技术</h1><h2 id="缓存："><a href="#缓存：" class="headerlink" title="缓存："></a>缓存：</h2><h3 id="5-1、缓存"><a href="#5-1、缓存" class="headerlink" title="5.1、缓存"></a>5.1、缓存</h3><ul>
<li>先加入依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>启用缓存</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">启用缓存</span><br><span class="line"><span class="meta">@SpringBootApplication</span><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheApplication</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	SpringApplication.run(CacheApplication.class，args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>使用缓存</li>
</ul>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220505234848921.png" alt="image-20220505234848921"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Cacheable(value=&quot;cachespace&quot; ,key=&quot;#id&quot;&#x27;)</span></span><br><span class="line"><span class="keyword">public</span> Book <span class="title function_">getById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> bookDao.selectById(id);</span><br><span class="line">&#125;</span><br><span class="line">           <span class="comment">//@Cacheable(里的value是放到什么地方，第二个是通过什么来查这个缓存)</span></span><br></pre></td></tr></table></figure>





<p>SpringBoot提供的缓存技术除了提供默认的缓存方案，还可以对其他缓存技术进行整合，统一接口，方便缓存技术的开发与管理</p>
<p><strong>Generic、JCache、<code>Ehcache</code>、Hazelcast、lnfinispan、Couchbase、<code>Redis</code>、Caffenine、Simple(默认)、<code>Memcached</code></strong></p>
<h3 id="5-2、缓存使用案例——手机验证码"><a href="#5-2、缓存使用案例——手机验证码" class="headerlink" title="5.2、缓存使用案例——手机验证码"></a>5.2、缓存使用案例——手机验证码</h3><p>需求：</p>
<ul>
<li><p>输入手机号获取验证码，组织文档以短信形式发送给用户（页面模拟)</p>
</li>
<li><p>输入手机号和验证码验证结果</p>
</li>
</ul>
<p>需求分析</p>
<ul>
<li>提供controller，传入手机号，业务层通过手机号计算出独有的6位验证码数据，存入缓存后返回此数据</li>
<li>提供controller，传入手机号与验证码，业务层通过手机号从缓存中读取验证码与输入验证码进行比对，返回比对结果</li>
</ul>
<p>先写一个pojo</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSCode</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String tele;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SMSCodeService</span> &#123;</span><br><span class="line"></span><br><span class="line">     String <span class="title function_">sendCodeToSMS</span><span class="params">(String tele)</span>;</span><br><span class="line"></span><br><span class="line">     <span class="type">boolean</span> <span class="title function_">checkCode</span><span class="params">(SMSCode smsCode)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service.impl</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SMSCodeService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CodeUtils codeUtils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line"><span class="comment">//    @Cacheable(value = &quot;smsCode&quot;,key = &quot;#tele&quot;)这个表示从缓存中拿值可以取出来的，我们用下一个，下面这个是不能从缓存中取，如果用这个的话就说明通过tele取出来的验证码是同一个，但是有一种场景是当登录完成的时候，需要新的验证码</span></span><br><span class="line">    <span class="meta">@CachePut(value = &quot;smsCode&quot;,key = &quot;#tele&quot;)</span><span class="comment">//只存不取</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sendCodeToSMS</span><span class="params">(String tele)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> codeUtils.generatorCode(tele);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//取出内存中的验证码和输出的验证码比对</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkCode</span><span class="params">(SMSCode smsCode)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> smsCode.getCode();</span><br><span class="line">        <span class="type">String</span> <span class="variable">cacheCode</span> <span class="operator">=</span> codeUtils.get(smsCode.getTele());</span><br><span class="line">        <span class="keyword">return</span> cacheCode.equals(code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写一个util生成验证码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeUtils</span> &#123;</span><br><span class="line"><span class="comment">//一种生成验证码的方式</span></span><br><span class="line">    <span class="keyword">public</span>  String <span class="title function_">generatorCode</span><span class="params">(String tele)</span>&#123;</span><br><span class="line">        String[] patch =  &#123;<span class="string">&quot;000000&quot;</span>,<span class="string">&quot;00000&quot;</span>,<span class="string">&quot;0000&quot;</span>,<span class="string">&quot;000&quot;</span>,<span class="string">&quot;00&quot;</span>,<span class="string">&quot;0&quot;</span>,<span class="string">&quot;&quot;</span>&#125;;</span><br><span class="line">        <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> tele.hashCode();</span><br><span class="line">        <span class="type">int</span> <span class="variable">encryption</span> <span class="operator">=</span> <span class="number">20206666</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">code</span> <span class="operator">=</span> hash ^ encryption;</span><br><span class="line">        <span class="type">long</span> <span class="variable">nowTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        code = code ^ nowTime;</span><br><span class="line">        code = code%<span class="number">100000</span>;</span><br><span class="line">        code = code &lt; <span class="number">0</span> ? -code : code;</span><br><span class="line">        <span class="type">String</span> <span class="variable">codeStr</span> <span class="operator">=</span> code+<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> codeStr.length();</span><br><span class="line">        <span class="keyword">return</span> patch[len] + codeStr;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//在这里通过key = &quot;tele&quot;来取出我们在smsCode存放的验证码有就返回 ，没有就返回null;</span></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;smsCode&quot;,key = &quot;#tele&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">(String tele)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>controller：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/sms&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SMSCodeService smsCodeService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCode</span><span class="params">(String  tele)</span>&#123;</span><br><span class="line">       <span class="keyword">return</span> smsCodeService.sendCodeToSMS(tele);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkCode</span><span class="params">(SMSCode smsCode)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> smsCodeService.checkCode(smsCode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<p>先像getCode发送请求，要传一个电话号码</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220506005144788.png" alt="image-20220506005144788"></p>
<p>验证的结果：</p>
<p>用返回的验证码来测试这里传的是两个参数其实是一个smsCode对象</p>
<p>验证码正确的时候：</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220506005216120.png" alt="image-20220506005216120"></p>
<p>如果写上错误的验证码：</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220506005243098.png" alt="image-20220506005243098"></p>
<h3 id="5-3、变更缓存供应商Ehcache"><a href="#5-3、变更缓存供应商Ehcache" class="headerlink" title="5.3、变更缓存供应商Ehcache"></a>5.3、变更缓存供应商Ehcache</h3><ul>
<li>导入依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.ehcache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ul>
<li><p>缓存淘汰的策略</p>
<ul>
<li>LFU：最少被使用，缓存的元素有一个hit属性，hit值最小的将会被清出缓存。</li>
<li>LRU：最近最少使用，缓存的元素有一个时间戳，当缓存容量满了，而又需要腾出地方来缓存新的元素的时候，那么现有缓存元素中时间戳离当前时间最远的元素将被清出缓存。</li>
<li>FIFO：先进先出</li>
</ul>
</li>
<li><p>配置文件说明</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">&quot;http://ehcache.org/ehcache.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">updateCheck</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">&quot;D:\ehcache&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--默犬认缓存策略--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- eternal:是否永久存在，设置为true则不会被清除，此时与timeout冲突，通常设置为false--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- diskPersistent:是否启用磁盘持久化--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--maxElementsInMemory :最大缓存数量--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- overflowToDisk :超过最大缓存数量是否持久化到磁盘--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- timeToIdleSeconds:最大不活动间隔，设置过长缓存容易溢出，设置过短无效果--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- timeToLiveSeconds:最大存活时间--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- memoryStoreEvictionPolicy :缓存清除策略--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">defaultCache</span></span></span><br><span class="line"><span class="tag">            <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">diskPersistent</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">maxElementsInMemory</span>=<span class="string">&quot;1000&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">overflowToDisk</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;60&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;60&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">&quot;LRU&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>写配置文件</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ehcache</span></span><br><span class="line">  <span class="attr">ehcache:</span></span><br><span class="line">    <span class="attr">config:</span> <span class="string">classpath:ehcache.xml</span></span><br></pre></td></tr></table></figure>

<h3 id="5-4、变更缓存供应商Redis"><a href="#5-4、变更缓存供应商Redis" class="headerlink" title="5.4、变更缓存供应商Redis"></a>5.4、变更缓存供应商Redis</h3><ul>
<li>导入依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>配置文件yml</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">  <span class="comment">#是否缓存空值</span></span><br><span class="line">    <span class="attr">cache-null-values:</span></span><br><span class="line">    <span class="comment">#key的前缀</span></span><br><span class="line">    <span class="attr">key-prefix:</span> <span class="string">sms</span></span><br><span class="line">    <span class="comment">#缓存存活的时间</span></span><br><span class="line">    <span class="attr">time-to-live:</span> <span class="string">10s</span></span><br><span class="line">    <span class="comment">#是否使用前缀</span></span><br><span class="line">    <span class="attr">use-key-prefix:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">redis:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure>

<p>ok!</p>
<p>这样就开启了redis缓存</p>
<h3 id="5-5、变更缓存供应商为Memcached"><a href="#5-5、变更缓存供应商为Memcached" class="headerlink" title="5.5、变更缓存供应商为Memcached"></a>5.5、变更缓存供应商为Memcached</h3><ul>
<li>下载</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://static.runoob.com/download/memcached-win64-1.4.4-14.zip">http://static.runoob.com/download/memcached-win64-1.4.4-14.zip</a> 默认监听端口为<strong>11211</strong></p>
<p><strong>解压后在cmd中敲(以管理员的的身份)</strong></p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220509001219248.png" alt="image-20220509001219248"></p>
<p>安装服务的命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">memcached.exe -d install</span><br></pre></td></tr></table></figure>

<p>启动服务的命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">memcached.exe -d start</span><br></pre></td></tr></table></figure>

<p>关闭服务的命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">memcached.exe -d stop</span><br></pre></td></tr></table></figure>





<h4 id="5-5-1、memcached客户端选择"><a href="#5-5-1、memcached客户端选择" class="headerlink" title="5.5.1、memcached客户端选择"></a>5.5.1、memcached客户端选择</h4><ul>
<li><p>Memcached client for Java:最早期客户端，稳定可靠，用户群广</p>
</li>
<li><p>SpyMemcached:效率更高</p>
</li>
<li><p>xmemcached:并发处理更好</p>
</li>
</ul>
<p>SpringBoot未提供对memcached的整合，需要使用硬编码方式实现客户端初始化管理</p>
<ul>
<li><p>整合xmemcached</p>
<ul>
<li>导依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.googlecode.xmemcached<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xmemcached<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>构造client</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemcachedConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MemcachedClient <span class="title function_">getMemcached</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">MemcachedClientBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XMemcachedClientBuilder</span>(<span class="string">&quot;localhost:11211&quot;</span>);</span><br><span class="line">        <span class="type">MemcachedClient</span> <span class="variable">client</span> <span class="operator">=</span> builder.build();</span><br><span class="line">        <span class="keyword">return</span> client;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<p>在service中进行使用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SMSCodeService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CodeUtils codeUtils;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MemcachedClient memcachedClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sendCodeToSMS</span><span class="params">(String tele)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> codeUtils.generatorCode(tele);</span><br><span class="line">        <span class="comment">//生成验证码的时候放入缓存</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//key 过期时间 0 代表永不过期，  value</span></span><br><span class="line">            memcachedClient.set(tele,<span class="number">120</span>,code);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (TimeoutException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException | MemcachedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkCode</span><span class="params">(SMSCode smsCode)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cacheCode</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            cacheCode = memcachedClient.get(smsCode.getTele());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//比对</span></span><br><span class="line">        <span class="keyword">return</span> cacheCode.equals(smsCode.getCode());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写配置用springboot提供的技术,从配置文件中读取内容属性</p>
<p>写一个配置类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;memcached&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemcachedProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String serverAddress;</span><br><span class="line">    <span class="keyword">private</span> Integer poolSize;</span><br><span class="line">    <span class="keyword">private</span> Integer outTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#-----------------memcached的配置-------------</span></span><br><span class="line"><span class="attr">memcached:</span></span><br><span class="line">  <span class="attr">serverAddress:</span> <span class="string">localhost:11211</span></span><br><span class="line">  <span class="attr">poolSize:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">outTime:</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure>

<p>在config中注入这个类</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220509004804995.png" alt="image-20220509004804995"></p>
<h3 id="5-6、缓存供应商变更-jetcache"><a href="#5-6、缓存供应商变更-jetcache" class="headerlink" title="5.6、缓存供应商变更 jetcache"></a>5.6、缓存供应商变更 jetcache</h3><p>jetlache对SpringCache进行了封装，在原有功能基础上实现了多级缓存、缓存统计、自动刷新、异步调用、数据报表等幼能</p>
<p>jetCache设定了本地缓存与远程缓存的多级缓存解决方案</p>
<ul>
<li>本地缓存（ local)<ul>
<li>LinkedHashMap</li>
<li>caffeine</li>
</ul>
</li>
<li>远程缓存（ remote)<ul>
<li>Redis</li>
<li>Tair</li>
</ul>
</li>
</ul>
<h4 id="5-6-1、整合jetcache"><a href="#5-6-1、整合jetcache" class="headerlink" title="5.6.1、整合jetcache"></a>5.6.1、整合jetcache</h4><ul>
<li>导入依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alicp.jetcache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jetcache-starter-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>做配置</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在jetcache中</span></span><br><span class="line"><span class="attr">jetcache:</span></span><br><span class="line"><span class="comment">#  远程方案</span></span><br><span class="line">  <span class="attr">remote:</span></span><br><span class="line"><span class="comment">#    默认的的设定</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line"><span class="comment">#      使用redis</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">poolConfig:</span></span><br><span class="line">        <span class="attr">maxTotal:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<h4 id="5-6-2、如何使用jetcache"><a href="#5-6-2、如何使用jetcache" class="headerlink" title="5.6.2、如何使用jetcache"></a>5.6.2、如何使用jetcache</h4><ul>
<li>在主启动类中加上注解 <code>@EnableCreateCacheAnnotation</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableCreateCacheAnnotation</span></span><br><span class="line"><span class="comment">//jet启动缓存的主开关</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application15JetCache</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">      SpringApplication.run(Application15JetCache.class, args);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在你要是用缓存的地方加入一个<code>Cache</code></li>
</ul>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220509175344177.png" alt="image-20220509175344177"></p>
<p>打上注解<code>@CreateCache</code></p>
<p>在<code>@CreateCache</code>中最少要做两个配置 <code>name</code> 和 <code>expire</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CreateCache(area = &quot;default&quot;,name = &quot;jetcache&quot;,expire = 120,timeUnit = TimeUnit.SECONDS)</span></span><br><span class="line"><span class="comment">//area表示你要使用的配置，前面配置了一个default的方案，name就是名字，随便取，expire是过期时间默认的单位是秒，可以用timeUnit来设置单位</span></span><br><span class="line"><span class="keyword">private</span> Cache&lt;String ,String &gt; jetCache ;</span><br></pre></td></tr></table></figure>

<p>使用的时候就可以调API</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SMSCodeService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CodeUtils codeUtils;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CreateCache(area = &quot;default&quot;,name = &quot;jetcache_&quot;,expire = 30,timeUnit = TimeUnit.SECONDS)</span></span><br><span class="line">    <span class="comment">//area表示你要使用的配置，前面配置了一个default的方案，name就是名字，随便取，expire是过期时间默认的单位是秒，可以用timeUnit来设置单位</span></span><br><span class="line">    <span class="keyword">private</span> Cache&lt;String ,String &gt; cache ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sendCodeToSMS</span><span class="params">(String tele)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> codeUtils.generatorCode(tele);</span><br><span class="line">        <span class="comment">//将验证码放入缓存</span></span><br><span class="line">        cache.put(tele,code);</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkCode</span><span class="params">(SMSCode smsCode)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cacheCode</span> <span class="operator">=</span> cache.get(smsCode.getTele());</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> smsCode.getCode();</span><br><span class="line">        <span class="keyword">return</span> cacheCode.equals(code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-6-3、jetcache本地方案"><a href="#5-6-3、jetcache本地方案" class="headerlink" title="5.6.3、jetcache本地方案"></a>5.6.3、jetcache本地方案</h4><p>配置：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">jetcache:</span>   </span><br><span class="line">  <span class="attr">local:</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">linkedhashmap</span></span><br><span class="line">      <span class="attr">keyConvertor:</span> <span class="string">fastjson</span></span><br></pre></td></tr></table></figure>

<p>在cache上写上 <code>cacheType=CacheType.LOCAL  </code>   这样就是本地的方案   不写的话默认是远程</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CreateCache(area = &quot;default&quot;, name = &quot;jetcache_&quot;, expire = 30, timeUnit = TimeUnit.SECONDS,cacheType = CacheType.LOCAL)</span></span><br><span class="line">   <span class="keyword">private</span> Cache&lt;String, String&gt; cache;</span><br></pre></td></tr></table></figure>

<h4 id="5-6-4、在方法上加上缓存"><a href="#5-6-4、在方法上加上缓存" class="headerlink" title="5.6.4、在方法上加上缓存"></a>5.6.4、在方法上加上缓存</h4><p>在controller中给每个方法加上缓存 这样就不用在发送请求了</p>
<ul>
<li><p>在主启动类上加上</p>
<p><code>@EnableMethodCache(basePackages = &quot;com.dhj&quot;)//开启方法注解</code></p>
</li>
<li><p>然后在方法上配上缓存，下次查询的时候就不用查数据库了</p>
<pre><code> `@Cached(area = &quot;default&quot;,name = &quot;getone_&quot;,key = &quot;#id&quot;,expire = 30)`
</code></pre>
</li>
</ul>
<p>前提是：</p>
<p>你得R对象要序列化</p>
<p>比如我在这里加上了缓存</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Cached(area = &quot;default&quot;,name = &quot;book_&quot;,key = &quot;#id&quot;,expire = 30)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(<span class="literal">true</span>, service.getById(id));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后这里返回的是R对象，你得R对象就要实现序列化</p>
<p>你得controller调用了service层 service层返回的又是一个实体类对象，所以你的实体类也要实现序列化</p>
<p>用  <code>implement Serializable</code>来实现 </p>
<ul>
<li>还要再配置中写上类型转换的方法fastjson，告诉springboot使用这个来讲对象转换成数据</li>
<li>还要告诉sprigboot 解码方式和转码方式 都为java</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在jetcache中</span></span><br><span class="line"><span class="attr">jetcache:</span></span><br><span class="line">  <span class="attr">statIntervalMinutes:</span> <span class="number">1</span></span><br><span class="line"><span class="comment">#  远程方案</span></span><br><span class="line">  <span class="attr">remote:</span></span><br><span class="line"><span class="comment">#    默认的的设定</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line"><span class="comment">#      使用redis</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">keyConvertor:</span> <span class="string">fastjson</span></span><br><span class="line">      <span class="attr">valueEncode:</span> <span class="string">java</span></span><br><span class="line">      <span class="attr">valueDecode:</span> <span class="string">java</span></span><br><span class="line">      <span class="attr">poolConfig:</span></span><br><span class="line">        <span class="attr">maxTotal:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">local:</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">linkedhashmap</span></span><br><span class="line">      <span class="attr">keyConvertor:</span> <span class="string">fastjson</span></span><br></pre></td></tr></table></figure>

<p><code>@cacheUpdate(key = &quot;#book.id&quot;,value=&quot;#book&quot;,name=&quot;book_&quot;)</code>更新缓存</p>
<p><code>@cacheInvalidate(name=&quot;book_&quot;,key=&quot;#id&quot;)</code> 删除缓存</p>
<p><code>@cacheRefresh(refresh = 120)</code>每过120秒更新一次</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Cached(area = &quot;default&quot;,name = &quot;book_&quot;,key = &quot;#id&quot;,expire = 30)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(<span class="literal">true</span>, service.getById(id));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@CacheInvalidate(name = &quot;book_&quot;,key = &quot;#id&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">deleteByid</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(service.removeById(id));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="meta">@CacheUpdate(name = &quot;book_&quot;,key = &quot;#book.id&quot;,value = &quot;#book&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> Book book)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(service.updateById(book));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在配置文件中写上</p>
<p><code>statIntervalMinutes: 1</code>就代表每过一分钟给你统计一次数量</p>
<h3 id="5-7、变更缓存为j2cache-多级缓存"><a href="#5-7、变更缓存为j2cache-多级缓存" class="headerlink" title="5.7、变更缓存为j2cache(多级缓存)"></a>5.7、变更缓存为j2cache(多级缓存)</h3><p>redis 和 ehcache整合 多级缓存的配置</p>
<ul>
<li><p>导入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/net.oschina.j2cache/j2cache-core --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.oschina.j2cache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>j2cache-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.2-release<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/net.oschina.j2cache/j2cache-spring-boot2-starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.oschina.j2cache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>j2cache-spring-boot2-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.0-release<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>做配置文件</p>
</li>
</ul>
<p>在resource中的配置文件</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220509204828678.png" alt="image-20220509204828678"></p>
<ul>
<li>&#96;&#96;&#96;java<br>j2cache:<br>  config-location: j2cache.properties<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">在resource下写一个`j2cache.properties`</span><br><span class="line"></span><br><span class="line">在j2cache的核心包里有所有的配置，因为是整合ehcache和redis 所以配置文件就这样写</span><br><span class="line"></span><br><span class="line">j2cache</span><br><span class="line"></span><br><span class="line">```properties</span><br><span class="line">#1级级存</span><br><span class="line">j2cache.L1.provider_class=ehcache</span><br><span class="line">ehcache.configxml=ehcache.xml</span><br><span class="line"></span><br><span class="line">#2级缓存</span><br><span class="line">j2cache.L2.provider_class=net.oschina.j2cache.cache.support.redis.SpringRedisProvider</span><br><span class="line">j2cache.L2.config_section=redis</span><br><span class="line"></span><br><span class="line">redis.hosts=localhost:6379</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#1级缓存中的数据如何到达2级锾存</span><br><span class="line">j2cache.broadcast=net.oschina.j2cache.cache.support.redis.SpringRedisPubSubPolicy</span><br></pre></td></tr></table></figure></li>
</ul>
<p>使用j2cache</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> CacheChannel cacheChannel;</span><br><span class="line"><span class="comment">//注入一个cacheChannel</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sendCodeToSMS</span><span class="params">(String tele)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> codeUtils.generatorCode(tele);</span><br><span class="line">        cacheChannel.set(<span class="string">&quot;code&quot;</span>,tele,code);</span><br><span class="line">        <span class="comment">//放入缓存</span></span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkCode</span><span class="params">(SMSCode smsCode)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cacheCode</span> <span class="operator">=</span> cacheChannel.get(<span class="string">&quot;code&quot;</span>, smsCode.getTele()).asString();</span><br><span class="line">        <span class="comment">//从缓存中取出</span></span><br><span class="line">        <span class="keyword">return</span> smsCode.getCode().equals(cacheCode);</span><br><span class="line">    &#125; 	</span><br></pre></td></tr></table></figure>

<h2 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h2><p>定时任务是企业级应用中的常见操作</p>
<p>◆年度报表	</p>
<p>◆缓存统计报告</p>
<p>◆….</p>
<p>市面上流行的定时任务技术<br>◆Quartz</p>
<p>◆Spring Task</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Timer</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Timer</span>();</span><br><span class="line">    <span class="type">TimerTask</span> <span class="variable">task</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TimerTask</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;timer run...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//每过两秒就执行run方法</span></span><br><span class="line">    t.schedule(task,<span class="number">0</span>,<span class="number">2000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-8、SpringBoot整合Quartz"><a href="#5-8、SpringBoot整合Quartz" class="headerlink" title="5.8、SpringBoot整合Quartz"></a>5.8、SpringBoot整合Quartz</h3><p><strong>概念</strong>:</p>
<ul>
<li><p>工作(Job):用于定义具体执行的工作</p>
</li>
<li><p>工作明细(JobDetail):用于描述定时工作相关的信息</p>
</li>
<li><p>触发器（Trigger):用于描述触发工作的规则，通常使用cron表达式定义调度规则调度器( Scheduler):描述了工作明细与触发器的对应关系</p>
</li>
</ul>
<p>步骤：</p>
<p>1、导坐标</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、创建具体执行的工作</p>
<p>创建一个类来表示你的具体工作，该类要继承<code>QuartzJobBean</code>类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Myquartz</span> <span class="keyword">extends</span> <span class="title class_">QuartzJobBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//工作的上下文对象</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">executeInternal</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;run quartz ....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后写配置</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220510005406698.png" alt="image-20220510005406698"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//定义成一个配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Quartz</span> &#123;</span><br><span class="line">    <span class="comment">//工作明细</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> JobDetail <span class="title function_">printJobDetail</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//storeDurably这里是表示是持久化你的工作</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="type">JobDetail</span> <span class="variable">detail</span> <span class="operator">=</span> JobBuilder.newJob(Myquartz.class).storeDurably().build();</span><br><span class="line">        <span class="keyword">return</span> detail;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//触发器</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Trigger <span class="title function_">printJobTrigger</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//second minute hour 日期 月份 星期 这里是每5秒执行一次</span></span><br><span class="line">        <span class="type">ScheduleBuilder</span> <span class="variable">scheduleBuilder</span> <span class="operator">=</span> CronScheduleBuilder.cronSchedule(<span class="string">&quot;0/5 * * * * ?&quot;</span>);</span><br><span class="line">        <span class="type">Trigger</span> <span class="variable">trigger</span> <span class="operator">=</span> TriggerBuilder.newTrigger().withSchedule(scheduleBuilder).forJob(printJobDetail()).build();</span><br><span class="line">        <span class="comment">//绑定对应的工作明细</span></span><br><span class="line">        <span class="keyword">return</span> trigger;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就行了</p>
<h3 id="5-9、springboot整合Task"><a href="#5-9、springboot整合Task" class="headerlink" title="5.9、springboot整合Task"></a>5.9、springboot整合Task</h3><p>开启定时任务的开关</p>
<p><strong><code>@EnableScheduling</code></strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="comment">//开启定时任务的开关</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application17Task</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		SpringApplication.run(Application17Task.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建一个类代表你的任务</p>
<p>该类要定义成一个bean   用<code>@Component</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTask</span> &#123;</span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/1 * * * * ?&quot;)</span><span class="comment">//每秒执行一次</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyTask run ...&quot;</span>+ LocalTime.now());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后加上 **<code>@Scheduled(cron = &quot;0/1 * * * * ?&quot;)</code>**就代表你要执行这个定时任务</p>
<ul>
<li><p>cron表达式：</p>
<p>cron表达式是一个字符串,该字符串由6个空格分为7个域，每一个域代表一个时间含义。通常定义“年”的部分可以省略，实际常用的由前六部分组成其实我们还可以借助于一些可视化的工具来生成cron表达式，但是如果我们同样需要能够看得懂别人写的表达式。”</p>
</li>
</ul>
<p>每五分钟执行一次：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span> <span class="number">0</span>/<span class="number">5</span> * * * ?</span><br></pre></td></tr></table></figure>

<p>每小时执行一次：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">0</span>/<span class="number">1</span> * * ?</span><br></pre></td></tr></table></figure>

<p>每天的7：30执行一次：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span> <span class="number">30</span> <span class="number">7</span> * * ?</span><br></pre></td></tr></table></figure>

<p>工作日的早上6点30分（即是周一到周五，每天早上的6点30分）：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span> <span class="number">30</span> <span class="number">7</span> ? * MON-FRI</span><br></pre></td></tr></table></figure>

<p>每个月的最后一天早上的10点整</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">10</span> L * ?</span><br></pre></td></tr></table></figure>

<p>….</p>
<h2 id="邮件"><a href="#邮件" class="headerlink" title="邮件"></a>邮件</h2><p>1、SMTP (Simple Mail Transfer Protocol)∶简单邮件传输协议，用于发送电子邮件的传输协议</p>
<p>2、POP3 ( Post Office Protocol - Version 3):用于接收电子邮件的标准协议</p>
<p>3、IMAP ( Internet Mail Access Protocol):互联网消息协议，是POP3的替代协议</p>
<h3 id="5-10、Springboot整合JavaMail"><a href="#5-10、Springboot整合JavaMail" class="headerlink" title="5.10、Springboot整合JavaMail"></a>5.10、Springboot整合JavaMail</h3><ul>
<li>导坐标</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>做配置</li>
</ul>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220511133315830.png" alt="image-20220511133315830"></p>
<p>这里的password不是登录密码，而是网页生成的授权码</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220511131846130.png" alt="image-20220511131846130"></p>
<p>写代码：</p>
<p>直接用JavaMailSender对象就可以来发邮件</p>
<h4 id="发送普通的邮箱"><a href="#发送普通的邮箱" class="headerlink" title="发送普通的邮箱"></a>发送普通的邮箱</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendMailServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SendMailService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JavaMailSender javaMailSender;</span><br><span class="line"><span class="comment">//    发件人用括号括起来的就说明在接受邮箱的时候可以显示你括号里的内容</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">from</span> <span class="operator">=</span> <span class="string">&quot;xxx@qq.com(小甜甜)&quot;</span>;</span><br><span class="line">    <span class="comment">//收件人</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">to</span>  <span class="operator">=</span> <span class="string">&quot;xxx@163.com&quot;</span>;</span><br><span class="line"><span class="comment">//    标题</span></span><br><span class="line">    String title=<span class="string">&quot;测试邮件&quot;</span>;</span><br><span class="line"><span class="comment">//    正文</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">text</span>  <span class="operator">=</span> <span class="string">&quot;这是测试邮件的正文&quot;</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendEmail</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SimpleMailMessage</span> <span class="variable">simpleMailMessage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleMailMessage</span>();</span><br><span class="line">        simpleMailMessage.setFrom(from);</span><br><span class="line">        simpleMailMessage.setTo(to);</span><br><span class="line">        simpleMailMessage.setText(text);</span><br><span class="line">        simpleMailMessage.setSubject(title);</span><br><span class="line">        javaMailSender.send(simpleMailMessage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220511133609458.png" alt="image-20220511133609458"></p>
<h4 id="发送带附件的邮箱"><a href="#发送带附件的邮箱" class="headerlink" title="发送带附件的邮箱"></a>发送带附件的邮箱</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这个发送邮件可以发送附件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendEmailPlus</span><span class="params">()</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;发送带邮件开始：&#123;&#125;,&#123;&#125;,&#123;&#125;&quot;</span>, to, from, title);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">MimeMessage</span> <span class="variable">mimeMessage</span> <span class="operator">=</span> javaMailSender.createMimeMessage();</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="type">MimeMessageHelper</span> <span class="variable">helper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MimeMessageHelper</span>(mimeMessage,<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//上传附件就要将multipart设置为true</span></span><br><span class="line">        helper.setFrom(from);</span><br><span class="line">        helper.setTo(to);</span><br><span class="line">        helper.setSubject(title);</span><br><span class="line">        helper.setText(text,<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//将html设置为true就可以解析正文中的html内容</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">f1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\software-rar\\清理软件.zip&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">f2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\python\\result\\jpg_from_wallhaven\\dpqjqg.jpg&quot;</span>);</span><br><span class="line">        helper.addAttachment(f1.getName(),f1);</span><br><span class="line">        helper.addAttachment(f2.getName(),f2);</span><br><span class="line">        javaMailSender.send(mimeMessage);</span><br><span class="line">        log.info(<span class="string">&quot;发送带附件邮件成功&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;发送带附件邮件失败&quot;</span>);</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220511141734575.png" alt="image-20220511141734575"></p>
<h2 id="消息"><a href="#消息" class="headerlink" title="消息"></a>消息</h2><p>企业级应用中广泛使用的三种异步消息传递技术</p>
<ul>
<li><p>JMS</p>
<ul>
<li>JMS(Java Message Service)∶一个规范，等同于JDBC规范，提供了与消息服务相关的API接口</li>
<li>.JMS消息模型<ul>
<li>peer-2-peer:点对点模型，消息发送到一个队列中，队列保存消息。队列的消息只能被一个消费者消费，或超时</li>
<li>publish-subscribe: 发布订阅模型，消息可以被多个消费者消费，生产者和消费者完全独立，不需要感知对方的存在</li>
</ul>
</li>
<li>JMS中的消息种类<ul>
<li>TextMessage</li>
<li>MapMessage</li>
<li>BytesMessage</li>
<li>StreamMessage</li>
<li>objectMessalge</li>
<li>Message(只有消息头和属性)</li>
</ul>
</li>
<li>JMS实现<ul>
<li>ActiveMQ、Redis、HornetMQ、RabbitMQ、RocketMQ（没有完全遵守JMS规范)</li>
</ul>
</li>
</ul>
</li>
<li><p>AMQP</p>
<ul>
<li>AMQP ( advanced message queuing protocol):一种协议（高级消息队列协议，也是消息代理规范），规范了网络交换的数据格式，兼容JMS</li>
<li>优点:具有跨平台性，服务器供应商，生产者，消费者可以使用不同的语言来实现</li>
<li>AMQP消息模型<ul>
<li><strong>direct exchange</strong></li>
<li>fanout exchange</li>
<li><strong>topic exchange</strong></li>
<li>headers exchange</li>
<li>system exchange</li>
</ul>
</li>
<li>AMQP消息种类:<strong>byte[]</strong></li>
<li>AMQP实现:RabbitMQ、StormMQ、<strong>RocketMQ</strong></li>
</ul>
</li>
<li><p>MQTT(了解)</p>
<p>MQTT(Message Queueing Telemetry Transport)消息队列遥测传输，专为小设备设计，是物联网（IOT）生态系统中主要成分之一<br>公</p>
</li>
<li><p>Kafka<br>Kafka，一种高吞吐量的分布式发布订阅消息系统，提供实时消息功能。</p>
</li>
</ul>
<h3 id="小案例：短信通知"><a href="#小案例：短信通知" class="headerlink" title="小案例：短信通知"></a>小案例：短信通知</h3><p>场景是：用户下单后处理玩订单后要发短信通知用户</p>
<p>订单Service</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MessageService messageService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">order</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="comment">//一系列的操作包换各种业务的调用</span></span><br><span class="line">        System.out.println(<span class="string">&quot;订单处理开始！&quot;</span>);</span><br><span class="line">        <span class="comment">//发短信的操作</span></span><br><span class="line">        messageService.sendMessage(id);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;订单处理结束！&quot;</span>);</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>消息service</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">MessageService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;待发送的短信订单已经纳入队列！&quot;</span>+id);</span><br><span class="line">        list.add(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从消息队列中取出来</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> list.remove(<span class="number">0</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;已发送短信的业务&quot;</span>+id);</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>订单controller</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/orders&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">order</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span>&#123;</span><br><span class="line">        orderService.order(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>消息controller</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/msgs&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MessageService messageService;</span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> messageService.doMessage();</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>每完成一次订单后就会有一个待发送的短信进入队列，这时需要调用短信的业务层。</p>
<h3 id="activeMQ"><a href="#activeMQ" class="headerlink" title="activeMQ:"></a>activeMQ:</h3><p>下载地址:<a target="_blank" rel="noopener" href="https://activemq.apache.org/components/classic/download/">https://activemq.apache.org/components/classic/download/</a> </p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220512010652130.png" alt="image-20220512010652130"></p>
<p><strong>高版本的需要jdk11，下5.16.5只需要jkd8</strong></p>
<p>解压缩到bin里找到win64或者win32执行批处理文件就可以启动服务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">activemq.bat</span><br></pre></td></tr></table></figure>

<p>访问服务器</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1:8161</span><br></pre></td></tr></table></figure>

<p>服务端口：61616 后台端口：8161</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:8161/">http://127.0.0.1:8161</a></p>
<p>后台的用户名和密码：admin</p>
<h3 id="5-11、SpringBoot整合activeamq"><a href="#5-11、SpringBoot整合activeamq" class="headerlink" title="5.11、SpringBoot整合activeamq"></a>5.11、SpringBoot整合activeamq</h3><ul>
<li>导坐标</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-activemq<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>做配置</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">activemq:</span></span><br><span class="line">    <span class="comment">#ip端口</span></span><br><span class="line">    <span class="attr">broker-url:</span> <span class="string">tcp://localhost:61616</span></span><br><span class="line">  <span class="attr">jms:</span></span><br><span class="line">    <span class="attr">template:</span></span><br><span class="line">      <span class="attr">default-destination:</span> <span class="string">dhj</span></span><br></pre></td></tr></table></figure>

<ul>
<li>操作API</li>
</ul>
<p>使用<code>JmsTemplate或者JmsMessagingTemplate</code>对象</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageServiceActiveMqImpl</span> <span class="keyword">implements</span> <span class="title class_">MessageService</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line"><span class="comment">//    private JmsTemplate jmsTemplate;</span></span><br><span class="line">    <span class="keyword">private</span> JmsMessagingTemplate jmsTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;待发送的短信订单已经纳入队列！&quot;</span>+id);</span><br><span class="line">        <span class="comment">//将这个id放入消息队列</span></span><br><span class="line"><span class="comment">//        jmsTemplate.convertAndSend(id);</span></span><br><span class="line">        <span class="comment">//前面带一个参数就是指定他的位置</span></span><br><span class="line">        jmsTemplate.convertAndSend(<span class="string">&quot;order.quque.id&quot;</span>,id);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从消息队列中取出来</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doMessage</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//        String  id = (String) jmsTemplate.receiveAndConvert(String.class);</span></span><br><span class="line">        <span class="comment">//前面带一个参数就是指定他的位置，从这个位置取出来</span></span><br><span class="line">        <span class="type">String</span>  <span class="variable">id</span> <span class="operator">=</span> (String) jmsTemplate.receiveAndConvert(<span class="string">&quot;order.quque.id&quot;</span>,String.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;已发送短信的业务&quot;</span>+id);</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>监听器：</p>
<p>上面的操作，每有一个消息进入消息队列的时候我们需要手动处理，activemq给了我们一个listener监听这我们的消息，有消息的时候就会调用</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageListener</span> &#123;</span><br><span class="line">    <span class="meta">@JmsListener(destination = &quot;order.quque.id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String id)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;已发送短信的业务&quot;</span>+id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就不需要手动调用了</p>
<h3 id="5-12、SpringBoot整合RabbitMq"><a href="#5-12、SpringBoot整合RabbitMq" class="headerlink" title="5.12、SpringBoot整合RabbitMq"></a>5.12、SpringBoot整合RabbitMq</h3><p>RabbitMQ</p>
<ul>
<li>RabbitMQ基于Erlang语言编写，需要安装Erlang</li>
<li>Erlang<ul>
<li>下载地址: <a target="_blank" rel="noopener" href="https://www.erlang.org/downloads">https://www.erlang.org/downloads</a></li>
<li>安装:一键傻瓜式安装，安装完毕需要重启，需要依赖Windows组件环境变量配置</li>
<li>ERLANG_HOME</li>
<li>PATH</li>
</ul>
</li>
<li>RabbitMq<ul>
<li>下载地址：<a target="_blank" rel="noopener" href="https://www.rabbitmq.com/download.html">https://www.rabbitmq.com/download.html</a></li>
</ul>
</li>
</ul>
<p>​		下载完毕后：在sbin目录下打开cmd窗口</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220512142342558.png" alt="image-20220512142342558"></p>
<p>启动服务：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rabbitmq-service.bat start</span><br></pre></td></tr></table></figure>

<p>关闭服务：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rabbitmq-service.bat stop</span><br></pre></td></tr></table></figure>

<p>开启一个后台界面 端口<code>15672</code>  </p>
<p>账号密码：guest</p>
<ul>
<li>先开启一个后台管理界面的插件</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rabbitmq-plugins.bat <span class="built_in">enable</span> rabbitmq_management</span><br></pre></td></tr></table></figure>

<p>查看服务状态</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rabbitmqctl status</span><br></pre></td></tr></table></figure>

<p>后台界面：<a target="_blank" rel="noopener" href="http://localhost:15672/">http://localhost:15672</a></p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220512142657408.png" alt="image-20220512142657408"></p>
<ul>
<li>导坐标</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>做配置</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br></pre></td></tr></table></figure>

<ul>
<li>代码</li>
</ul>
<p>定义消息队列：直连模式</p>
<h4 id="直连模式"><a href="#直连模式" class="headerlink" title="直连模式"></a>直连模式</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitDirectConfig</span> &#123;</span><br><span class="line"><span class="comment">//    定义一个存储消息的对象</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">getQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//名字,是否持久化，是否专用，是否删除</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;direct_queue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">//交换机</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">getExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(<span class="string">&quot;direct_exchange&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">//队列绑定交换机</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(getQueue()).to(getExchange()).with(<span class="string">&quot;direct&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>生产与消费信息 使用**<code>amqpTemplate对象</code>**可以直接<code>Autowired</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageServiceRabbitMqImpl</span> <span class="keyword">implements</span> <span class="title class_">MessageService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AmqpTemplate amqpTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;待发送短信的订单已经纳入处理队列 ===&gt;rabbitmq_direct id: &quot;</span> + id);</span><br><span class="line">        <span class="comment">//交换机的名称，绑定的名称，发送的信息</span></span><br><span class="line">        amqpTemplate.convertAndSend(<span class="string">&quot;direct_exchange&quot;</span>,<span class="string">&quot;direct&quot;</span>,id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>监听器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageListenerRabbitMq</span> &#123;</span><br><span class="line">    <span class="comment">//队列的名字</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;direct_queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;已发送短信的业务(rabbitmq quque direct)id: &quot;</span> + id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="topic模式"><a href="#topic模式" class="headerlink" title="topic模式"></a>topic模式</h4><p>配置：定义消息队列</p>
<p>绑定键匹配规则</p>
<ul>
<li><p>*(星号):用来表示一个单词，且该单词是必须出现的</p>
</li>
<li><p>#(井号):用来表示任意数量</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitTopicConfig</span> &#123;</span><br><span class="line"><span class="comment">//    定义一个存储消息的对象</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">getQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//名字,是否持久化，是否专用，是否删除</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;topic_queue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">//交换机</span></span><br><span class="line">    <span class="keyword">public</span> TopicExchange <span class="title function_">getExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TopicExchange</span>(<span class="string">&quot;topic_exchange&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">//队列绑定交换机</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(getQueue()).to(getExchange()).with(<span class="string">&quot;topic.*.id&quot;</span>);</span><br><span class="line">        <span class="comment">//这里的with可以取别名</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>监听器：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageListenerRabbitMq</span> &#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;topic_queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;已发送短信的业务(rabbitmq quque topic)id: &quot;</span> + id);</span><br><span class="line">        System.out.println(<span class="string">&quot;=================================&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageServiceRabbitMqImpl</span> <span class="keyword">implements</span> <span class="title class_">MessageService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AmqpTemplate amqpTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;待发送短信的订单已经纳入处理队列 ===&gt;rabbitmq_topic id: &quot;</span> + id);</span><br><span class="line">        amqpTemplate.convertAndSend(<span class="string">&quot;topic_exchange&quot;</span>,<span class="string">&quot;topic.order.id&quot;</span>,id);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-13、SpringBoot整合RocketMQ"><a href="#5-13、SpringBoot整合RocketMQ" class="headerlink" title="5.13、SpringBoot整合RocketMQ"></a>5.13、SpringBoot整合RocketMQ</h3><p>下载地址:<a target="_blank" rel="noopener" href="https://rocketmq.apache.org/">https://rocketmq.apache.org</a></p>
<p>安装:解压缩</p>
<p>默认服务端口:9876</p>
<p>环境变量配置:</p>
<ul>
<li><strong>PATH</strong></li>
<li><strong>NAMESRV_ADDR</strong>（建议): 127.0.0.1:9876</li>
<li><strong>ROCKETMQ_HOME</strong></li>
</ul>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220513144359716.png" alt="image-20220513144359716"></p>
<p>先启动命名服务器：</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220513144628714.png" alt="image-20220513144628714"></p>
<p>再启动业务服务器</p>
<p><code>mqbroker.cmd</code></p>
<p>测试是否能正常运行</p>
<p>在lib下有一个专门测试的jar包<code>rocketmq-example-4.9.3.jar</code></p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220513145128980.png" alt="image-20220513145128980"></p>
<p>如何运行，用bin下的tools. 生产一千条消息</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">D:\mysoftware\rocketmq-4.9.3\bin&gt;tools org.apache.rocketmq.example.quickstart.Producer</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220513150029316.png" alt="image-20220513150029316"></p>
<p>消费一些消息</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">D:\mysoftware\rocketmq-4.9.3\bin&gt;tools org.apache.rocketmq.example.quickstart.Consumer</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220513150058438.png" alt="image-20220513150058438"></p>
<ul>
<li>导坐标</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.rocketmq/rocketmq-spring-boot-starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.rocketmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rocketmq-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#rocketmq的配置</span></span><br><span class="line"><span class="attr">rocketmq:</span></span><br><span class="line">  <span class="attr">name-server:</span> <span class="string">localhost:9876</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  生产者的分组</span></span><br><span class="line">  <span class="attr">producer:</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">group_dhj</span></span><br></pre></td></tr></table></figure>

<p>代码：</p>
<p>主要是注入一个<code>RocketMQTemplate</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageRocketMqServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">MessageService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RocketMQTemplate rocketMQTemplate;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;待发送的短信订单已经纳入队列(rocketMq)！&quot;</span>+id);</span><br><span class="line"><span class="comment">//        rocketMQTemplate.convertAndSend(&quot;order_id&quot;,id);</span></span><br><span class="line">        <span class="type">SendCallback</span> <span class="variable">sendCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSuccess</span><span class="params">(SendResult sendResult)</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;消息发送成功===&gt;&quot;</span>+sendResult.toString());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onException</span><span class="params">(Throwable throwable)</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;消息发送失败！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//异步的方式来发送消息</span></span><br><span class="line">        rocketMQTemplate.asyncSend(<span class="string">&quot;order_id&quot;</span>,id,sendCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>监听：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RocketMQMessageListener(topic = &quot;order_id&quot;,consumerGroup = &quot;group_dhj&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RocketMqListener</span> <span class="keyword">implements</span> <span class="title class_">RocketMQListener</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;已发送短信的业务(RocketMq)&quot;</span> + id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-14、SpringBoot整合Kafka"><a href="#5-14、SpringBoot整合Kafka" class="headerlink" title="5.14、SpringBoot整合Kafka"></a>5.14、SpringBoot整合Kafka</h3><p>Kafka</p>
<p>文档：<a target="_blank" rel="noopener" href="https://kafka.apachecn.org/">Kafka 中文文档 - ApacheCN</a></p>
<p>下载地址:<a target="_blank" rel="noopener" href="https://kafka.apache.org/downloads">https://kafka.apache.org/downloads</a></p>
<p>国内的镜像源：<a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/apache/kafka/2.8.1/">Index of &#x2F;apache&#x2F;kafka&#x2F;2.8.1 (tsinghua.edu.cn)</a></p>
<p>windows系统下3.0.0版本存在BUG，建议使用2.X版本</p>
<ul>
<li><p>启动kafka服务器</p>
</li>
<li><p>先启动注册中心</p>
</li>
</ul>
<p>端口：2181</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">D:\mysoftware\kafka_2.12-2.8.1\bin\windows&gt;zookeeper-server-start.bat ../../config/zookeeper.properties</span><br></pre></td></tr></table></figure>

<ul>
<li>在启动服务</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">D:\mysoftware\kafka_2.12-2.8.1\bin\windows&gt;kafka-server-start.bat ../../config/server.properties</span><br></pre></td></tr></table></figure>

<p>端口：9092</p>
<p>测试：</p>
<p>创建一个topic</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kafka-topics.bat --zookeeper localhost:2181 --create --replication-factor 1 --partitions 1 --topic dhj_topic</span><br></pre></td></tr></table></figure>

<p>查看topic分区</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kafka-topics.bat --zookeeper localhost:2181 --list</span><br></pre></td></tr></table></figure>

<p>删除topic</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kafka-topics.bat --delete --zookeeper localhost:2181 --topic dhj_topic</span><br></pre></td></tr></table></figure>

<p>Kafka</p>
<ul>
<li><p>生产者功能测试</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kafka-console-producer.bat --broker-list localhost:9092 --topic dhj_topic</span><br></pre></td></tr></table></figure>
</li>
<li><p>消费者功能测测试</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kafka-console-consumer.bat --bootstrap-server localhost:9092 --topic dhj_topic --from-beginning</span><br></pre></td></tr></table></figure></li>
</ul>
<p>导坐标</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--       kafka--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>做配置</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#kafka</span></span><br><span class="line"><span class="attr">kafka:</span></span><br><span class="line">  <span class="attr">bootstrap-servers:</span> <span class="string">localhost:9092</span></span><br><span class="line">  <span class="attr">consumer:</span></span><br><span class="line">    <span class="attr">group-id:</span> <span class="string">order</span></span><br></pre></td></tr></table></figure>

<p>service实现类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageServiceKafkaImpl</span> <span class="keyword">implements</span> <span class="title class_">MessageService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> KafkaTemplate&lt;String,String&gt; kafkaTemplate;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;待发送的短信订单已经纳入队列！(kafka)&quot;</span>+id);</span><br><span class="line">        kafkaTemplate.send(<span class="string">&quot;dhj_topic&quot;</span>,id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>监听器：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageListener</span> &#123;</span><br><span class="line">    <span class="meta">@KafkaListener(topics = &quot;dhj_topic&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doMessage</span><span class="params">(ConsumerRecord&lt;String,String&gt; record)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;已发送短信的业务(kafka)&quot;</span>+record.value());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h2><p>监控的实施方式</p>
<ul>
<li>显示监控信息的服务器︰用于获取服务信息，并显示对应的信息</li>
<li>运行的服务:启动时主动上报，告知监控服务器自己需要受到监控</li>
</ul>
<h3 id="5-15、可视化监控平台"><a href="#5-15、可视化监控平台" class="headerlink" title="5.15、可视化监控平台"></a>5.15、可视化监控平台</h3><p>Spring Boot Admin，开源社区项目，用于管理和监控SpringBoot应用程序。客户端注册到服务端后，通过HTTP请求方式，服务端定期从客户端获取对应的信息，并通过UI界面展示对应信息。</p>
<ul>
<li>导坐标</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-starter-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 这个版本要和你的springboot的版本对应--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>开启  用 <code>@EnableAdminServer</code>注解开启服务</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableAdminServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application20Server</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		SpringApplication.run(Application20Server.class, args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>创建一个被监控的应用</p>
<ul>
<li>导依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-starter-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 这个版本要和你的springboot的版本对应--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ul>
<li>配置</li>
</ul>
</li>
</ul>
<p>​	<img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220515160620619.png" alt="image-20220515160620619"></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">boot:</span></span><br><span class="line">    <span class="attr">admin:</span></span><br><span class="line">      <span class="attr">client:</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">http://localhost:8080</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="attr">health:</span></span><br><span class="line">      <span class="attr">show-details:</span> <span class="string">always</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="自定义端点信息"><a href="#自定义端点信息" class="headerlink" title="自定义端点信息"></a>自定义端点信息</h3><p>在客户端创建一个类实现<code>InfoContributor</code>将该类变为一个bean<code>@component</code>让springboot加载到，同时在配置文件中添加一个info开启</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220521145257619.png" alt="image-20220521145257619"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Config</span> <span class="keyword">implements</span> <span class="title class_">InfoContributor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contribute</span><span class="params">(Info.Builder builder)</span> &#123;</span><br><span class="line">        builder.withDetail(<span class="string">&quot;nowTime&quot;</span>, LocalTime.now());</span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;buildTime&quot;</span>,<span class="string">&quot;2022&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;company&quot;</span>,<span class="string">&quot;Null&quot;</span>);</span><br><span class="line">        builder.withDetails(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>让后在web端就可以看到了！</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220521145337771.png" alt="image-20220521145337771"></p>
<h4 id="健康类的信息"><a href="#健康类的信息" class="headerlink" title="健康类的信息"></a>健康类的信息</h4><p>可以继承<code>AbstractHealthIndicator</code>类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HealthConfig</span> <span class="keyword">extends</span> <span class="title class_">AbstractHealthIndicator</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doHealthCheck</span><span class="params">(Health.Builder builder)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="性能的信息meterRegist"><a href="#性能的信息meterRegist" class="headerlink" title="性能的信息meterRegist"></a>性能的信息meterRegist</h4><p>假设执行一次删除就是付款操作 我们要监控这个付款操作</p>
<p>在构造方法中注入一个meterRegist  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Counter counter;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">BookController</span><span class="params">(MeterRegistry registry)</span>&#123;</span><br><span class="line">    counter = registry.counter(<span class="string">&quot;用户付费次数&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@DeleteMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">deleteByid</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">        counter.increment();<span class="comment">//自增</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(service.removeById(id));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>当然这个时业务层应当写在业务层</p>
<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220521151904450.png" alt="image-20220521151904450"></p>
<h4 id="自定义的端点"><a href="#自定义的端点" class="headerlink" title="自定义的端点"></a>自定义的端点</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Endpoint(id = &quot;pay&quot;,enableByDefault = true)</span><span class="comment">//到时候就访问这个端点http://localhost:81/actuator/pay</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayEndPoint</span> &#123;</span><br><span class="line">    <span class="meta">@ReadOperation</span><span class="comment">//到时候就访问这个端点http://localhost:81/actuator/pay就会运行这个方法返回这个值</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">pay</span><span class="params">()</span>&#123;</span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;level1&quot;</span>,<span class="number">100</span>);</span><br><span class="line">        map.put(<span class="string">&quot;level2&quot;</span>,<span class="number">1001</span>);</span><br><span class="line">        map.put(<span class="string">&quot;level3&quot;</span>,<span class="number">1003</span>);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">        <span class="comment">//map可以被转成json数据</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220521153001044.png" alt="image-20220521153001044"></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">DaiHaojun</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://daihaojun554.github.io/2022/04/29/SpringBoot开发实用篇/">http://daihaojun554.github.io/2022/04/29/SpringBoot开发实用篇/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringBoot/">SpringBoot</a><a class="post-meta__tags" href="/tags/%E5%BC%80%E5%8F%91%E4%BD%BF%E7%94%A8%E7%AF%87/">开发使用篇</a><a class="post-meta__tags" href="/tags/%E6%95%B4%E5%90%88%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8A%80%E6%9C%AF/">整合第三方技术</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2022/04/29/Nacos/"><i class="fa fa-chevron-left">  </i><span>Nacos</span></a></div><div class="next-post pull-right"><a href="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/"><span>springboot运维篇</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2022 By DaiHaojun</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://daihaojun.top">blog</a>!</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://lib.baomitu.com/animejs/latest/anime.min.js"></script><script src="https://lib.baomitu.com/jquery/latest/jquery.min.js"></script><script src="https://lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script src="https://lib.baomitu.com/velocity/latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" data-click="false"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>