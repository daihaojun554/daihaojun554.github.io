<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>myblog</title>
  
  <subtitle>学习之旅</subtitle>
  <link href="http://daihaojun554.github.io/atom.xml" rel="self"/>
  
  <link href="http://daihaojun554.github.io/"/>
  <updated>2022-09-21T11:21:53.387Z</updated>
  <id>http://daihaojun554.github.io/</id>
  
  <author>
    <name>DaiHaojun</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>多线程</title>
    <link href="http://daihaojun554.github.io/2022/09/22/%E7%BA%BF%E7%A8%8B/"/>
    <id>http://daihaojun554.github.io/2022/09/22/%E7%BA%BF%E7%A8%8B/</id>
    <published>2022-09-21T23:39:33.000Z</published>
    <updated>2022-09-21T11:21:53.387Z</updated>
    
    <content type="html"><![CDATA[<h1 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class ThreadTest &#123;</span><br><span class="line">    //        当前系统中只有固定的线程池数量所以是一个静态变量</span><br><span class="line">    public static ExecutorService executorService = Executors.newFixedThreadPool(10);</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        /*</span><br><span class="line">         *1) 、继承Thread</span><br><span class="line">         *   Thread01 thread01 = new Thread01();</span><br><span class="line">             thread01.start();//启动线程</span><br><span class="line">         *2)、实现Runnable接口</span><br><span class="line">         *         Runnable01 runnable01 = new Runnable01();</span><br><span class="line">                   new Thread(runnable01).start();</span><br><span class="line">         *3)、实现callable接口+ FutureTask(可以拿到返回结果，可以处理异常) 、</span><br><span class="line">                 FutureTask&lt;Integer&gt; integerFutureTask = new FutureTask&lt;&gt;(new Callable01());</span><br><span class="line">                 new Thread(integerFutureTask).start();</span><br><span class="line">                //等待线程完成之后获取返回结果</span><br><span class="line">                Integer integer = integerFutureTask.get();</span><br><span class="line">         *4）、线程池 给线程池提交任务</span><br><span class="line">         *</span><br><span class="line">         *      executorService.execute(new Runnable01());</span><br><span class="line">         *      executorService.submit(new Runnable01());</span><br><span class="line">         *  创建线程池：</span><br><span class="line">         *      1.new ThreadPoolExecutor();</span><br><span class="line">         *      2。Executors.newFixedThreadPool(10)</span><br><span class="line">         *</span><br><span class="line">         *   区别：1,2不能得到返回值，3，4可以获取到返回值</span><br><span class="line">         *        1，2，3都不能得到资源控制</span><br><span class="line">         *        4，可以得到资源控制，系统稳定。</span><br><span class="line">         *</span><br><span class="line"></span><br><span class="line">         */</span><br><span class="line">        System.out.println(&quot;main-------------&gt;&gt;&gt;&gt;&gt;&gt;...start====&gt;&quot; + Thread.currentThread().getName());</span><br><span class="line">  /*      Thread01 thread01 = new Thread01();</span><br><span class="line">        thread01.start();//启动线程</span><br><span class="line">        Thread.sleep(3000);</span><br><span class="line">        System.out.println(&quot;main-------------&gt;&gt;&gt;&gt;&gt;&gt;...end====&gt;&quot;+Thread.currentThread().getName());*/</span><br><span class="line">//===========================2实现runnable接口实现里面的run方法==========================</span><br><span class="line">/*        Runnable01 runnable01 = new Runnable01();</span><br><span class="line">        new Thread(runnable01).start();*/</span><br><span class="line">//        ==============================实现callable接口+ FutureTask(可以拿到返回结果，可以处理异常)*4)===============</span><br><span class="line">/*        System.out.println(&quot;main-------------&gt;&gt;&gt;&gt;&gt;&gt;...start====&gt;&quot;);</span><br><span class="line">        FutureTask&lt;Integer&gt; integerFutureTask = new FutureTask&lt;&gt;(new Callable01());</span><br><span class="line">        new Thread(integerFutureTask).start();</span><br><span class="line">        //等待线程完成之后获取返回结果</span><br><span class="line">        Integer integer = integerFutureTask.get();</span><br><span class="line">        System.out.println(&quot;main-------------&gt;&gt;&gt;&gt;&gt;&gt;...end====&gt;&quot;+integer);*/</span><br><span class="line">//        ==================线程池=======================给线程池直接提交任务</span><br><span class="line"></span><br><span class="line">//        new Thread(() -&gt; &#123; System.out.println(&quot;hello&quot;);&#125;).start(); 可能会导致 资源过多，导致系统崩溃</span><br><span class="line"></span><br><span class="line">//        所有的的异步任务都交给线程池</span><br><span class="line">        executorService.execute(new Runnable01());</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         *                               int corePoolSize</span><br><span class="line">         *                               int maximumPoolSize,</span><br><span class="line">         *                               long keepAliveTime,</span><br><span class="line">         *                               TimeUnit unit,</span><br><span class="line">         *                               BlockingQueue&lt;Runnable&gt; workQueue,</span><br><span class="line">         *                               ThreadFactory threadFactory,</span><br><span class="line">         *                               RejectedExecutionHandler handler</span><br><span class="line">         * 七大参数</span><br><span class="line">         *     1. corePoolSize【5】：核心线程数量 等待接收任务 new Thread(5) 一直存在 ，除非设置了 允许线程超时的时间</span><br><span class="line">         *      the number of threads to keep in the pool, even if they are idle, unless &#123;@code allowCoreThreadTimeOut&#125; is set</span><br><span class="line">         *     2. maximumPoolSize 最大线程数量，控制并发的</span><br><span class="line">         *     3.keepAliveTime 持续存活时间  当前正在运行的线程数量，大于我们的核心线程数量，这就是我们的最大时间，</span><br><span class="line">         *         它会释放空闲的线程(最大线程的大小-核心线程数量的大小)核心线程不释放</span><br><span class="line">         *     4.   TimeUnit unit, 时间单位</span><br><span class="line">         *     5.  workQueue 阻塞队列 如果任务有很多，将目前多的任务，放到队列里面，后面只要有空闲的线程，就会去队列中去取出新的任务去执行</span><br><span class="line">         *         the queue to use for holding tasks before they are</span><br><span class="line">         *             executed.  This queue will hold only the &#123;@code Runnable&#125;</span><br><span class="line">         *             tasks submitted by the &#123;@code execute&#125; method.</span><br><span class="line">         *     6.ThreadFactory threadFactory, 线程的创建工厂</span><br><span class="line">         *     7.handler 如果队列满了，就会指定的拒绝策略，执行任务</span><br><span class="line">         the handler to use when execution is blocked because the thread bounds and queue capacities are reached</span><br><span class="line">         执行的顺序：</span><br><span class="line">         1.先指定核心的线程池5，准备接受任务</span><br><span class="line">         2.core满了之后，在后面进来的任务就会进入阻塞队列，如果有空闲的core线程就会去执行阻塞队列中的任务</span><br><span class="line">         3.如果阻塞队列也满了的话，就会开启新的线程，但是开启的新的线程数量和core的总数量不能超过maxPoolSize</span><br><span class="line">         4.max满了的话就会执行拒绝策略</span><br><span class="line">         5，max没满的话，有很多空闲，就会在指定的keeplivetime里如果没有新的任务执行，就会释放，max-core这些线程</span><br><span class="line"></span><br><span class="line">         new LinkedBlockingDeque(20) 阻塞队列最大的容量</span><br><span class="line"></span><br><span class="line">         */</span><br><span class="line">        ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(5,</span><br><span class="line">                10,</span><br><span class="line">                10,</span><br><span class="line">                TimeUnit.SECONDS,</span><br><span class="line">                new LinkedBlockingDeque&lt;&gt;(10000),</span><br><span class="line">                Executors.defaultThreadFactory(),</span><br><span class="line">                new ThreadPoolExecutor.AbortPolicy());</span><br><span class="line">//        Executors.newCachedThreadPool(); //core 是0 所有的都可以回收</span><br><span class="line">//        Executors.newFixedThreadPool(10);// 指定固定线程数量 的线程池</span><br><span class="line">//        Executors.newScheduledThreadPool(10);//定时任务的线程池</span><br><span class="line">//        Executors.newSingleThreadExecutor(); //单线程的线程池，后台从单线程中获取任务，单个执行</span><br><span class="line">        System.out.println(&quot;main-------------&gt;&gt;&gt;&gt;&gt;&gt;...end====&gt;&quot; + Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static class Thread01 extends Thread &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line"></span><br><span class="line">            System.out.println(&quot;当前线程&quot; + Thread.currentThread().getId());</span><br><span class="line">            int i = 10 / 2;</span><br><span class="line">            System.out.println(&quot;i的值是&quot; + i + &quot;&lt;&lt;&lt;&lt;&lt;&lt;-------------&lt;&lt;&lt;&lt;&lt;&lt;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static class Runnable01 implements Runnable &#123;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            System.out.println(&quot;当前线程&quot; + Thread.currentThread().getId());</span><br><span class="line">            int i = 10 / 2;</span><br><span class="line">            System.out.println(&quot;i的值是&quot; + i + &quot;&lt;&lt;&lt;&lt;&lt;&lt;-------------&lt;&lt;&lt;&lt;&lt;&lt;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static class Callable01 implements Callable&lt;Integer&gt; &#123;</span><br><span class="line">        //        Callable&lt;Integer&gt; 线程返回值</span><br><span class="line">        @Override</span><br><span class="line">        public Integer call() throws Exception &#123;</span><br><span class="line">            System.out.println(&quot;当前线程&quot; + Thread.currentThread().getId());</span><br><span class="line">            int i = 10 / 2;</span><br><span class="line">            System.out.println(&quot;i的值是&quot; + i + &quot;&lt;&lt;&lt;&lt;&lt;&lt;-------------&lt;&lt;&lt;&lt;&lt;&lt;&quot;);</span><br><span class="line">            return i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;多线程&quot;&gt;&lt;a href=&quot;#多线程&quot; class=&quot;headerlink&quot; title=&quot;多线程&quot;&gt;&lt;/a&gt;多线程&lt;/h1&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;</summary>
      
    
    
    
    
    <category term="多线程" scheme="http://daihaojun554.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
    <category term="java" scheme="http://daihaojun554.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>缓存问题</title>
    <link href="http://daihaojun554.github.io/2022/09/10/%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98/"/>
    <id>http://daihaojun554.github.io/2022/09/10/%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98/</id>
    <published>2022-09-09T23:50:03.000Z</published>
    <updated>2022-09-11T04:40:31.850Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-高并发下缓存失效问题-缓存穿透"><a href="#1-高并发下缓存失效问题-缓存穿透" class="headerlink" title="1.高并发下缓存失效问题-缓存穿透"></a>1.高并发下缓存失效问题-缓存穿透</h1><p>（查询永不存在key）</p><p>高并发下缓存失效问题-缓存穿透</p><blockquote><p>指查询一个一定不存在的数据，由于缓存是不命中，将去查询数据库，但是数据库也无此记录，我们没有将这次查询的null写入缓存，这将导致这个不存在的数据每次请求都要到存储层去查询，失去了缓存的意义</p></blockquote><p>风险:</p><blockquote><p>利用不存在的数据进行攻击，数据库瞬时压力增大，最终导致崩溃</p></blockquote><p>解决:</p><blockquote><p>null结果缓存，并加入短暂过期时间</p></blockquote><h1 id="2-高并发下缓存失效问题-缓存雪崩"><a href="#2-高并发下缓存失效问题-缓存雪崩" class="headerlink" title="2.高并发下缓存失效问题-缓存雪崩"></a>2.高并发下缓存失效问题-缓存雪崩</h1><p>（大面积key同时失效）</p><p>缓存雪崩:</p><blockquote><p>缓存雪崩是指在我们设置缓存时key采用了相同的过期时间，导致缓存在某一时刻同时失效，请求全部转发到DB，DB瞬时压力过重雪崩</p></blockquote><blockquote><p>解决：</p></blockquote><p>   原有的失效时间基础上增加一个随机值，比如1-5分钟随机，这样每一个缓存的过期时间的重复率就会降低，就很难引发集体失效的事件。</p><h1 id="3-高并发下缓存失效问题-缓存击穿"><a href="#3-高并发下缓存失效问题-缓存击穿" class="headerlink" title="3.高并发下缓存失效问题-缓存击穿"></a>3.高并发下缓存失效问题-缓存击穿</h1><p>（访问同一个key，热点key）</p><blockquote><p>缓存击穿:</p></blockquote><p>​    对于一些设置了过期时间的key，如果这些key可能会在某些时间点被超高并发地访问，是一种非常“热点”的数据。<br>​    如果这个key在大量请求同时进来前正好失效，那么,所有对这个key的数据查询都落到db，我们称为缓存击穿。</p><blockquote><p>解决</p></blockquote><p>​     加锁, 大量并发只让一个去查，其他人等待，查到以后释放锁，其他人获取到锁，先查缓存，就会有数据，不用去db</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-高并发下缓存失效问题-缓存穿透&quot;&gt;&lt;a href=&quot;#1-高并发下缓存失效问题-缓存穿透&quot; class=&quot;headerlink&quot; title=&quot;1.高并发下缓存失效问题-缓存穿透&quot;&gt;&lt;/a&gt;1.高并发下缓存失效问题-缓存穿透&lt;/h1&gt;&lt;p&gt;（查询永不存在key</summary>
      
    
    
    
    
    <category term="redis" scheme="http://daihaojun554.github.io/tags/redis/"/>
    
    <category term="缓存问题" scheme="http://daihaojun554.github.io/tags/%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>Nginx教程</title>
    <link href="http://daihaojun554.github.io/2022/08/20/nginx%E6%95%99%E7%A8%8B%20_%20%E6%96%87%E6%A1%A3%E5%90%88%E9%9B%86/"/>
    <id>http://daihaojun554.github.io/2022/08/20/nginx%E6%95%99%E7%A8%8B%20_%20%E6%96%87%E6%A1%A3%E5%90%88%E9%9B%86/</id>
    <published>2022-08-19T21:52:12.000Z</published>
    <updated>2022-08-19T11:37:50.200Z</updated>
    
    <content type="html"><![CDATA[<ul><li><code>HTML----&gt;MD</code><a href="https://devtool.tech/html-md">https://devtool.tech/html-md</a></li></ul><h2 id="文档来自于：https-www-ydlclass-com-doc21xnv-nginx"><a href="#文档来自于：https-www-ydlclass-com-doc21xnv-nginx" class="headerlink" title="文档来自于：https://www.ydlclass.com/doc21xnv/nginx/"></a>文档来自于：<a href="https://www.ydlclass.com/doc21xnv/nginx/">https://www.ydlclass.com/doc21xnv/nginx/</a></h2><h2 id><a href="#" class="headerlink" title></a></h2><h2 id="第一章-基础及安装"><a href="#第一章-基础及安装" class="headerlink" title="第一章 基础及安装"></a>第一章 基础及安装</h2><h3 id="一、nginx-功能介绍"><a href="#一、nginx-功能介绍" class="headerlink" title="一、nginx 功能介绍"></a>一、nginx 功能介绍</h3><p>Nginx (“engine x”) 是一款开源的，支持高性能、高并发的 Web 服务和代理服务软件。它是由俄罗斯人 Igor Sysoev 开发的，最初被应用在俄罗斯的大型网站 <a href="http://www.rambler.ru/">www.rambler.ru</a> 上。后来作者将源代码以类 BSD 许可的形式开源出来供全球使用。因为它的<code>稳定性</code>、<code>丰富的模块库</code>、<code>灵活的配置</code>和<code>低系统资源</code>的消耗而闻名。</p><p>目前，市场上还有很多的同类竞品，如大名鼎鼎的apache，Lighttpd。目前，Nginx的市场份额和域数量双双稳居世界第一，并以 4.12 亿的总数遥遥领先其它竞争对手。</p><p><strong>小知识：</strong></p><blockquote><p>BSD许可证的条款</p></blockquote><p>使用BSD协议，需要遵守以下规则</p><ol><li>如果再发布的产品中包含源代码，则在源代码中必须带有原来代码中的BSD协议；</li><li>如果再发布的只是二进制类库&#x2F;软件，则需要在类库&#x2F;软件的文档和版权声明中包含原来代码中的BSD协议；</li><li>不可以用开源代码的“作者&#x2F;机构的名字”或“原来产品的名字”做市场推广。</li></ol><p>现今存在的开源协议很多，而经过Open Source Initiative（开放源代码倡议）通过批准的开源协议目前有60多种（<a href="http://www.opensource.org/licenses/alphabetical">http://www.opensource.org/licenses/alphabetical</a> ）。我们在常见的开源协议如BSD, GPL, LGPL,MIT等都是OSI批准的协议。</p><p>我们可以在这网网站，</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/1657530052574.7ce836ab.png" alt="1657530052574"></p><p>我们摘取几个和大家分享一下：</p><ul><li>Apache License 2.0：它是对商业应用友好的许可。使用者也可以在需要的时候修改代码来满足需要并作为开源或商业产品发布&#x2F;销售。</li><li>BSD开源协议（Berkerley Software Distribution）：商业软件可以使用，也可以修改使用BSD协议的代码。</li><li>MIT ( MIT license )：商业软件可以使用，也可以修改MIT协议的代码，甚至可以出售MIT协议的代码。</li><li>MPL ( Mozilla Public License 1.1 )：商业软件可以使用，也可以修改MPL协议的代码，但修改后的代码版权归软件的发起者。</li><li>CDDL (Common Development and Distribution License )：商业软件可以使用，也可以修改CDDL协议的代码。</li><li>EPL (Eclipse Public License 1.0 )：商业软件可以使用，也可以修改EPL协议的代码，但要承担代码产生的侵权责任。</li><li>GPL ( GNU General Public License )：商业软件不能使用GPL协议的代码。</li><li>LGPL ( GNU Library or “Lesser” General Public License )：商业软件可以使用，但不能修改LGPL协议的代码。</li></ul><h3 id="二、nginx可以提供的服务"><a href="#二、nginx可以提供的服务" class="headerlink" title="二、nginx可以提供的服务"></a>二、nginx可以提供的服务</h3><ol><li>web 服务</li><li>负载均衡 （反向代理）</li><li>web cache（web 缓存）</li></ol><h3 id="三、nginx-的优点"><a href="#三、nginx-的优点" class="headerlink" title="三、nginx 的优点"></a>三、nginx 的优点</h3><ol><li>比其他服务器响应更快。</li><li>高扩展，nginx的设计极具扩展性，他是由多个功能不同且耦合性极低的模块组成。</li><li>单机支持并发极高，理论上支持10万的并发连接，nginx支持的并发连接和内存相关，超过10万也是可以的。</li><li>低内存消耗，10000个非活跃的http keep-alive链接在nginx中仅仅消耗2.5M的内存。</li><li>支持热部署，如不用停止服务就能重新加载配置文件。</li><li>极具自由的BSD许可协议。我们不仅可以直接阅读nginx的源代码、还能用来修改升级。</li></ol><h3 id="四、nginx应用场合"><a href="#四、nginx应用场合" class="headerlink" title="四、nginx应用场合"></a>四、nginx应用场合</h3><ol><li>静态服务器。用来存放我们的静态资源，如图片、静态页面、js、css等。</li><li>反向代理，负载均衡。日pv2000W以下，都可以直接用nginx做代理。</li><li>缓存服务。</li></ol><h3 id="五、nginx实战"><a href="#五、nginx实战" class="headerlink" title="五、nginx实战"></a>五、nginx实战</h3><p>我们的nginx测试都是在linux环境中进行的，所有首先你需要一个linux系统，可以是云服务器，也可以是自己的vmware。</p><h4 id="1、下载nginx安装包"><a href="#1、下载nginx安装包" class="headerlink" title="1、下载nginx安装包"></a>1、下载nginx安装包</h4><p>进入nginx官网（<a href="http://nginx.org/en/%EF%BC%89%EF%BC%9A">http://nginx.org/en/）：</a></p><p><img src="https://www.ydlclass.com/doc21xnv/assets/1657531156233.a7274079.png" alt="1657531156233"></p><p>Nginx官网提供了三个类型的版本</p><ul><li>Mainline version：Mainline 是 Nginx 目前主力在做的版本，可以说是开发版</li><li>Stable version：最新稳定版，生产环境上建议使用的版本</li><li>Legacy versions：遗留的老版本的稳定版</li></ul><p>我们下载这个最新的稳定版本：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/1657531361055.acd562a3.png" alt="1657531361055"></p><h4 id="2、安装依赖包"><a href="#2、安装依赖包" class="headerlink" title="2、安装依赖包"></a>2、安装依赖包</h4><p>nginx安装依赖GCC、openssl-devel、pcre-devel和zlib-devel软件库，他们的作用如下：</p><ul><li>zlib库用于对HTTP包的内容做gzip格式的压缩，并指定对于某些类型（content-type）的HTTP响应使用gzip来进行压缩以减少网络传输量，则在编译时就必须把zlib编译进Nginx。</li><li>Pcre全称（Perl Compatible Regular Expressions），Perl库，包括 <a href="https://baike.baidu.com/item/perl/851577">perlopen in new window</a> 兼容的<a href="https://baike.baidu.com/item/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F">正则表达式open in new window</a>库，如果我们在nginx中使用了正则表达式，那么在编译Nginx时就必须把PCRE库编译进Nginx。</li><li>如果服务器不只是要支持HTTP，还需要在更安全的SSL协议上传输HTTP，那么需要拥有OpenSSL。另外，如果我们想使用MD5、SHA1等散列函数，那么也需要安装它。可以这样安装：</li></ul><p>我们使用一下的命令进行安装：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install gcc zlib-devel  pcre pcre-devel openssl openssl-devel -y </span><br></pre></td></tr></table></figure><p>1  </p><p>小知识：</p><p>devel 包主要是供开发用，至少包括以下2个东西头文件和链接，有的还含有开发文档或演示代码。</p><p>以 glib 和 glib-devel 为例:</p><ul><li><p>如果你安装基于 glib 开发的程序，只需要安装 glib 包就行了。</p></li><li><p>但是如果你要编译使用了 glib 的源代码，则需要安装 glib-devel。</p></li></ul><h4 id="3、编译安装"><a href="#3、编译安装" class="headerlink" title="3、编译安装"></a>3、编译安装</h4><p>下载nginx</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.22.0.tar.gz</span><br></pre></td></tr></table></figure><p>1  </p><p><img src="https://www.ydlclass.com/doc21xnv/assets/1657535839648.dbb22e94.png" alt="1657535839648"></p><p>解压：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zvxf nginx-1.22.0.tar.gz</span><br></pre></td></tr></table></figure><p>1  </p><p>nginx最简单的编译安装方式，就是进入目录后，使用以下命令：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p>1<br>2<br>3  </p><ul><li><p><code>./configure</code>命令做了很多幕后工作，包括检测操作系统内核和已经安装的软件，参数的解析，中间目录的生成，以及根据参数生成c源码文件和makefile文件等。</p></li><li><p>make命令根据，configure命令生成的makefile文件编译nginx工程，并生成目标文件、最终的二进制文件。</p></li><li><p>make install命令负责将nginx安装到指定的安装目录，包括相关目录的建立和二进制文件、位置文件的复制。</p></li></ul><p>以上命令会将nginx按照默认配置（默认模块、默认安装路径）进行安装，如果需要自定义一些配置，则需要使用如下的方式。</p><p>具体的命令如下：</p><ul><li>使用<code>./configure --help</code>查看各个模块的使用情况。</li><li>使用<code>--without-http_ssi_module</code>的方式关闭不需要的模块。</li><li>可以使用<code>--with-http_perl_modules</code>方式安装需要的模块。</li></ul><blockquote><p>编译命令</p></blockquote><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxf nginx-1.22.0.tar.gz </span><br><span class="line"><span class="built_in">cd</span> nginx-1.22.0</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> /data/nginx -p</span><br><span class="line"></span><br><span class="line">./configure --prefix=/data/nginx --user=nginx --group=nginx  --with-http_ssl_module  --with-http_stub_status_module</span><br><span class="line"></span><br><span class="line"><span class="comment"># -M ： 不创建主目录  -s ： 不允许登录 /sbin/nologin是一个有一个特殊的shell，不需要登陆</span></span><br><span class="line">useradd nginx -M -s /sbin/nologin </span><br><span class="line">make &amp;&amp; make install </span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10  </p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">--with-<span class="attribute">http_ssl_module</span>  安装该模块，该模块是nginx支持ssl协议，提供https服务。</span><br><span class="line">--with-http_stub_status_module  <span class="comment">#是一个监视模块，可以查看目前的连接数等一些信息，因为是非核心模块，所以我们使用nginx -V默认是没有安装的</span></span><br></pre></td></tr></table></figure><p>1<br>2  </p><p><img src="https://www.ydlclass.com/doc21xnv/assets/1657540449988.903f8df3.png" alt="1657540449988"></p><blockquote><p>测试nginx配置文件是否正常</p></blockquote><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/data/nginx/sbin/nginx -t </span><br><span class="line">nginx: the configuration file /data/nginx-1.10.1/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /data/nginx-1.10.1/conf/nginx.conf <span class="built_in">test</span> is successful</span><br></pre></td></tr></table></figure><p>1<br>2<br>3  </p><blockquote><p>启动nginx服务器</p></blockquote><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/data/nginx/sbin/nginx  -t      <span class="comment">## 检查配置文件</span></span><br><span class="line">/data/nginx/sbin/nginx          <span class="comment">## 确定nginx服务</span></span><br><span class="line">netstat -lntup |grep nginx      <span class="comment">## 检查进程是否正常</span></span><br><span class="line">curl http://localhost           <span class="comment">## 确认结果</span></span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4  </p><blockquote><p>nginx其他命令</p></blockquote><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nginx -s signal</span><br><span class="line">signal：</span><br><span class="line">stop — 立马关闭</span><br><span class="line">quit — 优雅关闭，处理完没处理好的请求后关闭</span><br><span class="line">reload — 重新加载配置文件</span><br><span class="line">reopen — reopening the <span class="built_in">log</span> files</span><br><span class="line">用来打开日志文件，这样nginx会把新日志信息写入这个新的文件中</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6<br>7  </p><p>安装net-tools来查看端口使用情况：</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">yum -y install net-tools</span><br></pre></td></tr></table></figure><p>1  </p><p>net-tools工具箱包括<a href="https://so.csdn.net/so/search?q=arp&spm=1001.2101.3001.7020">arpopen in new window</a>, hostname, ifconfig, netstat, rarp, route, plipconfig, slattach, mii-tool and iptunnel and ipmaddr等命令。</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/1657540929779.ca292d0c.png" alt="1657540929779"></p><p>在浏览器输入服务器地址：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220706172230504.4c7d5b14.png" alt="image-20220706172230504"></p><h3 id="六、nginx配置文件"><a href="#六、nginx配置文件" class="headerlink" title="六、nginx配置文件"></a>六、nginx配置文件</h3><p>nginx安装目录，如下：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/1657541074372.2b553dab.png" alt="1657541074372"></p><blockquote><p>配置基础配置文件</p></blockquote><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">            <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">        <span class="section">location</span> = /50x.html &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">### 测试配置文件是否正常</span></span><br><span class="line">shell&gt; /data/nginx/sbin/<span class="attribute">nginx</span> -t </span><br><span class="line">nginx: the configuration file /data/nginx-<span class="number">1</span>.<span class="number">10</span>.<span class="number">3</span>/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /data/nginx-<span class="number">1</span>.<span class="number">10</span>.<span class="number">3</span>/conf/nginx.conf test is successful</span><br><span class="line">shell&gt; curl -I http://localhost      <span class="comment"># -I代表只显示头信息</span></span><br><span class="line">HTTP/<span class="number">1</span>.<span class="number">1</span> <span class="number">200</span> OK</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28  </p><p>我们不妨先思考一个问题，我们看到的网页是在哪里呢，我们通过<code>root html</code>配置结合安装目录中有html目录，大概能猜出来，首页的文件就在html文件夹：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/1657542245510.9ccd3363.png" alt="1657542245510"></p><p><img src="https://www.ydlclass.com/doc21xnv/assets/1657542307377.b2f65d2b.png" alt="1657542307377"></p><h3 id="七、配置文件解读"><a href="#七、配置文件解读" class="headerlink" title="七、配置文件解读"></a>七、配置文件解读</h3><p>nginx配置文件主要分为四个部分：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">main&#123; <span class="comment">#（全局设置）</span></span><br><span class="line">    http&#123; <span class="comment">#服务器配置</span></span><br><span class="line">        <span class="section">upstream</span>&#123;&#125; <span class="comment">#（负载均衡服务器设置）</span></span><br><span class="line">        server&#123; <span class="comment">#（主机设置：主要用于指定主机和端口）</span></span><br><span class="line">            <span class="section">location</span>&#123;&#125; <span class="comment">#（URL匹配的设置）</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8  </p><p>server继承自main，location继承自server，upstream即不会继承其他设置也不会被继承。 <img src="https://www.ydlclass.com/doc21xnv/assets/image-20220606171640915.d0d40614.png" alt="image-20220606171640915"></p><h4 id="1、main-全局配置"><a href="#1、main-全局配置" class="headerlink" title="1、main 全局配置"></a>1、main 全局配置</h4><p>nginx在运行时与具体业务功能无关的一些参数，比如工作进程数，运行的身份等。</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">user</span> ydlclass;</span><br><span class="line"><span class="attribute">worker_processes</span> <span class="number">4</span>;</span><br><span class="line"><span class="attribute">worker_cpu_affinity</span> <span class="number">0001</span> <span class="number">0010</span> <span class="number">0100</span> <span class="number">1000</span>;</span><br><span class="line"><span class="attribute">error_log</span>  /data/nginx/logs/<span class="literal">error</span>.log  <span class="literal">crit</span>;</span><br><span class="line"><span class="attribute">pid</span>        /data/nginx/logs/nginx.pid;</span><br><span class="line"><span class="attribute">worker_rlimit_nofile</span> <span class="number">65535</span>;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6  </p><ul><li><code>user nginx;</code>: 指定nginx进程使用什么用户启动</li><li><code>worker_processes 4;</code> : 指定启动多少进程来处理请求，一般情况下设置成CPU的核数，如果开启了ssl和gzip应该设置成与逻辑CPU数量一样甚至为2倍，可以减少I&#x2F;O操作。使用<code>grep ^processor /proc/cpuinfo | wc -l</code>查看CPU核数。</li><li><code>worker_cpu_affinity 0001 0010 0100 1000;</code>: 在高并发情况下，通过设置将CPU和具体的进程绑定来降低由于多核CPU切换造成的寄存器等现场重建带来的性能损耗。如worker_cpu_affinity 0001 0010 0100 1000; （四核）。</li><li><code>error_log logs/error.log;</code>: error_log是个主模块指令，用来定义全局错误日志文件。日志输出级别有debug、info、notice、warn、error、crit可供选择，其中，debug输出日志最为最详细，而crit输出日志最少。</li><li><code>pid logs/nginx.pid;</code>: 指定进程pid文件的位置。</li></ul><p>我们可以使用<code>ps -ef | grep nginx</code>查看master和worker的进程，这里有一个master和四个worker：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220713182916582.7d761cef.png" alt="image-20220713182916582"></p><h4 id="2、events模块"><a href="#2、events模块" class="headerlink" title="2、events模块"></a>2、events模块</h4><p>events 模块主要是nginx 和用户交互网络连接优化的配置内容，我们主要看一下两个配置：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">events&#123;</span><br><span class="line">  <span class="attribute">use</span> <span class="literal">epoll</span>;</span><br><span class="line">  <span class="attribute">worker_connections</span>  <span class="number">65536</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4  </p><ul><li><code>use epoll;</code>是使用事件模块指令，用来指定Nginx的工作模式。Nginx支持的工作模式有select、poll、kqueue、epoll、rtsig和&#x2F;dev&#x2F;poll。其中select和poll都是标准的工作模式，kqueue和epoll是高效的工作模式，不同的是epoll用在Linux平台上，而kqueue用在BSD系统中。对于Linux系统，epoll工作模式是首选。在操作系统不支持这些高效模型时才使用select。</li><li><code>worker_connections 65536;</code>每一个worker进程能并发处理（发起）的最大连接数。</li></ul><h4 id="3、http服务器"><a href="#3、http服务器" class="headerlink" title="3、http服务器"></a>3、http服务器</h4><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">  <span class="attribute">include</span>       mime.types;</span><br><span class="line">  <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line">  <span class="comment">#charset  gb2312;</span></span><br><span class="line">  <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">  <span class="attribute">keepalive_timeout</span>  <span class="number">60s</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6<br>7  </p><ul><li>include是个主模块指令，实现对配置文件所包含的文件的设定，可以减少主配置文件的复杂度。该文件也在conf目录中。</li><li>default_type属于HTTP核心模块指令，这里设定默认类型为二进制流，也就是当文件类型未定义时使用这种方式。</li><li>charset gb2312; 指定客户端编码格式。</li><li>sendfile实际上是 Linux2.0+以后的推出的一个系统调用，web服务器可以通过调整自身的配置来决定是否利用 sendfile这个系统调用。sendfile是个比 read 和 write 更高性能的系统接口。 当 Nginx 是一个静态文件服务器的时候，开启 SENDFILE 配置项能大大提高 Nginx 的性能。 但是当 Nginx 是作为一个反向代理来使用的时候，SENDFILE 则没什么用。</li><li>Nginx 使用 keepalive_timeout 来指定 KeepAlive 的超时时间（timeout）。指定每个 TCP 连接最多可以保持多长时间。Nginx 的默认值是 75 秒，有些浏览器最多只保持 60 秒，所以可以设定为 60 秒。若将它设置为 0，就禁止了 keepalive 连接。</li></ul><h2 id="第二章-实战-部署前后分离项目"><a href="#第二章-实战-部署前后分离项目" class="headerlink" title="第二章 实战-部署前后分离项目"></a>第二章 实战-部署前后分离项目</h2><p>本章节我们会演示日常的工作中，我们是怎么利用nginx部署项目的。我们以部署一套前后分离的项目为本次讲述的内容。</p><h3 id="一、搭建后端项目"><a href="#一、搭建后端项目" class="headerlink" title="一、搭建后端项目"></a>一、搭建后端项目</h3><p>创建一个最简单的springboot项目：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/1657507807889.8ffd6220.png" alt="1657507807889"></p><p>只需要依赖一个web模块即可：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220713092526231.f68f20ca.png" alt="image-20220713092526231"></p><p>提供一个api接口，可以获取服务端的主机地址和服务端口：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NginxController</span> <span class="keyword">implements</span> <span class="title class_">ApplicationListener</span>&lt;WebServerInitializedEvent&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(WebServerInitializedEvent event)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.port = event.getWebServer().getPort();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;host&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getHost</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">        InetAddress address;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            address = InetAddress.getLocalHost();</span><br><span class="line">            <span class="keyword">return</span>  address.getHostAddress() + <span class="string">&quot;:&quot;</span> + port;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnknownHostException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error：Network card information is not available！&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23  </p><p>测试接口：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220713094617222.f5e63e7a.png" alt="image-20220713094617222"></p><h3 id="二、搭建前端项目"><a href="#二、搭建前端项目" class="headerlink" title="二、搭建前端项目"></a>二、搭建前端项目</h3><p>搭建前端工程，使用vue官方提供的脚手架搭建一个基础工程：</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">https://cli.vuejs.org/guide/creating-a-project.html</span><br></pre></td></tr></table></figure><p>1  </p><p>使用<code>vue ui</code>搭建脚手架，选择安装vue-router：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/1657507661343.1264f023.png" alt="1657507661343"></p><p>启动项目，打开项目：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/1657509039232.85fa6931.png" alt="1657509039232"></p><p>安装axios：</p><p>使用axios访问后端的api接口，修改app.vue如下：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;img alt=&quot;Vue logo&quot; src=&quot;./assets/logo.png&quot;&gt;</span><br><span class="line">  &lt;br&gt;服务器的ip和端口是：&#123;&#123; host &#125;&#125;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import axios from &#x27;axios&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      host: &quot;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted()&#123;</span><br><span class="line">    var ip_addr = document.location.hostname</span><br><span class="line">    axios.get(&#x27;http://&#x27;+ip_addr+&#x27;:8080/host&#x27;).then(res=&gt;&#123;</span><br><span class="line">      this.host = res.data</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23  </p><p>浏览器访问，发生了跨域问题：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/1657509682419.d88211fc.png" alt="1657509682419"></p><p>添加配置项，新建<code>vue.config.js</code>位置文件，配置代理如下:</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">port</span>: <span class="number">80</span>,</span><br><span class="line">    <span class="attr">proxy</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6  </p><p>同时修改axiso的请求地址：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">mounted</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> ip_addr = <span class="variable language_">document</span>.<span class="property">location</span>.<span class="property">hostname</span></span><br><span class="line">    axios.<span class="title function_">get</span>(<span class="string">&#x27;http://&#x27;</span>+ip_addr+<span class="string">&#x27;/host&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">host</span> = res.<span class="property">data</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6  </p><p>再次访问前端工程，发现跨域问题解决：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/1657510276751.45fc20bd.png" alt="1657510276751"></p><h3 id="三、nginx做静态服务器"><a href="#三、nginx做静态服务器" class="headerlink" title="三、nginx做静态服务器"></a>三、nginx做静态服务器</h3><p>我们都知道，nginx的安装目录中有这样一个文件夹：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220712152343632.b6290bdc.png" alt="image-20220712152343632"></p><p>我们再结合nginx的基础配置文件中的以下内容：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span>   html;</span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9  </p><p>我们不妨猜想一下当url为<code>/</code>时（当然这是错的），会去html目录寻找index.html文件作为首页。</p><p>我们不妨修改一下index.html文件看看，修改是否可以生效。</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220712153302770.534eec67.png" alt="image-20220712153302770"></p><p>确实可以生效，于是我们可以得出，结论只需要将我们的q前端文件放在html目录即可（事实上放在哪里都可以）。</p><p>我们尝试将构建的结果放入html文件夹：</p><p>前端工程产物如下：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220713131449954.a4979cf4.png" alt="image-20220713131449954"></p><p>上传至nginx：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220713132032861.981fcea7.png" alt="image-20220713132032861"></p><p>他真的可以访问了，但是，此时却出现了问题，ngixn无法判断哪些是静态资源，哪些是需要访问api接口的：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220713132138381.ec54fad9.png" alt="image-20220713132138381"></p><p>问题如下，此问题按下不表，后续处理：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220713132219959.7fb714a1.png" alt="image-20220713132219959"></p><h3 id="四、虚拟主机配置详解"><a href="#四、虚拟主机配置详解" class="headerlink" title="四、虚拟主机配置详解"></a>四、虚拟主机配置详解</h3><p>http服务上支持【若干虚拟主机】。每个虚拟主机对应一个server配置项，配置项里面包含该虚拟主机相关的配置。</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span> default;</span><br><span class="line">    <span class="attribute">server_name</span> www.ydlclass.com;</span><br><span class="line">    <span class="attribute">index</span> index.html index.htm index.php;</span><br><span class="line">    <span class="attribute">root</span> /data/www;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ .*\.(gif|jpg|jpeg|png|bmp|swf)$</span>&#123;</span><br><span class="line">        <span class="attribute">expires</span>      <span class="number">30d</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~ .*\.(js|css)?$</span>&#123;</span><br><span class="line">        <span class="attribute">expires</span>      <span class="number">1h</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14  </p><ul><li><code>listen 80;</code> 监听端口，默认80，小于1024的要以root启动。可以为listen :80、listen 127.0.0.1:80等形式。</li><li><code>server_name www.ydlclass.com</code> 用于设置虚拟主机服务名称，如：127.0.0.1 、 localhost 、域名[<a href="http://www.baidu.com/">www.baidu.com</a> | <a href="http://www.jd.com/]%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E8%BF%9B%E8%A1%8C%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D%E3%80%82">www.jd.com\]，也可以进行正则匹配。</a></li><li><code>root /data/www</code> 定义服务器的默认网站根目录位置。可以是linux的绝对路径（&#x2F;xxx&#x2F;xx），也可以是nginx安装目录的相对路径（html）。</li><li><code>index index.jsp index.html index.htm</code> ：定义路径下默认访问的文件名，一般跟着root放。</li></ul><h4 id="1、location-常见的配置项："><a href="#1、location-常见的配置项：" class="headerlink" title="1、location 常见的配置项："></a>1、location 常见的配置项：</h4><p>location通常用来匹配uri，其基本语法如下：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> [=|~|~*|^~] /uri/ &#123;&#125;</span><br></pre></td></tr></table></figure><p>1  </p><p>（1）&#x3D;表示匹配uri时必须做到完全匹配，如</p><p>（2）~表示匹配URI时是字母大小写敏感的，可以使用正则表达式。</p><p>（3）~*表示匹配URI时是忽略字母大小敏感的，可以使用正则表达式。</p><p>（4）^~表示匹配uri时只需满足前缀匹配即可</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 所有 /./img/开头的uri会全部匹配</span></span><br><span class="line"><span class="section">location</span><span class="regexp"> ^~</span> /./img/ &#123;&#125;</span><br></pre></td></tr></table></figure><p>1<br>2  </p><p>（5）uri参数中是可以使用正则表达式的，如匹配以 .gif .jpg和.jpeg结尾的uri，如下:</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> <span class="regexp">~* \.(gif|jpg|jpeg)$</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>1  </p><p>（6）以下方式可以匹配所有的uri</p><p>（7）<code>@</code> 指定一个命名的location，一般用于内部重定义请求：</p><p>结果总结： 匹配的优先顺序，<code>=</code>&gt;<code>^~</code>（匹配固定字符串，忽略正则）&gt;<code>~*</code>&gt;<code>/</code> ，工作中尽量将‘&#x3D;’放在前面。</p><p><a href="http://192.168.111.201/1.png">http://192.168.111.201/1.png</a></p><h4 id="2、文件路径的定义"><a href="#2、文件路径的定义" class="headerlink" title="2、文件路径的定义"></a>2、文件路径的定义</h4><p>（1）以root方式设置资源路径</p><p>语法 root path ，默认 root html，可以在http、server、location模块中配置。</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span><span class="regexp"> ^~</span> /backend &#123;</span><br><span class="line"><span class="attribute">root</span> /data/www/backend</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3  </p><p>如果url为 <code>/backend/index/test.html</code>则会返回&#x2F;data&#x2F;www&#x2F;backend&#x2F;backend&#x2F;index&#x2F;test.html这个文件。</p><p>（2）以alias方式设置资源路径</p><p>alias也是用来设置文件资源的，它和root不同点在于如何解读紧跟location后面的uri参数，可以在location中配置：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span><span class="regexp"> ^~</span> /backend &#123;</span><br><span class="line"><span class="attribute">alias</span> /data/www/backend</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3  </p><p>如果url为 <code>/backend/index/test.html</code>则会返回&#x2F;data&#x2F;www&#x2F;backend&#x2F;index&#x2F;test.html文件。</p><p>alias会将location后的url部分丢弃掉，而root不会。</p><p>（3）访问首页</p><p>可以在http、server、location中配置。</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">index</span> index.html index.htm index.php</span><br></pre></td></tr></table></figure><p>1  </p><p>nginx会依次访问index中定义的文件，知道访问成功为止。</p><p>（4）根据http返回码重定向页面</p><p>可以在http、server、location中配置。</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">error_page 404 /404.html</span><br><span class="line">error_page 502 503 504 /50x.html</span><br></pre></td></tr></table></figure><p>1<br>2  </p><p>（5）try_files</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">try_files path1 path2 ... uri</span><br></pre></td></tr></table></figure><p>1  </p><p>该配置项可以配置在server、location模块。</p><p>try_files后边会跟若干路径，nginx会尝试按照顺序访问每一个path，如果可以有效的读取，就直接访问当下path资源，否则继续向下访问，如果都读取不到就重定向到uri参数上</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">try_files</span> /a/b.html <span class="variable">$uri</span> <span class="variable">$uri</span>/index.html <span class="variable">$uri</span>.html <span class="variable">@other</span>;</span><br><span class="line"><span class="section">location</span> <span class="variable">@other</span> &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://backend</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4  </p><h4 id="3、解决前端的路由问题"><a href="#3、解决前端的路由问题" class="headerlink" title="3、解决前端的路由问题"></a>3、解决前端的路由问题</h4><p>我们在前端直接点击路由的按钮可以访问，因为这种情况并未再次向nginx发送请求，仅仅是前端的路由切换：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220714164105074.a93f281a.png" alt="image-20220714164105074"></p><p>但是，如果直接访问<code>/about</code>就GG了，这个url直接访问nginx时，nginx会认为你要查找about这个资源，当然是404了：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220714164156365.6b100278.png" alt="image-20220714164156365"></p><p>所以我们要通过一些配置来解决这个问题，vue工程都是单页面的，所以无论哪个路由都应该使用唯一的index.html，所以我们可以做如下的配置，该配置的意思就是将其他的所有请求，都强制使用&#x2F;index.html：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">root</span> /data/www/ui;</span><br><span class="line">    <span class="attribute">try_files</span> /index.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4  </p><p>但是这个有问题的，比如下边的请求，也会强制使用index.html，我明明需要js，你却给我一个HTML：</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">http://192.168.111.201/js/app.aa11d15b.js</span><br></pre></td></tr></table></figure><p>1  </p><p>所以配置要改成下边的内容，$uri是一个变量，他就是具体的url，对一<code>/js/app.aa11d15b.js</code>这个请求，首先会访问<code>/data/www/ui/js/app.aa11d15b.js</code>这个资源，当然存在，就直接返回了，而其他的路由资源会使用index.html：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">root</span> /data/www/ui;</span><br><span class="line">    <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ <span class="variable">$uri</span>/index.html <span class="variable">$uri</span>.html /index.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4  </p><h4 id="4、对图片开启gzip压缩"><a href="#4、对图片开启gzip压缩" class="headerlink" title="4、对图片开启gzip压缩"></a>4、对图片开启gzip压缩</h4><p>在http模块中添加如下内容：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">gzip_min_length</span> <span class="number">1k</span>;</span><br><span class="line"><span class="attribute">gzip_buffers</span>    <span class="number">4</span> <span class="number">16k</span>;</span><br><span class="line"><span class="attribute">gzip_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line"><span class="attribute">gzip_comp_level</span> <span class="number">5</span>;</span><br><span class="line"><span class="attribute">gzip_types</span> image/png;</span><br><span class="line"><span class="attribute">gzip_vary</span> <span class="literal">on</span>;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6<br>7  </p><p>解释如下：</p><ul><li><p>gzip on;使用”gzip on;”参数来启用压缩，默认是关闭的。</p></li><li><p>gzip_min_length 1k;gzip压缩的最小文件，小于设置值的文件将不会压缩#指定Nginx服务需要向服务器申请的缓存空间的个数*大小，默认32 4k|16 8k;</p></li><li><p>gzip_buffers 4 16k;设置压缩缓冲区大小，此处设置为4个16K内存作为压缩结果流缓存</p></li><li><p>gzip_http_version 1.1;启用压缩功能时，协议的最小版本，默认HTTP&#x2F;1.1</p></li><li><p>gzip_comp_level 5;压缩比例由低到高从1到9，默认为1。但需要注意的是压缩比设置的越高就会越消耗CPU的资源，因此在生产环境中我们会设置该参数的值在3~5之间，最好不要超过5，因为随着压缩比的增大的确会降低传输的带宽成本但发送数据前会占用更多的CPU时间分片。</p></li><li><p>gzip_types image&#x2F;png;指明仅对哪些类型的资源执行压缩操作；默认为gzip_types text&#x2F;html，不用显示指定，否则出错。</p></li><li><p>gzip_vary on;该指令用于设置在使用Gzip功能时是否发送带有“Vary: Accept-Encoding”头域的响应头部。该头域的主要功能是告诉接收方发送的数据经过了压缩处理。开启后的效果是在响应头部添加了Accept-Encoding: gzip，这对于本身不支持Gzip压缩的客户端浏览器是有用的。</p></li></ul><p>这一次没有设置图片压缩：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220713153150102.ca095497.png" alt="image-20220713153150102"></p><p>设置图片压缩后，响应多了如下的首部信息：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220713153422776.1dce8c84.png" alt="image-20220713153422776"></p><h3 id="五、反向代理解决跨域"><a href="#五、反向代理解决跨域" class="headerlink" title="五、反向代理解决跨域"></a>五、反向代理解决跨域</h3><h4 id="1、配置nginx反向代理"><a href="#1、配置nginx反向代理" class="headerlink" title="1、配置nginx反向代理"></a>1、配置nginx反向代理</h4><p>我们可以通过proxy_pass参数设置反向代理的服务器，语法如下：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://ydl.com;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4  </p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220713160342661.a6e6f2fa.png" alt="image-20220713160342661"></p><p>我们的实现逻辑很简单，就是将以<code>/api</code>为前缀的uri全部反向代理到真正的后端服务即可。</p><p>安装java环境：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220713161110581.785e07ad.png" alt="image-20220713161110581"></p><p>后台启动成功：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220713161557596.d7964e5e.png" alt="image-20220713161557596"></p><p>我们为了区分前端页面和api接口，将所有访问后端api的url统一加上前缀 &#x2F;api</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">mounted</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> ip_addr = <span class="variable language_">document</span>.<span class="property">location</span>.<span class="property">hostname</span></span><br><span class="line">  axios.<span class="title function_">get</span>(<span class="string">&#x27;http://&#x27;</span>+ip_addr+<span class="string">&#x27;/api/host&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">host</span> = res.<span class="property">data</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6  </p><p>现在我们想的是将前端发送的以api打头的url全部代理到，后端8080端口：</p><p>前端访问的接口：<a href="http://192.168.111.200/api/host">http://192.168.111.200:80/api/host</a></p><p>后端的接口：<a href="http://192.168.111.200:8080/host">http://192.168.111.200:8080/host</a></p><p>在实现代理的过程中，我们需要将&#x2F;api这个前缀删除掉，有以下两种方法，一种是重写url，如下：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span><span class="regexp"> ^~</span> /api/ &#123;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/api(.*)$</span> <span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://127.0.0.1:8080;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4  </p><p>更简单的做法是，在代理地址的后边加<code>/</code>，这样做也会去掉前缀，但不如以上方式灵活：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span><span class="regexp"> ^~</span> /api/ &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://127.0.0.1:8080/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3  </p><p>小知识：location中的rewirte：</p><ol><li><p>rewrite break：url重写后，直接使用当前资源，不再执行location里余下的语句，完成本次请求，地址栏url不变</p></li><li><p>rewrite last：url重写后，马上发起一个新的请求，再次进入server块，重试location匹配，超过10次匹配不到报500错误，地址栏url不变</p></li><li><p>rewrite redirect：返回302临时重定向，地址栏显示重定向后的url。</p></li></ol><h3 id="六、为后端工程做负载均衡"><a href="#六、为后端工程做负载均衡" class="headerlink" title="六、为后端工程做负载均衡"></a>六、为后端工程做负载均衡</h3><p>有时候，我们的后端工程压力太大，可能需要将后端工程部署在多台服务器上，此时就需要使用负载均衡了，在学习负载均衡的时候我们不妨先了解一下upstream模块。</p><h4 id="1、upstream模块解读"><a href="#1、upstream模块解读" class="headerlink" title="1、upstream模块解读"></a>1、upstream模块解读</h4><p>nginx 的负载均衡功能依赖于 ngx_http_upstream_module模块。upstream 模块应该放于http{}标签内。</p><p>模块写法如下：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">upstream</span> backend &#123;</span><br><span class="line">    ip_hash; </span><br><span class="line">    <span class="attribute">server</span> backend1.example.com;</span><br><span class="line">    <span class="attribute">server</span> backend2.example.com:<span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> backup2.example.com:<span class="number">8080</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6<br>7  </p><p>然后在location处使用如下写法：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://backend;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3  </p><p>以上写法的意思就是，将来同一个url访问我们的服务时，服务可以由backend中的服务器按照某种特定规则轮流提供。</p><blockquote><p>ngixn负载均衡的五种算法</p></blockquote><p>（1）round robin 轮询 （默认） 按时间顺序依次将请求分配到各个后台服务器中，挂掉的服务器自动从列表中剔除</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">upstream</span> bakend &#123;  </span><br><span class="line">   <span class="attribute">server</span> <span class="number">192.168.0.1</span> down;    </span><br><span class="line">   <span class="attribute">server</span> <span class="number">192.168.0.2</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4  </p><p>（2）weight 轮询权重 weight的值越大分配到的访问概率越高，主要用于后端每台服务器性能不均衡的情况下，或在主从的情况下设置不同的权值，达到合理有效的地利用主机资源。</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">upstream</span> bakend &#123;  </span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.0.1</span> weight=<span class="number">20</span>;  </span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.0.2</span> weight=<span class="number">10</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4  </p><p>（3）ip_hash：每个请求按访问IP的哈希结果分配，使来自同一个IP的访客固定访问一台后端服务器，并且可以有效解决动态网页存在的session共享问题。</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">upstream</span> bakend &#123;  </span><br><span class="line">    ip_hash;  </span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.0.1:88</span>;  </span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.0.2:80</span>;  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5  </p><p>（4）url_hash：按访问的URL的哈希结果来分配请求，使每个URL定向到同一台后端服务器，可以进一步提高后端服务器缓存的效率。Nginx本身不支持url_hash，需要安装Nginx的hash软件包。</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">upstream</span> backend &#123;  </span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.0.1:88</span>;     //使用hash语句时，不能在使用weight等其他参数</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.0.2:80</span>;  </span><br><span class="line">    <span class="attribute">hash</span> <span class="variable">$request_uri</span>;  </span><br><span class="line">    <span class="attribute">hash_method</span> crc32;    //使用hash算法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6  </p><p>（5）fair算法：可以根据页面大小和加载时间长短智能地进行负载均衡，根据后端服务器的响应时间来分配请求，响应时间短的优先分配。Nginx本身不支持fair，要安装upstream_fair模块才能使用。</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">upstream</span> backend &#123;  </span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.0.1:88</span>;  </span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.0.2:80</span>;  </span><br><span class="line">    fair;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5  </p><h4 id="2、项目配置"><a href="#2、项目配置" class="headerlink" title="2、项目配置"></a>2、项目配置</h4><p>首先我们需要将我们的后端项目在服务器中启动两份或多份，可以是同一台服务器，也可以是多台服务器，只要可以互联互通即可。</p><p>同一台服务器可以使用如下命令，重新指定一个端口即可：</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">java -jar ydl-nginx.jar --server.port=8081</span><br></pre></td></tr></table></figure><p>1  </p><p>我们需要定义一个upstream，将都有的后端服务配置在其中：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">upstream</span> ydlclass &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8080</span> weight <span class="number">10</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8081</span> weight <span class="number">20</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4  </p><p>修改location的proxy_pass：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span><span class="regexp"> ^~</span> /api/ &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://ydlclass/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3  </p><p>在浏览器中不停的刷新，发现端口在不停的变化，说明我们的多次请求确实落在了不同服务上。</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220713171258079.eee6d3ab.png" alt="image-20220713171258079"></p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220713171229793.48f7dfb3.png" alt="image-20220713171229793"></p><h3 id="七、其他的跨域问题"><a href="#七、其他的跨域问题" class="headerlink" title="七、其他的跨域问题"></a>七、其他的跨域问题</h3><p>如果现在本机的前端项目（也就是其他服务器的前端项目）也想要访问虚拟机中ngixn代理的api接口。这是一个典型的不同的项目之间进行访问的问题，这必然存在跨域问题，如下图：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220713175913937.3a1a0718.png" alt="image-20220713175913937"></p><p>我们将本地的vue工程进行如下修改：</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">mounted</span>(<span class="params"></span>)&#123;</span><br><span class="line">    axios.<span class="title function_">get</span>(<span class="string">&#x27;http://192.168.111.200/api/host&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">host</span> = res.<span class="property">data</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5  </p><p>此时，确实发生了跨域问题：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220713172639758.500766cd.png" alt="image-20220713172639758"></p><p>根据我们学习过的知识要解决跨域问题。其实，只需要在客户端发送【预检请求】时指定对应的响应头即可，nginx可以很方便的给响应增加一些首部信息，方法如下，在：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span><span class="regexp"> ^~</span> /api/ &#123;</span><br><span class="line">    <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="string">&#x27;*&#x27;</span>;</span><br><span class="line"><span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow_Credentials&#x27;</span> <span class="string">&#x27;true&#x27;</span>;</span><br><span class="line"><span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span> <span class="string">&#x27;Authorization,Accept,Origin,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Content-Range,Range&#x27;</span>;</span><br><span class="line"><span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span> <span class="string">&#x27;GET,POST,OPTIONS,PUT,DELETE,PATCH&#x27;</span>;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://ydlclass/;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8  </p><p>访问本地地址，本次访问跨域的问题被解决了：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220713172843173.7a1457c5.png" alt="image-20220713172843173"></p><p>我们也能看到对应的响应首部信息，多了如下内容：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220713180106546.01b1e3a2.png" alt="image-20220713180106546"></p><h3 id="八、nginx监控"><a href="#八、nginx监控" class="headerlink" title="八、nginx监控"></a>八、nginx监控</h3><p>开启nginx的监控服务</p><h4 id="1、开启状态页"><a href="#1、开启状态页" class="headerlink" title="1、开启状态页"></a>1、开启状态页</h4><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#设定查看Nginx状态的地址   </span></span><br><span class="line"><span class="section">location</span> = /status &#123;  </span><br><span class="line">  <span class="attribute">stub_status</span> <span class="literal">on</span>;   <span class="comment">#表示开启stubStatus的工作状态统计功能。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4  </p><h4 id="2、访问URL"><a href="#2、访问URL" class="headerlink" title="2、访问URL"></a>2、访问URL</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl http://127.0.0.1/status</span><br><span class="line"></span><br><span class="line">Active connections:  1</span><br><span class="line">server accepts handled requests</span><br><span class="line"> 16 16 18</span><br><span class="line">Reading: 0 Writing: 1 Waiting: 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># active connections – 活跃的连接数量</span></span><br><span class="line"><span class="comment"># server accepts handled reque</span></span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9  </p><p>我们可以访问&#x2F;status查看当前nginx的状态：</p><p><img src="https://www.ydlclass.com/doc21xnv/assets/image-20220706172922752.f43db494.png" alt="image-20220706172922752"></p><table><thead><tr><th>状态码</th><th>表示的意义</th></tr></thead><tbody><tr><td>Active connections</td><td>当前所有处于打开状态的连接数</td></tr><tr><td>accepts</td><td>总共处理了多少个连接</td></tr><tr><td>handled</td><td>成功创建多少握手</td></tr><tr><td>requests</td><td>总共处理了多少个请求</td></tr><tr><td>Reading</td><td>表示正处于接收请求状态的连接数</td></tr><tr><td>Writing</td><td>表示请求已经接收完成，且正处于处理请求或发送响应的过程中的连接数</td></tr><tr><td>Waiting</td><td>开启keep-alive的情况下，这个值等于active - (reading + writing)，意思就是Nginx已处理完正在等候下一次请求指令的驻留连接</td></tr></tbody></table><h3 id="五、其它nginx配置"><a href="#五、其它nginx配置" class="headerlink" title="五、其它nginx配置"></a>五、其它nginx配置</h3><h4 id="1、访问控制-allow-x2F-deny"><a href="#1、访问控制-allow-x2F-deny" class="headerlink" title="1、访问控制 allow&#x2F;deny"></a>1、访问控制 allow&#x2F;deny</h4><p>Nginx 的访问控制模块默认就会安装，而且写法也非常简单，可以分别有多个allow,deny，允许或禁止某个ip或ip段访问，依次满足任何一个规则就停止往下匹配。如：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> /status &#123;</span><br><span class="line">  <span class="attribute">stub_status</span> <span class="literal">on</span>;</span><br><span class="line">  <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">  <span class="attribute">allow</span> <span class="number">192.168.10.100</span>;</span><br><span class="line">  <span class="attribute">allow</span> <span class="number">172.29.73.0</span>/<span class="number">24</span>;</span><br><span class="line">  <span class="attribute">deny</span> all;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6<br>7  </p><h4 id="2、列出目录-autoindex"><a href="#2、列出目录-autoindex" class="headerlink" title="2、列出目录 autoindex"></a>2、列出目录 autoindex</h4><p>Nginx默认是不允许列出整个目录的。如需此功能，打开nginx.conf文件，在location，server 或 http段中加入如下参数：这个功能我们可以做一个资源下载站。</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span><span class="regexp"> ^~</span> /file &#123;</span><br><span class="line">    <span class="attribute">root</span>   /data/www;</span><br><span class="line">    <span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">autoindex_exact_size</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">autoindex_localtime</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">charset</span> utf-<span class="number">8</span>,gbk;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1<br>2<br>3<br>4<br>5<br>6<br>7  </p><ul><li><code>autoindex on;</code>运行列出目录内容。另外两个参数最好也加上去。</li><li><code>autoindex_exact_size off;</code> 默认为on，显示出文件的确切大小，单位是bytes。改为off后，显示出文件的大概大小，单位是kB或者MB或者GB。</li><li><code>autoindex_localtime on;</code> 默认为off，显示的文件时间为GMT时间。改为on后，显示的文件时间为文件的服务器时间。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;&lt;code&gt;HTML----&amp;gt;MD&lt;/code&gt;&lt;a href=&quot;https://devtool.tech/html-md&quot;&gt;https://devtool.tech/html-md&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;文档来自于：https-w</summary>
      
    
    
    
    
    <category term="nginx" scheme="http://daihaojun554.github.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>scrapy中ImagePipeline的使用</title>
    <link href="http://daihaojun554.github.io/2022/08/12/scrapy/"/>
    <id>http://daihaojun554.github.io/2022/08/12/scrapy/</id>
    <published>2022-08-11T23:50:03.000Z</published>
    <updated>2022-08-11T16:52:08.876Z</updated>
    
    <content type="html"><![CDATA[<p>​</p><h1 id="1-ImagePipeline的使用"><a href="#1-ImagePipeline的使用" class="headerlink" title="1.ImagePipeline的使用"></a>1.ImagePipeline的使用</h1><p>返回的的url交给自定义的imagePipeline</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220811220315217.png" alt="image-20220811220315217"></p><h2 id="1-1-自定义一个继承ImagesPipeline的类"><a href="#1-1-自定义一个继承ImagesPipeline的类" class="headerlink" title="1.1.自定义一个继承ImagesPipeline的类"></a>1.1.自定义一个继承ImagesPipeline的类</h2><p>重写三个方法：</p><p><code>def get_media_requests(self,item,info):</code></p><ul><li>这个就是将parse处理过来的url穿过来交给scrapy进行发送请求</li></ul><p><code>def file_path(self,request,response=None,info=None):</code></p><ul><li>重命名每个img的名字</li></ul><p><code>def item_completed(self,results,item,info):</code></p><ul><li>处理完成后的操作</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> scrapy.pipelines.images <span class="keyword">import</span> ImagesPipeline</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">imgsPipeline</span>(<span class="title class_ inherited__">ImagesPipeline</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_media_requests</span>(<span class="params">self,item,info</span>):</span><br><span class="line">        <span class="keyword">yield</span> scrapy.Request(item[<span class="string">&#x27;src&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">file_path</span>(<span class="params">self,request,response=<span class="literal">None</span>,info=<span class="literal">None</span></span>):</span><br><span class="line">        imgName = request.url.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span>  imgName</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">item_completed</span>(<span class="params">self,results,item,info</span>):</span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="1-2-在settings中做配置"><a href="#1-2-在settings中做配置" class="headerlink" title="1.2.在settings中做配置"></a>1.2.在settings中做配置</h2><ul><li>header之类的</li><li>延迟</li><li>开启管道</li><li>定义图片的存放路径：</li></ul><p><code>IMAGES_STORE=&#39;G:/pictures/xxxx/&#39;</code></p><h1 id="2-下载中间件"><a href="#2-下载中间件" class="headerlink" title="2.下载中间件"></a>2.下载中间件</h1><h2 id="process-request"><a href="#process-request" class="headerlink" title="process_request"></a>process_request</h2><p><code>#拦截请求</code>:可以进行请求伪装ua，或者代理ip<br>    <code>def process_request(self, request, spider):</code><br>    <code>pass</code></p><h3 id="ua代理："><a href="#ua代理：" class="headerlink" title="ua代理："></a>ua代理：</h3><p><code>request.headers[&#39;User-Agent&#39;] = random.choice(USER_AGENT_LIST)</code></p><h2 id="process-response"><a href="#process-response" class="headerlink" title="process_response"></a>process_response</h2><p><code>#拦截响应</code>:可以进行篡改页面数据，进行自定义响应</p><p><code>def process_response(self, request, response, spider):</code></p><p><code>pass</code></p><h2 id="process-exception"><a href="#process-exception" class="headerlink" title="process_exception:"></a>process_exception:</h2><p>拦截异常：一般用于发生异常的时候换ip重新发送请求</p><p><code>def process_exception(self, request, exception, spider):</code></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> settings <span class="keyword">import</span> USER_AGENT_LIST</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">YoiDownloaderMiddleware</span>:</span><br><span class="line">    <span class="comment"># Not all methods need to be defined. If a method is not defined,</span></span><br><span class="line">    <span class="comment"># scrapy acts as if the downloader middleware does not modify the</span></span><br><span class="line">    <span class="comment"># passed objects.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">from_crawler</span>(<span class="params">cls, crawler</span>):</span><br><span class="line">        <span class="comment"># This method is used by Scrapy to create your spiders.</span></span><br><span class="line">        s = cls()</span><br><span class="line">        crawler.signals.connect(s.spider_opened, signal=signals.spider_opened)</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line">    <span class="comment">#拦截请求</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request, spider</span>):</span><br><span class="line">        <span class="comment"># Called for each request that goes through the downloader</span></span><br><span class="line">        <span class="comment"># middleware.</span></span><br><span class="line">request.headers[<span class="string">&#x27;User-Agent&#x27;</span>] = random.choice(USER_AGENT_LIST)</span><br><span class="line">        <span class="comment"># Must either:</span></span><br><span class="line">        <span class="comment"># - return None: continue processing this request</span></span><br><span class="line">        <span class="comment"># - or return a Response object</span></span><br><span class="line">        <span class="comment"># - or return a Request object</span></span><br><span class="line">        <span class="comment"># - or raise IgnoreRequest: process_exception() methods of</span></span><br><span class="line">        <span class="comment">#   installed downloader middleware will be called</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_response</span>(<span class="params">self, request, response, spider</span>):</span><br><span class="line">        <span class="comment"># Called with the response returned from the downloader.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Must either;</span></span><br><span class="line">        <span class="comment"># - return a Response object</span></span><br><span class="line">        <span class="comment"># - return a Request object</span></span><br><span class="line">        <span class="comment"># - or raise IgnoreRequest</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_exception</span>(<span class="params">self, request, exception, spider</span>):</span><br><span class="line">        <span class="comment"># Called when a download handler or a process_request()</span></span><br><span class="line">        <span class="comment"># (from other downloader middleware) raises an exception.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Must either:</span></span><br><span class="line">        <span class="comment"># - return None: continue processing this exception</span></span><br><span class="line">        <span class="comment"># - return a Response object: stops process_exception() chain</span></span><br><span class="line">        <span class="comment"># - return a Request object: stops process_exception() chain</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">spider_opened</span>(<span class="params">self, spider</span>):</span><br><span class="line">        spider.logger.info(<span class="string">&#x27;Spider opened: %s&#x27;</span> % spider.name)</span><br></pre></td></tr></table></figure><p>ua池：settings中</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">USER_AGENT_LIST=[<span class="string">&quot;Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; WOW64; Trident/6.0)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; Trident/6.0)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; Trident/5.0)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 10.0; Windows NT 6.1; Trident/5.0)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/1.22 (compatible; MSIE 10.0; Windows 3.1)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; MSIE 9.0; WIndows NT 9.0; en-US))&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 7.1; Trident/5.0)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; Media Center PC 6.0; InfoPath.3; MS-RTC LM 8; Zune 4.7)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; Media Center PC 6.0; InfoPath.3; MS-RTC LM 8; Zune 4.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; Zune 4.0; InfoPath.3; MS-RTC LM 8; .NET4.0C; .NET4.0E)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 2.0.50727; Media Center PC 6.0)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 2.0.50727; Media Center PC 6.0)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0; .NET CLR 2.0.50727; SLCC2; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; Zune 4.0; Tablet PC 2.0; InfoPath.3; .NET4.0C; .NET4.0E)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0; chromeframe/11.0.696.57)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0) chromeframe/10.0.648.205&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.0; Trident/5.0; chromeframe/11.0.696.57)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 ( ; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 9.0; Windows NT 5.1; Trident/5.0)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 7.1; Trident/5.0; .NET CLR 2.0.50727; SLCC2; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; InfoPath.3; .NET4.0C)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; AskTB5.5)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; InfoPath.2; .NET4.0C; .NET4.0E)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; Win64; x64; Trident/5.0; .NET CLR 2.0.50727; SLCC2; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; InfoPath.3; .NET4.0C)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; FDM; .NET CLR 1.1.4322; .NET4.0C; .NET4.0E; Tablet PC 2.0)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 5.2; Trident/4.0; Media Center PC 4.0; SLCC1; .NET CLR 3.0.04320)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; SLCC1; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729; .NET CLR 1.1.4322)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; InfoPath.2; SLCC1; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729; .NET CLR 2.0.50727)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; .NET CLR 1.1.4322; .NET CLR 2.0.50727)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 5.0; Trident/4.0; InfoPath.1; SV1; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729; .NET CLR 3.0.04506.30)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (compatible; MSIE 7.0; Windows NT 5.0; Trident/4.0; FBSMTWB; .NET CLR 2.0.34861; .NET CLR 3.0.3746.3218; .NET CLR 3.5.33652; msn OptimizedIE8;ENUS)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.2; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; Media Center PC 6.0; InfoPath.2; MS-RTC LM 8)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; Media Center PC 6.0; InfoPath.2; MS-RTC LM 8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; Media Center PC 6.0; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET4.0C)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; InfoPath.3; .NET4.0C; .NET4.0E; .NET CLR 3.5.30729; .NET CLR 3.0.30729; MS-RTC LM 8)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; InfoPath.2)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; Zune 3.0)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; msn OptimizedIE8;ZHCN)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; MS-RTC LM 8; InfoPath.3; .NET4.0C; .NET4.0E) chromeframe/8.0.552.224&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; MS-RTC LM 8; .NET4.0C; .NET4.0E; Zune 4.7; InfoPath.3)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; MS-RTC LM 8; .NET4.0C; .NET4.0E; Zune 4.7)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; MS-RTC LM 8)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; InfoPath.3; Zune 4.0)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; InfoPath.3; .NET4.0C; .NET4.0E; MS-RTC LM 8; Zune 4.7)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:2.2a1pre) Gecko/20110324 Firefox/4.2a1pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:2.2a1pre) Gecko/20100101 Firefox/4.2a1pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.2a1pre) Gecko/20110324 Firefox/4.2a1pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.2a1pre) Gecko/20110323 Firefox/4.2a1pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:2.0b9pre) Gecko/20110111 Firefox/4.0b9pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0b9pre) Gecko/20101228 Firefox/4.0b9pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 5.1; rv:2.0b9pre) Gecko/20110105 Firefox/4.0b9pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0b8pre) Gecko/20101114 Firefox/4.0b8pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0b8pre) Gecko/20101213 Firefox/4.0b8pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0b8pre) Gecko/20101128 Firefox/4.0b8pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0b8pre) Gecko/20101114 Firefox/4.0b8pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 5.1; rv:2.0b8pre) Gecko/20101127 Firefox/4.0b8pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0b8) Gecko/20100101 Firefox/4.0b8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; rv:2.0b7pre) Gecko/20100921 Firefox/4.0b7pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0b7) Gecko/20101111 Firefox/4.0b7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0b7) Gecko/20100101 Firefox/4.0b7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0b6pre) Gecko/20100903 Firefox/4.0b6pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; rv:2.0b6pre) Gecko/20100903 Firefox/4.0b6pre Firefox/4.0b6pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:2.0b4) Gecko/20100818 Firefox/4.0b4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; Linux i686; rv:2.0b3pre) Gecko/20100731 Firefox/4.0b3pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 5.2; rv:2.0b13pre) Gecko/20110304 Firefox/4.0b13pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 5.1; rv:2.0b13pre) Gecko/20110223 Firefox/4.0b13pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; Linux i686; rv:2.0b12pre) Gecko/20110204 Firefox/4.0b12pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; Linux i686; rv:2.0b12pre) Gecko/20100101 Firefox/4.0b12pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0b11pre) Gecko/20110128 Firefox/4.0b11pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0b11pre) Gecko/20110131 Firefox/4.0b11pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0b11pre) Gecko/20110129 Firefox/4.0b11pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0b11pre) Gecko/20110128 Firefox/4.0b11pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; rv:2.0b11pre) Gecko/20110126 Firefox/4.0b11pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0b11pre) Gecko/20110126 Firefox/4.0b11pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0b10pre) Gecko/20110118 Firefox/4.0b10pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; rv:2.0b10pre) Gecko/20110113 Firefox/4.0b10pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; Linux i686; rv:2.0b10) Gecko/20100101 Firefox/4.0b10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:2.0b10) Gecko/20110126 Firefox/4.0b10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; rv:2.0b10) Gecko/20110126 Firefox/4.0b10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; pl-PL; rv:2.0) Gecko/20110307 Firefox/4.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-GB; rv:2.0) Gecko/20110404 Fedora/16-dev Firefox/4.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; Arch Linux i686; rv:2.0) Gecko/20110321 Firefox/4.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; ru; rv:1.9.2.3) Gecko/20100401 Firefox/4.0 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; rv:2.0) Gecko/20110319 Firefox/4.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; rv:1.9) Gecko/20100101 Firefox/4.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; pl-PL; rv:1.9.0.2) Gecko/20121223 Ubuntu/9.25 (jaunty) Firefox/3.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; pl-PL; rv:1.9.0.2) Gecko/2008092313 Ubuntu/9.25 (jaunty) Firefox/3.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; it-IT; rv:1.9.0.2) Gecko/2008092313 Ubuntu/9.25 (jaunty) Firefox/3.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Mozilla/5.0 (X11; U; Linux i686; it-IT; rv:1.9.0.2) Gecko/2008092313 Ubuntu/9.25 (jaunty) Firefox/3.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; ru; rv:1.9.3a5pre) Gecko/20100526 Firefox/3.7a5pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; ru; rv:1.9.2b5) Gecko/20091204 Firefox/3.6b5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2b5) Gecko/20091204 Firefox/3.6b5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; fr; rv:1.9.2b5) Gecko/20091204 Firefox/3.6b5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.2) Gecko/20091218 Firefox 3.6b5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; fr; rv:1.9.2b4) Gecko/20091124 Firefox/3.6b4 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2b4) Gecko/20091124 Firefox/3.6b4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2b1) Gecko/20091014 Firefox/3.6b1 GTB5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2a1pre) Gecko/20090428 Firefox/3.6a1pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2a1pre) Gecko/20090405 Firefox/3.6a1pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; ru-RU; rv:1.9.2a1pre) Gecko/20090405 Ubuntu/9.04 (jaunty) Firefox/3.6a1pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; Windows NT 5.1; es-ES; rv:1.9.2a1pre) Gecko/20090402 Firefox/3.6a1pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; Windows NT 5.1; en-US; rv:1.9.2a1pre) Gecko/20090402 Firefox/3.6a1pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; ja; rv:1.9.2a1pre) Gecko/20090402 Firefox/3.6a1pre (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.9) Gecko/20100915 Gentoo Firefox/3.6.9&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.9.2.9) Gecko/20100913 Firefox/3.6.9&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-GB; rv:1.9.2.9) Gecko/20100824 Firefox/3.6.9 ( .NET CLR 3.5.30729; .NET CLR 4.0.20506)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.2; en-GB; rv:1.9.2.9) Gecko/20100824 Firefox/3.6.9&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; OpenBSD i386; en-US; rv:1.9.2.8) Gecko/20101230 Firefox/3.6.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.8) Gecko/20100804 Gentoo Firefox/3.6.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.8) Gecko/20100723 SUSE/3.6.8-0.1.1 Firefox/3.6.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; zh-CN; rv:1.9.2.8) Gecko/20100722 Ubuntu/10.04 (lucid) Firefox/3.6.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; ru; rv:1.9.2.8) Gecko/20100723 Ubuntu/10.04 (lucid) Firefox/3.6.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; fi-FI; rv:1.9.2.8) Gecko/20100723 Ubuntu/10.04 (lucid) Firefox/3.6.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.8) Gecko/20100727 Firefox/3.6.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; de-DE; rv:1.9.2.8) Gecko/20100725 Gentoo Firefox/3.6.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; FreeBSD i386; de-CH; rv:1.9.2.8) Gecko/20100729 Firefox/3.6.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; zh-CN; rv:1.9.2.8) Gecko/20100722 Firefox/3.6.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; pt-BR; rv:1.9.2.8) Gecko/20100722 Firefox/3.6.8 GTB7.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; it; rv:1.9.2.8) Gecko/20100722 AskTbADAP/3.9.1.14019 Firefox/3.6.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; he; rv:1.9.2.8) Gecko/20100722 Firefox/3.6.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; fr; rv:1.9.2.8) Gecko/20100722 Firefox 3.6.8 GTB7.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-GB; rv:1.9.2.8) Gecko/20100722 Firefox/3.6.8 ( .NET CLR 3.5.30729; .NET4.0C)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; de; rv:1.9.2.8) Gecko/20100722 Firefox 3.6.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; de; rv:1.9.2.3) Gecko/20121221 Firefox/3.6.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.2; zh-TW; rv:1.9.2.8) Gecko/20100722 Firefox/3.6.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9.2.8) Gecko/20100722 Firefox/3.6.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; tr; rv:1.9.2.8) Gecko/20100722 Firefox/3.6.8 ( .NET CLR 3.5.30729; .NET4.0E&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.7) Gecko/20100809 Fedora/3.6.7-1.fc14 Firefox/3.6.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.7) Gecko/20100723 Fedora/3.6.7-1.fc13 Firefox/3.6.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.7) Gecko/20100726 CentOS/3.6-3.el5.centos Firefox/3.6.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; hu; rv:1.9.2.7) Gecko/20100713 Firefox/3.6.7 GTB7.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; ru; rv:1.9.2.8) Gecko/20100722 Firefox/3.6.7 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; pt-PT; rv:1.9.2.7) Gecko/20100713 Firefox/3.6.7 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.6) Gecko/20100628 Ubuntu/10.04 (lucid) Firefox/3.6.6 GTB7.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.6) Gecko/20100628 Ubuntu/10.04 (lucid) Firefox/3.6.6 GTB7.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.6) Gecko/20100628 Ubuntu/10.04 (lucid) Firefox/3.6.6 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.6) Gecko/20100628 Ubuntu/10.04 (lucid) Firefox/3.6.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; pt-PT; rv:1.9.2.6) Gecko/20100625 Firefox/3.6.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; it; rv:1.9.2.6) Gecko/20100625 Firefox/3.6.6 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.6) Gecko/20100625 Firefox/3.6.6 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; zh-CN; rv:1.9.2.6) Gecko/20100625 Firefox/3.6.6 GTB7.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; nl; rv:1.9.2.6) Gecko/20100625 Firefox/3.6.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; it; rv:1.9.2.6) Gecko/20100625 Firefox/3.6.6 ( .NET CLR 3.5.30729; .NET4.0E)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.4) Gecko/20100614 Ubuntu/10.04 (lucid) Firefox/3.6.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.4) Gecko/20100625 Gentoo Firefox/3.6.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; zh-TW; rv:1.9.2.4) Gecko/20100611 Firefox/3.6.4 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; ru; rv:1.9.2.4) Gecko/20100513 Firefox/3.6.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; ja; rv:1.9.2.4) Gecko/20100611 Firefox/3.6.4 GTB7.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; cs; rv:1.9.2.4) Gecko/20100513 Firefox/3.6.4 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; zh-CN; rv:1.9.2.4) Gecko/20100513 Firefox/3.6.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; ja; rv:1.9.2.4) Gecko/20100513 Firefox/3.6.4 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; fr; rv:1.9.2.4) Gecko/20100523 Firefox/3.6.4 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.2.4) Gecko/20100527 Firefox/3.6.4 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.2.4) Gecko/20100527 Firefox/3.6.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.2.4) Gecko/20100523 Firefox/3.6.4 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.2.4) Gecko/20100513 Firefox/3.6.4 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.2; en-CA; rv:1.9.2.4) Gecko/20100523 Firefox/3.6.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-TW; rv:1.9.2.4) Gecko/20100611 Firefox/3.6.4 GTB7.0 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9.2.4) Gecko/20100513 Firefox/3.6.4 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9.2.4) Gecko/20100503 Firefox/3.6.4 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; nb-NO; rv:1.9.2.4) Gecko/20100611 Firefox/3.6.4 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; ko; rv:1.9.2.4) Gecko/20100523 Firefox/3.6.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; cs; rv:1.9.2.4) Gecko/20100611 Firefox/3.6.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.3pre) Gecko/20100405 Firefox/3.6.3plugin1 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; fr; rv:1.9.2.3) Gecko/20100403 Fedora/3.6.3-4.fc13 Firefox/3.6.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.3) Gecko/20100403 Firefox/3.6.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; de; rv:1.9.2.3) Gecko/20100401 SUSE/3.6.3-1.1 Firefox/3.6.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; ko-KR; rv:1.9.2.3) Gecko/20100423 Ubuntu/10.04 (lucid) Firefox/3.6.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.3) Gecko/20100404 Ubuntu/10.04 (lucid) Firefox/3.6.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.3 GTB7.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.2) Gecko/20100316 Firefox/3.6.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; de; rv:1.9.2.3) Gecko/20100423 Ubuntu/10.04 (lucid) Firefox/3.6.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux AMD64; en-US; rv:1.9.2.3) Gecko/20100403 Ubuntu/10.10 (maverick) Firefox/3.6.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; zh-CN; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.3 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; ru; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; pl; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; it; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; hu; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.3 GTB7.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; es-ES; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.3 GTB7.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; es-ES; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.3 GTB7.0 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; es-ES; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.3 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; cs; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.3 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; ca; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.3 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; fr; rv:1.9.2.2) Gecko/20100316 Firefox/3.6.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; fr; rv:1.9.2.2) Gecko/20100316 Firefox/3.6.2 GTB7.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.2) Gecko/20100316 AskTbSPC2/3.9.1.14019 Firefox/3.6.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.2.2) Gecko/20100316 Firefox/3.6.2 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; ru; rv:1.9.2.2) Gecko/20100316 Firefox/3.6.2 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; pl; rv:1.9.2.2) Gecko/20100316 Firefox/3.6.2 GTB6 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.9.2.2) Gecko/20100316 Firefox/3.6.2 ( .NET CLR 3.0.04506.648)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.9.2.2) Gecko/20100316 Firefox/3.6.2 ( .NET CLR 3.0.04506.30)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.7; en-US; rv:1.9.2.2) Gecko/20100316 Firefox/3.6.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.10pre) Gecko/20100902 Ubuntu/9.10 (karmic) Firefox/3.6.1pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; ja-JP; rv:1.9.2.16) Gecko/20110323 Ubuntu/10.10 (maverick) Firefox/3.6.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.16) Gecko/20110323 Ubuntu/9.10 (karmic) Firefox/3.6.16 FirePHP/0.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-GB; rv:1.9.2.16) Gecko/20110319 Firefox/3.6.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; fr; rv:1.9.2.16) Gecko/20110319 Firefox/3.6.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; pl; rv:1.9.2.16) Gecko/20110319 Firefox/3.6.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; ko; rv:1.9.2.16) Gecko/20110319 Firefox/3.6.16 ( .NET CLR 3.5.30729; .NET4.0E)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; fr; rv:1.9.2.16) Gecko/20110319 Firefox/3.6.16 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en; rv:1.9.1.13) Gecko/20100914 Firefox/3.6.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-GB; rv:1.9.2.16) Gecko/20110319 AskTbUTR/3.11.3.15590 Firefox/3.6.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.16pre) Gecko/20110304 Ubuntu/10.10 (maverick) Firefox/3.6.15pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.15) Gecko/20110303 Ubuntu/10.04 (lucid) Firefox/3.6.15 FirePHP/0.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; de; rv:1.9.2.15) Gecko/20110330 CentOS/3.6-1.el5.centos Firefox/3.6.15&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; es-ES; rv:1.9.2.15) Gecko/20110303 Firefox/3.6.15&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.15) Gecko/20110303 Firefox/3.6.15 ( .NET CLR 3.5.30729; .NET4.0C) FirePHP/0.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-GB; rv:1.9.2.15) Gecko/20110303 AskTbBT4/3.11.3.15590 Firefox/3.6.15 ( .NET CLR 3.5.30729; .NET4.0C)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.15) Gecko/20110303 Firefox/3.6.15 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.14pre) Gecko/20110105 Firefox/3.6.14pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux armv7l; en-US; rv:1.9.2.14) Gecko/20110224 Firefox/3.6.14 MB860/Version.0.43.3.MB860.AmericaMovil.en.MX&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; zh-CN; rv:1.9.2.14) Gecko/20110218 Firefox/3.6.14&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-AU; rv:1.9.2.14) Gecko/20110218 Firefox/3.6.14&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-GB; rv:1.9.2.14) Gecko/20110218 Firefox/3.6.14 GTB7.1 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.9.2.13) Firefox/3.6.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; pl-PL; rv:1.9.2.13) Gecko/20101206 Ubuntu/10.04 (lucid) Firefox/3.6.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; nb-NO; rv:1.9.2.13) Gecko/20101206 Ubuntu/10.04 (lucid) Firefox/3.6.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; it; rv:1.9.2.13) Gecko/20101206 Ubuntu/10.04 (lucid) Firefox/3.6.13 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; fr; rv:1.9.2.13) Gecko/20110103 Fedora/3.6.13-1.fc14 Firefox/3.6.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; fr; rv:1.9.2.13) Gecko/20101203 Firefox/3.6.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.13) Gecko/20101223 Gentoo Firefox/3.6.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.13) Gecko/20101219 Gentoo Firefox/3.6.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.13) Gecko/20101206 Red Hat/3.6-3.el4 Firefox/3.6.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.13) Gecko/20101206 Firefox/3.6.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-NZ; rv:1.9.2.13) Gecko/20101206 Ubuntu/10.10 (maverick) Firefox/3.6.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-GB; rv:1.9.2.13) Gecko/20101206 Ubuntu/9.10 (karmic) Firefox/3.6.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-GB; rv:1.9.2.13) Gecko/20101206 Red Hat/3.6-2.el5 Firefox/3.6.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; da-DK; rv:1.9.2.13) Gecko/20101206 Ubuntu/10.10 (maverick) Firefox/3.6.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux MIPS32 1074Kf CPS QuadCore; en-US; rv:1.9.2.13) Gecko/20110103 Fedora/3.6.13-1.fc14 Firefox/3.6.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; ru; rv:1.9.2.13) Gecko/20101206 Ubuntu/10.10 (maverick) Firefox/3.6.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; pt-BR; rv:1.9.2.13) Gecko/20101209 Fedora/3.6.13-1.fc13 Firefox/3.6.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; es-ES; rv:1.9.2.13) Gecko/20101206 Ubuntu/9.10 (karmic) Firefox/3.6.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; de; rv:1.9.2.13) Gecko/20101209 CentOS/3.6-2.el5.centos Firefox/3.6.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; de; rv:1.9.2.13) Gecko/20101206 Ubuntu/10.10 (maverick) Firefox/3.6.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; NetBSD i386; en-US; rv:1.9.2.12) Gecko/20101030 Firefox/3.6.12&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; es-MX; rv:1.9.2.12) Gecko/20101027 Ubuntu/10.04 (lucid) Firefox/3.6.12&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; es-ES; rv:1.9.2.12) Gecko/20101027 Fedora/3.6.12-1.fc13 Firefox/3.6.12&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; es-ES; rv:1.9.2.12) Gecko/20101026 SUSE/3.6.12-0.7.1 Firefox/3.6.12&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.12) Gecko/20101102 Gentoo Firefox/3.6.12&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.12) Gecko/20101102 Firefox/3.6.12&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux ppc; fr; rv:1.9.2.12) Gecko/20101027 Ubuntu/10.10 (maverick) Firefox/3.6.12&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; ko-KR; rv:1.9.2.12) Gecko/20101027 Ubuntu/10.10 (maverick) Firefox/3.6.12&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-GB; rv:1.9.2.12) Gecko/20101027 Ubuntu/10.10 (maverick) Firefox/3.6.12 GTB7.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; de; rv:1.9.2.12) Gecko/20101027 Fedora/3.6.12-1.fc13 Firefox/3.6.12&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; FreeBSD x86_64; rv:2.0) Gecko/20100101 Firefox/3.6.12&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; zh-CN; rv:1.9.2.12) Gecko/20101026 Firefox/3.6.12 ( .NET CLR 3.5.30729; .NET4.0E)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; sv-SE; rv:1.9.2.12) Gecko/20101026 Firefox/3.6.12&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.2.12) Gecko/20101026 Firefox/3.6.12 (.NET CLR 2.0.50727; .NET CLR 3.0.30729; .NET CLR 3.5.30729; .NET CLR 3.5.21022)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; de; rv:1.9.2.12) Gecko/20101026 Firefox/3.6.12 GTB5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; ru; rv:1.9.2.11) Gecko/20101028 CentOS/3.6-2.el5.centos Firefox/3.6.11&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux armv7l; en-GB; rv:1.9.2.3pre) Gecko/20100723 Firefox/3.6.11&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.2; ru; rv:1.9.2.11) Gecko/20101012 Firefox/3.6.11&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; it; rv:1.9.2.11) Gecko/20101012 Firefox/3.6.11 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; zh-CN; rv:1.9.2.10) Gecko/20100922 Ubuntu/10.10 (maverick) Firefox/3.6.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; pt-BR; rv:1.9.2.10) Gecko/20100922 Ubuntu/10.10 (maverick) Firefox/3.6.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; pl-PL; rv:1.9.2.10) Gecko/20100922 Ubuntu/10.10 (maverick) Firefox/3.6.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.10) Gecko/20100922 Ubuntu/10.10 (maverick) Firefox/3.6.10 GTB7.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; el-GR; rv:1.9.2.10) Gecko/20100922 Ubuntu/10.10 (maverick) Firefox/3.6.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; de; rv:1.9.2.10) Gecko/20100922 Ubuntu/10.10 (maverick) Firefox/3.6.10 GTB7.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; cs-CZ; rv:1.9.2.10) Gecko/20100915 Ubuntu/10.04 (lucid) Firefox/3.6.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; pl-PL; rv:1.9.2.10) Gecko/20100915 Ubuntu/10.04 (lucid) Firefox/3.6.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; fr-FR; rv:1.9.2.10) Gecko/20100914 Firefox/3.6.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; es-AR; rv:1.9.2.10) Gecko/20100922 Ubuntu/10.10 (maverick) Firefox/3.6.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.10) Gecko/20100915 Ubuntu/9.04 (jaunty) Firefox/3.6.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-GB; rv:1.9.2.11) Gecko/20101013 Ubuntu/10.10 (maverick) Firefox/3.6.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-CA; rv:1.9.2.10) Gecko/20100922 Ubuntu/10.10 (maverick) Firefox/3.6.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; de; rv:1.9.2.10) Gecko/20100922 Ubuntu/10.10 (maverick) Firefox/3.6.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; de; rv:1.9.2.10) Gecko/20100915 Ubuntu/9.10 (karmic) Firefox/3.6.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; de; rv:1.9.2.10) Gecko/20100915 Ubuntu/10.04 (lucid) Firefox/3.6.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; de; rv:1.9.2.10) Gecko/20100914 SUSE/3.6.10-0.3.1 Firefox/3.6.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; ro; rv:1.9.2.10) Gecko/20100914 Firefox/3.6.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; nl; rv:1.9.2.10) Gecko/20100914 Firefox/3.6.10 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; fr; rv:1.9.2.10) Gecko/20100914 Firefox/3.6.10 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.1) Gecko/20100122 firefox/3.6.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0(Windows; U; Windows NT 7.0; rv:1.9.2) Gecko/20100101 Firefox/3.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0(Windows; U; Windows NT 5.2; rv:1.9.2) Gecko/20100101 Firefox/3.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2) Gecko/20100222 Ubuntu/10.04 (lucid) Firefox/3.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2) Gecko/20100130 Gentoo Firefox/3.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; de; rv:1.9.2) Gecko/20100308 Ubuntu/10.04 (lucid) Firefox/3.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.2pre) Gecko/20100312 Ubuntu/9.04 (jaunty) Firefox/3.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2) Gecko/20100128 Gentoo Firefox/3.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2) Gecko/20100115 Ubuntu/10.04 (lucid) Firefox/3.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2) Gecko/20100115 Firefox/3.6 FirePHP/0.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; Linux i686; rv:2.0) Gecko/20100101 Firefox/3.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; FreeBSD i686) Firefox/3.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; ru-RU; rv:1.9.2) Gecko/20100105 MRA 5.6 (build 03278) Firefox/3.6 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; lt; rv:1.9.2) Gecko/20100115 Firefox/3.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.3a3pre) Gecko/20100306 Firefox3.6 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.8) Gecko/20100806 Firefox/3.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-GB; rv:1.9.2.3) Gecko/20100401 Firefox/3.6;MEGAUPLOAD 1.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; ar; rv:1.9.2) Gecko/20100115 Firefox/3.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; ru; rv:1.9.2) Gecko/20100115 Firefox/3.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; ru; rv:1.9.2) Gecko/20100105 Firefox/3.6 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; pl; rv:1.9.2) Gecko/20100115 Firefox/3.6 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1b5pre) Gecko/20090517 Firefox/3.5b4pre (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1b4pre) Gecko/20090409 Firefox/3.5b4pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1b4pre) Gecko/20090401 Firefox/3.5b4pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; nl-NL; rv:1.9.1b4) Gecko/20090423 Firefox/3.5b4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.1b4) Gecko/20090423 Firefox/3.5b4 GTB5 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-GB; rv:1.9.1b4) Gecko/20090423 Firefox/3.5b4 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9.1b4) Gecko/20090423 Firefox/3.5b4 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9.1b4) Gecko/20090423 Firefox/3.5b4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1b4) Gecko/20090423 Firefox/3.5b4 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-GB; rv:1.9.1b4) Gecko/20090423 Firefox/3.5b4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; fr; rv:1.9.1b4) Gecko/20090423 Firefox/3.5b4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b4) Gecko/20090423 Firefox/3.5b4 GTB5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; it; rv:1.9.1.9) Gecko/20100402 Ubuntu/9.10 (karmic) Firefox/3.5.9 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; it; rv:1.9.1.9) Gecko/20100330 Fedora/3.5.9-2.fc12 Firefox/3.5.9&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; fr; rv:1.9.1.9) Gecko/20100317 SUSE/3.5.9-0.1.1 Firefox/3.5.9 GTB7.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; es-CL; rv:1.9.1.9) Gecko/20100402 Ubuntu/9.10 (karmic) Firefox/3.5.9&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; cs-CZ; rv:1.9.1.9) Gecko/20100317 SUSE/3.5.9-0.1.1 Firefox/3.5.9&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; nl; rv:1.9.1.9) Gecko/20100401 Ubuntu/9.10 (karmic) Firefox/3.5.9&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; hu-HU; rv:1.9.1.9) Gecko/20100330 Fedora/3.5.9-1.fc12 Firefox/3.5.9&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; es-ES; rv:1.9.1.9) Gecko/20100317 SUSE/3.5.9-0.1 Firefox/3.5.9&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1.9) Gecko/20100401 Ubuntu/9.10 (karmic) Firefox/3.5.9 GTB7.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1.9) Gecko/20100315 Ubuntu/9.10 (karmic) Firefox/3.5.9&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1.4) Gecko/20091028 Ubuntu/9.10 (karmic) Firefox/3.5.9&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; tr; rv:1.9.1.9) Gecko/20100315 Firefox/3.5.9 GTB7.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; hu; rv:1.9.1.9) Gecko/20100315 Firefox/3.5.9 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; fr; rv:1.9.1.9) Gecko/20100315 Firefox/3.5.9&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; et; rv:1.9.1.9) Gecko/20100315 Firefox/3.5.9&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.9) Gecko/20100315 Firefox/3.5.9&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; nl; rv:1.9.1.9) Gecko/20100315 Firefox/3.5.9 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; es-ES; rv:1.9.1.9) Gecko/20100315 Firefox/3.5.9 GTB5 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; de; rv:1.9.2.13) Gecko/20101203 Firefox/3.5.9 (de)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; de; rv:1.9.1.9) Gecko/20100315 Firefox/3.5.9 GTB7.0 (.NET CLR 3.0.30618)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; ru; rv:1.9.1.8) Gecko/20100216 Fedora/3.5.8-1.fc12 Firefox/3.5.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; es-ES; rv:1.9.1.8) Gecko/20100216 Fedora/3.5.8-1.fc11 Firefox/3.5.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.1.8) Gecko/20100318 Gentoo Firefox/3.5.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; zh-CN; rv:1.9.1.8) Gecko/20100216 Fedora/3.5.8-1.fc12 Firefox/3.5.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; ja-JP; rv:1.9.1.8) Gecko/20100216 Fedora/3.5.8-1.fc12 Firefox/3.5.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; es-AR; rv:1.9.1.8) Gecko/20100214 Ubuntu/9.10 (karmic) Firefox/3.5.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; de; rv:1.9.1.8) Gecko/20100214 Ubuntu/9.10 (karmic) Firefox/3.5.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; de; rv:1.9.1.8) Gecko/20100202 Firefox/3.5.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; FreeBSD i386; ja-JP; rv:1.9.1.8) Gecko/20100305 Firefox/3.5.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; sl; rv:1.9.1.8) Gecko/20100202 Firefox/3.5.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.1.8) Gecko/20100202 Firefox/3.5.8 (.NET CLR 3.5.30729) FirePHP/0.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-TW; rv:1.9.1.8) Gecko/20100202 Firefox/3.5.8 GTB6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; ja; rv:1.9.1.8) Gecko/20100202 Firefox/3.5.8 GTB7.0 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2) Gecko/20100305 Gentoo Firefox/3.5.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; cs-CZ; rv:1.9.1.7) Gecko/20100106 Ubuntu/9.10 (karmic) Firefox/3.5.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; es-ES; rv:1.9.1.7) Gecko/20091222 SUSE/3.5.7-1.1.1 Firefox/3.5.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; ja; rv:1.9.1.7) Gecko/20091221 Firefox/3.5.7 GTB6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; de; rv:1.9.1.7) Gecko/20091221 Firefox/3.5.7 (.NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.2; fr; rv:1.9.1.7) Gecko/20091221 Firefox/3.5.7 (.NET CLR 3.0.04506.648)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; fa; rv:1.9.1.7) Gecko/20091221 Firefox/3.5.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.7) Gecko/20091221 MRA 5.5 (build 02842) Firefox/3.5.7 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; fr; rv:1.9.1.6) Gecko/20091215 Ubuntu/9.10 (karmic) Firefox/3.5.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.1.6) Gecko/20100117 Gentoo Firefox/3.5.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; zh-CN; rv:1.9.1.6) Gecko/20091216 Fedora/3.5.6-1.fc11 Firefox/3.5.6 GTB6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; es-ES; rv:1.9.1.6) Gecko/20091201 SUSE/3.5.6-1.1.1 Firefox/3.5.6 GTB6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1.6) Gecko/20100118 Gentoo Firefox/3.5.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-GB; rv:1.9.1.6) Gecko/20091215 Ubuntu/9.10 (karmic) Firefox/3.5.6 GTB6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; de; rv:1.9.1.6) Gecko/20091215 Ubuntu/9.10 (karmic) Firefox/3.5.6 GTB7.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; de; rv:1.9.1.6) Gecko/20091215 Ubuntu/9.10 (karmic) Firefox/3.5.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; de; rv:1.9.1.6) Gecko/20091201 SUSE/3.5.6-1.1.1 Firefox/3.5.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; cs-CZ; rv:1.9.1.6) Gecko/20100107 Fedora/3.5.6-1.fc12 Firefox/3.5.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; ca; rv:1.9.1.6) Gecko/20091215 Ubuntu/9.10 (karmic) Firefox/3.5.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; it; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; id; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.1.6) Gecko/20091201 MRA 5.4 (build 02647) Firefox/3.5.6 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; nl; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 (.NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.6) Gecko/20091201 MRA 5.5 (build 02842) Firefox/3.5.6 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.6) Gecko/20091201 MRA 5.5 (build 02842) Firefox/3.5.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 GTB6 (.NET CLR 3.5.30729) FBSMTWB&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 (.NET CLR 3.5.30729) FBSMTWB&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; fr; rv:1.9.1.5) Gecko/20091109 Ubuntu/9.10 (karmic) Firefox/3.5.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.1.8pre) Gecko/20091227 Ubuntu/9.10 (karmic) Firefox/3.5.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.1.5) Gecko/20091114 Gentoo Firefox/3.5.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686 (x86_64); en-US; rv:1.9.1.5) Gecko/20091102 Firefox/3.5.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; uk; rv:1.9.1.5) Gecko/20091102 Firefox/3.5.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.5) Gecko/20091102 MRA 5.5 (build 02842) Firefox/3.5.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; ru; rv:1.9.1.5) Gecko/20091102 MRA 5.5 (build 02842) Firefox/3.5.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-GB; rv:1.9.1.5) Gecko/20091102 Firefox/3.5.5 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.2; zh-CN; rv:1.9.1.5) Gecko/Firefox/3.5.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.5) Gecko/20091102 MRA 5.5 (build 02842) Firefox/3.5.5 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.5) Gecko/20091102 MRA 5.5 (build 02842) Firefox/3.5.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 5.1; U; zh-cn; rv:1.8.1) Gecko/20091102 Firefox/3.5.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; pl; rv:1.9.1.5) Gecko/20091102 Firefox/3.5.5 FBSMTWB&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; ja; rv:1.9.1.4) Gecko/20091016 SUSE/3.5.4-1.1.2 Firefox/3.5.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.4) Gecko/20091016 Firefox/3.5.4 (.NET CLR 3.5.30729) FBSMTWB&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.2; en-US; rv:1.9.1.4) Gecko/20091007 Firefox/3.5.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; ru-RU; rv:1.9.1.4) Gecko/20091016 Firefox/3.5.4 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-GB; rv:1.9.1.4) Gecko/20091016 Firefox/3.5.4 ( .NET CLR 3.5.30729; .NET4.0E)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.9.1.4) Gecko/20091007 Firefox/3.5.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; fr; rv:1.9.1.5) Gecko/20091109 Ubuntu/9.10 (karmic) Firefox/3.5.3pre&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.1.3) Gecko/20090914 Slackware/13.0_stable Firefox/3.5.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.1.3) Gecko/20090913 Firefox/3.5.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; ru; rv:1.9.1.3) Gecko/20091020 Ubuntu/9.10 (karmic) Firefox/3.5.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; fr; rv:1.9.1.3) Gecko/20090913 Firefox/3.5.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1.3) Gecko/20090919 Firefox/3.5.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1.3) Gecko/20090912 Gentoo Firefox/3.5.3 FirePHP/0.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-GB; rv:1.9.1.3) Gecko/20090824 Firefox/3.5.3 GTB5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; FreeBSD i386; ru-RU; rv:1.9.1.3) Gecko/20090913 Firefox/3.5.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; zh-CN; rv:1.9.1.3) Gecko/20090824 Firefox/3.5.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; fr; rv:1.9.1.3) Gecko/20090824 Firefox/3.5.3 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en; rv:1.9.1.3) Gecko/20090824 Firefox/3.5.3 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.5.3;MEGAUPLOAD 1.0 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; de; rv:1.9.1.3) Gecko/20090824 Firefox/3.5.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; de-DE; rv:1.9.1.3) Gecko/20090824 Firefox/3.5.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; ko; rv:1.9.1.3) Gecko/20090824 Firefox/3.5.3 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; fi; rv:1.9.1.3) Gecko/20090824 Firefox/3.5.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.1.3) Gecko/20090824 Firefox/3.5.3 (.NET CLR 2.0.50727; .NET CLR 3.0.30618; .NET CLR 3.5.21022; .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; bg; rv:1.9.1.3) Gecko/20090824 Firefox/3.5.3 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.2; en-US; rv:1.9.1.3) Gecko/20090824 Firefox/3.5.3 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; ko; rv:1.9.1.3) Gecko/20090824 Firefox/3.5.3 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; pl; rv:1.9.1.2) Gecko/20090911 Slackware Firefox/3.5.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.1.2) Gecko/20090803 Slackware Firefox/3.5.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.1.2) Gecko/20090803 Firefox/3.5.2 Slackware&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; ru-RU; rv:1.9.1.2) Gecko/20090804 Firefox/3.5.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1.2) Gecko/20090729 Slackware/13.0 Firefox/3.5.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686 (x86_64); fr; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; zh-CN; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-GB; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; pl; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2 GTB7.1 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; es-MX; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-GB; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; de; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; de; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-TW; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; uk; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; pt-BR; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; ja; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; ja; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; es-ES; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.16) Gecko/20101130 Firefox/3.5.16 FirePHP/0.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; de; rv:1.9.1.16) Gecko/20101130 AskTbMYC/3.9.1.14019 Firefox/3.5.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; it; rv:1.9.1.16) Gecko/20101130 Firefox/3.5.16 GTB7.1 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.1.16) Gecko/20101130 MRA 5.4 (build 02647) Firefox/3.5.16 ( .NET CLR 3.5.30729; .NET4.0C)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.16) Gecko/20101130 Firefox/3.5.16 GTB7.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.16) Gecko/20101130 AskTbPLTV5/3.8.0.12304 Firefox/3.5.16 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-GB; rv:1.9.1.16) Gecko/20101130 Firefox/3.5.16 GTB7.1 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-GB; rv:1.9.1.16) Gecko/20101130 Firefox/3.5.16 GTB7.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; it; rv:1.9.1.15) Gecko/20101027 Fedora/3.5.15-1.fc12 Firefox/3.5.15&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-GB; rv:1.9.1.15) Gecko/20101027 Fedora/3.5.15-1.fc12 Firefox/3.5.15&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.0; ru; rv:1.9.1.13) Gecko/20100914 Firefox/3.5.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.0.12) Gecko/2009070611 Firefox/3.5.12&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; ru; rv:1.9.1.12) Gecko/20100824 MRA 5.7 (build 03755) Firefox/3.5.12&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux; en-US; rv:1.9.1.11) Gecko/20100720 Firefox/3.5.11&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; de; rv:1.9.1.11) Gecko/20100701 Firefox/3.5.11 ( .NET CLR 3.5.30729; .NET4.0C)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; pt-BR; rv:1.9.1.11) Gecko/20100701 Firefox/3.5.11 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; hu; rv:1.9.1.11) Gecko/20100701 Firefox/3.5.11&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.10) Gecko/20100504 Firefox/3.5.11 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; de; rv:1.9.1.10) Gecko/20100506 SUSE/3.5.10-0.1.1 Firefox/3.5.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-GB; rv:1.9.1.10) Gecko/20100504 Firefox/3.5.10 GTB7.0 ( .NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; rv:1.9.1.1) Gecko/20090716 Linux Firefox/3.5.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.3) Gecko/20100524 Firefox/3.5.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.1.1) Gecko/20090716 Linux Mint/7 (Gloria) Firefox/3.5.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.1.1) Gecko/20090716 Firefox/3.5.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.1.1) Gecko/20090714 SUSE/3.5.1-1.1 Firefox/3.5.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86; rv:1.9.1.1) Gecko/20090716 Linux Firefox/3.5.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; nl; rv:1.9.1.1) Gecko/20090715 Firefox/3.5.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1.2pre) Gecko/20090729 Ubuntu/9.04 (jaunty) Firefox/3.5.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1.1) Gecko/20090715 Firefox/3.5.1 GTB5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; de; rv:1.9.1.1) Gecko/20090722 Gentoo Firefox/3.5.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; de; rv:1.9.1.1) Gecko/20090714 SUSE/3.5.1-1.1 Firefox/3.5.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; DragonFly i386; de; rv:1.9.1) Gecko/20090720 Firefox/3.5.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.1) Gecko/20090718 Firefox/3.5.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; de; rv:1.9.1.1) Gecko/20090715 Firefox/3.5.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; tr; rv:1.9.1.1) Gecko/20090715 Firefox/3.5.1 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; sv-SE; rv:1.9.1.1) Gecko/20090715 Firefox/3.5.1 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; ja; rv:1.9.1.1) Gecko/20090715 Firefox/3.5.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-GB; rv:1.9.1.1) Gecko/20090715 Firefox/3.5.1 GTB5 (.NET CLR 4.0.20506)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-GB; rv:1.9.1.1) Gecko/20090715 Firefox/3.5.1 GTB5 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; de; rv:1.9.1.1) Gecko/20090715 Firefox/3.5.1 GTB5 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11;U; Linux i686; en-GB; rv:1.9.1) Gecko/20090624 Ubuntu/9.04 (jaunty) Firefox/3.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.1) Gecko/20090630 Firefox/3.5 GTB6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; ja; rv:1.9.1) Gecko/20090624 Firefox/3.5 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; it-IT; rv:1.9.0.2) Gecko/2008092313 Ubuntu/9.04 (jaunty) Firefox/3.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; fr; rv:1.9.1) Gecko/20090624 Firefox/3.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; fr-FR; rv:1.9.1) Gecko/20090624 Ubuntu/9.04 (jaunty) Firefox/3.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1) Gecko/20090701 Ubuntu/9.04 (jaunty) Firefox/3.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-us; rv:1.9.0.2) Gecko/2008092313 Ubuntu/9.04 (jaunty) Firefox/3.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; de; rv:1.9.1) Gecko/20090624 Ubuntu/8.04 (hardy) Firefox/3.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; de; rv:1.9.1) Gecko/20090624 Firefox/3.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686 (x86_64); de; rv:1.9.1) Gecko/20090624 Firefox/3.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.9.1) Gecko/20090703 Firefox/3.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.9.0.10) Gecko/20090624 Firefox/3.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; pl; rv:1.9.1) Gecko/20090624 Firefox/3.5 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; es-ES; rv:1.9.1) Gecko/20090624 Firefox/3.5 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1) Gecko/20090612 Firefox/3.5 (.NET CLR 4.0.20506)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1) Gecko/20090612 Firefox/3.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; de; rv:1.9.1) Gecko/20090624 Firefox/3.5 (.NET CLR 4.0.20506)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; de; rv:1.9.1) Gecko/20090624 Firefox/3.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; zh-TW; rv:1.9.1) Gecko/20090624 Firefox/3.5 (.NET CLR 3.5.30729)&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 5.1) AppleWebKit/534.25 (KHTML, like Gecko) Chrome/12.0.706.0 Safari/534.25&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/534.24 (KHTML, like Gecko) Ubuntu/10.10 Chromium/12.0.703.0 Chrome/12.0.703.0 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; Linux i686) AppleWebKit/534.24 (KHTML, like Gecko) Ubuntu/10.10 Chromium/12.0.702.0 Chrome/12.0.702.0 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/12.0.702.0 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/12.0.702.0 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.699.0 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.0; WOW64) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.699.0 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_6) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.698.0 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.697.0 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 5.1) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.696.43 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.696.34 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.0; WOW64) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.696.34 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.696.3 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.696.3 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.0) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.696.3 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; Linux i686) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.696.14 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.696.12 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_6) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.696.12 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/534.24 (KHTML, like Gecko) Ubuntu/10.04 Chromium/11.0.696.0 Chrome/11.0.696.0 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_0) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.696.0 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.694.0 Safari/534.24&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; Linux i686) AppleWebKit/534.23 (KHTML, like Gecko) Chrome/11.0.686.3 Safari/534.23&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.21 (KHTML, like Gecko) Chrome/11.0.682.0 Safari/534.21&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.21 (KHTML, like Gecko) Chrome/11.0.678.0 Safari/534.21&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_7_0; en-US) AppleWebKit/534.21 (KHTML, like Gecko) Chrome/11.0.678.0 Safari/534.21&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/534.20 (KHTML, like Gecko) Chrome/11.0.672.2 Safari/534.20&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT) AppleWebKit/534.20 (KHTML, like Gecko) Chrome/11.0.672.2 Safari/534.20&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_6; en-US) AppleWebKit/534.20 (KHTML, like Gecko) Chrome/11.0.672.2 Safari/534.20&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.20 (KHTML, like Gecko) Chrome/11.0.669.0 Safari/534.20&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.19 (KHTML, like Gecko) Chrome/11.0.661.0 Safari/534.19&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.18 (KHTML, like Gecko) Chrome/11.0.661.0 Safari/534.18&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_6; en-US) AppleWebKit/534.18 (KHTML, like Gecko) Chrome/11.0.660.0 Safari/534.18&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.17 (KHTML, like Gecko) Chrome/11.0.655.0 Safari/534.17&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_4; en-US) AppleWebKit/534.17 (KHTML, like Gecko) Chrome/11.0.655.0 Safari/534.17&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.17 (KHTML, like Gecko) Chrome/11.0.654.0 Safari/534.17&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.2; en-US) AppleWebKit/534.17 (KHTML, like Gecko) Chrome/11.0.652.0 Safari/534.17&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.17 (KHTML, like Gecko) Chrome/10.0.649.0 Safari/534.17&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; de-DE) AppleWebKit/534.17 (KHTML, like Gecko) Chrome/10.0.649.0 Safari/534.17&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.82 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux armv7l; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.204 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; FreeBSD x86_64; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.204 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; FreeBSD i386; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.204 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_5; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.204&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.134 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.134 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.134 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_6; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.134 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Ubuntu/10.10 Chromium/10.0.648.133 Chrome/10.0.648.133 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.133 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Ubuntu/10.10 Chromium/10.0.648.133 Chrome/10.0.648.133 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.133 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.133 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_3; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.133 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_2; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.133 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Ubuntu/10.10 Chromium/10.0.648.127 Chrome/10.0.648.127 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.127 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_4; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.127 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_8; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.127 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.11 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; ru-RU) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.11 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.11 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Ubuntu/10.10 Chromium/10.0.648.0 Chrome/10.0.648.0 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Ubuntu/10.10 Chromium/10.0.648.0 Chrome/10.0.648.0 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_4; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.0 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Ubuntu/10.10 Chromium/10.0.642.0 Chrome/10.0.642.0 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_5; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.639.0 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.638.0 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686 (x86_64); en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.634.0 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.634.0 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.16 SUSE/10.0.626.0 (KHTML, like Gecko) Chrome/10.0.626.0 Safari/534.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.15 (KHTML, like Gecko) Chrome/10.0.613.0 Safari/534.15&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US) AppleWebKit/534.15 (KHTML, like Gecko) Ubuntu/10.10 Chromium/10.0.613.0 Chrome/10.0.613.0 Safari/534.15&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US) AppleWebKit/534.15 (KHTML, like Gecko) Ubuntu/10.04 Chromium/10.0.612.3 Chrome/10.0.612.3 Safari/534.15&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US) AppleWebKit/534.15 (KHTML, like Gecko) Chrome/10.0.612.1 Safari/534.15&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US) AppleWebKit/534.15 (KHTML, like Gecko) Ubuntu/10.10 Chromium/10.0.611.0 Chrome/10.0.611.0 Safari/534.15&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.14 (KHTML, like Gecko) Chrome/10.0.602.0 Safari/534.14&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.14 (KHTML, like Gecko) Chrome/10.0.601.0 Safari/534.14&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.14 (KHTML, like Gecko) Chrome/10.0.601.0 Safari/534.14&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/540.0 (KHTML,like Gecko) Chrome/9.1.0.0 Safari/540.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/540.0 (KHTML, like Gecko) Ubuntu/10.10 Chrome/9.1.0.0 Safari/540.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/534.14 (KHTML, like Gecko) Chrome/9.0.601.0 Safari/534.14&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.14 (KHTML, like Gecko) Ubuntu/10.10 Chromium/9.0.600.0 Chrome/9.0.600.0 Safari/534.14&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.14 (KHTML, like Gecko) Chrome/9.0.600.0 Safari/534.14&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.13 (KHTML, like Gecko) Chrome/9.0.599.0 Safari/534.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US) AppleWebKit/534.13 (KHTML, like Gecko) Chrome/9.0.597.84 Safari/534.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US) AppleWebKit/534.13 (KHTML, like Gecko) Chrome/9.0.597.44 Safari/534.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.13 (KHTML, like Gecko) Chrome/9.0.597.19 Safari/534.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.13 (KHTML, like Gecko) Chrome/9.0.597.15 Safari/534.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_5; en-US) AppleWebKit/534.13 (KHTML, like Gecko) Chrome/9.0.597.15 Safari/534.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.13 (KHTML, like Gecko) Chrome/9.0.597.0 Safari/534.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.13 (KHTML, like Gecko) Chrome/9.0.597.0 Safari/534.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/534.13 (KHTML, like Gecko) Chrome/9.0.597.0 Safari/534.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.13 (KHTML, like Gecko) Chrome/9.0.597.0 Safari/534.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_5; en-US) AppleWebKit/534.13 (KHTML, like Gecko) Chrome/9.0.597.0 Safari/534.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_4; en-US) AppleWebKit/534.13 (KHTML, like Gecko) Chrome/9.0.597.0 Safari/534.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.13 (KHTML, like Gecko) Chrome/9.0.596.0 Safari/534.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.13 (KHTML, like Gecko) Ubuntu/10.04 Chromium/9.0.595.0 Chrome/9.0.595.0 Safari/534.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US) AppleWebKit/534.13 (KHTML, like Gecko) Ubuntu/9.10 Chromium/9.0.592.0 Chrome/9.0.592.0 Safari/534.13&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Windows NT 6; en-US) AppleWebKit/534.12 (KHTML, like Gecko) Chrome/9.0.587.0 Safari/534.12&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US) AppleWebKit/534.12 (KHTML, like Gecko) Chrome/9.0.579.0 Safari/534.12&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686 (x86_64); en-US) AppleWebKit/534.12 (KHTML, like Gecko) Chrome/9.0.576.0 Safari/534.12&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/540.0 (KHTML, like Gecko) Ubuntu/10.10 Chrome/8.1.0.0 Safari/540.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.2; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.558.0 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; CrOS i686 0.9.130; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.344 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; CrOS i686 0.9.128; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.343 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; CrOS i686 0.9.128; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.341 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; CrOS i686 0.9.128; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.339 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; CrOS i686 0.9.128; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.339&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Ubuntu/10.10 Chromium/8.0.552.237 Chrome/8.0.552.237 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; de-DE) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.224 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/533.3 (KHTML, like Gecko) Chrome/8.0.552.224 Safari/533.3&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_8; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.224 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.215 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.215 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.215 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_4; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.210 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.200 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.551.0 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/7.0.548.0 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/7.0.544.0 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.1.15) Gecko/20101027 Mozilla/5.0 (Windows; U; Windows NT 5.2; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/7.0.540.0 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/7.0.540.0 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; de-DE) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/7.0.540.0 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.2; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/7.0.540.0 Safari/534.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.9 (KHTML, like Gecko) Chrome/7.0.531.0 Safari/534.9&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/534.8 (KHTML, like Gecko) Chrome/7.0.521.0 Safari/534.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux i686; en-US) AppleWebKit/534.7 (KHTML, like Gecko) Chrome/7.0.517.24 Safari/534.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; fr-FR) AppleWebKit/534.7 (KHTML, like Gecko) Chrome/7.0.514.0 Safari/534.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.7 (KHTML, like Gecko) Chrome/7.0.514.0 Safari/534.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.7 (KHTML, like Gecko) Chrome/7.0.514.0 Safari/534.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.6 (KHTML, like Gecko) Chrome/7.0.500.0 Safari/534.6&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; tr-TR) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; ko-KR) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; fr-FR) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; cs-CZ) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; ja-JP) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_5_8; zh-cn) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_5_8; ja-jp) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_7; ja-jp) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_6; zh-cn) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_6; sv-se) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_6; ko-kr) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_6; ja-jp) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_6; it-it) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_6; fr-fr) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_6; es-es) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_6; en-us) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_6; en-gb) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_6; de-de) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; sv-SE) AppleWebKit/533.19.4 (KHTML, like Gecko) Version/5.0.3 Safari/533.19.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; ja-JP) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.3 Safari/533.19.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; de-DE) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.3 Safari/533.19.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; hu-HU) AppleWebKit/533.19.4 (KHTML, like Gecko) Version/5.0.3 Safari/533.19.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.3 Safari/533.19.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; de-DE) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.3 Safari/533.19.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; ru-RU) AppleWebKit/533.19.4 (KHTML, like Gecko) Version/5.0.3 Safari/533.19.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; ja-JP) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.3 Safari/533.19.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; it-IT) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.3 Safari/533.19.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.3 Safari/533.19.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_7; en-us) AppleWebKit/534.16+ (KHTML, like Gecko) Version/5.0.3 Safari/533.19.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_6; fr-ch) AppleWebKit/533.19.4 (KHTML, like Gecko) Version/5.0.3 Safari/533.19.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_5; de-de) AppleWebKit/534.15+ (KHTML, like Gecko) Version/5.0.3 Safari/533.19.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_5; ar) AppleWebKit/533.19.4 (KHTML, like Gecko) Version/5.0.3 Safari/533.19.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Android 2.2; Windows; U; Windows NT 6.1; en-US) AppleWebKit/533.19.4 (KHTML, like Gecko) Version/5.0.3 Safari/533.19.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; zh-HK) AppleWebKit/533.18.1 (KHTML, like Gecko) Version/5.0.2 Safari/533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/533.19.4 (KHTML, like Gecko) Version/5.0.2 Safari/533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; tr-TR) AppleWebKit/533.18.1 (KHTML, like Gecko) Version/5.0.2 Safari/533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; nb-NO) AppleWebKit/533.18.1 (KHTML, like Gecko) Version/5.0.2 Safari/533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; fr-FR) AppleWebKit/533.18.1 (KHTML, like Gecko) Version/5.0.2 Safari/533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-TW) AppleWebKit/533.19.4 (KHTML, like Gecko) Version/5.0.2 Safari/533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; ru-RU) AppleWebKit/533.18.1 (KHTML, like Gecko) Version/5.0.2 Safari/533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_8; zh-cn) AppleWebKit/533.18.1 (KHTML, like Gecko) Version/5.0.2 Safari/533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPod; U; CPU iPhone OS 4_3_1 like Mac OS X; zh-cn) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8G4 Safari/6533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPod; U; CPU iPhone OS 4_2_1 like Mac OS X; he-il) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8C148 Safari/6533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPhone; U; fr; CPU iPhone OS 4_2_1 like Mac OS X; fr) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8C148a Safari/6533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_3_1 like Mac OS X; zh-tw) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8G4 Safari/6533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_3 like Mac OS X; pl-pl) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8F190 Safari/6533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_3 like Mac OS X; fr-fr) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8F190 Safari/6533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_3 like Mac OS X; en-gb) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8F190 Safari/6533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_2_1 like Mac OS X; nb-no) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8C148a Safari/6533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_2_1 like Mac OS X; it-it) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8C148a Safari/6533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_2_1 like Mac OS X; fr) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8C148a Safari/6533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_2_1 like Mac OS X; fi-fi) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8C148a Safari/6533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_2_1 like Mac OS X; fi-fi) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8C148 Safari/6533.18.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.2; en-US) AppleWebKit/533.17.8 (KHTML, like Gecko) Version/5.0.1 Safari/533.17.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_4; th-th) AppleWebKit/533.17.8 (KHTML, like Gecko) Version/5.0.1 Safari/533.17.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-us) AppleWebKit/531.2+ (KHTML, like Gecko) Version/5.0 Safari/531.2+&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; U; Linux x86_64; en-ca) AppleWebKit/531.2+ (KHTML, like Gecko) Version/5.0 Safari/531.2+&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; ja-JP) AppleWebKit/533.16 (KHTML, like Gecko) Version/5.0 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; es-ES) AppleWebKit/533.18.1 (KHTML, like Gecko) Version/5.0 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/533.18.1 (KHTML, like Gecko) Version/5.0 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; ja-JP) AppleWebKit/533.16 (KHTML, like Gecko) Version/5.0 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_5_8; ja-jp) AppleWebKit/533.16 (KHTML, like Gecko) Version/5.0 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_4_11; fr) AppleWebKit/533.16 (KHTML, like Gecko) Version/5.0 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_3; zh-cn) AppleWebKit/533.16 (KHTML, like Gecko) Version/5.0 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_3; ru-ru) AppleWebKit/533.16 (KHTML, like Gecko) Version/5.0 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_3; ko-kr) AppleWebKit/533.16 (KHTML, like Gecko) Version/5.0 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_3; it-it) AppleWebKit/533.16 (KHTML, like Gecko) Version/5.0 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_3; en-us) AppleWebKit/534.1+ (KHTML, like Gecko) Version/5.0 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_3; en-au) AppleWebKit/533.16 (KHTML, like Gecko) Version/5.0 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_3; el-gr) AppleWebKit/533.16 (KHTML, like Gecko) Version/5.0 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_3; ca-es) AppleWebKit/533.16 (KHTML, like Gecko) Version/5.0 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_8; zh-tw) AppleWebKit/533.16 (KHTML, like Gecko) Version/5.0 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_8; ja-jp) AppleWebKit/533.16 (KHTML, like Gecko) Version/5.0 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_8; it-it) AppleWebKit/533.16 (KHTML, like Gecko) Version/5.0 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_8; fr-fr) AppleWebKit/533.16 (KHTML, like Gecko) Version/5.0 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.0; en-en) AppleWebKit/533.16 (KHTML, like Gecko) Version/4.1 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_4_11; nl-nl) AppleWebKit/533.16 (KHTML, like Gecko) Version/4.1 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_4_11; ja-jp) AppleWebKit/533.16 (KHTML, like Gecko) Version/4.1 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_4_11; de-de) AppleWebKit/533.16 (KHTML, like Gecko) Version/4.1 Safari/533.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_7; en-us) AppleWebKit/533.4 (KHTML, like Gecko) Version/4.1 Safari/533.4&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en) AppleWebKit/526.9 (KHTML, like Gecko) Version/4.0dp1 Safari/526.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_4_11; tr) AppleWebKit/528.4+ (KHTML, like Gecko) Version/4.0dp1 Safari/526.11.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_4_11; en) AppleWebKit/528.4+ (KHTML, like Gecko) Version/4.0dp1 Safari/526.11.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_4_11; de) AppleWebKit/528.4+ (KHTML, like Gecko) Version/4.0dp1 Safari/526.11.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10.5; en-US; rv:1.9.1b3pre) Gecko/20081212 Mozilla/5.0 (Windows; U; Windows NT 5.1; en) AppleWebKit/526.9 (KHTML, like Gecko) Version/4.0dp1 Safari/526.8&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_6; en-gb) AppleWebKit/528.10+ (KHTML, like Gecko) Version/4.0dp1 Safari/526.11.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_4; en-us) AppleWebKit/528.4+ (KHTML, like Gecko) Version/4.0dp1 Safari/526.11.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_4; en-gb) AppleWebKit/528.4+ (KHTML, like Gecko) Version/4.0dp1 Safari/526.11.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; es-ES) AppleWebKit/531.22.7 (KHTML, like Gecko) Version/4.0.5 Safari/531.22.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/533.18.1 (KHTML, like Gecko) Version/4.0.5 Safari/531.22.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/531.22.7 (KHTML, like Gecko) Version/4.0.5 Safari/531.22.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-gb) AppleWebKit/531.22.7 (KHTML, like Gecko) Version/4.0.5 Safari/531.22.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; cs-CZ) AppleWebKit/531.22.7 (KHTML, like Gecko) Version/4.0.5 Safari/531.22.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_5_8; en-us) AppleWebKit/531.22.7 (KHTML, like Gecko) Version/4.0.5 Safari/531.22.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_4_11; da-dk) AppleWebKit/531.22.7 (KHTML, like Gecko) Version/4.0.5 Safari/531.22.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_3; ja-jp) AppleWebKit/531.22.7 (KHTML, like Gecko) Version/4.0.5 Safari/531.22.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_3; en-us) AppleWebKit/533.4+ (KHTML, like Gecko) Version/4.0.5 Safari/531.22.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_3; en-us) AppleWebKit/531.22.7 (KHTML, like Gecko) Version/4.0.5 Safari/531.22.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_3; de-de) AppleWebKit/531.22.7 (KHTML, like Gecko) Version/4.0.5 Safari/531.22.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_2; ja-jp) AppleWebKit/531.22.7 (KHTML, like Gecko) Version/4.0.5 Safari/531.22.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_8; nl-nl) AppleWebKit/531.22.7 (KHTML, like Gecko) Version/4.0.5 Safari/531.22.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_1 like Mac OS X; en-us) AppleWebKit/532.9 (KHTML, like Gecko) Version/4.0.5 Mobile/8B5097d Safari/6531.22.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_1 like Mac OS X; en-us) AppleWebKit/532.9 (KHTML, like Gecko) Version/4.0.5 Mobile/8B117 Safari/6531.22.7&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0(iPad; U; CPU iPhone OS 3_2 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Version/4.0.4 Mobile/7B314 Safari/531.21.10gin_lib.cc&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0(iPad; U; CPU iPhone OS 3_2 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Version/4.0.4 Mobile/7B314 Safari/531.21.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0(iPad; U; CPU iPhone OS 3_2 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Version/4.0.4 Mobile/7B314 Safari/123&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; zh-TW) AppleWebKit/531.21.8 (KHTML, like Gecko) Version/4.0.4 Safari/531.21.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; ko-KR) AppleWebKit/531.21.8 (KHTML, like Gecko) Version/4.0.4 Safari/531.21.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/533.18.1 (KHTML, like Gecko) Version/4.0.4 Safari/531.21.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.2; en-US) AppleWebKit/531.21.8 (KHTML, like Gecko) Version/4.0.4 Safari/531.21.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; de-DE) AppleWebKit/532+ (KHTML, like Gecko) Version/4.0.4 Safari/531.21.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_4_11; hu-hu) AppleWebKit/531.21.8 (KHTML, like Gecko) Version/4.0.4 Safari/531.21.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_3; en-us) AppleWebKit/531.21.11 (KHTML, like Gecko) Version/4.0.4 Safari/531.21.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_2; ru-ru) AppleWebKit/533.2+ (KHTML, like Gecko) Version/4.0.4 Safari/531.21.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_2; de-at) AppleWebKit/531.21.8 (KHTML, like Gecko) Version/4.0.4 Safari/531.21.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPhone; U; CPU OS 3_2 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Version/4.0.4 Mobile/7B334b Safari/531.21.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPhone Simulator; U; CPU iPhone OS 3_2 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Version/4.0.4 Mobile/7D11 Safari/531.21.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPad; U; CPU OS 3_2_2 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Version/4.0.4 Mobile/7B500 Safari/53&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPad; U; CPU OS 3_2 like Mac OS X; es-es) AppleWebKit/531.21.10 (KHTML, like Gecko) Version/4.0.4 Mobile/7B367 Safari/531.21.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPad; U; CPU OS 3_2 like Mac OS X; es-es) AppleWebKit/531.21.10 (KHTML, like Gecko) Version/4.0.4 Mobile/7B360 Safari/531.21.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPad; U; CPU OS 3_2 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Version/4.0.4 Mobile/7B334b Safari/531.21.1021.10gin_lib.cc&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (iPad; U; CPU iPhone OS 3_2 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Version/4.0.4 Mobile/7B314&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-us) AppleWebKit/531.9 (KHTML, like Gecko) Version/4.0.3 Safari/531.9&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_5_8; en-us) AppleWebKit/532.0+ (KHTML, like Gecko) Version/4.0.3 Safari/531.9.2009&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_5_8; en-us) AppleWebKit/532.0+ (KHTML, like Gecko) Version/4.0.3 Safari/531.9&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_1; nl-nl) AppleWebKit/532.3+ (KHTML, like Gecko) Version/4.0.3 Safari/531.9&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_8; fi-fi) AppleWebKit/531.9 (KHTML, like Gecko) Version/4.0.3 Safari/531.9&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_8; en-us) AppleWebKit/531.21.8 (KHTML, like Gecko) Version/4.0.3 Safari/531.21.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/532+ (KHTML, like Gecko) Version/4.0.2 Safari/530.19.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/530.19.2 (KHTML, like Gecko) Version/4.0.2 Safari/530.19.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; zh-TW) AppleWebKit/530.19.2 (KHTML, like Gecko) Version/4.0.2 Safari/530.19.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; pl-PL) AppleWebKit/530.19.2 (KHTML, like Gecko) Version/4.0.2 Safari/530.19.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; ja-JP) AppleWebKit/530.19.2 (KHTML, like Gecko) Version/4.0.2 Safari/530.19.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; fr-FR) AppleWebKit/530.19.2 (KHTML, like Gecko) Version/4.0.2 Safari/530.19.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/530.19.2 (KHTML, like Gecko) Version/4.0.2 Safari/530.19.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.2; de-DE) AppleWebKit/530.19.2 (KHTML, like Gecko) Version/4.0.2 Safari/530.19.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN) AppleWebKit/530.19.2 (KHTML, like Gecko) Version/4.0.2 Safari/530.19.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/530.19.2 (KHTML, like Gecko) Version/4.0.2 Safari/530.19.1&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10_5_7; en-us) AppleWebKit/530.19.2 (KHTML, like Gecko) Version/4.0.2 Safari/530.19&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_7; en-us) AppleWebKit/530.19.2 (KHTML, like Gecko) Version/4.0.2 Safari/530.19&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_7; en-us) AppleWebKit/531.2+ (KHTML, like Gecko) Version/4.0.1 Safari/530.18&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_5_7; en-us) AppleWebKit/530.19.2 (KHTML, like Gecko) Version/4.0.1 Safari/530.18&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; ru-RU) AppleWebKit/528.16 (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; ja-JP) AppleWebKit/528.16 (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; hu-HU) AppleWebKit/528.16 (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; he-IL) AppleWebKit/528.16 (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; he-IL) AppleWebKit/528+ (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; fr-FR) AppleWebKit/528.16 (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; es-es) AppleWebKit/528.16 (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/528.16 (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en) AppleWebKit/528.16 (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; de-DE) AppleWebKit/528.16 (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-TW) AppleWebKit/528.16 (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN) AppleWebKit/528.16 (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; sv-SE) AppleWebKit/528.16 (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; ru-RU) AppleWebKit/528.16 (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; pt-PT) AppleWebKit/528.16 (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; pt-BR) AppleWebKit/528.16 (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; nb-NO) AppleWebKit/528.16 (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; hu-HU) AppleWebKit/528.16 (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; fr-FR) AppleWebKit/528.16 (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; fi-FI) AppleWebKit/528.16 (KHTML, like Gecko) Version/4.0 Safari/528.16&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.0; U; en) Presto/2.8.99 Version/11.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.1; U; zh-tw) Presto/2.8.131 Version/11.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux x86_64; U; Ubuntu/10.10 (maverick); pl) Presto/2.7.62 Version/11.01&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux i686; U; ja) Presto/2.7.62 Version/11.01&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux i686; U; fr) Presto/2.7.62 Version/11.01&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; zh-tw) Presto/2.7.62 Version/11.01&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; zh-cn) Presto/2.7.62 Version/11.01&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; sv) Presto/2.7.62 Version/11.01&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; en-US) Presto/2.7.62 Version/11.01&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; cs) Presto/2.7.62 Version/11.01&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.0; U; pl) Presto/2.7.62 Version/11.01&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.2; U; ru) Presto/2.7.62 Version/11.01&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.1; U;) Presto/2.7.62 Version/11.01&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.1; U; cs) Presto/2.7.62 Version/11.01&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.13) Gecko/20101213 Opera/9.80 (Windows NT 6.1; U; zh-tw) Presto/2.7.62 Version/11.01&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; U; nl; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 Opera 11.01&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; U; de; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 Opera 11.01&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; de) Opera 11.01&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux x86_64; U; pl) Presto/2.7.62 Version/11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux i686; U; it) Presto/2.7.62 Version/11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; zh-cn) Presto/2.6.37 Version/11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; pl) Presto/2.7.62 Version/11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; ko) Presto/2.7.62 Version/11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; fi) Presto/2.7.62 Version/11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; en-GB) Presto/2.7.62 Version/11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1 x64; U; en) Presto/2.7.62 Version/11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.0; U; en) Presto/2.7.39 Version/11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.1; U; ru) Presto/2.7.39 Version/11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.1; U; MRA 5.5 (build 02842); ru) Presto/2.7.62 Version/11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.1; U; it) Presto/2.7.62 Version/11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.0; U; ja; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 Opera 11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 5.1; U; pl; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 Opera 11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 5.1; U; de; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 Opera 11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; X11; Linux x86_64; pl) Opera 11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; fr) Opera 11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; ja) Opera 11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; en) Opera 11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; pl) Opera 11.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; pl) Presto/2.6.31 Version/10.70&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 5.2; U; ru; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 Opera 10.70&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 5.1; U; zh-cn; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 Opera 10.70&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.2; U; zh-cn) Presto/2.6.30 Version/10.63&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.2; U; en) Presto/2.6.30 Version/10.63&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.1; U; MRA 5.6 (build 03278); ru) Presto/2.6.30 Version/10.63&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.1; U; pl) Presto/2.6.30 Version/10.62&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64; U; de; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 Opera 10.62&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; X11; Linux x86_64; de) Opera 10.62&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; en) Opera 10.62&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux i686; U; pl) Presto/2.6.30 Version/10.61&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux i686; U; es-ES) Presto/2.6.30 Version/10.61&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; zh-cn) Presto/2.6.30 Version/10.61&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; en) Presto/2.6.30 Version/10.61&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.0; U; it) Presto/2.6.30 Version/10.61&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.2; U; ru) Presto/2.6.30 Version/10.61&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows 98; U; de) Presto/2.6.30 Version/10.61&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Macintosh; Intel Mac OS X; U; nl) Presto/2.6.30 Version/10.61&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux i686; U; en) Presto/2.5.27 Version/10.60&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.0; U; nl) Presto/2.6.30 Version/10.60&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/10.60 (Windows NT 5.1; U; zh-cn) Presto/2.6.30 Version/10.60&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/10.60 (Windows NT 5.1; U; en-US) Presto/2.6.30 Version/10.60&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux i686; U; it) Presto/2.5.24 Version/10.54&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux i686; U; en-GB) Presto/2.5.24 Version/10.53&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 5.1; U; zh-cn; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 Opera 10.53&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 5.1; U; Firefox/5.0; en; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 Opera 10.53&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 5.1; U; Firefox/4.5; en; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 Opera 10.53&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 5.1; U; Firefox/3.5; en; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 Opera 10.53&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; ko) Opera 10.53&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; fr) Presto/2.5.24 Version/10.52&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; en) Presto/2.5.22 Version/10.51&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.0; U; cs) Presto/2.5.22 Version/10.51&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.2; U; ru) Presto/2.5.22 Version/10.51&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Linux i686; U; en) Presto/2.5.22 Version/10.51&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; U; en-GB; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 Opera 10.51&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Linux i686; U; en; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6 Opera 10.51&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 8.0; Linux i686; en) Opera 10.51&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; zh-tw) Presto/2.5.22 Version/10.50&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; zh-cn) Presto/2.5.22 Version/10.50&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; sk) Presto/2.6.22 Version/10.50&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; ja) Presto/2.5.22 Version/10.50&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.0; U; zh-cn) Presto/2.5.22 Version/10.50&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.1; U; sk) Presto/2.5.22 Version/10.50&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.1; U; ru) Presto/2.5.22 Version/10.50&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/10.50 (Windows NT 6.1; U; en-GB) Presto/2.2.2&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (S60; SymbOS; Opera Tablet/9174; U; en) Presto/2.7.81 Version/10.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; U; Linux i686; en-US; rv:1.9.2.3) Presto/2.2.15 Version/10.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux x86_64; U; it) Presto/2.2.15 Version/10.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; de) Presto/2.2.15 Version/10.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.0; U; Gecko/20100115; pl) Presto/2.2.15 Version/10.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.0; U; en) Presto/2.2.15 Version/10.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.1; U; de) Presto/2.2.15 Version/10.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.1; U; cs) Presto/2.2.15 Version/10.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 6.0; U; tr; rv:1.8.1) Gecko/20061208 Firefox/2.0.0 Opera 10.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 6.0; X11; Linux i686; de) Opera 10.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 6.0; tr) Opera 10.10&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux x86_64; U; en-GB) Presto/2.2.15 Version/10.01&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux x86_64; U; en) Presto/2.2.15 Version/10.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux x86_64; U; de) Presto/2.2.15 Version/10.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux i686; U; ru) Presto/2.2.15 Version/10.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux i686; U; pt-BR) Presto/2.2.15 Version/10.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux i686; U; pl) Presto/2.2.15 Version/10.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux i686; U; nb) Presto/2.2.15 Version/10.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux i686; U; en-GB) Presto/2.2.15 Version/10.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux i686; U; en) Presto/2.2.15 Version/10.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux i686; U; Debian; pl) Presto/2.2.15 Version/10.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (X11; Linux i686; U; de) Presto/2.2.15 Version/10.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; zh-cn) Presto/2.2.15 Version/10.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; fi) Presto/2.2.15 Version/10.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; en) Presto/2.2.15 Version/10.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; de) Presto/2.2.15 Version/10.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.1; U; cs) Presto/2.2.15 Version/10.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.0; U; en) Presto/2.2.15 Version/10.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 6.0; U; de) Presto/2.2.15 Version/10.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.2; U; en) Presto/2.2.15 Version/10.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.1; U; zh-cn) Presto/2.2.15 Version/10.00&quot;</span>,</span><br><span class="line"><span class="string">&quot;Opera/9.80 (Windows NT 5.1; U; ru) Presto/2.2.15 Version/10.00&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="ip代理："><a href="#ip代理：" class="headerlink" title="ip代理："></a>ip代理：</h2><ul><li>一般写在<code>process_exception()</code>中</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">PROXY_http = [</span><br><span class="line">    <span class="string">&#x27;126.120.102.124:80&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;101.208.131.169:56055&#x27;</span>,</span><br><span class="line">]</span><br><span class="line">PROXY_https = [</span><br><span class="line">    <span class="string">&#x27;20.83.49.90:900&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;91.182.12.212:3508&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_exception</span>(<span class="params">self, request, exception, spider</span>):</span><br><span class="line">        <span class="comment"># Called when a download handler or a process_request()</span></span><br><span class="line">        <span class="comment"># (from other downloader middleware) raises an exception.</span></span><br><span class="line"><span class="keyword">if</span> request.url.split(<span class="string">&quot;:&quot;</span>)[<span class="number">0</span>]==<span class="string">&quot;http&quot;</span> :</span><br><span class="line">            request.meta[<span class="string">&#x27;proxy&#x27;</span>]=<span class="string">&#x27;http://&#x27;</span>+random.choice(self.PROXY_http)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            request.meta[<span class="string">&#x27;proxy&#x27;</span>]=<span class="string">&#x27;https://&#x27;</span>+random.choice(self.PROXY_https)</span><br><span class="line">        <span class="comment">#将修正后的请求进行重新发送</span></span><br><span class="line">        <span class="keyword">return</span> request</span><br><span class="line">        <span class="comment"># Must either:</span></span><br><span class="line">        <span class="comment"># - return None: continue processing this exception</span></span><br><span class="line">        <span class="comment"># - return a Response object: stops process_exception() chain</span></span><br><span class="line">        <span class="comment"># - return a Request object: stops process_exception() chain</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h2 id="开启中间件"><a href="#开启中间件" class="headerlink" title="开启中间件"></a>开启中间件</h2><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220811232438732.png" alt="image-20220811232438732"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​	&lt;/p&gt;
&lt;h1 id=&quot;1-ImagePipeline的使用&quot;&gt;&lt;a href=&quot;#1-ImagePipeline的使用&quot; class=&quot;headerlink&quot; title=&quot;1.ImagePipeline的使用&quot;&gt;&lt;/a&gt;1.ImagePipeline的使用&lt;/h1</summary>
      
    
    
    
    
    <category term="python" scheme="http://daihaojun554.github.io/tags/python/"/>
    
    <category term="ImagePipeline的使用" scheme="http://daihaojun554.github.io/tags/ImagePipeline%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>crawlSpider</title>
    <link href="http://daihaojun554.github.io/2022/08/11/crawl-spider/"/>
    <id>http://daihaojun554.github.io/2022/08/11/crawl-spider/</id>
    <published>2022-08-11T00:00:00.000Z</published>
    <updated>2022-08-12T09:45:23.544Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CrawlSpider："><a href="#CrawlSpider：" class="headerlink" title="CrawlSpider："></a>CrawlSpider：</h1><p>spider的子类：主要用于全站数据爬取</p><p>创建crawl的步骤</p><ul><li>创建一个工程</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scrapy startproject &lt;myproName&gt;</span><br></pre></td></tr></table></figure><ul><li>创建一个crawl的模板爬虫</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scrapy genspider -t crawl &lt;spiderName&gt; &lt;domain&gt;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> scrapy.linkextractors <span class="keyword">import</span> LinkExtractor</span><br><span class="line"><span class="keyword">from</span> scrapy.spiders <span class="keyword">import</span> CrawlSpider, Rule</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CrawlfirstSpider</span>(<span class="title class_ inherited__">CrawlSpider</span>):</span><br><span class="line">    name = <span class="string">&#x27;crawlFirst&#x27;</span><span class="comment">#爬虫文件的名称</span></span><br><span class="line">   <span class="comment"># allowed_domains = [&#x27;www.xxx.com&#x27;]#允许的domain</span></span><br><span class="line">    start_urls = [<span class="string">&#x27;http://www.xxx.com/&#x27;</span>]<span class="comment">#起始的url</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#LinkExtractor 链接提取器 提取链接-&gt; 根据指定规则(allow)后面跟的正则，进行指定链接的提取</span></span><br><span class="line">   link=LinkExtractor(allow=<span class="string">r&#x27;Items/&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    rules = (</span><br><span class="line">        <span class="comment">#规则解 析器 实例化的规则解析器</span></span><br><span class="line">        Rule(link, callback=<span class="string">&#x27;parse_item&#x27;</span>, follow=<span class="literal">True</span>),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_item</span>(<span class="params">self, response</span>):</span><br><span class="line">        item = &#123;&#125;</span><br><span class="line">        <span class="comment">#item[&#x27;domain_id&#x27;] = response.xpath(&#x27;//input[@id=&quot;sid&quot;]/@value&#x27;).get()</span></span><br><span class="line">        <span class="comment">#item[&#x27;name&#x27;] = response.xpath(&#x27;//div[@id=&quot;name&quot;]&#x27;).get()</span></span><br><span class="line">        <span class="comment">#item[&#x27;description&#x27;] = response.xpath(&#x27;//div[@id=&quot;description&quot;]&#x27;).get()</span></span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;CrawlSpider：&quot;&gt;&lt;a href=&quot;#CrawlSpider：&quot; class=&quot;headerlink&quot; title=&quot;CrawlSpider：&quot;&gt;&lt;/a&gt;CrawlSpider：&lt;/h1&gt;&lt;p&gt;spider的子类：主要用于全站数据爬取&lt;/p&gt;
&lt;p&gt;创建</summary>
      
    
    
    
    
    <category term="python" scheme="http://daihaojun554.github.io/tags/python/"/>
    
    <category term="爬虫" scheme="http://daihaojun554.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>vue3</title>
    <link href="http://daihaojun554.github.io/2022/07/25/vue3/"/>
    <id>http://daihaojun554.github.io/2022/07/25/vue3/</id>
    <published>2022-07-24T23:39:33.000Z</published>
    <updated>2022-07-30T09:57:36.746Z</updated>
    
    <content type="html"><![CDATA[<p>文档参考：<a href="https://zhoushugang.gitee.io/erabbit-client-pc-document">https://zhoushugang.gitee.io/erabbit-client-pc-document</a></p><h1 id="Vue3"><a href="#Vue3" class="headerlink" title="Vue3"></a>Vue3</h1><p>通过vite创建vue3项目</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220730173906209.png" alt="image-20220730173906209"></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm init vite-app [projectName]</span><br></pre></td></tr></table></figure><h2 id="组合api："><a href="#组合api：" class="headerlink" title="组合api："></a>组合api：</h2><h3 id="setup函数"><a href="#setup函数" class="headerlink" title="setup函数:"></a><code>setup</code>函数:</h3><ul><li><code>setup</code> 是一个新的组件选项，作为组件中使用组合API的起点。</li><li>从组件生命周期来看，它的执行在组件实例创建之前<code>vue2.x的beforeCreate</code>执行。</li><li>这就意味着在<code>setup</code>函数中 <code>this</code> 还不是组件实例，<code>this</code> 此时是 <code>undefined</code></li><li>在模版中需要使用的数据和函数，需要在 <code>setup</code> 返回。</li></ul><h3 id="vue2-x生命周期钩子函数："><a href="#vue2-x生命周期钩子函数：" class="headerlink" title="vue2.x生命周期钩子函数："></a>vue2.x生命周期钩子函数：</h3><ul><li>beforeCreate</li><li>created</li><li>beforeMount</li><li>mounted</li><li>beforeUpdate</li><li>updated</li><li>beforeDestroy</li><li>destroyed</li></ul><h3 id="认识vue3-0生命周期钩子函数"><a href="#认识vue3-0生命周期钩子函数" class="headerlink" title="认识vue3.0生命周期钩子函数"></a>认识vue3.0生命周期钩子函数</h3><ul><li><code>setup</code> 创建实例前</li><li><code>onBeforeMount</code> 挂载DOM前</li><li><code>onMounted</code> 挂载DOM后</li><li><code>onBeforeUpdate</code> 更新组件前</li><li><code>onUpdated</code> 更新组件后</li><li><code>onBeforeUnmount</code> 卸载销毁前</li><li><code>onUnmounted</code> 卸载销毁后</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;文档参考：&lt;a href=&quot;https://zhoushugang.gitee.io/erabbit-client-pc-document&quot;&gt;https://zhoushugang.gitee.io/erabbit-client-pc-document&lt;/a&gt;&lt;/p&gt;
&lt;h</summary>
      
    
    
    
    
    <category term="框架" scheme="http://daihaojun554.github.io/tags/%E6%A1%86%E6%9E%B6/"/>
    
    <category term="vue" scheme="http://daihaojun554.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>Mq消息队列</title>
    <link href="http://daihaojun554.github.io/2022/06/30/MQ/"/>
    <id>http://daihaojun554.github.io/2022/06/30/MQ/</id>
    <published>2022-06-29T22:48:29.000Z</published>
    <updated>2022-06-19T07:32:22.106Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MQ"><a href="#MQ" class="headerlink" title="MQ"></a>MQ</h1><h2 id="同步调用："><a href="#同步调用：" class="headerlink" title="同步调用："></a>同步调用：</h2><h3 id="同步调用的优点："><a href="#同步调用的优点：" class="headerlink" title="同步调用的优点："></a><strong>同步调用的优点：</strong></h3><ul><li>时效性较强，可以立即得到结果</li></ul><h3 id="同步调用的缺点："><a href="#同步调用的缺点：" class="headerlink" title="同步调用的缺点："></a><strong>同步调用的缺点：</strong></h3><ul><li>耦合度高</li><li>性能和吞吐能力下降</li><li>有额外的资源消耗</li><li>有级联失败问题</li></ul><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220618140433265.png" alt="image-20220618140433265"></p><h2 id="异步调用："><a href="#异步调用：" class="headerlink" title="异步调用："></a>异步调用：</h2><p>Broker 是一个像数据总线一样的东西，所有的服务要接收数据和发送数据都发到这个总线上，这个总线就像协议一样，让服务间的通讯变得标准和可控。</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220618140541027.png" alt="image-20220618140541027"></p><h3 id="异步调用好处："><a href="#异步调用好处：" class="headerlink" title="异步调用好处："></a><strong>异步调用好处：</strong></h3><ul><li>吞吐量提升：无需等待订阅者处理完成，响应更快速</li><li>故障隔离：服务没有直接调用，不存在级联失败问题</li><li>调用间没有阻塞，不会造成无效的资源占用</li><li>耦合度极低，每个服务都可以灵活插拔，可替换 </li><li>流量削峰：不管发布事件的流量波动多大，都由 Broker 接收，订阅者可以按照自己的速度去处理事件</li></ul><h3 id="异步调用缺点："><a href="#异步调用缺点：" class="headerlink" title="异步调用缺点："></a><strong>异步调用缺点：</strong></h3><ul><li>架构复杂了，业务没有明显的流程线，不好管理</li><li>需要依赖于 Broker 的可靠、安全、性能</li></ul><h2 id="MQ消息队列"><a href="#MQ消息队列" class="headerlink" title="MQ消息队列"></a>MQ消息队列</h2><p>MQ，中文是消息队列（MessageQueue），字面来看就是存放消息的队列，也就是事件驱动架构中的 Broker</p><p>比较常见的 MQ 实现：</p><ul><li>ActiveMQ</li><li>RabbitMQ</li><li>RocketMQ</li><li>Kafka</li></ul><p>几种常见MQ的对比：</p><table><thead><tr><th align="left"></th><th align="left"><strong>RabbitMQ</strong></th><th align="left"><strong>ActiveMQ</strong></th><th align="left"><strong>RocketMQ</strong></th><th align="left"><strong>Kafka</strong></th></tr></thead><tbody><tr><td align="left">公司&#x2F;社区</td><td align="left">Rabbit</td><td align="left">Apache</td><td align="left">阿里</td><td align="left">Apache</td></tr><tr><td align="left">开发语言</td><td align="left">Erlang</td><td align="left">Java</td><td align="left">Java</td><td align="left">Scala&amp;Java</td></tr><tr><td align="left">协议支持</td><td align="left">AMQP、XMPP、SMTP、STOMP</td><td align="left">OpenWire、STOMP、REST、XMPP、AMQP</td><td align="left">自定义协议</td><td align="left">自定义协议</td></tr><tr><td align="left">可用性</td><td align="left">高</td><td align="left">一般</td><td align="left">高</td><td align="left">高</td></tr><tr><td align="left">单机吞吐量</td><td align="left">一般</td><td align="left">差</td><td align="left">高</td><td align="left">非常高</td></tr><tr><td align="left">消息延迟</td><td align="left">微秒级</td><td align="left">毫秒级</td><td align="left">毫秒级</td><td align="left">毫秒以内</td></tr><tr><td align="left">消息可靠性</td><td align="left">高</td><td align="left">一般</td><td align="left">高</td><td align="left">一般</td></tr></tbody></table><h2 id="RabbitMQ快速入门"><a href="#RabbitMQ快速入门" class="headerlink" title="RabbitMQ快速入门"></a>RabbitMQ快速入门</h2><ul><li>RabbitMQ的概述和安装</li><li>常见的消息模型</li><li>快速入门</li></ul><table><thead><tr><th>这里是centos，用docker使用rabbitmq，window安装的话移步到<a href="https://daihaojun.top/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/#5-12%E3%80%81SpringBoot%E6%95%B4%E5%90%88RabbitMq">这里</a></th></tr></thead></table><p>拉镜像：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull rabbitmq:3-management</span><br></pre></td></tr></table></figure><p>起容器：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run --name mq -p 5672:5672 -p 15672:15672 -v /home/mydata/rabbitmq/data:/var/lib/rabbitmq --hostname mq1 -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=admin -d rabbitmq:3-management</span><br></pre></td></tr></table></figure><p>访问后台：<a href="http://ip:15672/">http://ip:15672</a></p><p><strong>RabbitMQ 中的一些角色</strong></p><ul><li>publisher：生产者</li><li>consumer：消费者</li><li>exchange：交换机，负责消息路由</li><li>queue：队列，存储消息</li><li>virtualHost：虚拟主机，<strong>隔离不同租户</strong>的 exchange、queue、消息的隔离</li></ul><p><strong>MQ 的基本结构</strong></p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220618150056304.png" alt="image-20220618150056304"></p><p>官网的 <a href="https://www.rabbitmq.com/getstarted.html">五个例子</a></p><ul><li>基本消息队列</li></ul><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220618150938186.png" alt="image-20220618150938186"></p><ul><li><p>工作消息队列</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220618150947730.png"></p></li><li><p>发布订阅(Public Subscribe)</p><ul><li>Fanout Exchange:广播</li><li>Direct Exchange：路由</li><li>Topic Exchange：主题</li></ul></li></ul><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220618151132098.png" alt="image-20220618151132098"></p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220618151144878.png" alt="image-20220618151144878"></p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220618151154177.png" alt="image-20220618151154177"></p><h4 id="Hello，world！"><a href="#Hello，world！" class="headerlink" title="Hello，world！"></a>Hello，world！</h4><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220618151338079.png" alt="image-20220618151338079"></p><p>官方的 HelloWorld 是基于最基础的消息队列模型来实现的，只包括三个角色：</p><ul><li>publisher：消息发布者，将消息发送到队列queue</li><li>queue：消息队列，负责接受并缓存消息</li><li>consumer：订阅队列，处理队列中的消息</li></ul><h2 id="SpringAMQP"><a href="#SpringAMQP" class="headerlink" title="SpringAMQP"></a>SpringAMQP</h2><p>SpringAMQP 是基于 RabbitMQ 封装的一套模板，并且还利用 SpringBoot 对其实现了自动装配，使用起来非常方便。</p><p>SpringAMQP 的官方地址：<a href="https://spring.io/projects/spring-amqp">https://spring.io/projects/spring-amqp</a></p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220618184458466.png" alt="image-20220618184458466"></p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220618184508538.png" alt="image-20220618184508538"></p><p>SpringAMQP 提供了三个功能：</p><ul><li>自动声明队列、交换机及其绑定关系</li><li>基于注解的监听器模式，异步接收消息</li><li>封装了 RabbitTemplate 工具，用于发送消息</li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>做配置：</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.56</span><span class="number">.10</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span></span><br></pre></td></tr></table></figure><p>生产消息：</p><h3 id="DirectQueue"><a href="#DirectQueue" class="headerlink" title="DirectQueue"></a>DirectQueue</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate template;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testMq</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;我是一条待处理的消息1111&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">        template.convertAndSend(queue,msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>监听消息：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitMqListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenMsg</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;消费者接受消息&quot;</span>+<span class="string">&quot;[&quot;</span>+msg+<span class="string">&quot;]&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>定义一条消息队列</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Queue <span class="title function_">oneQueue</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;simple.queue&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="WorkQueue"><a href="#WorkQueue" class="headerlink" title="WorkQueue"></a>WorkQueue</h3><p>Work queues，也被称为（Task queues），任务模型。简单来说就是<strong>让多个消费者绑定到一个队列，共同消费队列中的消息</strong>。</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220619131319304.png" alt="image-20220619131319304"></p><p>当消息处理比较耗时的时候，可能生产消息的速度会远远大于消息的消费速度。长此以往，消息就会堆积越来越多，无法及时处理。</p><p>此时就可以使用 work 模型，多个消费者共同处理消息处理，速度就能大大提高了。</p><p>Work 模型的使用：</p><ul><li>多个消费者绑定到一个队列，同一条消息只会被一个消费者处理</li><li>通过设置 prefetch 来控制消费者预取的消息数量</li></ul><h3 id="发布-x2F-订阅"><a href="#发布-x2F-订阅" class="headerlink" title="发布&#x2F;订阅"></a>发布&#x2F;订阅</h3><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220619132502490.png" alt="image-20220619132502490"></p><p>图中可以看到，在订阅模型中，多了一个 exchange 角色，而且过程略有变化</p><ul><li>Publisher：生产者，也就是要发送消息的程序，但是不再发送到队列中，<strong>而是发给 exchange（交换机）</strong></li><li>Consumer：消费者，与以前一样，订阅队列，没有变化</li><li>Queue：消息队列也与以前一样，接收消息、缓存消息</li><li>Exchange：交换机，一方面，接收生产者发送的消息；另一方面，知道如何处理消息，例如递交给某个特别队列、递交给所有队列、或是将消息丢弃。到底如何操作，取决于 Exchange 的类型。Exchange 有以下3种类型：<ul><li>Fanout：广播，将消息交给所有绑定到交换机的队列</li><li>Direct：定向，把消息交给符合指定 routing key 的队列</li><li>Topic：通配符，把消息交给符合 routing pattern（路由模式） 的队列</li></ul></li></ul><p><strong>Exchange（交换机）只负责转发消息，不具备存储消息的能力</strong>，因此如果没有任何队列与 Exchange 绑定，或者没有符合路由规则的队列，那么消息会丢失！</p><h4 id="Fanout"><a href="#Fanout" class="headerlink" title="Fanout"></a>Fanout</h4><p>Fanout，英文翻译是扇出，在 MQ 中我们也可以称为广播。</p><p>在广播模式下，消息发送流程是这样的：</p><ul><li>可以有多个队列</li><li>每个队列都要绑定到 Exchange（交换机）</li><li>生产者发送的消息，只能发送到交换机，交换机来决定要发给哪个队列，生产者无法决定</li><li>交换机把消息发送给绑定过的所有队列</li><li>订阅队列的消费者都能拿到消息</li></ul><p>在 consumer 中创建一个类，声明队列、交换机、<strong>绑定对象 Binding</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FanoutConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//交换机</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FanoutExchange <span class="title function_">fanoutExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FanoutExchange</span>(<span class="string">&quot;dhj.fanout&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//队列1</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">fanoutQueue1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;fanout.queue1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//队列2</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">fanoutQueue2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;fanout.queue2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//绑定</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">fanoutBinding</span><span class="params">(Queue fanoutQueue1,FanoutExchange fanoutExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder</span><br><span class="line">                .bind(fanoutQueue1)</span><br><span class="line">                .to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">fanoutBinding2</span><span class="params">(Queue fanoutQueue2,FanoutExchange fanoutExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder</span><br><span class="line">                .bind(fanoutQueue2)</span><br><span class="line">                .to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>监听这两个队列</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;fanout.queue1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenFanoutMsg</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者接受消息1&quot;</span> + <span class="string">&quot;[&quot;</span> + msg + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;fanout.queue2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenFanout2Msg</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者接受消息2&quot;</span> + <span class="string">&quot;[&quot;</span> + msg + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>向交换机发送消息</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//向交换机发送消息</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testFanoutMq</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">exchange</span> <span class="operator">=</span> <span class="string">&quot;dhj.fanout&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello everyone&quot;</span>;</span><br><span class="line">        template.convertAndSend(exchange,<span class="string">&quot;&quot;</span>,message);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220619134822024.png" alt="image-20220619134822024"></p><h4 id="Direct"><a href="#Direct" class="headerlink" title="Direct"></a>Direct</h4><p>在 Fanout 模式中，一条消息，会被所有订阅的队列都消费。但是，在某些场景下，我们希望不同的消息被不同的队列消费。这时就要用到 DirectExchange</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220619152645242.png" alt="image-20220619152645242"></p><p>在 Direct 模型下：</p><ul><li>队列与交换机的绑定，不能是任意绑定了，而是要指定一个<code>RoutingKey</code>（路由key）</li><li>消息的发送方向 Exchange发送消息时，也必须指定消息的 <code>RoutingKey</code>。</li><li>Exchange 不再把消息交给每一个绑定的队列，而是根据消息的<code>Routing Key</code>进行判断，只有队列的<code>Routingkey</code> 与消息的 <code>Routing key</code>完全一致，才会接收到消息</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(value = &quot;direct.queue1&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(value = &quot;dhj.direct&quot;),</span></span><br><span class="line"><span class="meta">    key = &#123;&quot;yellow&quot;,&quot;red&quot;&#125;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;接收到direct.queue1的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span> + LocalTime.now());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(value = &quot;direct.queue2&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(value = &quot;dhj.direct&quot;),</span></span><br><span class="line"><span class="meta">    key = &#123;&quot;red&quot;,&quot;bule&quot;&#125;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue2</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;接收到direct.queue2的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span> + LocalTime.now());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>生产者</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * direct</span></span><br><span class="line"><span class="comment"> * 向交换机发送消息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDirectExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 交换机名称</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;dhj.direct&quot;</span>;</span><br><span class="line">    <span class="comment">// 消息</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, i am direct&quot;</span>;</span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;bule&quot;</span>, message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Topic"><a href="#Topic" class="headerlink" title="Topic"></a>Topic</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">        value = @Queue(name = &quot;topic.queue1&quot;),</span></span><br><span class="line"><span class="meta">        exchange = @Exchange(name = &quot;dhj.topic&quot;,type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">        key = &quot;#.news&quot;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">TopicQueueListener1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者接受消息,#.news&quot;</span> + <span class="string">&quot;[&quot;</span> + msg + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">        value = @Queue(name = &quot;topic.queue2&quot;),</span></span><br><span class="line"><span class="meta">        exchange = @Exchange(name = &quot;dhj.topic&quot;,type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">        key = &quot;china.#&quot;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">TopicQueueListener2</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者接受消息,china.*&quot;</span> + <span class="string">&quot;[&quot;</span> + msg + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Topic </code>与 <code>Direct</code>相比，都是可以根据<code>RoutingKey</code>把消息路由到不同的队列。只不过<code>Topic </code>类型可以让队列在绑定<code>Routing key</code> 的时候使用通配符！</p><p>通配符规则：</p><p><code>#</code>：匹配一个或多个词</p><p><code>*</code>：只能匹配一个词</p><p>例如：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">item.#`：能够匹配`item.spu.insert` 或者 `item.spu #一个或者多个</span><br><span class="line">item.*`：只能匹配`item.spu *恰好一个</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//向交换机发送消息</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testTopicMq</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">exchange</span> <span class="operator">=</span> <span class="string">&quot;dhj.topic&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;中国的消息！&quot;</span>;</span><br><span class="line"></span><br><span class="line">    template.convertAndSend(exchange,<span class="string">&quot;china.#&quot;</span>,message);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;MQ&quot;&gt;&lt;a href=&quot;#MQ&quot; class=&quot;headerlink&quot; title=&quot;MQ&quot;&gt;&lt;/a&gt;MQ&lt;/h1&gt;&lt;h2 id=&quot;同步调用：&quot;&gt;&lt;a href=&quot;#同步调用：&quot; class=&quot;headerlink&quot; title=&quot;同步调用：&quot;&gt;&lt;/a&gt;同步调用</summary>
      
    
    
    
    
    <category term="消息队列" scheme="http://daihaojun554.github.io/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
    <category term="MQ" scheme="http://daihaojun554.github.io/tags/MQ/"/>
    
  </entry>
  
  <entry>
    <title>Swagger</title>
    <link href="http://daihaojun554.github.io/2022/06/26/swagger/"/>
    <id>http://daihaojun554.github.io/2022/06/26/swagger/</id>
    <published>2022-06-25T22:47:08.000Z</published>
    <updated>2022-06-27T06:33:41.363Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h1><h2 id="1-如何使用"><a href="#1-如何使用" class="headerlink" title="1.如何使用"></a>1.如何使用</h2><ul><li>导包</li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger2 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--        swaggerui--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger-ui --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>做配置：</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line"><span class="comment">//    swagger会帮助我们生成文档信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//    1。配置接口信息</span></span><br><span class="line"><span class="comment">//    2。配置生成规则</span></span><br><span class="line"><span class="comment">//    3。</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">getDocket</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Docket</span> <span class="variable">docket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2);</span><br><span class="line">        <span class="comment">//指定封面信息以及一些基本的信息说明</span></span><br><span class="line">        <span class="type">ApiInfoBuilder</span> <span class="variable">apiInfoBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>();</span><br><span class="line">        apiInfoBuilder.title(<span class="string">&quot;fmmall后端的接口文档&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;此文档包括了后端的一些接口信息&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;2.0.1&quot;</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;daihaojun&quot;</span>,<span class="string">&quot;http://daihaojun.top&quot;</span>,<span class="string">&quot;1842118776@qq.com&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">        <span class="type">ApiInfo</span> <span class="variable">apiInfo</span> <span class="operator">=</span> apiInfoBuilder.build();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        docket.apiInfo(apiInfo)</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.dhj.fmmall.controller&quot;</span>))</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> docket;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>访问：<a href="http://ip:port/swagger-ui.html">http://ip:port/swagger-ui.html</a></p><h2 id="2-swagger注解说明"><a href="#2-swagger注解说明" class="headerlink" title="2.swagger注解说明"></a>2.swagger注解说明</h2><h4 id="1-Api"><a href="#1-Api" class="headerlink" title="1. @Api"></a>1. <code>@Api</code></h4><p>@Api 用在类上，说明该类的作用。可以标记一个 Controller 类作为 Swagger 文档资源，使用方式代码如下所示。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@Api(value = &quot;用户管理的接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;登录接口&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">login</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.ok(userService.checkLogin(username,password));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-ApiModel"><a href="#2-ApiModel" class="headerlink" title="2. @ApiModel"></a>2. <code>@ApiModel</code></h4><p>@ApiModel 用在类上，表示对类进行说明，用于实体类中的参数接收说明。使用方式代码如下所示。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Api(value = &quot;用户管理的接口&quot;,tags = &quot;用户管理&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;登录接口&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">login</span><span class="params">(<span class="meta">@ApiParam(value = &quot;用户登录名&quot;,required = true)</span> String username,</span></span><br><span class="line"><span class="params">                   <span class="meta">@ApiParam(value = &quot;用户登录密码&quot;,required = true)</span> String password)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.ok(userService.checkLogin(username,password));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>效果如图：</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220627142049623.png" alt="image-20220627142049623"></p><h4 id="3-ApiModelProperty"><a href="#3-ApiModelProperty" class="headerlink" title="3. @ApiModelProperty"></a>3. <code>@ApiModelProperty</code></h4><p><code>@ApiModelProperty</code> 用于字段，表示对 model 属性的说明。使用方式代码如下所示。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>,Cloneable&#123;</span><br><span class="line">    <span class="comment">/** 主键id;用户id */</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(name = &quot;主键id&quot;,notes = &quot;用户id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long userId ;</span><br><span class="line">    <span class="comment">/** 用户名;用户名 */</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(name = &quot;用户名&quot;,notes = &quot;用户名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-ApiOperation"><a href="#4-ApiOperation" class="headerlink" title="4.@ApiOperation"></a>4.<code>@ApiOperation</code></h4><p>对某个接口进行说明，用于方法上</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@Api(value = &quot;用户管理的接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;登录接口&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">login</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.ok(userService.checkLogin(username,password));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-ApiParam"><a href="#5-ApiParam" class="headerlink" title="5. @ApiParam"></a>5. <code>@ApiParam</code></h4><p>@ApiParam 用于 Controller 中方法的参数说明。使用方式代码如下所示。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;登录接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">login</span><span class="params">(<span class="meta">@ApiParam(value = &quot;用户登录名&quot;,required = true)</span> String username,</span></span><br><span class="line"><span class="params">               <span class="meta">@ApiParam(value = &quot;用户登录密码&quot;,required = true)</span> String password)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> R.ok(userService.checkLogin(username,password));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>效果如图：</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220627142151766.png" alt="image-20220627142151766"></p><h4 id="6-Ignore"><a href="#6-Ignore" class="headerlink" title="6.@Ignore"></a>6.<code>@Ignore</code></h4><p>方法注解被添加此注解这个请求将不会生成文档</p><p>基本 的就这些</p><h2 id="3-其他的ui"><a href="#3-其他的ui" class="headerlink" title="3.其他的ui"></a>3.其他的ui</h2><p>导入依赖</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.github.xiaoymin/swagger-bootstrap-ui --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-bootstrap-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>直接重启项目就行</p><p>访问<a href="http://ip:port/doc.html">http://ip:port/doc.html</a></p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220627143338497.png" alt="image-20220627143338497"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Swagger&quot;&gt;&lt;a href=&quot;#Swagger&quot; class=&quot;headerlink&quot; title=&quot;Swagger&quot;&gt;&lt;/a&gt;Swagger&lt;/h1&gt;&lt;h2 id=&quot;1-如何使用&quot;&gt;&lt;a href=&quot;#1-如何使用&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    
    <category term="Swagger" scheme="http://daihaojun554.github.io/tags/Swagger/"/>
    
  </entry>
  
  <entry>
    <title>Thymeleaf</title>
    <link href="http://daihaojun554.github.io/2022/06/21/Thymeleaf/"/>
    <id>http://daihaojun554.github.io/2022/06/21/Thymeleaf/</id>
    <published>2022-06-20T22:47:08.000Z</published>
    <updated>2022-06-25T06:23:45.001Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Thymeleaf"><a href="#Thymeleaf" class="headerlink" title="Thymeleaf"></a>Thymeleaf</h1><h2 id="1-Thymeleaf简介"><a href="#1-Thymeleaf简介" class="headerlink" title="1.Thymeleaf简介:"></a>1.Thymeleaf简介:</h2><p>Thymeleaf是一种类似于jsp的动态网页技术</p><ul><li>jsp必须通过依赖tomcat运行，不能直接在浏览器中运行</li><li>HTML可以查看网页的效果，但是不能接收后端的控制器传递的数据</li><li>Thymeleaf保留了html后缀，可以直接在浏览器中运行的能力，又有jsp的动态显示数据的功能</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">## <span class="number">2.</span>SpringBoot 整合thymeleaf</span><br><span class="line"></span><br><span class="line">导入依赖：</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>在<code>resources</code>下面有一个<code>templates</code>目录和<code>static</code>目录，放在<code>templates</code>被称作模板，放在<code>static</code>叫做静态资源，静态资源可以直接被访问，模板不行</p><p>在html中的标签中加入命名空间</p><p><code>xmlns:th=&quot;http://www.thymeleaf.org&quot;</code></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>模板需要通过控制器转发</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220625131731476.png" alt="image-20220625131731476"></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test2.html&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;test2.html&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220625131750649.png" alt="image-20220625131750649"></p><p>th的语法：</p><p>1.<code>th:text</code> 将控制器传递过来的内容放在html标签中</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">str:<span class="tag">&lt;<span class="name">label</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;str&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.<code>th:inline=“text”</code> 将取到的值拼接到后面</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:inline</span>=<span class="string">&quot;text&quot;</span>&gt;</span>我的名字是:[[$&#123;str&#125;]]<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;book&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/book1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">addBook</span><span class="params">(Model model)</span>&#123;</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">&quot;str&quot;</span>,<span class="string">&quot;my name is dhj&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;test2.html&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220625133547533.png" alt="image-20220625133547533"></p><p>3.循环语句  <code>th:each=&quot;b:$&#123;books&#125;&quot;</code></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">style</span>=<span class="string">&quot;width: 500px&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;0&quot;</span> <span class="attr">border</span>=<span class="string">&quot;1px&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>图书列表<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>图书id<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>图书名字<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>图书作者<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;b:$&#123;books&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;b.id&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;b.bookName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;b.bookAuthor&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ArrayList&lt;Book&gt; books = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="type">Book</span>  <span class="variable">b1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>(<span class="number">1</span>, <span class="string">&quot;c++&quot;</span>, <span class="string">&quot;dhj1&quot;</span>);</span><br><span class="line"><span class="type">Book</span>  <span class="variable">b2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>(<span class="number">2</span>, <span class="string">&quot;python&quot;</span>, <span class="string">&quot;dhj2&quot;</span>);</span><br><span class="line"><span class="type">Book</span>  <span class="variable">b3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>(<span class="number">3</span>, <span class="string">&quot;java&quot;</span>, <span class="string">&quot;dhj3&quot;</span>);</span><br><span class="line"><span class="type">Book</span>  <span class="variable">b4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>(<span class="number">4</span>, <span class="string">&quot;javascript&quot;</span>, <span class="string">&quot;dhj4&quot;</span>);</span><br><span class="line"><span class="type">Book</span>  <span class="variable">b5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>(<span class="number">5</span>, <span class="string">&quot;html&quot;</span>, <span class="string">&quot;dhj5&quot;</span>);</span><br><span class="line">books.add(b1);</span><br><span class="line">books.add(b2);</span><br><span class="line">books.add(b3);</span><br><span class="line">books.add(b4);</span><br><span class="line">books.add(b5);</span><br><span class="line">model.addAttribute(<span class="string">&quot;books&quot;</span>,books);</span><br></pre></td></tr></table></figure><p>……</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Thymeleaf&quot;&gt;&lt;a href=&quot;#Thymeleaf&quot; class=&quot;headerlink&quot; title=&quot;Thymeleaf&quot;&gt;&lt;/a&gt;Thymeleaf&lt;/h1&gt;&lt;h2 id=&quot;1-Thymeleaf简介&quot;&gt;&lt;a href=&quot;#1-Thymeleaf简</summary>
      
    
    
    
    
    <category term="Thymeleaf" scheme="http://daihaojun554.github.io/tags/Thymeleaf/"/>
    
    <category term="模板语法" scheme="http://daihaojun554.github.io/tags/%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ELasticsearch搜索引擎</title>
    <link href="http://daihaojun554.github.io/2022/06/20/ELasticsearch%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/"/>
    <id>http://daihaojun554.github.io/2022/06/20/ELasticsearch%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/</id>
    <published>2022-06-19T23:50:03.000Z</published>
    <updated>2022-08-29T02:47:12.073Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ELasticsearch"><a href="#ELasticsearch" class="headerlink" title="ELasticsearch"></a>ELasticsearch</h1><ul><li>了解ES</li><li>倒排索引</li><li>es的一些概念</li><li>安装es</li></ul><h2 id="了解ES："><a href="#了解ES：" class="headerlink" title="了解ES："></a>了解ES：</h2><p>ELasticsearch 是一款非常强大的开源搜索引擎，具备非常多强大功能，可以帮助我们从海量数据中快速找到需要的内容，可以用来实现搜索、日志统计、分析、系统监控等功能。</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220619153534702.png" alt="image-20220619153534702"></p><h2 id="倒排索引和正向索引"><a href="#倒排索引和正向索引" class="headerlink" title="倒排索引和正向索引"></a>倒排索引和正向索引</h2><p>正向索引：</p><p>传统数据库Mysql采用正向索引，中的id创建索引</p><p>倒排索引：</p><p>先了解两个概念</p><ul><li><p>文档：document每天数据就是一个文档</p></li><li><p>词条：term文档中按照语义分成的词语</p></li></ul><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220619155056625.png" alt="image-20220619155056625"></p><p><strong>倒排索引的搜索流程</strong>如下（以搜索”华为手机”为例）</p><ol><li>用户输入条件<code>&quot;华为手机&quot;</code>进行搜索</li><li>对用户输入内容<strong>分词</strong>，得到词条：<code>华为</code>、<code>手机</code></li><li>拿着词条在倒排索引中查找，可以得到包含词条的文档 id 有 1、2、3</li><li>拿着文档 id 到正向索引中查找具体文档</li></ol><p><strong>虽然要先查询倒排索引，再查询正向索引，但是词条和文档id 都建立了索引，查询速度非常快！无需全表扫描。</strong></p><p>为什么一个叫做正向索引，一个叫做倒排索引呢？</p><p><strong>正向索引</strong>是最传统的，根据 id 索引的方式。但根据词条查询时，必须先逐条获取每个文档，然后判断文档中是否包含所需要的词条，是<strong>根据文档找词条的过程</strong></p><p><strong>倒排索引</strong>则相反，是先找到用户要搜索的词条，根据得到的文档 id 获取该文档。是<strong>根据词条找文档的过程</strong></p><h2 id="文档和字段"><a href="#文档和字段" class="headerlink" title="文档和字段"></a>文档和字段</h2><p>elasticsearch 是面向<strong>文档（Document）</strong>存储的，可以是数据库中的一条商品数据，一个订单信息。文档数据会被序列化为 json 格式后存储在 elasticsearch</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220619155806430.png" alt="image-20220619155806430"></p><h2 id="索引和映射"><a href="#索引和映射" class="headerlink" title="索引和映射"></a>索引和映射</h2><p><strong>索引（Index）</strong>，就是相同类型的文档的集合。</p><p>例如：</p><ul><li>所有用户文档，就可以组织在一起，称为用户的索引；</li><li>所有商品的文档，可以组织在一起，称为商品的索引；</li><li>所有订单的文档，可以组织在一起，称为订单的索引；</li></ul><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220619155924408.png" alt="image-20220619155924408"></p><p>因此，我们可以把索引当做是数据库中的表。</p><p>数据库的表会有约束信息，用来定义表的结构、字段的名称、类型等信息。因此，索引库中就有<strong>映射（mapping）</strong>，是索引中文档的字段约束信息，类似表的结构约束。</p><p><strong>mysql 与 elasticsearch</strong></p><table><thead><tr><th align="center"><strong>MySQL</strong></th><th align="center"><strong>Elasticsearch</strong></th><th align="center"><strong>说明</strong></th></tr></thead><tbody><tr><td align="center">Table</td><td align="center">Index</td><td align="center">索引(index)，就是文档的集合，类似数据库的表(table)</td></tr><tr><td align="center">Row</td><td align="center">Document</td><td align="center">文档（Document），就是一条条的数据，类似数据库中的行（Row），文档都是JSON格式</td></tr><tr><td align="center">Column</td><td align="center">Field</td><td align="center">字段（Field），就是JSON文档中的字段，类似数据库中的列（Column）</td></tr><tr><td align="center">Schema</td><td align="center">Mapping</td><td align="center">Mapping（映射）是索引中文档的约束，例如字段类型约束。类似数据库的表结构（Schema）</td></tr><tr><td align="center">SQL</td><td align="center">DSL</td><td align="center">DSL是elasticsearch提供的JSON风格的请求语句，用来操作elasticsearch，实现CRUD</td></tr></tbody></table><ul><li>Mysql：擅长事务类型操作，可以确保数据的安全和一致性</li><li>Elasticsearch：擅长海量数据的搜索、分析、计算</li></ul><h2 id="安装elasticsearch、kibana"><a href="#安装elasticsearch、kibana" class="headerlink" title="安装elasticsearch、kibana"></a>安装elasticsearch、kibana</h2><h1 id="1-部署单点es"><a href="#1-部署单点es" class="headerlink" title="1.部署单点es"></a>1.部署单点es</h1><h2 id="1-1-创建网络"><a href="#1-1-创建网络" class="headerlink" title="1.1.创建网络"></a>1.1.创建网络</h2><p>因为我们还需要部署kibana容器，因此需要让es和kibana容器互联。这里先创建一个网络：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker network create es-net</span><br></pre></td></tr></table></figure><h2 id="1-2-加载镜像"><a href="#1-2-加载镜像" class="headerlink" title="1.2.加载镜像"></a>1.2.加载镜像</h2><p>elasticsearch的7.12.1版本的镜像</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220619233032578.png" alt="image-20220619233032578"></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 拉取镜像</span></span><br><span class="line">docker pull elasticsearch:[你的版本号tag]</span><br></pre></td></tr></table></figure><h2 id="1-3-运行"><a href="#1-3-运行" class="headerlink" title="1.3.运行"></a>1.3.运行</h2><p>运行docker命令，部署单点es：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">--name es \</span><br><span class="line">    -e <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span> \</span><br><span class="line">    -e <span class="string">&quot;discovery.type=single-node&quot;</span> \</span><br><span class="line">    -v es-data:/usr/share/elasticsearch/data \</span><br><span class="line">    -v es-plugins:/usr/share/elasticsearch/plugins \</span><br><span class="line">    --privileged \</span><br><span class="line">    --network es-net \</span><br><span class="line">    -p 9200:9200 \</span><br><span class="line">    -p 9300:9300 \</span><br><span class="line">elasticsearch:7.12.1</span><br></pre></td></tr></table></figure><p>命令解释：</p><ul><li><code>-e &quot;cluster.name=es-docker-cluster&quot;</code>：设置集群名称</li><li><code>-e &quot;http.host=0.0.0.0&quot;</code>：监听的地址，可以外网访问</li><li><code>-e &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</code>：内存大小</li><li><code>-e &quot;discovery.type=single-node&quot;</code>：非集群模式</li><li><code>-v es-data:/usr/share/elasticsearch/data</code>：挂载逻辑卷，绑定es的数据目录</li><li><code>-v es-logs:/usr/share/elasticsearch/logs</code>：挂载逻辑卷，绑定es的日志目录</li><li><code>-v es-plugins:/usr/share/elasticsearch/plugins</code>：挂载逻辑卷，绑定es的插件目录</li><li><code>--privileged</code>：授予逻辑卷访问权</li><li><code>--network es-net</code> ：加入一个名为es-net的网络中</li></ul><p>访问<a href="http://192.168.150.101:9200/">http://192.168.150.101:9200</a> </p><h1 id="2-部署kibana"><a href="#2-部署kibana" class="headerlink" title="2.部署kibana"></a>2.部署kibana</h1><p>kibana可以给我们提供一个elasticsearch的可视化界面，便于我们学习。</p><h2 id="2-1-部署"><a href="#2-1-部署" class="headerlink" title="2.1.部署"></a>2.1.部署</h2><p>运行docker命令，部署kibana</p><p>拉取镜像：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 拉取镜像</span></span><br><span class="line">docker pull kibana:[你的版本号tag]</span><br></pre></td></tr></table></figure><p>运行一个容器：</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">--name kibana \</span><br><span class="line">-e ELASTICSEARCH_HOSTS=http://es:9200 \</span><br><span class="line">--network=es-net \</span><br><span class="line">-p 5601:5601  \</span><br><span class="line">kibana:7.12.1</span><br></pre></td></tr></table></figure><ul><li><code>--network es-net</code> ：加入一个名为es-net的网络中，与elasticsearch在同一个网络中</li><li><code>-e ELASTICSEARCH_HOSTS=http://es:9200&quot;</code>：设置elasticsearch的地址，因为kibana已经与elasticsearch在一个网络，因此可以用容器名直接访问elasticsearch</li><li><code>-p 5601:5601</code>：端口映射配置</li></ul><p>稍等一会就可以访问<a href="http://ip:5601/">http://ip:5601</a></p><h1 id="3-安装IK分词器"><a href="#3-安装IK分词器" class="headerlink" title="3.安装IK分词器"></a>3.安装IK分词器</h1><p>IK分词器 es （插件）</p><p>下载: <a href="https://github.com/medcl/elasticsearch-analysis-ik/releases">https://github.com/medcl/elasticsearch-analysis-ik/releases</a></p><p>解压到es目录下的<strong>plugins</strong>下</p><p>IK提供了两个分词算法：ik_smart和ik_max_word，其中ik smart为最少切分，ik_max_word为最细粒度划分!</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220619234300809.png" alt="image-20220619234300809"></p><p>ik分词可以自定义添加词语，打开IKAnalyzer.cfg.xml，我们可以自己加入我们的扩展字典。</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220619234944475.png" alt="image-20220619234944475"></p><p>可以添加一些热点词，禁止的词语等等。。。</p><h1 id="4-ES索引库操作"><a href="#4-ES索引库操作" class="headerlink" title="4.ES索引库操作"></a>4.ES索引库操作</h1><ul><li>mapping映射属性</li><li>索引库的CRUD</li></ul><p>mapping是索引库中对文档的约束，常见的mapping属性有</p><ul><li><p>type字符串类型，常见的类型有：</p><ul><li>字符串text(可分词文本)，keyword(精确值，例如：品牌，国家，ip)</li><li>数值：long，int，double…..</li><li>布尔：boolean</li><li>日期：Date</li></ul></li><li><p>index:是否创建倒排索引，默认为true</p></li><li><p>analyzer：使用哪种分词器</p><ul><li><code>ik_smart</code></li><li><code>ik_max_word</code></li></ul></li><li><p>properties：子字段，对象嵌套的时候会使用到</p></li></ul><h2 id="创建索引库："><a href="#创建索引库：" class="headerlink" title="创建索引库："></a>创建索引库：</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"># 创建索引库</span><br><span class="line"># 索引库的名字叫dhj</span><br><span class="line">PUT /dhj</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;info&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">        <span class="punctuation">,</span> <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;emali&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">,</span> <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;object&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;firstName&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;keyword&quot;</span></span><br><span class="line">              <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;lastName&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;keyword&quot;</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="删除索引库："><a href="#删除索引库：" class="headerlink" title="删除索引库："></a>删除索引库：</h2><p><code>delete /索引库的名字</code></p><h2 id="查看索引库："><a href="#查看索引库：" class="headerlink" title="查看索引库："></a>查看索引库：</h2><p><code>GET/索引库的名字</code></p><h2 id="修改索引库："><a href="#修改索引库：" class="headerlink" title="修改索引库："></a>修改索引库：</h2><p>禁止修改索引库</p><p>但是允许你添加新的字段</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT /索引库名称/_mapping</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;new_word&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;XXX&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="5-文档操作"><a href="#5-文档操作" class="headerlink" title="5.文档操作"></a>5.文档操作</h1><h2 id="5-1-添加文档"><a href="#5-1-添加文档" class="headerlink" title="5.1.添加文档"></a>5.1.添加文档</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /索引库名字/_doc/文档id</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">     <span class="attr">&quot;field1&quot;</span><span class="punctuation">:</span><span class="string">&quot;value1&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;field2&quot;</span><span class="punctuation">:</span><span class="string">&quot;value2&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;field3&quot;</span><span class="punctuation">:</span><span class="string">&quot;value3&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;field4&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;son1&quot;</span><span class="punctuation">:</span><span class="string">&quot;value4&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;son2&quot;</span><span class="punctuation">:</span><span class="string">&quot;value5&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="punctuation">&#125;</span></span><br><span class="line">    </span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="5-2-查询文档"><a href="#5-2-查询文档" class="headerlink" title="5.2.查询文档"></a>5.2.查询文档</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">GET /索引库名字/_doc/文档id</span><br></pre></td></tr></table></figure><h2 id="5-3-删除文档"><a href="#5-3-删除文档" class="headerlink" title="5.3.删除文档"></a>5.3.删除文档</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">DELETE /索引库名字/_doc/文档id</span><br></pre></td></tr></table></figure><h2 id="5-4-修改"><a href="#5-4-修改" class="headerlink" title="5.4.修改"></a>5.4.修改</h2><h3 id="5-4-1-全量修改"><a href="#5-4-1-全量修改" class="headerlink" title="5.4.1.全量修改"></a>5.4.1.全量修改</h3><p>如果id存在的话，会删除旧的文档，添加新的文档</p><p>不存在的话就会创建新的文档</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT  /索引库名字/_doc/文档id</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;field1&quot;</span><span class="punctuation">:</span><span class="string">&quot;value1&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;field2&quot;</span><span class="punctuation">:</span><span class="string">&quot;value2&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="5-4-2-增量修改"><a href="#5-4-2-增量修改" class="headerlink" title="5.4.2.增量修改"></a>5.4.2.增量修改</h3><p>修改指定字段值</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST  /索引库名字/_update/文档id</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;字段名&quot;</span><span class="punctuation">:</span><span class="string">&quot;新的值&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="创建索引库"><a href="#创建索引库" class="headerlink" title="创建索引库"></a>创建索引库</h1><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">#hotel  凡是参与搜索的都可以copy_to <span class="punctuation">,</span>创建索引库</span><br><span class="line">PUT /hotel</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;copy_to&quot;</span><span class="punctuation">:</span> <span class="string">&quot;all&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;score&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;copy_to&quot;</span><span class="punctuation">:</span> <span class="string">&quot;all&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;city&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;copy_to&quot;</span><span class="punctuation">:</span> <span class="string">&quot;all&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;starName&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;business&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;geo_point&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;pic&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;all&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="6-RestClient操作索引库"><a href="#6-RestClient操作索引库" class="headerlink" title="6.RestClient操作索引库"></a>6.RestClient操作索引库</h1><ul><li>引入依赖</li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--elasticsearch--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>创建RestClient对象</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@BeforeEach</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">    client = <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(</span><br><span class="line">            HttpHost.create(<span class="string">&quot;http://192.168.56.10:9200&quot;</span>)</span><br><span class="line">    ));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testCreateIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1.准备Request      PUT /hotel</span></span><br><span class="line">        <span class="type">CreateIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreateIndexRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.准备请求参数</span></span><br><span class="line">        request.source(MAPPING_TEMPLATE, XContentType.JSON);</span><br><span class="line">        <span class="comment">// 3.发送请求</span></span><br><span class="line">        client.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testExistsIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1.准备Request</span></span><br><span class="line">        <span class="type">GetIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetIndexRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">        <span class="comment">// 3.发送请求</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isExists</span> <span class="operator">=</span> client.indices().exists(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        System.out.println(isExists ? <span class="string">&quot;存在&quot;</span> : <span class="string">&quot;不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDeleteIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1.准备Request</span></span><br><span class="line">        <span class="type">DeleteIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteIndexRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">        <span class="comment">// 3.发送请求</span></span><br><span class="line">        client.indices().delete(request, RequestOptions.DEFAULT);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@AfterEach</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    client.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="7-RestClient操作文档"><a href="#7-RestClient操作文档" class="headerlink" title="7.RestClient操作文档"></a>7.RestClient操作文档</h1><p><strong>查询文档的DSL</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GET /hotel/_doc/38812</span><br></pre></td></tr></table></figure><h2 id="7-1-新增文档"><a href="#7-1-新增文档" class="headerlink" title="7.1.新增文档"></a>7.1.新增文档</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">testAddDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">       <span class="comment">// 1.查询数据库hotel数据</span></span><br><span class="line">       <span class="type">Hotel</span> <span class="variable">hotel</span> <span class="operator">=</span> hotelService.getById(<span class="number">38812L</span>);</span><br><span class="line">       <span class="comment">// 2.转换为HotelDoc</span></span><br><span class="line">       <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotelDoc</span>(hotel);</span><br><span class="line">       <span class="comment">// 3.转JSON</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(hotelDoc);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 1.准备Request</span></span><br><span class="line">       <span class="type">IndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;hotel&quot;</span>).id(hotelDoc.getId().toString());</span><br><span class="line">       <span class="comment">// 2.准备请求参数DSL，其实就是文档的JSON字符串</span></span><br><span class="line">       request.source(json, XContentType.JSON);</span><br><span class="line">       <span class="comment">// 3.发送请求</span></span><br><span class="line">       client.index(request, RequestOptions.DEFAULT);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2 id="7-2-修改文档"><a href="#7-2-修改文档" class="headerlink" title="7.2.修改文档"></a>7.2.修改文档</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testUpdateById</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.准备Request</span></span><br><span class="line">    <span class="type">UpdateRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UpdateRequest</span>(<span class="string">&quot;hotel&quot;</span>, <span class="string">&quot;61083&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.准备参数</span></span><br><span class="line">    request.doc(</span><br><span class="line">            <span class="string">&quot;price&quot;</span>, <span class="string">&quot;870&quot;</span></span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 3.发送请求</span></span><br><span class="line">    client.update(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-3-查看文档"><a href="#7-3-查看文档" class="headerlink" title="7.3.查看文档"></a>7.3.查看文档</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testGetDocumentById</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.准备Request      // GET /hotel/_doc/&#123;id&#125;</span></span><br><span class="line">    <span class="type">GetRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetRequest</span>(<span class="string">&quot;hotel&quot;</span>, <span class="string">&quot;61083&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.发送请求</span></span><br><span class="line">    <span class="type">GetResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.get(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 3.解析响应结果</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> response.getSourceAsString();</span><br><span class="line"></span><br><span class="line">    <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> JSON.parseObject(json, HotelDoc.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;hotelDoc = &quot;</span> + hotelDoc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-4-删除文档"><a href="#7-4-删除文档" class="headerlink" title="7.4.删除文档"></a>7.4.删除文档</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testDeleteDocumentById</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.准备Request      // DELETE /hotel/_doc/&#123;id&#125;</span></span><br><span class="line">    <span class="type">DeleteRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteRequest</span>(<span class="string">&quot;hotel&quot;</span>, <span class="string">&quot;61083&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.发送请求</span></span><br><span class="line">    client.delete(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>RestClient.index()、delete()、get()、update()</code></p><h2 id="7-5-批量的操作"><a href="#7-5-批量的操作" class="headerlink" title="7.5.批量的操作"></a>7.5.批量的操作</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testBulkRequest</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 查询所有的酒店数据</span></span><br><span class="line">    List&lt;Hotel&gt; list = hotelService.list();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.准备Request</span></span><br><span class="line">    <span class="type">BulkRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>();</span><br><span class="line">    <span class="comment">// 2.准备参数</span></span><br><span class="line">    <span class="keyword">for</span> (Hotel hotel : list) &#123;</span><br><span class="line">        <span class="comment">// 2.1.转为HotelDoc</span></span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HotelDoc</span>(hotel);</span><br><span class="line">        <span class="comment">// 2.2.转json</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(hotelDoc);</span><br><span class="line">        <span class="comment">// 2.3.添加请求</span></span><br><span class="line">        request.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;hotel&quot;</span>).id(hotel.getId().toString()).source(json, XContentType.JSON));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.发送请求</span></span><br><span class="line">    client.bulk(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="8-DSL搜索，全文检索"><a href="#8-DSL搜索，全文检索" class="headerlink" title="8.DSL搜索，全文检索"></a>8.DSL搜索，全文检索</h1><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">检索全部</span><br><span class="line">GET /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">按照给的字段来检索</span><br><span class="line">GET /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;all&quot;</span><span class="punctuation">:</span> <span class="string">&quot;上海&quot;</span></span><br><span class="line">        # 这个all是 通过copy_to把多个要查询的字段来拷到all中来</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">和上面一个意思</span><br><span class="line">GET /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;multi_match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;上海&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;city&quot;</span><span class="punctuation">,</span><span class="string">&quot;business&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>查询所有</strong>：查询出所有数据，一般测试用。例如：match_all</p><p><strong>全文检索（full text）查询</strong>：利用分词器对用户输入内容分词，然后去倒排索引库中匹配。例如：</p><ul><li>match_query</li><li>multi_match_query</li></ul><p><strong>精确查询</strong>：根据精确词条值查找数据，一般是查找 keyword、数值、日期、boolean 等类型字段。例如：</p><ul><li>ids</li><li>range</li><li>term</li></ul><p><strong>地理（geo）查询</strong>：根据经纬度查询。例如：</p><ul><li>geo_distance</li><li>geo_bounding_box</li></ul><p><strong>复合（compound）查询</strong>：复合查询可以将上述各种查询条件组合起来，合并查询条件。例如：</p><ul><li>bool</li><li>function_score</li></ul><h2 id="8-1-term查询（精确查询）"><a href="#8-1-term查询（精确查询）" class="headerlink" title="8.1.term查询（精确查询）"></a>8.1.term查询（精确查询）</h2><p>因为精确查询的字段搜是不分词的字段，因此查询的条件也必须是<strong>不分词</strong>的词条。查询时，用户输入的内容跟自动值完全匹配时才认为符合条件。如果用户输入的内容过多，反而搜索不到数据。</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">GET /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;city&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;杭州&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="8-2-range-查询-范围查询"><a href="#8-2-range-查询-范围查询" class="headerlink" title="8.2.range 查询(范围查询)"></a>8.2.range 查询(范围查询)</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">GET /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span> <span class="number">300</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="8-3-地理查询"><a href="#8-3-地理查询" class="headerlink" title="8.3.地理查询"></a>8.3.地理查询</h2><p>根据经纬度查询，</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"># distance查询</span><br><span class="line">GET /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;geo_distance&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;distance&quot;</span><span class="punctuation">:</span> <span class="string">&quot;15km&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="string">&quot;31.2 ,10.1&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><hr><hr><hr><h1 id="初步理解"><a href="#初步理解" class="headerlink" title="初步理解"></a>初步理解</h1><h2 id="cat"><a href="#cat" class="headerlink" title="_cat"></a>_cat</h2><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220822124507089.png" alt="image-20220822124507089"></p><p>查看节点的各种信息</p><ul><li><a href="http://ip/_cat/indices">http://ip/_cat/indices</a> 查看所有的索引</li><li><a href="http://ip/_cat/master">http://ip/_cat/master</a> 查看主节点的信息</li><li><a href="http://ip/_cat/health">http://ip/_cat/health</a> 查看健康状况</li><li><a href="http://ip/_cat/nodes">http://ip/_cat/nodes</a> 查看节点信息</li></ul><h2 id="索引一条文档（保存一条记录）"><a href="#索引一条文档（保存一条记录）" class="headerlink" title="索引一条文档（保存一条记录）"></a>索引一条文档（保存一条记录）</h2><p>put ，保存到哪个索引的哪个类型下</p><p>put  ：<code>http://ip:9200/索引/类型/唯一标识</code></p><p>请求体 的内容</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;jonn davie&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>如果再次发送相同的数据，就会更新操作，并且版本号变成加1</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220826151034261.png" alt="image-20220826151034261"></p><p>保存 post请求 不指定id 保存 就会自动的生成唯一的标识，如果带上id就是update操作</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220826151444600.png" alt="image-20220826151444600"></p><h2 id="查询一条数据"><a href="#查询一条数据" class="headerlink" title="查询一条数据"></a>查询一条数据</h2><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220826152234294.png" alt="image-20220826152234294"></p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;customer&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;external&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_version&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_seq_no&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="comment">//做并发控制的，每次更新seq_no 加1 乐观锁</span></span><br><span class="line">    <span class="attr">&quot;_primary_term&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;found&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;观子而志管理&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><code>http://124.223.63.141:9200/customer/external/1?if_seq_no=1&amp;if_primary_term=1</code></p><p>请求体：</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;abcdjd&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220826153325591.png" alt="image-20220826153325591"></p><h2 id="更新文档"><a href="#更新文档" class="headerlink" title="更新文档"></a>更新文档</h2><p>post <code>http://ip:9200/customer/external/&#123;id&#125;/_update</code></p><p>&#96;&#96;</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;萨科技的喀什的贺卡上加大数据库&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>或者：</p><p><code>post/put: http://ip:9200/customer/external/&#123;id&#125;</code></p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;name&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">123</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="删除一条文档"><a href="#删除一条文档" class="headerlink" title="删除一条文档"></a>删除一条文档</h2><p><code>delete http://ip:9200/customer/external/&#123;id&#125;</code></p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220826154932468.png" alt="image-20220826154932468"></p><h2 id="批量bulk"><a href="#批量bulk" class="headerlink" title="批量bulk"></a>批量bulk</h2><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220826155901329.png" alt="image-20220826155901329"></p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /customer/external/_bulk</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;JohnDave&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;daihaojun&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;3&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;maoyongfeng&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /_bulk</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;delete&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span><span class="string">&quot;website&quot;</span><span class="punctuation">,</span><span class="attr">&quot;_type&quot;</span><span class="punctuation">:</span><span class="string">&quot;blog&quot;</span><span class="punctuation">,</span><span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;123&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;create&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span><span class="string">&quot;website&quot;</span><span class="punctuation">,</span><span class="attr">&quot;_type&quot;</span><span class="punctuation">:</span><span class="string">&quot;blog&quot;</span><span class="punctuation">,</span><span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;123&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;My first blog title post&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span><span class="string">&quot;website&quot;</span><span class="punctuation">,</span><span class="attr">&quot;_type&quot;</span><span class="punctuation">:</span><span class="string">&quot;blog&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;My first blog title post&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;update&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span><span class="string">&quot;website&quot;</span><span class="punctuation">,</span><span class="attr">&quot;_type&quot;</span><span class="punctuation">:</span><span class="string">&quot;blog&quot;</span><span class="punctuation">,</span><span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;123&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;my update blog post&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>es测试数据:</p><p><code>post /bank/account/_bulk</code></p><p><a href="https://dhj-gulimall.oss-cn-hangzhou.aliyuncs.com/elasticsearch/account.json">https://dhj-gulimall.oss-cn-hangzhou.aliyuncs.com/elasticsearch/account.json</a></p><p>ES支持两种基本方式检索:</p><ul><li>一个是通过使用 REST request URI 发送搜索参数（uri+检索参数)</li></ul><p><code>GET /bank/_search?q=*&amp;sort=account_number:asc</code></p><ul><li>另一个是通过使用REST request body来发送它们（uri+请求体)</li></ul><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;Field_Name&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;order&quot;</span><span class="punctuation">:</span><span class="string">&quot;desc&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;Field_Name&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;order&quot;</span><span class="punctuation">:</span><span class="string">&quot;desc&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;Field_Name&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;order&quot;</span><span class="punctuation">:</span><span class="string">&quot;desc&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;Field_Name&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;order&quot;</span><span class="punctuation">:</span><span class="string">&quot;desc&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;FieldName&quot;</span><span class="punctuation">,</span><span class="string">&quot;FieldName2&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="match【分词匹配】"><a href="#match【分词匹配】" class="headerlink" title="match【分词匹配】"></a>match【分词匹配】</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">GET bank/_search<span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;FIELDNAME&quot;</span><span class="punctuation">:</span><span class="string">&quot;...&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="match-phrase【短语匹配】"><a href="#match-phrase【短语匹配】" class="headerlink" title="match_phrase【短语匹配】"></a>match_phrase【短语匹配】</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">GET bank/_search<span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match_phrase&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;FIELDNAME&quot;</span><span class="punctuation">:</span><span class="string">&quot;...&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="multi-match【多字段匹配，分词】"><a href="#multi-match【多字段匹配，分词】" class="headerlink" title="multi_match【多字段匹配，分词】"></a>multi_match【多字段匹配，分词】</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">GET bank/_search<span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;multi_match&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="string">&quot;mill&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;fieldName&quot;</span><span class="punctuation">,</span>&#x27;fieldName2&#x27;<span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="bool-复合查询"><a href="#bool-复合查询" class="headerlink" title="bool-复合查询"></a>bool-复合查询</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">GET bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;state&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AK&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span> <span class="string">&quot;F&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;must_not&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;lastname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Kirby&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Dewitt&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;should&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;lastname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Hebert&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">          </span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">      </span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">GET bank/_search<span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;must&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;match&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;FieldName&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;match&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;FieldName2&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;must_not&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">                 <span class="punctuation">&#123;</span><span class="attr">&quot;match&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;FieldName&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;match&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;FieldName2&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;should&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;match&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;fieldName&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;match&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;fieldName&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;match&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;fieldName&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">          </span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="filter-结果过滤【不贡献相关性得分】"><a href="#filter-结果过滤【不贡献相关性得分】" class="headerlink" title="filter-结果过滤【不贡献相关性得分】"></a>filter-结果过滤【不贡献相关性得分】</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">GET bank/_search<span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;fieldName&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          </span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="term【精确字段】"><a href="#term【精确字段】" class="headerlink" title="term【精确字段】"></a>term【精确字段】</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">GET bank/_search<span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;FIELDNAME&quot;</span><span class="punctuation">:</span><span class="string">&quot;...&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>文本字段采用match匹配，精确字段采用term来匹配</p></blockquote><h2 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h2><p>搜索address中包含mill的所有人的年龄分布以及平均年龄,</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">######## 搜索address中包含mill的所有人的年龄分布以及平均年龄<span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">GET bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mill&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;AgeAgg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;age&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">100</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;avgAgg&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;age&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>查出所有年龄分布，并且这些年龄段中M的平均薪资和F的平均薪资和M的平均薪资以及这个年龄段的总体平均薪资</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">GET bank/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;AgeAggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;age&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">100</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;genderAggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gender.keyword&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;BalabncesAggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;balance&quot;</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">          </span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">      </span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h1><h2 id="创建新的映射"><a href="#创建新的映射" class="headerlink" title="创建新的映射"></a>创建新的映射</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT /newbank</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;account_number&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ignore_above&quot;</span><span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;balance&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;city&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;employer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;firstname&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ignore_above&quot;</span><span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;lastname&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ignore_above&quot;</span><span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;state&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><a href="https://docs.kilvn.com/elasticsearch/docs/288.html">映射</a></p><h2 id="将数据迁移"><a href="#将数据迁移" class="headerlink" title="将数据迁移"></a>将数据迁移</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST _reindex</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bank&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;account&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dest&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;newbank&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="分词"><a href="#分词" class="headerlink" title="分词"></a>分词</h1><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">POST /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;standard&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The cat is hitting Ultraman&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>安装ik分词器</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_smart&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;我是正经人!&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">POST /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;我是正经人!&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="自定义分词"><a href="#自定义分词" class="headerlink" title="自定义分词"></a>自定义分词</h2><p>将配置修改并且配置远程的词库</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220828173549447.png" alt="image-20220828173549447"></p><h3 id="配置远程的es词库"><a href="#配置远程的es词库" class="headerlink" title="配置远程的es词库"></a>配置远程的es词库</h3><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220828173559340.png" alt="image-20220828173559340"></p><h1 id="使用ElasticSearch-Rest-client"><a href="#使用ElasticSearch-Rest-client" class="headerlink" title="使用ElasticSearch-Rest-client"></a>使用ElasticSearch-Rest-client</h1><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--    es的hignclient    --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>配置</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ElasticSearchConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span>  RestHighLevelClient  <span class="title function_">esRestClient</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;124.223.63.141&quot;</span>, <span class="number">9200</span>, <span class="string">&quot;http&quot;</span>)));</span><br><span class="line">        <span class="keyword">return</span> client;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="建立索引，也可更新"><a href="#建立索引，也可更新" class="headerlink" title="建立索引，也可更新"></a>建立索引，也可更新</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建索引，并且插入数据</span></span><br><span class="line"><span class="comment">     * 也可更新</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Product</span>();</span><br><span class="line">        product.setSku(<span class="string">&quot;bk-1&quot;</span>);</span><br><span class="line">        product.setProductName(<span class="string">&quot;CityBike&quot;</span>);</span><br><span class="line">        product.setPrice(<span class="number">120.0</span>);</span><br><span class="line">        <span class="comment">//创建一个indexrequest对象</span></span><br><span class="line">        <span class="type">IndexRequest</span> <span class="variable">indexRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>();</span><br><span class="line">        indexRequest.id(product.getSku());</span><br><span class="line">        indexRequest.index(<span class="string">&quot;product&quot;</span>);</span><br><span class="line">        <span class="comment">//source将，对象转换成json字符串，并且指定类型 </span></span><br><span class="line">        indexRequest.source(JSON.toJSONString(product), XContentType.JSON);</span><br><span class="line">        <span class="type">IndexResponse</span> <span class="variable">index</span> <span class="operator">=</span> esClient.index(indexRequest, RequestOptions.DEFAULT);</span><br><span class="line">        System.out.println(index);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220829101934682.png" alt="image-20220829101934682"></p><h3 id="通过id和索引来查询"><a href="#通过id和索引来查询" class="headerlink" title="通过id和索引来查询"></a>通过id和索引来查询</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 通过id来查询</span><br><span class="line"> * @throws IOException</span><br><span class="line"> */</span><br><span class="line">@Test</span><br><span class="line">public void testgetByid() throws IOException &#123;</span><br><span class="line">    //指定索引和id</span><br><span class="line">    GetRequest getRequest = new GetRequest(&quot;product&quot;,&quot;bk-1&quot;);</span><br><span class="line">    GetResponse documentFields = esClient.get(getRequest, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(documentFields);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220829103044963.png" alt="image-20220829103044963"><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220829103100259.png" alt="image-20220829103100259"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ELasticsearch&quot;&gt;&lt;a href=&quot;#ELasticsearch&quot; class=&quot;headerlink&quot; title=&quot;ELasticsearch&quot;&gt;&lt;/a&gt;ELasticsearch&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;了解ES&lt;/li&gt;
&lt;li&gt;倒排索引&lt;/</summary>
      
    
    
    
    
    <category term="分布式搜索" scheme="http://daihaojun554.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E6%90%9C%E7%B4%A2/"/>
    
  </entry>
  
  <entry>
    <title>GateWay网关</title>
    <link href="http://daihaojun554.github.io/2022/06/20/GateWay%E7%BD%91%E5%85%B3/"/>
    <id>http://daihaojun554.github.io/2022/06/20/GateWay%E7%BD%91%E5%85%B3/</id>
    <published>2022-06-19T23:50:03.000Z</published>
    <updated>2022-06-17T08:31:39.128Z</updated>
    
    <content type="html"><![CDATA[<h1 id="GateWay网关"><a href="#GateWay网关" class="headerlink" title="GateWay网关"></a><code>GateWay</code>网关</h1><p>为什么需要网关？对微服务的保护</p><p>网管的功能：</p><ul><li>身份认证和权限校验</li><li>服务路由，负载均衡</li><li>请求限流</li></ul><p>所有的请求首先进入网关</p><p>网关技术的实现：</p><p>在springcloud中网关的实现包括两种</p><ul><li><p>gateway</p></li><li><p>zuul</p><p><code>zuul</code>是基于<code>servlet</code>实现的，属于阻塞式的编程，而<code>springcloudGateway</code>是<code>spring5</code>中提供的<code>webflux</code>属于<strong>响应式的编程</strong>，具有<strong>更好的性能</strong></p></li></ul><h2 id="搭建网关的步骤："><a href="#搭建网关的步骤：" class="headerlink" title="搭建网关的步骤："></a>搭建网关的步骤：</h2><p>网关是一个独立的服务</p><p>1、需要引入两个依赖</p><p>nacos微服务的注册和发现，gateway的依赖</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-gateway --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2、配置服务的注册与发现     </p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span> <span class="comment"># 服务名称</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br></pre></td></tr></table></figure><p>编写路由配置和nacos的地址</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">gateway:</span></span><br><span class="line">  <span class="attr">routes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">userservice</span> <span class="comment">#路由标识</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">lb://userservice/</span>  <span class="comment"># 路由的目标地址</span></span><br><span class="line">      <span class="attr">predicates:</span> <span class="comment">#路由断言，判断请求是否符合规则</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">Path=/user/**</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">orderservice</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">lb://orderservice/</span></span><br><span class="line">      <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/order/**</span></span><br></pre></td></tr></table></figure><h2 id="路由断言工厂的可配置内容："><a href="#路由断言工厂的可配置内容：" class="headerlink" title="路由断言工厂的可配置内容："></a>路由断言工厂的可配置内容：</h2><ul><li>路由id，唯一标识</li><li>路由目标地址uri，可配成lb和http两种</li><li>路由的断言predicates，判断请求是否符合要求，符合就转到目标路由地址</li><li>filter：路由的过滤器，处理请求和响应</li></ul><p>Spring中提供了11个基本的predicate工厂</p><h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><table><thead><tr><th align="left">名称</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left">After</td><td align="left">是某个时间点后的请求</td><td align="left">- After&#x3D;2037-01-20T17:42:47.789-07:00[America&#x2F;Denver]</td></tr><tr><td align="left">Before</td><td align="left">是某个时间点之前的请求</td><td align="left">- Before&#x3D;2031-04-13T15:14:47.433+08:00[Asia&#x2F;Shanghai]</td></tr><tr><td align="left">Between</td><td align="left">是某两个时间点之前的请求</td><td align="left">- Between&#x3D;2037-01-20T17:42:47.789-07:00[America&#x2F;Denver], 2037-01-21T17:42:47.789-07:00[America&#x2F;Denver]</td></tr><tr><td align="left">Cookie</td><td align="left">请求必须包含某些cookie</td><td align="left">- Cookie&#x3D;chocolate, ch.p</td></tr><tr><td align="left">Header</td><td align="left">请求必须包含某些header</td><td align="left">- Header&#x3D;X-Request-Id, \d+</td></tr><tr><td align="left">Host</td><td align="left">请求必须是访问某个host（域名）</td><td align="left">- Host&#x3D;<code>**.somehost.org</code>, <code>**.anotherhost.org</code></td></tr><tr><td align="left">Method</td><td align="left">请求方式必须是指定方式</td><td align="left">- Method&#x3D;GET,POST</td></tr><tr><td align="left">Path</td><td align="left">请求路径必须符合指定规则</td><td align="left">- Path&#x3D;&#x2F;red&#x2F;{segment},&#x2F;blue&#x2F;**</td></tr><tr><td align="left">Query</td><td align="left">请求参数必须包含指定参数</td><td align="left">- Query&#x3D;name, Jack或者- Query&#x3D;name</td></tr><tr><td align="left">RemoteAddr</td><td align="left">请求者的ip必须是指定范围</td><td align="left">- RemoteAddr&#x3D;192.168.1.1&#x2F;24</td></tr></tbody></table><table><thead><tr><th>官方文档：<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories">Spring Cloud Gateway predicates</a></th></tr></thead></table><h3 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h3><h4 id="GateWayFilter："><a href="#GateWayFilter：" class="headerlink" title="GateWayFilter："></a><strong>GateWayFilter：</strong></h4><p>是网关提供的一种过滤器，可以对进入网关的请求和微服务返回的响应进行处理</p><p>Spring提供的过滤器工厂有30多个：</p><table><thead><tr><th>官方文档：<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gatewayfilter-factories">Spring Cloud Gateway Filter</a></th></tr></thead></table><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">AddRequestHeader=color-key,</span> <span class="string">blue-value</span></span><br></pre></td></tr></table></figure><p>当然，Gateway 也是有<strong>全局过滤器</strong>的，如果要<strong>对所有的路由都生效</strong>，则可以将过滤器工厂写到 default-filters 下：</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">default-filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">AddRequestHeader=msg,</span> <span class="string">this</span> <span class="string">is</span> <span class="string">my</span> <span class="string">message</span> <span class="comment"># 添加请求头</span></span><br></pre></td></tr></table></figure><h4 id="全局过滤器："><a href="#全局过滤器：" class="headerlink" title="全局过滤器："></a><strong>全局过滤器：</strong></h4><p>globalFilter：</p><p>全局过滤器可以自定义逻辑，实现<code>globalFilter</code>接口</p><p><strong>需求：</strong>定义全局过滤器，拦截请求，判断请求的参数是否满足下面条件</p><ul><li>参数中是否有 authorization</li><li>authorization 参数值是否为 admin</li></ul><p>如果同时满足则放行，否则拦截。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//@Order(-1)//执行顺序值越小，优先级越高</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorZeFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * **需求：**定义全局过滤器，拦截请求，判断请求的参数是否满足下面条件</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * - 参数中是否有 authorization</span></span><br><span class="line"><span class="comment">     * - authorization 参数值是否为 admin</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 如果同时满足则放行，否则拦截。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> exchange</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chain</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line"><span class="comment">//        1获取请求参数</span></span><br><span class="line">        <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line"></span><br><span class="line">        MultiValueMap&lt;String, String&gt; queryParams = request.getQueryParams();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">authorization</span> <span class="operator">=</span> queryParams.getFirst(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;admin&quot;</span>.equals(authorization)) &#123;</span><br><span class="line"><span class="comment">//            是,就放行</span></span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            exchange.getResponse().setStatusCode(UNAUTHORIZED);<span class="comment">//401</span></span><br><span class="line">            <span class="comment">//拦截</span></span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再去访问这个才行</p><p><a href="http://localhost:10000/user/now?authorization=admin">http://localhost:10000/user/now?authorization=admin</a></p><p><strong>过滤器一定要有顺序</strong></p><p>过滤器的执行顺序</p><h2 id="过滤器顺序"><a href="#过滤器顺序" class="headerlink" title="过滤器顺序"></a>过滤器顺序</h2><p>请求进入网关会碰到三类过滤器：DefaultFilter、当前路由的过滤器、GlobalFilter；</p><p>请求路由后，会将三者合并到一个过滤器链（集合）中，排序后依次执行每个过滤器.</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617162511736.png" alt="image-20220617162511736"></p><p>排序的规则是什么呢？</p><ul><li><p>每一个过滤器都必须指定一个 int 类型的 order 值，<strong>order 值越小，优先级越高，执行顺序越靠前</strong>。</p></li><li><p>GlobalFilter 通过实现 Ordered 接口，或者使用 @Order 注解来指定 order 值，由我们自己指定。</p></li><li><p>路由过滤器和 defaultFilter 的 order 由 Spring 指定，默认是按照声明顺序从1递增。</p></li><li><p>当过滤器的 order 值一样时，<strong>会按照 defaultFilter &gt; 路由过滤器 &gt; GlobalFilter 的顺序执行。</strong></p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;GateWay网关&quot;&gt;&lt;a href=&quot;#GateWay网关&quot; class=&quot;headerlink&quot; title=&quot;GateWay网关&quot;&gt;&lt;/a&gt;&lt;code&gt;GateWay&lt;/code&gt;网关&lt;/h1&gt;&lt;p&gt;为什么需要网关？对微服务的保护&lt;/p&gt;
&lt;p&gt;网管的功能：</summary>
      
    
    
    
    
    <category term="网关" scheme="http://daihaojun554.github.io/tags/%E7%BD%91%E5%85%B3/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloud</title>
    <link href="http://daihaojun554.github.io/2022/06/19/SpringCloud/"/>
    <id>http://daihaojun554.github.io/2022/06/19/SpringCloud/</id>
    <published>2022-06-19T00:00:00.000Z</published>
    <updated>2022-06-16T14:45:25.458Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringCloud技术"><a href="#SpringCloud技术" class="headerlink" title="SpringCloud技术"></a>SpringCloud技术</h1><p><strong>认识微服务</strong></p><h2 id="单体架构"><a href="#单体架构" class="headerlink" title="单体架构"></a>单体架构</h2><p><strong>单体架构</strong>：将业务的所有功能集中在一个项目中开发，打成一个包部署。</p><p><img src="/2022/06/19/SpringCloud/image-20220616124406710.png" alt="image-20220616124406710"></p><p><strong>优点：</strong>架构简单，部署成本低</p><p><strong>缺点：</strong>耦合度高（维护困难、升级困难）</p><h2 id="分布式架构"><a href="#分布式架构" class="headerlink" title="分布式架构"></a>分布式架构</h2><p><strong>分布式架构</strong>：根据业务功能对系统做拆分，每个业务功能模块作为独立项目开发，称为一个服务。</p><p><img src="/2022/06/19/SpringCloud/image-20220616124430772.png" alt="image-20220616124430772"></p><p><strong>优点：</strong>降低服务耦合，有利于服务升级和拓展</p><p><strong>缺点：</strong>服务调用关系错综复杂</p><p>分布式架构虽然降低了服务耦合，但是服务拆分时也有很多问题需要思考：</p><ul><li>服务拆分的粒度如何界定？</li><li>服务之间如何调用？</li><li>服务的调用关系如何管理？</li></ul><p><strong>人们需要制定一套行之有效的标准来约束分布式架构。</strong></p><h2 id="微服务"><a href="#微服务" class="headerlink" title="微服务"></a>微服务</h2><p>微服务的架构特征：</p><ul><li>单一职责：微服务拆分粒度更小，每一个服务都对应唯一的业务能力，做到单一职责</li><li>自治：团队独立、技术独立、数据独立，独立部署和交付</li><li>面向服务：服务提供统一标准的接口，与语言和技术无关</li><li>隔离性强：服务调用做好隔离、容错、降级，避免出现级联问题</li></ul><p><img src="/2022/06/19/SpringCloud/image-20220616124504388.png"></p><p>微服务的上述特性<strong>其实是在给分布式架构制定一个标准</strong>，进一步降低服务之间的耦合度，提供服务的独立性和灵活性。做到高内聚，低耦合。</p><p><strong>因此，可以认为微服务是一种经过良好架构设计的分布式架构方案 。</strong></p><p>其中在 Java 领域最引人注目的就是 SpringCloud 提供的方案了。</p><h2 id="SpringCloud"><a href="#SpringCloud" class="headerlink" title="SpringCloud"></a>SpringCloud</h2><p>SpringCloud 是目前国内使用最广泛的微服务框架。官网地址：<a href="https://spring.io/projects/spring-cloud%E3%80%82">https://spring.io/projects/spring-cloud。</a></p><p>SpringCloud 集成了各种微服务功能组件，并基于 SpringBoot 实现了这些组件的自动装配，从而提供了良好的开箱即用体验。</p><p>其中常见的组件包括：</p><p><img src="/2022/06/19/SpringCloud/image-20220616124523903.png"></p><p>另外，SpringCloud 底层是依赖于 SpringBoot 的，并且有版本的兼容关系，如下：</p><p><img src="/2022/06/19/SpringCloud/image-20220616142949202.png" alt="image-20220616142949202"></p><h2 id="内容知识"><a href="#内容知识" class="headerlink" title="内容知识"></a>内容知识</h2><p><img src="/2022/06/19/SpringCloud/image-20220616124550661.png" alt="image-20220616124550661"></p><p><img src="/2022/06/19/SpringCloud/image-20220616124639201.png"></p><h2 id="技术栈对比"><a href="#技术栈对比" class="headerlink" title="技术栈对比"></a>技术栈对比</h2><p><img src="/2022/06/19/SpringCloud/image-20220616124710860.png"></p><h2 id="案例：一个订单模块和一个用户模块"><a href="#案例：一个订单模块和一个用户模块" class="headerlink" title="案例：一个订单模块和一个用户模块"></a>案例：一个订单模块和一个用户模块</h2><p>当查询订单的同时查询出来他用户的信息</p><p>用户和订单都是在不同的数据库，也就是说需要分库了，每个模块对应一个微服务</p><p><img src="/2022/06/19/SpringCloud/image-20220616124940192.png" alt="image-20220616124940192"></p><p>解决方法：我们可以在订单的业务层，当查询出来订单的时候获取到订单中用户的id然后再去发请求，因为是跨服务的，所以需要用到一个**<code>RestTemplate</code>**对象  </p><p>这样子：启动容器的 时候注入一个**<code>RestTemplate</code>**对象  </p><p><img src="/2022/06/19/SpringCloud/image-20220616125140481.png" alt="image-20220616125140481"></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RestTemplate <span class="title function_">template</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="keyword">public</span> Order <span class="title function_">queryOrderById</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.查询订单</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.findById(orderId);</span><br><span class="line">        <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> restTemplate.getForObject(<span class="string">&quot;http://localhost:8081/user/&quot;</span> + order.getUserId(), User.class);</span><br><span class="line"><span class="comment">//        2.获取到订单里的用户id,并且再次发送请求</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//3、将查询出来的值设置到订单里去</span></span><br><span class="line">        order.setUser(u);</span><br><span class="line">        <span class="comment">// 4.返回</span></span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><p>再次启动服务就ok</p><p>在一次服务中，服务的调用者为消费者，服务的提供者为提供者</p><h1 id="1、Eureka注册中心"><a href="#1、Eureka注册中心" class="headerlink" title="1、Eureka注册中心"></a>1、Eureka注册中心</h1><p>上面服务的问题，上面的代码的调用是采取硬编码的方式，非常的不合理</p><p><img src="/2022/06/19/SpringCloud/image-20220616130723227.png" alt="image-20220616130723227"></p><p><strong>order-service 如何得知 user-service 实例地址？</strong></p><ul><li>user-service 服务实例启动后，将自己的信息注册到 eureka-server(Eureka服务端)，叫做<strong>服务注册</strong></li><li>eureka-server 保存服务名称到服务实例地址列表的映射关系</li><li>order-service 根据服务名称，拉取实例地址列表，这个叫<strong>服务发现</strong>或服务拉取</li></ul><p><strong>order-service 如何从多个 user-service 实例中选择具体的实例？</strong></p><p>order-service从实例列表中利用<strong>负载均衡算法</strong>选中一个实例地址，向该实例地址发起远程调用</p><p><strong>order-service 如何得知某个 user-service 实例是否依然健康，是不是已经宕机？</strong></p><ul><li>user-service 会<strong>每隔一段时间(默认30秒)向 eureka-server 发起请求</strong>，报告自己状态，称为<strong>心跳</strong></li><li>当超过一定时间没有发送心跳时，eureka-server 会认为微服务实例故障，将该实例从服务列表中剔除</li><li>order-service 拉取服务时，就能将故障实例排除了</li></ul><p><img src="/2022/06/19/SpringCloud/image-20220616130824185.png" alt="image-20220616130824185"></p><h2 id="搭建注册中心-需要重新创建一个微服务"><a href="#搭建注册中心-需要重新创建一个微服务" class="headerlink" title="搭建注册中心(需要重新创建一个微服务)"></a>搭建注册中心(需要重新创建一个微服务)</h2><p><strong>搭建 eureka-server</strong></p><p>引入 SpringCloud 为 eureka 提供的 starter 依赖，注意这里是用 <strong>server</strong></p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>编写启动类</strong></p><p>注意要添加一个 <code>@EnableEurekaServer</code> <strong>注解</strong>，开启 eureka 的<strong>注册中心</strong>功能</p><p><strong>编写配置文件</strong></p><p>编写一个 application.yml 文件，内容如下：</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10086</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eurekaserver</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment"># 是否向eureka注册自身服务</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment">#是否检索服务</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:10086/eureka</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>其中 <code>default-zone</code> 是因为前面配置类开启了注册中心所需要配置的 eureka 的<strong>地址信息</strong>，因为 eureka 本身也是一个微服务，这里也要将自己注册进来，当后面 eureka <strong>集群</strong>时，这里就可以填写多个，使用 “,” 隔开。</p><p>启动完成后，访问 <a href="http://localhost:10086/">http://localhost:10086/</a></p><h2 id="服务的注册"><a href="#服务的注册" class="headerlink" title="服务的注册"></a>服务的注册</h2><blockquote><p>将 user-service、order-service 都注册到 eureka</p></blockquote><p>引入 SpringCloud 为 eureka 提供的 starter 依赖，注意这里是用 <strong>client</strong></p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在启动类上添加注解：<code>@EnableEurekaClient</code></p><p>在 application.yml 文件，添加下面的配置：</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">      <span class="comment">#name：orderservice</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span> </span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http:127.0.0.1:10086/eureka</span></span><br></pre></td></tr></table></figure><p>3个项目启动后，访问 <a href="http://localhost:10086/">http://localhost:10086/</a></p><p><a href="https://cdn.xn2001.com/img/2021/20210901090958.png">  </a><img src="/2022/06/19/SpringCloud/image-20220616135112438.png" alt="image-20220616135112438"></p><p>启动多个实例可以通过复制启动键</p><p><img src="/2022/06/19/SpringCloud/image-20220616135158416.png" alt="image-20220616135158416"></p><p><img src="/2022/06/19/SpringCloud/image-20220616135245375.png" alt="image-20220616135245375"></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-Dserver.port=xxxx</span><br></pre></td></tr></table></figure><p>这里是替换yml文件中的端口地址</p><h2 id="服务的拉取"><a href="#服务的拉取" class="headerlink" title="服务的拉取"></a>服务的拉取</h2><blockquote><p>在 order-service 中完成服务拉取，然后通过负载均衡挑选一个服务，实现远程调用</p></blockquote><p>下面我们让 orderservice 向 eureka-server 拉取 userservice 的信息，实现服务发现。</p><p>首先给 <code>RestTemplate</code> 这个 Bean 添加一个 <code>@LoadBalanced</code> <strong>注解</strong>，用于开启<strong>负载均衡</strong>。（后面会讲）</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改 OrderService 访问的url路径，用<strong>服务名</strong>代替ip、端口：</p><p><img src="/2022/06/19/SpringCloud/image-20220616135442158.png" alt="image-20220616135442158"></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> Order <span class="title function_">queryOrderById</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.查询订单</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.findById(orderId);</span><br><span class="line">        <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> restTemplate.getForObject(<span class="string">&quot;http://userservice/user/&quot;</span> + order.getUserId(), User.class);</span><br><span class="line"><span class="comment">//        2.获取到订单里的用户id,并且再次发送请求</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、将查询出来的值设置到订单里去</span></span><br><span class="line">        order.setUser(u);</span><br><span class="line">        <span class="comment">// 4.返回</span></span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h2><p> <code>@LoadBalanced</code> 注解，即可实现负载均衡功能，这是什么原理呢？</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220616223027399.png" alt="image-20220616223027399"></p><ul><li><code>@LoadBalanced</code>这个注解代表的意思将来这个RestTemplate发送的请求将会被Ribbon拦截</li></ul><p>负载均衡默认使用了轮训算法，当然我们也可以自定义。</p><p><strong>SpringCloud 底层提供了一个名为 Ribbon 的组件，来实现负载均衡功能。</strong></p><h2 id="负载均衡策略"><a href="#负载均衡策略" class="headerlink" title="负载均衡策略"></a>负载均衡策略</h2><p>负载均衡的规则都定义在 IRule 接口中，而 IRule 有很多不同的实现类：</p><p><img src="https://cdn.xn2001.com/img/2021/20210901091811.png" alt="img"></p><p>不同规则的含义如下：</p><table><thead><tr><th align="left"><strong>内置负载均衡规则类</strong></th><th align="left"><strong>规则描述</strong></th></tr></thead><tbody><tr><td align="left">RoundRobinRule</td><td align="left">简单轮询服务列表来选择服务器。它是Ribbon默认的负载均衡规则。</td></tr><tr><td align="left">AvailabilityFilteringRule</td><td align="left">对以下两种服务器进行忽略：（1）在默认情况下，这台服务器如果3次连接失败，这台服务器就会被设置为“短路”状态。短路状态将持续30秒，如果再次连接失败，短路的持续时间就会几何级地增加。 （2）并发数过高的服务器。如果一个服务器的并发连接数过高，配置了AvailabilityFilteringRule 规则的客户端也会将其忽略。并发连接数的上限，可以由客户端设置。</td></tr><tr><td align="left">WeightedResponseTimeRule</td><td align="left">为每一个服务器赋予一个权重值。服务器响应时间越长，这个服务器的权重就越小。这个规则会随机选择服务器，这个权重值会影响服务器的选择。</td></tr><tr><td align="left"><strong>ZoneAvoidanceRule</strong></td><td align="left">以区域可用的服务器为基础进行服务器的选择。使用Zone对服务器进行分类，这个Zone可以理解为一个机房、一个机架等。而后再对Zone内的多个服务做轮询。</td></tr><tr><td align="left">BestAvailableRule</td><td align="left">忽略那些短路的服务器，并选择并发数较低的服务器。</td></tr><tr><td align="left">RandomRule</td><td align="left">随机选择一个可用的服务器。</td></tr><tr><td align="left">RetryRule</td><td align="left">重试机制的选择逻辑</td></tr></tbody></table><h2 id="自定义策略"><a href="#自定义策略" class="headerlink" title="自定义策略"></a>自定义策略</h2><p>通过定义 IRule 实现可以修改负载均衡规则，有两种方式：</p><h3 id="1-代码方式"><a href="#1-代码方式" class="headerlink" title="1 代码方式"></a>1 代码方式</h3><p>在 order-service 中的 OrderApplication 类中，定义一个新的 IRule：</p><p>将负载均衡的规则改为了Random随机</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> IRule <span class="title function_">iRule</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span>  <span class="title class_">RandomRule</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-配置文件方式"><a href="#2-配置文件方式" class="headerlink" title="2 配置文件方式"></a>2 配置文件方式</h3><p>在 order-service 的 application.yml 文件中，添加新的配置也可以修改规则：</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">userservice:</span> <span class="comment"># 给需要调用的微服务配置负载均衡规则，orderservice服务去调用userservice服务</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.netflix.loadbalancer.RandomRule</span> <span class="comment"># 负载均衡规则 </span></span><br></pre></td></tr></table></figure><h2 id="饥饿加载"><a href="#饥饿加载" class="headerlink" title="饥饿加载"></a>饥饿加载</h2><p>当我们启动 orderservice，第一次访问时，时间消耗会大很多，这是因为 Ribbon 懒加载的机制。</p><p>Ribbon 默认是采用懒加载，即第一次访问时才会去创建 LoadBalanceClient，拉取集群地址，所以请求时间会很长。</p><p>而饥饿加载则会在项目启动时创建 LoadBalanceClient，降低第一次访问的耗时，通过下面配置开启饥饿加载：</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">eager-load:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">clients:</span> <span class="string">userservice</span> <span class="comment"># 项目启动时直接去拉取userservice的集群，多个用&quot;,&quot;隔开</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;SpringCloud技术&quot;&gt;&lt;a href=&quot;#SpringCloud技术&quot; class=&quot;headerlink&quot; title=&quot;SpringCloud技术&quot;&gt;&lt;/a&gt;SpringCloud技术&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;认识微服务&lt;/strong&gt;&lt;/p&gt;</summary>
      
    
    
    
    
    <category term="Spring" scheme="http://daihaojun554.github.io/tags/Spring/"/>
    
    <category term="springCloud" scheme="http://daihaojun554.github.io/tags/springCloud/"/>
    
  </entry>
  
  <entry>
    <title>Docker</title>
    <link href="http://daihaojun554.github.io/2022/06/17/Docker/"/>
    <id>http://daihaojun554.github.io/2022/06/17/Docker/</id>
    <published>2022-06-17T00:00:00.000Z</published>
    <updated>2022-06-18T05:52:37.101Z</updated>
    
    <content type="html"><![CDATA[<h1 id="一、Docker"><a href="#一、Docker" class="headerlink" title="一、Docker"></a>一、Docker</h1><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617164342451.png" alt="image-20220617164342451"></p><h2 id="Docker如何解决依赖兼容问题的"><a href="#Docker如何解决依赖兼容问题的" class="headerlink" title="Docker如何解决依赖兼容问题的"></a>Docker如何解决依赖兼容问题的</h2><ul><li>将应用的Libs(函数库)和deps(依赖).配置一起打包</li><li>将每个应用放到一个隔离的容器中去运行，避免互相干扰</li></ul><h2 id="Docker如何解决不同系统环境的问题"><a href="#Docker如何解决不同系统环境的问题" class="headerlink" title="Docker如何解决不同系统环境的问题"></a>Docker如何解决不同系统环境的问题</h2><ul><li>Docker将用户程序所需要调用的系统(比如centos)函数库一起打包</li><li>Docker运行到不同操作系统时，直接基于函数打包的函数库，借助于操作系统的Linux内核来运行</li></ul><table><thead><tr><th><a href="https://www.runoob.com/docker/centos-docker-install.html">centos7安装docker</a></th></tr></thead></table><h2 id="docker基本操作"><a href="#docker基本操作" class="headerlink" title="docker基本操作"></a>docker基本操作</h2><p>1、docker build 构建镜像</p><p>2、docker images 查看本地镜像</p><p>3、docker pull 从服务器拉取镜像</p><p>4、docker rmi 删除镜像(remove image)</p><p>5、docker push 推送镜像</p><p>6、docker save 保存镜像为压缩包</p><p>7、docker load 加载docker文件</p><p>docker commond –help查看某个命令的文档</p><p>容器的操作：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run --name myname -p 80:80 -d nginx</span><br></pre></td></tr></table></figure><p>–name myname :给我的容器取个名字</p><p>-p:端口映射 前面的是宿主机，后面的是容器端口</p><p>-d：后台运行</p><p> nginx： 镜像的名称，基于这个镜像创建一个容器</p><p>进入容器内部：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it  name bash</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker volume [<span class="built_in">command</span>]</span><br></pre></td></tr></table></figure><p> 数据卷：volume是一个虚拟目录，指向宿主机文件系统的某个目录</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220618122154940.png" alt="image-20220618122154940"></p><p>create ：创建一个 volume</p><p>inspect：显示出一个或多个数据卷的信息</p><p>ls：列出所有的数据卷</p><p>prune ：删除未使用的数据卷</p><p>rm：删除一个或多个指定的volume</p><p>在创建容器的时候可以使用-v参数来挂载一个数据卷到某个容器内部</p><p>创建一个nginx的容器并且挂载到本地的80端口，并且数据在本地的&#x2F;home&#x2F;mydata&#x2F;nginx&#x2F;html里面</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run --name myname -p 80:80 -v /home/mydata/nginx/html:/usr/share/nginx/html -d nginx</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;一、Docker&quot;&gt;&lt;a href=&quot;#一、Docker&quot; class=&quot;headerlink&quot; title=&quot;一、Docker&quot;&gt;&lt;/a&gt;一、Docker&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;https://daihaojun.oss-cn-hangzhou.al</summary>
      
    
    
    
    
    <category term="Docker" scheme="http://daihaojun554.github.io/tags/Docker/"/>
    
    <category term="镜像" scheme="http://daihaojun554.github.io/tags/%E9%95%9C%E5%83%8F/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot原理篇</title>
    <link href="http://daihaojun554.github.io/2022/05/21/SpringBoot%E5%8E%9F%E7%90%86%E7%AF%87/"/>
    <id>http://daihaojun554.github.io/2022/05/21/SpringBoot%E5%8E%9F%E7%90%86%E7%AF%87/</id>
    <published>2022-05-20T22:47:08.000Z</published>
    <updated>2022-05-22T17:00:13.782Z</updated>
    
    <content type="html"><![CDATA[<h1 id="一、SpringBoot原理篇"><a href="#一、SpringBoot原理篇" class="headerlink" title="一、SpringBoot原理篇"></a>一、SpringBoot原理篇</h1><h2 id="1-1、自动装配"><a href="#1-1、自动装配" class="headerlink" title="1.1、自动装配"></a>1.1、自动装配</h2><h3 id="1-1-1、bean的加载方式"><a href="#1-1-1、bean的加载方式" class="headerlink" title="1.1.1、bean的加载方式"></a>1.1.1、bean的加载方式</h3><ul><li>使用spring 的方式来定义bean</li></ul><h4 id="1、xml的方式"><a href="#1、xml的方式" class="headerlink" title="1、xml的方式"></a>1、xml的方式</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--xml的方式自己创建bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.dhj.bean.Cat&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span>  <span class="attr">class</span>=<span class="string">&quot;com.dhj.bean.Dog&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    xml的方式第三方的bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;druidDataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span>  <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span>  <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span>  <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext1.xml&quot;</span>);</span><br><span class="line">    String[] arr = context.getBeanDefinitionNames();</span><br><span class="line">    <span class="keyword">for</span> (String s : arr) &#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/05/21/SpringBoot%E5%8E%9F%E7%90%86%E7%AF%87/image-20220521161540699.png" alt="image-20220521161540699"></p><h4 id="2、注解的方式"><a href="#2、注解的方式" class="headerlink" title="2、注解的方式"></a>2、注解的方式</h4><p>在xml文件中开启命名空间</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag"></span></span></span><br><span class="line"><span class="string"><span class="tag">&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--组件扫描的位置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.dhj.bean&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后在类上加上注解<code>@Component(value = &quot;xxx&quot;)、@Service(&quot;xxx&quot;)、@Repository(&quot;xxx&quot;)、@Controller(&quot;xxx&quot;)</code>…</p><p>第三方的bean如何使用注解</p><p>定义一个config类交给spring管理可以使用可以使用<code>@Component</code>建议使用<code>@Configuration</code>然后定义一个方法将你要的bean对象当成返回值，同时在方法上加上<code>@Bean</code>的注解就可以被spring管理</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DBconfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DruidDataSource <span class="title function_">dataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">druidDataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        druidDataSource.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        druidDataSource.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        druidDataSource.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/mydb&quot;</span>);</span><br><span class="line">        druidDataSource.setMaxActive(<span class="number">10</span>);</span><br><span class="line">        druidDataSource.setLoginTimeout(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">return</span> druidDataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3、第三种方式不写xml文件"><a href="#3、第三种方式不写xml文件" class="headerlink" title="3、第三种方式不写xml文件"></a>3、第三种方式不写xml文件</h4><p>创建一个类 这个类就代替了xml的功能</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(value = &#123;&quot;com.dhj.bean&quot;,&quot;com.dhj.config&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig3</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>App</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig3.class);</span><br><span class="line"></span><br><span class="line">        String[] arr = context.getBeanDefinitionNames();</span><br><span class="line">        <span class="keyword">for</span> (String s : arr) &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> (DruidDataSource) context.getBean(<span class="string">&quot;dataSource&quot;</span>);</span><br><span class="line">        System.out.println(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>工厂模式：</p><p>创建一个DogFactoryBean类实现FactoryBean</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DogFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;Dog&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> Dog <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Class&lt;Dog&gt; <span class="title function_">getObjectType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Dog.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(value = &#123;&quot;com.dhj.bean&quot;,&quot;com.dhj.config&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig3</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DogFactoryBean <span class="title function_">dog</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DogFactoryBean</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>返回的这个bean是你工厂的泛型对象即为Dog</p><p>这样就可以在初始话的时候可以进行一系列的初始化的工作</p><h4 id="4、-ImportResource-xml和注解同时使用"><a href="#4、-ImportResource-xml和注解同时使用" class="headerlink" title="4、@ImportResource    xml和注解同时使用"></a>4、<code>@ImportResource</code>    xml和注解同时使用</h4><p><strong>可以通过<code>@ImportResource(&quot;applicationContext1.xml&quot;)</code>的方式将xml文件中的bean加载到一个配置类中</strong></p><h4 id="5、-proxyBeanMethods"><a href="#5、-proxyBeanMethods" class="headerlink" title="5、@proxyBeanMethods"></a>5、<code>@proxyBeanMethods</code></h4><p>使用proxyBeanMethods&#x3D;true可以保障调用此方法得到的对象是从容器中获取的而不是重新创建的</p><h4 id="6、-Import"><a href="#6、-Import" class="headerlink" title="6、@Import"></a>6、<code>@Import</code></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;Dog.class,Cat.class,DBconfig.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig4</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用@import可以导入你想要的对象</p><h4 id="7、registerBean-“name”-Class-，容器初始化后自动注册，这个比BeanDefinitionRegistryPostProcessor的优先级高"><a href="#7、registerBean-“name”-Class-，容器初始化后自动注册，这个比BeanDefinitionRegistryPostProcessor的优先级高" class="headerlink" title="7、registerBean(“name”,Class)，容器初始化后自动注册，这个比BeanDefinitionRegistryPostProcessor的优先级高"></a>7、registerBean(“name”,Class)，容器初始化后自动注册，这个比<code>BeanDefinitionRegistryPostProcessor</code>的优先级高</h4><p>这个方法可以注册bean，但是同名的bean会被最后一个覆盖</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">AnnotationConfigApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig4.class);</span><br><span class="line">context.registerBean(<span class="string">&quot;tom&quot;</span>, Cat.class,<span class="number">0</span>);</span><br><span class="line">context.registerBean(<span class="string">&quot;tom&quot;</span>, Cat.class,<span class="number">1</span>);</span><br><span class="line">context.registerBean(<span class="string">&quot;tom&quot;</span>, Cat.class,<span class="number">2</span>);</span><br></pre></td></tr></table></figure><h4 id="8、实现这个接口-ImportSelector"><a href="#8、实现这个接口-ImportSelector" class="headerlink" title="8、实现这个接口 ImportSelector"></a>8、实现这个接口 <code>ImportSelector</code></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportSelecter</span> <span class="keyword">implements</span> <span class="title class_">ImportSelector</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;com.dhj.bean.Cat&quot;</span>,<span class="string">&quot;com.dhj..bean.Mouse&quot;</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;MyImportSelecter.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig6</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="9、实现这个接口-ImportBeanDefinitionRegistrar"><a href="#9、实现这个接口-ImportBeanDefinitionRegistrar" class="headerlink" title="9、实现这个接口 ImportBeanDefinitionRegistrar"></a>9、实现这个接口 ImportBeanDefinitionRegistrar</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line"><span class="comment">//        使用元数据来判定.....</span></span><br><span class="line">        <span class="comment">//......//</span></span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> BeanDefinitionBuilder.rootBeanDefinition(Dog.class).getBeanDefinition();</span><br><span class="line">        registry.registerBeanDefinition(<span class="string">&quot;yellow&quot;</span>,beanDefinition);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="10、实现这个接口BeanDefinitionRegistryPostProcessor"><a href="#10、实现这个接口BeanDefinitionRegistryPostProcessor" class="headerlink" title="10、实现这个接口BeanDefinitionRegistryPostProcessor"></a>10、实现这个接口<code>BeanDefinitionRegistryPostProcessor</code></h4><p>bean定义注册的后处理器</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanDefinitionRegistryPostProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry beanDefinitionRegistry)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> BeanDefinitionBuilder.rootBeanDefinition(BookServiceImpl4.class).getBeanDefinition();</span><br><span class="line">        beanDefinitionRegistry.registerBeanDefinition(<span class="string">&quot;bookService&quot;</span>,beanDefinition);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory configurableListableBeanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//后处理的机制，在前面beandefition加载完毕后了之后，它再加载，同名的bean直接被覆盖</span></span><br></pre></td></tr></table></figure><h3 id="1-1-2、bean的加载控制"><a href="#1-1-2、bean的加载控制" class="headerlink" title="1.1.2、bean的加载控制"></a>1.1.2、bean的加载控制</h3><ul><li>bean的加载控制指根据特定情况对bean进行选择性加载以达到适用于项目的目标。</li></ul><p>​只有后面几种方式可以进行控制bean到底加载还是不加载，前面的xml和注解的方式不能控制bean的加载</p><h4 id="1、硬编码进行控制"><a href="#1、硬编码进行控制" class="headerlink" title="1、硬编码进行控制"></a>1、硬编码进行控制</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ctx</span>   <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">        String[] arr = ctx.getBeanDefinitionNames();</span><br><span class="line">        <span class="keyword">for</span> (String s : arr) &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportSelector</span> <span class="keyword">implements</span> <span class="title class_">ImportSelector</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;com.dhj.bean.Mouse&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(clazz!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//做判断</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;com.dhj.bean.Cat&quot;</span>&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line"><span class="comment">//            e.printStackTrace();</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Import(MyImportSelector.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2、注解进行控制"><a href="#2、注解进行控制" class="headerlink" title="2、注解进行控制"></a>2、注解进行控制</h4><p>使用@<code>Conditional</code>注解的派生注解设置各种组合条件控制bean的加载</p><p><code>@Confitional</code> 要导入boot的坐标</p><p>如：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line"><span class="comment">//    @ConditionalOnClass(Mouse.class)//如果你的工程中有这个类，就加载cat类</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingClass(&quot;com.dhj.bean.Wolf&quot;)</span><span class="comment">//如果你的工程中没有这个类，就加载cat类</span></span><br><span class="line">    <span class="meta">@ConditionalOnBean(name = &quot;jerry&quot;)</span><span class="comment">//如果加载了Jerry这个bean，就加载tom</span></span><br><span class="line">    <span class="keyword">public</span> Cat <span class="title function_">tom</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Cat</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-1-3、bean的依赖属性配置"><a href="#1-1-3、bean的依赖属性配置" class="headerlink" title="1.1.3、bean的依赖属性配置"></a>1.1.3、bean的依赖属性配置</h3><p>例子：有这样一个场景，当我们在配置文件中写了配置的时候就读取配置里的内容，没有就是用默认值，然后不管写不写配置文件我的程序都可以运行</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(CartoonProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cartoon</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Cat cat;</span><br><span class="line">    <span class="keyword">private</span> Mouse mouse;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CartoonProperties cartoonProperties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Cartoon</span><span class="params">(CartoonProperties cartoonProperties)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cartoonProperties = cartoonProperties;</span><br><span class="line">        cat = <span class="keyword">new</span> <span class="title class_">Cat</span>();</span><br><span class="line">        cat.setAge(cartoonProperties.getCat()!= <span class="literal">null</span> &amp;&amp; cartoonProperties.getCat().getAge() != <span class="literal">null</span> ? cartoonProperties.getCat().getAge() : <span class="number">3</span>);</span><br><span class="line">        cat.setName(cartoonProperties.getCat()!= <span class="literal">null</span> &amp;&amp; StringUtils.hasText(cartoonProperties.getCat().getName()) ? cartoonProperties.getCat().getName() : <span class="string">&quot;tom&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        mouse = <span class="keyword">new</span> <span class="title class_">Mouse</span>();</span><br><span class="line">        mouse.setAge(cartoonProperties.getMouse()!= <span class="literal">null</span> &amp;&amp;cartoonProperties.getMouse().getAge() != <span class="literal">null</span> ? cartoonProperties.getMouse().getAge() : <span class="number">4</span>);</span><br><span class="line">        mouse.setName(cartoonProperties.getMouse()!=<span class="literal">null</span>&amp;&amp;StringUtils.hasText(cartoonProperties.getMouse().getName()) ? cartoonProperties.getMouse().getName() : <span class="string">&quot;jerry&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(mouse.getAge() + <span class="string">&quot;岁的&quot;</span> + mouse.getName() + <span class="string">&quot;和&quot;</span> + cat.getAge() + <span class="string">&quot;岁的&quot;</span> + cat.getName() + <span class="string">&quot;打起来了！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;cartoon&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartoonProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Cat cat;</span><br><span class="line">    <span class="keyword">private</span> Mouse mouse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>还有两个类，猫和老鼠类两个类里面都有名字和年龄</p><p>App:</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@Import(Cartoon.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> SpringApplication.run(App.class);</span><br><span class="line">         <span class="type">Cartoon</span> <span class="variable">cartoon</span> <span class="operator">=</span> (Cartoon) ctx.getBean(<span class="string">&quot;com.dhj.bean.Cartoon&quot;</span>);</span><br><span class="line">         cartoon.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-1-4、自动装配原理"><a href="#1-1-4、自动装配原理" class="headerlink" title="1.1.4、自动装配原理"></a>1.1.4、自动装配原理</h3><h3 id="1-1-5、变更自动装配"><a href="#1-1-5、变更自动装配" class="headerlink" title="1.1.5、变更自动装配"></a>1.1.5、变更自动装配</h3><ul><li>自定义自动配置（META-INF&#x2F;spring.factories )</li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">com.itheima.bean.CartoonCatAndMouse</span><br></pre></td></tr></table></figure><ul><li>控制SpringBoot内置自动配置类加载</li></ul><p><img src="/2022/05/21/SpringBoot%E5%8E%9F%E7%90%86%E7%AF%87/image-20220522220337098.png" alt="image-20220522220337098"></p><p>或者使用这个注解</p><ul><li><code>@EnableAutoConfiguration(excludeName = &quot;&quot; ,exclude = &#123;&#125;)</code></li></ul><h2 id="1-2、自定义Starter"><a href="#1-2、自定义Starter" class="headerlink" title="1.2、自定义Starter"></a>1.2、自定义Starter</h2><p>案例：统计独立IP访问次数</p><p>自定义starter</p><p>辅助功能开发</p><h2 id="1-3、核心原理"><a href="#1-3、核心原理" class="headerlink" title="1.3、核心原理"></a>1.3、核心原理</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;一、SpringBoot原理篇&quot;&gt;&lt;a href=&quot;#一、SpringBoot原理篇&quot; class=&quot;headerlink&quot; title=&quot;一、SpringBoot原理篇&quot;&gt;&lt;/a&gt;一、SpringBoot原理篇&lt;/h1&gt;&lt;h2 id=&quot;1-1、自动装配&quot;&gt;&lt;a </summary>
      
    
    
    
    
    <category term="SpringBoot" scheme="http://daihaojun554.github.io/tags/SpringBoot/"/>
    
    <category term="Spring" scheme="http://daihaojun554.github.io/tags/Spring/"/>
    
    <category term="SpringMVC" scheme="http://daihaojun554.github.io/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>Nacos</title>
    <link href="http://daihaojun554.github.io/2022/04/29/Nacos/"/>
    <id>http://daihaojun554.github.io/2022/04/29/Nacos/</id>
    <published>2022-04-28T21:52:12.000Z</published>
    <updated>2022-08-19T11:37:46.219Z</updated>
    
    <content type="html"><![CDATA[<h1 id="一、Nacos注册中心-阿里巴巴的产品"><a href="#一、Nacos注册中心-阿里巴巴的产品" class="headerlink" title="一、Nacos注册中心(阿里巴巴的产品)"></a>一、Nacos注册中心(阿里巴巴的产品)</h1><ul><li>服务的注册与发现</li><li>分布式配置</li></ul><h2 id="下载："><a href="#下载：" class="headerlink" title="下载："></a>下载：</h2><p><a href="https://github.com/alibaba/nacos/releases">https://github.com/alibaba/nacos/releases</a></p><p>下载慢</p><p>国内：<a href="https://gitee.com/mirrors/Nacos">https://gitee.com/mirrors/Nacos</a></p><p>解压后到bin目录去</p><p>执行：启动nacos服务</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">startup.cmd -m standalone</span><br></pre></td></tr></table></figure><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220616231510198.png" alt="image-20220616231510198"></p><p>访问这个地址</p><p>用户名和密码是nacos</p><h2 id="服务注册："><a href="#服务注册：" class="headerlink" title="服务注册："></a>服务注册：</h2><p><strong>引入依赖</strong></p><p>在 cloud-demo 父工程中引入 SpringCloudAlibaba 的依赖：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后在 user-service 和 order-service 中的pom文件中引入 nacos-discovery 依赖：</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后再次做配置：</p><p>​注意需要注释掉原来的eureka的yml配置</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br></pre></td></tr></table></figure><p>访问</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220616232810463.png" alt="image-20220616232810463"></p><h2 id="配置集群"><a href="#配置集群" class="headerlink" title="配置集群"></a>配置集群</h2><p>接下来我们给 user-service <strong>配置集群</strong></p><p>修改 user-service 的 application.yml 文件，添加集群配置：</p><h3 id="集群的名字："><a href="#集群的名字：" class="headerlink" title="集群的名字："></a>集群的名字：</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">HZ</span> <span class="comment"># 集群名称 HZ杭州</span></span><br></pre></td></tr></table></figure><p>重启两个 user-service 实例后，我们再去启动一个上海集群的实例。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-Dserver.port=8083 -Dspring.cloud.nacos.discovery.cluster-name=SH</span><br></pre></td></tr></table></figure><p>去nacos看</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617120443179.png" alt="image-20220617120443179"></p><p>可以发现有集群的地址</p><h3 id="权重："><a href="#权重：" class="headerlink" title="权重："></a>权重：</h3><p>权重的值可以自己配，</p><p>越小就能让他被访问的次数越小，权重为0 的时候直接不会访问</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617120933277.png" alt="image-20220617120933277"></p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617120948473.png" alt="image-20220617120948473"></p><h3 id="环境隔离-namespace："><a href="#环境隔离-namespace：" class="headerlink" title="环境隔离-namespace："></a>环境隔离-namespace：</h3><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617123344147.png" alt="image-20220617123344147"></p><p><strong>nacos中服务存储和数据存储，的最外层都是一个名为namespace的东西，用来做最外层的隔离</strong></p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617121410936.png" alt="image-20220617121410936"></p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617121430151.png" alt="image-20220617121430151"></p><p>命名空间的id可以不填，会自动生成</p><p>如何修改一个实例的命名空间，？</p><p>去代码修改</p><p>在你的yml文件里面加上</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617121752146.png" alt="image-20220617121752146"></p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">cloud:</span></span><br><span class="line">  <span class="attr">nacos:</span></span><br><span class="line">    <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">    <span class="attr">discovery:</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="number">1398e436</span><span class="string">-69c1-44b5-bdc5-e36811d81966</span></span><br></pre></td></tr></table></figure><p>namespace的值为生成的值</p><h1 id="二、"><a href="#二、" class="headerlink" title="二、"></a>二、</h1><ul><li><p>配置</p></li><li><p>feign远程调用</p></li><li><p>gateway网关</p></li></ul><h2 id="配置的统一管理："><a href="#配置的统一管理：" class="headerlink" title="配置的统一管理："></a>配置的统一管理：</h2><p>在nacos中添加一个配置文件</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617123140019.png" alt="image-20220617123140019"></p><p>把 nacos 地址放在 application.yml 中，显然是不合适的，<strong>Nacos 就无法根据地址去获取配置了。</strong></p><p>因此，nacos 地址必须放在优先级最高的 bootstrap.yml 文件。</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617123436556.png" alt="image-20220617123436556"></p><p>具体实现：</p><p>1、引入配置客户端的依赖</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacos配置管理依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2、写配置文件</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617124822776.png" alt="image-20220617124822776"></p><h2 id="热更新："><a href="#热更新：" class="headerlink" title="热更新："></a>热更新：</h2><p>nacos中的配置文件中变更后。</p><p>是修改 nacos 中的配置后，微服务中无需重启即可让配置生效，也就是<strong>配置热更新</strong>。</p><p>有两种方式：</p><ol><li>用 <code>@value</code> 读取配置时，搭配 <code>@RefreshScope</code>；</li></ol><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617130136390.png" alt="image-20220617130136390"></p><ol start="2"><li>直接用 <code>@ConfigurationProperties</code> 读取配置</li></ol><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;pattern&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PatternProperties</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String dateformat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> PatternProperties patternProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;now&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">now</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//格式化时间</span></span><br><span class="line">    <span class="keyword">return</span> LocalDateTime.now().format(DateTimeFormatter.ofPattern(patternProperties.getDateformat()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="多环境配置管理"><a href="#多环境配置管理" class="headerlink" title="多环境配置管理"></a>多环境配置管理</h2><p>共享的环境</p><p><strong>在 user-service 中读取共享配置</strong></p><p>在 user-service 服务中，修改 PatternProperties 类，读取新添加的属性：</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617132057652.png" alt="image-20220617132057652"></p><p><strong>运行两个 UserApplication，使用不同的profile</strong></p><p>修改 UserApplication2 这个启动项，改变其profile值：</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617132117524.png" alt="image-20220617132117524"></p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617132129835.png" alt="image-20220617132129835"></p><p>这样，UserApplication(8081) 使用的 profile 是 dev，UserApplication2(8082) 使用的 profile 是test</p><p>启动 UserApplication 和 UserApplication2</p><p>访问</p><p><a href="http://localhost:8081/user/prop">http://localhost:8081/user/prop</a></p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617132327199.png" alt="image-20220617132327199"></p><p>和</p><p><a href="http://localhost:8082/user/prop">http://localhost:8082/user/prop</a></p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617132225423.png" alt="image-20220617132225423"></p><h2 id="配置优先级"><a href="#配置优先级" class="headerlink" title="配置优先级"></a>配置优先级</h2><p>当 nacos、服务本地同时<strong>出现相同属性时</strong>，优先级有高低之分。</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617132726467.png" alt="image-20220617132726467"></p><h2 id="远程调用"><a href="#远程调用" class="headerlink" title="远程调用"></a>远程调用</h2><p>发一条http请求需要</p><ul><li>服务名称</li><li>请求的url</li><li>请求参数</li><li>请求的方式</li><li>请求的返回类型</li></ul><p><strong>添加feign的依赖</strong></p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>添加注解</strong></p><p>在 order-service 启动类添加注解开启 Feign</p><p><code>@EnableFeignClient</code></p><p><strong>在 order-service 中新建一个接口</strong>，内容如下</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;userservice&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserFeign</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">findById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@FeignClient(&quot;userservice&quot;)</code>：其中参数填写的是微服务名</p><p><code>@GetMapping(&quot;/user/&#123;id&#125;&quot;)</code>：其中参数填写的是请求路径</p><p>这个客户端主要是基于 <code>SpringMVC</code> 的注解 <code>@GetMapping</code> 来声明远程调用的信息</p><p><code>Feign</code> 可以帮助我们发送 http 请求，无需自己使用 <code>RestTemplate</code> 来发送了。</p><p><strong>注意：两个不同的服务要在同一个<code>namespace</code>的时候才能被远程调用</strong></p><h2 id="自定义配置"><a href="#自定义配置" class="headerlink" title="自定义配置"></a>自定义配置</h2><p>Feign 可以支持很多的自定义配置，如下表所示：</p><table><thead><tr><th align="left">类型</th><th align="left">作用</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><strong>feign.Logger.Level</strong></td><td align="left">修改日志级别</td><td align="left">包含四种不同的级别：NONE、BASIC、HEADERS、FULL</td></tr><tr><td align="left">feign.codec.Decoder</td><td align="left">响应结果的解析器</td><td align="left">http远程调用的结果做解析，例如解析json字符串为java对象</td></tr><tr><td align="left">feign.codec.Encoder</td><td align="left">请求参数编码</td><td align="left">将请求参数编码，便于通过http请求发送</td></tr><tr><td align="left">feign.Contract</td><td align="left">支持的注解格式</td><td align="left">默认是SpringMVC的注解</td></tr><tr><td align="left">feign.Retryer</td><td align="left">失败重试机制</td><td align="left">请求失败的重试机制，默认是没有，不过会使用Ribbon的重试</td></tr></tbody></table><p>一般情况下，默认值就能满足我们使用，如果要自定义时，只需要创建自定义的 @Bean 覆盖默认 Bean 即可。下面以日志为例来演示如何自定义配置。</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span> </span><br><span class="line">      <span class="attr">default:</span> <span class="comment"># 针对所有微服务的配置</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">FULL</span> <span class="comment">#  日志级别 </span></span><br><span class="line">    <span class="comment">#=======================================================================================================</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span> </span><br><span class="line">      <span class="attr">userservice:</span> <span class="comment"># 针对某个微服务的配置</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">FULL</span> <span class="comment">#  日志级别 </span></span><br></pre></td></tr></table></figure><ul><li>NONE：不记录任何日志信息，这是默认值。</li><li>BASIC：仅记录请求的方法，URL以及响应状态码和执行时间</li><li>HEADERS：在BASIC的基础上，额外记录了请求和响应的头信息</li><li>FULL：记录所有请求和响应的明细，包括头信息、请求体、元数据</li></ul><p>也可以基于 <strong>Java 代码</strong>来修改日志级别，先声明一个类，然后声明一个 Logger.Level 的对象</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultFeignConfiguration</span>  &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Logger.Level <span class="title function_">feignLogLevel</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.BASIC; <span class="comment">// 日志级别为BASIC</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果要<strong>全局生效</strong>，将其放到启动类的 <code>@EnableFeignClients</code> 这个注解中：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(defaultConfiguration = DefaultFeignConfiguration .class)</span> </span><br></pre></td></tr></table></figure><p>如果是<strong>局部生效</strong>，则把它放到对应的 <code>@FeignClient</code> 这个注解中：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;userservice&quot;, configuration = DefaultFeignConfiguration .class)</span> </span><br></pre></td></tr></table></figure><h2 id="Feign的性能调优-连接池配置"><a href="#Feign的性能调优-连接池配置" class="headerlink" title="Feign的性能调优-连接池配置"></a>Feign的性能调优-连接池配置</h2><p>Feign添加<code>HttpClient</code>的支持</p><p>引入依赖</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--httpClient的依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.openfeign<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>配置连接池</strong></p><p>在 order-service 的 application.yml 中添加配置</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">default:</span> <span class="comment"># default全局的配置</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">BASIC</span> <span class="comment"># 日志级别，BASIC就是基本的请求和响应信息</span></span><br><span class="line">  <span class="attr">httpclient:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启feign对HttpClient的支持</span></span><br><span class="line">    <span class="attr">max-connections:</span> <span class="number">200</span> <span class="comment"># 最大的连接数</span></span><br><span class="line">    <span class="attr">max-connections-per-route:</span> <span class="number">50</span> <span class="comment"># 每个路径的最大连接数</span></span><br></pre></td></tr></table></figure><h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><h3 id="继承方式"><a href="#继承方式" class="headerlink" title="继承方式"></a>继承方式</h3><p>一样的代码可以通过继承来共享：</p><p>1）定义一个 API 接口，利用定义方法，并基于 SpringMVC 注解做声明</p><p>2）Feign 客户端、Controller 都集成该接口</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617142658137.png" alt="image-20220617142658137"></p><h3 id="抽取方式"><a href="#抽取方式" class="headerlink" title="抽取方式"></a>抽取方式</h3><p>将 FeignClient 抽取为独立模块，并且把接口有关的 pojo、默认的 Feign 配置都放到这个模块中，提供给所有消费者使用。</p><p>例如：将 UserClient、User、Feign 的默认配置都抽取到一个 feign-api 包中，所有微服务引用该依赖包，即可直接使用。</p><p><img src="https://daihaojun.oss-cn-hangzhou.aliyuncs.com/img/image-20220617143136602.png" alt="image-20220617143136602"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;一、Nacos注册中心-阿里巴巴的产品&quot;&gt;&lt;a href=&quot;#一、Nacos注册中心-阿里巴巴的产品&quot; class=&quot;headerlink&quot; title=&quot;一、Nacos注册中心(阿里巴巴的产品)&quot;&gt;&lt;/a&gt;一、Nacos注册中心(阿里巴巴的产品)&lt;/h1&gt;&lt;ul</summary>
      
    
    
    
    
    <category term="spring cloud" scheme="http://daihaojun554.github.io/tags/spring-cloud/"/>
    
    <category term="注册中心，发现" scheme="http://daihaojun554.github.io/tags/%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%EF%BC%8C%E5%8F%91%E7%8E%B0/"/>
    
    <category term="微服务" scheme="http://daihaojun554.github.io/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>Mybatis-plus</title>
    <link href="http://daihaojun554.github.io/2022/04/29/Mybatis-plus/"/>
    <id>http://daihaojun554.github.io/2022/04/29/Mybatis-plus/</id>
    <published>2022-04-28T21:52:12.000Z</published>
    <updated>2022-06-04T07:49:09.561Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Mybatis-plus"><a href="#Mybatis-plus" class="headerlink" title="Mybatis-plus"></a>Mybatis-plus</h1><p>如何使用：</p><p>导入坐标</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.velocity/velocity-engine-core --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-engine-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GeneratorMybatis</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DruidDataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">runGeneratro</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(dataSource.getUrl());</span><br><span class="line"></span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">autoGenerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line">        <span class="comment">//数据源相关的配置</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dataSourceConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line"></span><br><span class="line">        dataSourceConfig.setDriverName(dataSource.getDriverClassName());</span><br><span class="line">        dataSourceConfig.setUsername(dataSource.getUsername());</span><br><span class="line">        dataSourceConfig.setPassword(dataSource.getPassword());</span><br><span class="line">        dataSourceConfig.setUrl(dataSource.getUrl());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//包相关的配置</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">packageConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">        packageConfig.setParent(<span class="string">&quot;com.dhj&quot;</span>);</span><br><span class="line">        packageConfig.setEntity(<span class="string">&quot;domain&quot;</span>);</span><br><span class="line">        packageConfig.setMapper(<span class="string">&quot;dao&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//基本的一些配置</span></span><br><span class="line">        <span class="type">GlobalConfig</span> <span class="variable">globalConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line">        globalConfig.setOutputDir(System.getProperty(<span class="string">&quot;user.dir&quot;</span>)+<span class="string">&quot;/src/main/java&quot;</span>);</span><br><span class="line"><span class="comment">//        globalConfig.setOpen(false);</span></span><br><span class="line">        globalConfig.setAuthor(<span class="string">&quot;戴浩军&quot;</span>);</span><br><span class="line">        globalConfig.setControllerName(<span class="string">&quot;%sController&quot;</span>);</span><br><span class="line">        globalConfig.setMapperName(<span class="string">&quot;%sDao&quot;</span>);</span><br><span class="line">        globalConfig.setServiceName(<span class="string">&quot;%sService&quot;</span>);</span><br><span class="line">        globalConfig.setIdType(IdType.AUTO);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//策略相关的配置</span></span><br><span class="line">        <span class="type">StrategyConfig</span> <span class="variable">strategyConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">        strategyConfig.setTablePrefix(<span class="string">&quot;ec_simple_&quot;</span>);</span><br><span class="line">        strategyConfig.setRestControllerStyle(<span class="literal">true</span>);</span><br><span class="line">        strategyConfig.setEntityLombokModel(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        autoGenerator.setPackageInfo(packageConfig);</span><br><span class="line">        autoGenerator.setDataSource(dataSourceConfig);</span><br><span class="line">        autoGenerator.setGlobalConfig(globalConfig);</span><br><span class="line">        autoGenerator.setStrategy(strategyConfig);</span><br><span class="line">        autoGenerator.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Mybatis-plus&quot;&gt;&lt;a href=&quot;#Mybatis-plus&quot; class=&quot;headerlink&quot; title=&quot;Mybatis-plus&quot;&gt;&lt;/a&gt;Mybatis-plus&lt;/h1&gt;&lt;p&gt;如何使用：&lt;/p&gt;
&lt;p&gt;导入坐标&lt;/p&gt;
&lt;figure </summary>
      
    
    
    
    
    <category term="框架" scheme="http://daihaojun554.github.io/tags/%E6%A1%86%E6%9E%B6/"/>
    
    <category term="SpringBoot" scheme="http://daihaojun554.github.io/tags/SpringBoot/"/>
    
    <category term="Mybatis-plus" scheme="http://daihaojun554.github.io/tags/Mybatis-plus/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot开发实用篇</title>
    <link href="http://daihaojun554.github.io/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/"/>
    <id>http://daihaojun554.github.io/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/</id>
    <published>2022-04-28T21:52:12.000Z</published>
    <updated>2022-05-21T07:38:01.616Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringBoot开发实用篇"><a href="#SpringBoot开发实用篇" class="headerlink" title="SpringBoot开发实用篇"></a>SpringBoot开发实用篇</h1><h1 id="目录："><a href="#目录：" class="headerlink" title="目录："></a>目录：</h1><ul><li>热部署</li><li>配置高级</li><li>测试</li><li>数据层解决方案</li><li>整合第三方技术</li><li>监控</li></ul><h1 id="一、热部署"><a href="#一、热部署" class="headerlink" title="一、热部署"></a>一、热部署</h1><h2 id="1-1、如何添加SpringBoot的热部署"><a href="#1-1、如何添加SpringBoot的热部署" class="headerlink" title="1.1、如何添加SpringBoot的热部署"></a>1.1、如何添加SpringBoot的热部署</h2><p>在pom.xml中加入这个：</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220428220941318.png" alt="image-20220428220941318"></p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>激活热部署:ctrl+F9 (build project)</p><p>1．开启开发者工具后启用热部署</p><p>2．使用构建项目操作启动热部署（ Ctrl+F9)</p><p>3．热部署仅仅加载当前开发者自定义开发的资源，不加载jar资源</p><h2 id="1-2、自动启动热部署"><a href="#1-2、自动启动热部署" class="headerlink" title="1.2、自动启动热部署"></a>1.2、自动启动热部署</h2><p>热部署只在开发环境下有用。实际上线的情况不可能改代码</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220428222714897.png" alt="image-20220428222714897"></p><p>勾上</p><p>然后ctrl+ alt+ shift +&#x2F;</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220428223310440.png" alt="image-20220428223310440"></p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220428223210427.png" alt="image-20220428223210427"></p><p>whenapprunning勾上</p><p>激活方式: ldea失去焦点5秒后启动热部署</p><p>热部署的范围：</p><p>默认不触发重启的目录列表<br>&#x2F;META-INF &#x2F; maven<br>&#x2F;META-INF&#x2F;resources<br>&#x2F;resources<br>&#x2F;static<br>&#x2F;public<br>&#x2F;templates</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220428225317272.png" alt="image-20220428225317272"></p><p>这个就是表示的哪些文件不参与热部署，可以自己配置</p><h2 id="1-3、如何关闭热部署？"><a href="#1-3、如何关闭热部署？" class="headerlink" title="1.3、如何关闭热部署？"></a>1.3、如何关闭热部署？</h2><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430170058256.png" alt="image-20220430170058256"></p><p>设置为false</p><h1 id="二、配置高级"><a href="#二、配置高级" class="headerlink" title="二、配置高级"></a>二、配置高级</h1><h2 id="2-1、-ConfigurationProperties"><a href="#2-1、-ConfigurationProperties" class="headerlink" title="2.1、@ConfigurationProperties"></a>2.1、@ConfigurationProperties</h2><p><strong><code>@ConfigurationProperties</code></strong></p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430171339307.png" alt="image-20220430171339307"></p><p>定义一个配置类，然后在配置文件里给它赋值</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430171415829.png" alt="image-20220430171415829"></p><p>启动容器的时候就能够得到这些值</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430171447144.png" alt="image-20220430171447144"></p><p>当要整合第三方的对象的时候就这样假设要定一个druid对象</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;datasource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> DruidDataSource <span class="title function_">dataSource</span><span class="params">()</span>&#123;</span><br><span class="line">   <span class="type">DruidDataSource</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">   <span class="keyword">return</span> ds;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">datasource:</span></span><br><span class="line">  <span class="attr">driverClassName:</span> <span class="string">com.dhj.Driver</span></span><br></pre></td></tr></table></figure><p>这样就可以拿到值了</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430172526039.png" alt="image-20220430172526039"></p><p><strong><code>@EnableConfigurationProperties</code></strong><br><code>@EnableConfigurationProperties</code>注解可以将使用@ConfigurationProperties注解对应的类加入Spring容器</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(ServerConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;servers&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerConfig</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-2、松散绑定"><a href="#2-2、松散绑定" class="headerlink" title="2.2、松散绑定"></a>2.2、松散绑定</h2><p>在配置文件中名称可以 很宽松</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430174214017.png" alt="image-20220430174214017"></p><p>这里的每一种都可以匹配到</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430174244867.png" alt="image-20220430174244867"></p><p>但是<code>@Value</code>中不支持这种宽松绑定</p><h2 id="2-3、超时时间的单位问题"><a href="#2-3、超时时间的单位问题" class="headerlink" title="2.3、超时时间的单位问题"></a>2.3、超时时间的单位问题</h2><p>像上面的timeout这个没有单位，不明确，实际上是毫秒</p><p>jdk8以后提供了一个专门的时间类</p><table><thead><tr><th>ServerConfig(ipAddress&#x3D;192.168.0.3, port&#x3D;2345, timeout&#x3D;-1, serverOutTime&#x3D;PT0.003S)</th></tr></thead></table><p>默认是秒，你也可以自己换<br><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430175454337.png" alt="image-20220430175454337"></p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430175401848.png" alt="image-20220430175401848"></p><table><thead><tr><th>ServerConfig(ipAddress&#x3D;192.168.0.3, port&#x3D;2345, timeout&#x3D;-1, serverOutTime&#x3D;PT72H)</th></tr></thead></table><h2 id="2-4、存储的单位"><a href="#2-4、存储的单位" class="headerlink" title="2.4、存储的单位"></a>2.4、存储的单位</h2><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430175657308.png" alt="image-20220430175657308"></p><table><thead><tr><th>ServerConfig(ipAddress&#x3D;192.168.0.3, port&#x3D;2345, timeout&#x3D;-1, serverOutTime&#x3D;PT72H,dataSize&#x3D;10B)</th></tr></thead></table><p>默认是byte</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430175911607.png" alt="image-20220430175911607"></p><p>同样也可自己设置有mb，gb，tb，kb…</p><table><thead><tr><th>ServerConfig(ipAddress&#x3D;192.168.0.3, port&#x3D;2345, timeout&#x3D;-1, serverOutTime&#x3D;PT72H, dataSize&#x3D;10485760B)</th></tr></thead></table><p>但是显示的是b</p><p>也可在配置文件中直接把单位配上</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430180202689.png" alt="image-20220430180202689"></p><h2 id="2-5、数据的格式校验"><a href="#2-5、数据的格式校验" class="headerlink" title="2.5、数据的格式校验"></a>2.5、数据的格式校验</h2><p>开启数据校验有助于系统安全性，J2EE规范中JSR303规范定义了一组有关数据校验相关的API</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220430180516280.png" alt="image-20220430180516280"></p><p>仓库搜索validation(验证的意思)</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--1、导入jsr303校验--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.validation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>validation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;servers&quot;)</span></span><br><span class="line"><span class="comment">//2、开启校验，这里只是开启了校验但是没有指定校验的规则</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String ipAddress;</span><br><span class="line">    <span class="comment">//3、在bean的具体字段上规定校验的规则</span></span><br><span class="line">    <span class="meta">@Max(value = 8888,message = &quot;最大值不能超过8888&quot;)</span></span><br><span class="line">    <span class="meta">@Min(value = 202,message = &quot;最小值不能低于202&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> timeout;</span><br><span class="line">    <span class="meta">@DurationUnit(ChronoUnit.DAYS)</span></span><br><span class="line">    <span class="keyword">private</span> Duration serverOutTime;</span><br><span class="line">    <span class="meta">@DataSizeUnit(DataUnit.MEGABYTES)</span></span><br><span class="line">    <span class="keyword">private</span> DataSize dataSize;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th><strong>Description:<br><br>The Bean Validation API is on the classpath but no implementation could be found<br><br>Action:<br><br>Add an implementation, such as Hibernate Validator, to the classpath</strong></th></tr></thead></table><p>报错</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.hibernate.validator/hibernate-validator --&gt;</span></span><br><span class="line">&lt;-- 使用hibernate的校验框架 实现校验--&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate.validator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>okl！这样就可以实现校验了 这个里有很多的校验规则</p><p><strong>注意yml文件中对于数字的定义支持进制书写格式，如需使用字符串请使用引号明确标注</strong></p><h1 id="三、测试"><a href="#三、测试" class="headerlink" title="三、测试"></a>三、测试</h1><h2 id="3-1、-给测试环境添加属性"><a href="#3-1、-给测试环境添加属性" class="headerlink" title="3.1、 给测试环境添加属性"></a>3.1、 给测试环境添加属性</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(properties = &quot;test.prop=value1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PropertiesAndArgsTest</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;test.prop&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testProperties</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(msg);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>properties这个属性，可以设置临时的属性写法是”key&#x3D;value”</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(args = &#123;&quot;--test.prop=value2&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PropertiesAndArgsTest</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;test.prop&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testProperties</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(msg);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>args属性可以加上一些临时的属性写法是 “–name&#x3D;value”</p><p> <strong>args的优先级很高</strong></p><h2 id="3-2、加载测试的专用配置"><a href="#3-2、加载测试的专用配置" class="headerlink" title="3.2、加载测试的专用配置"></a>3.2、加载测试的专用配置</h2><p>使用<code>@Import</code>注解可以加载当前测试的专用配置</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@Import(MsgConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CongurationTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> String Msg;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(Msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MsgConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">msg</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;bean Msg&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-3、表现层的测试"><a href="#3-3、表现层的测试" class="headerlink" title="3.3、表现层的测试"></a>3.3、表现层的测试</h2><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220501174536397.png" alt="image-20220501174536397"></p><p>在测试类中写上这个</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220501174612496.png" alt="image-20220501174612496"></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-1、发送虚拟请求"><a href="#3-3-1、发送虚拟请求" class="headerlink" title="3.3.1、发送虚拟请求"></a>3.3.1、发送虚拟请求</h3><p>1、先写一个controller</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getById</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getByid is running&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;springboot&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>需要用springboot提供的虚拟调用</p><p>2、先开启虚拟mvc的调用</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220501175251070.png" alt="image-20220501175251070"></p><p>3、模拟请求</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//注入虚拟MVC调用对象</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWeb</span><span class="params">(<span class="meta">@Autowired</span> MockMvc mvc)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//模拟虚拟请求，访问当前的books</span></span><br><span class="line">        <span class="type">MockHttpServletRequestBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> MockMvcRequestBuilders.get(<span class="string">&quot;/books&quot;</span>);</span><br><span class="line">        <span class="comment">//发送请求</span></span><br><span class="line">        mvc.perform(builder);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220501175948997.png" alt="image-20220501175948997"></p><p>4、验证</p><ul><li>验证状态的匹配</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testStatue</span><span class="params">(<span class="meta">@Autowired</span> MockMvc mvc)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//模拟</span></span><br><span class="line">    <span class="type">MockHttpServletRequestBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> MockMvcRequestBuilders.get(<span class="string">&quot;/books&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">ResultActions</span> <span class="variable">perform</span> <span class="operator">=</span> mvc.perform(builder);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设定预期值，与真实值比较</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义本次的预期值</span></span><br><span class="line">    <span class="type">StatusResultMatchers</span> <span class="variable">status</span> <span class="operator">=</span> MockMvcResultMatchers.status();</span><br><span class="line"></span><br><span class="line">    <span class="type">ResultMatcher</span> <span class="variable">ok</span> <span class="operator">=</span> status.isOk();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加预期值与真实值比较</span></span><br><span class="line">    perform.andExpect(ok);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>验证响应体的匹配</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testBody</span><span class="params">(<span class="meta">@Autowired</span> MockMvc mvc)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//模拟</span></span><br><span class="line">    <span class="type">MockHttpServletRequestBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> MockMvcRequestBuilders.get(<span class="string">&quot;/books&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">ResultActions</span> <span class="variable">perform</span> <span class="operator">=</span> mvc.perform(builder);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设定预期值，与真实值比较</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义本次的预期值</span></span><br><span class="line">    <span class="type">ContentResultMatchers</span> <span class="variable">content</span> <span class="operator">=</span> MockMvcResultMatchers.content();</span><br><span class="line"></span><br><span class="line">    <span class="type">ResultMatcher</span> <span class="variable">ok</span> <span class="operator">=</span> content.string(<span class="string">&quot;springboot1&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加预期值与真实值比较</span></span><br><span class="line">    perform.andExpect(ok);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>验证json的匹配</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testJson</span><span class="params">(<span class="meta">@Autowired</span> MockMvc mvc)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//模拟</span></span><br><span class="line">    <span class="type">MockHttpServletRequestBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> MockMvcRequestBuilders.get(<span class="string">&quot;/books&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">ResultActions</span> <span class="variable">perform</span> <span class="operator">=</span> mvc.perform(builder);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设定预期值，与真实值比较</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义本次的预期值</span></span><br><span class="line">    <span class="type">ContentResultMatchers</span> <span class="variable">content</span> <span class="operator">=</span> MockMvcResultMatchers.content();</span><br><span class="line"></span><br><span class="line">    <span class="type">ResultMatcher</span> <span class="variable">ok</span> <span class="operator">=</span> content.json(<span class="string">&quot;&#123;\&quot;id\&quot;:1,\&quot;name\&quot;:\&quot;springboot\&quot;,\&quot;type\&quot;:\&quot;springboot\&quot;,\&quot;desc\&quot;:\&quot;springboot\&quot;&#125;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加预期值与真实值比较</span></span><br><span class="line">    perform.andExpect(ok);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>……还可以测试很多东西</p><h2 id="3-4、如何让数据层测试事务回滚"><a href="#3-4、如何让数据层测试事务回滚" class="headerlink" title="3.4、如何让数据层测试事务回滚"></a>3.4、如何让数据层测试事务回滚</h2><p>为测试用例添加事务，SpringBoot会对测试用例对应的事务提交操作进行回滚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DaoTest</span> &#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> BookService bookService;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>如果想在测试用例中提交事务，可以通过<code>@Rollback</code>注解设置</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Rol1back(false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DaoTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> BookService bookService;</span><br><span class="line">    <span class="comment">//.....</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-5、测试用例设置随机数据"><a href="#3-5、测试用例设置随机数据" class="headerlink" title="3.5、测试用例设置随机数据"></a>3.5、测试用例设置随机数据</h2><p>在yml中设置：</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">testcase:</span></span><br><span class="line">  <span class="attr">book:</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">$&#123;random.int&#125;</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">$&#123;random.value&#125;</span></span><br><span class="line">    <span class="attr">uuid:</span> <span class="string">$&#123;random.uuid&#125;</span></span><br><span class="line">    <span class="attr">publishTime:</span> <span class="string">$&#123;random.long&#125;</span></span><br></pre></td></tr></table></figure><p>再次创建一个实体类来进行封装</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;testcase.book&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookCase</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String uuid;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> publishTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>进行测试：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> BookCase bookCase;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testBookCase</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(bookCase);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220501193609388.png" alt="image-20220501193609388"></p><p>ok!</p><h1 id="四、数据层解决方案"><a href="#四、数据层解决方案" class="headerlink" title="四、数据层解决方案"></a>四、数据层解决方案</h1><h2 id="4-1、SQL"><a href="#4-1、SQL" class="headerlink" title="4.1、SQL"></a>4.1、SQL</h2><h3 id="4-1-1、hikari"><a href="#4-1-1、hikari" class="headerlink" title="4.1.1、hikari"></a>4.1.1、hikari</h3><ul><li>当我们的springboot不配置任何数据源的时候，默认使用**<code>HikariDatasource</code>**数据源</li><li>当我们的springboot是web环境的时候，springboot里的tomcat提供Datasource</li></ul><p>配置hikari的时候配置的文件这么写：</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost/springboot-ssmp?useSSL=false&amp;characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure><p><strong>url一定要写在hikari上面</strong></p><h3 id="4-1-2、JdbcTemplate"><a href="#4-1-2、JdbcTemplate" class="headerlink" title="4.1.2、JdbcTemplate"></a>4.1.2、JdbcTemplate</h3><ul><li>首先要加一个springboot-starter-jdbc的依赖</li></ul>  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>  他这是自己的jdbc模板类</p><p>  然后怎么用呢，</p>  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ApplicationTests</span> &#123;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">JdbcTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="comment">//第一步加载jdbcTemplate对象</span></span><br><span class="line"><span class="comment">//    jdbcTemplate.update(&quot;sql&quot;);</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from tb_book where id = 1&quot;</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//定义它的行的映射</span></span><br><span class="line">      RowMapper&lt;Book&gt; rm = <span class="keyword">new</span> <span class="title class_">RowMapper</span>&lt;Book&gt;() &#123;</span><br><span class="line">         <span class="meta">@Override</span></span><br><span class="line">         <span class="keyword">public</span> Book <span class="title function_">mapRow</span><span class="params">(ResultSet rs, <span class="type">int</span> rowNum)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">            <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">b_name</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;b_name&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">b_type</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;b_type&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">b_desc</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;b_desc&quot;</span>);</span><br><span class="line">            book.setId(id);</span><br><span class="line">            book.setBDesc(b_desc);</span><br><span class="line">            book.setBName(b_name);</span><br><span class="line">            book.setBType(b_type);</span><br><span class="line">            <span class="keyword">return</span> book;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      List&lt;Book&gt; query = jdbcTemplate.query(sql, rm);</span><br><span class="line">      System.out.println(query);</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JdbcTemplate的插入测试</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">JdbcTemplateSave</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="type">String</span>  <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into tb_book (b_name,b_type,b_desc) values(&#x27;iambig&#x27;,&#x27;iambig&#x27;,&#x27;iambig&#x27;)&quot;</span>;</span><br><span class="line">jdbcTemplate.execute(sql);</span><br><span class="line">&#125;    </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220502204512585.png" alt="image-20220502204512585"></p><h3 id="4-1-3、SpringBoot的内置的数据库"><a href="#4-1-3、SpringBoot的内置的数据库" class="headerlink" title="4.1.3、SpringBoot的内置的数据库"></a>4.1.3、SpringBoot的内置的数据库</h3><p>SpringBoot提供了3种内嵌数据库供开发者选择，提高开发测试效率</p><ul><li>H2</li><li>HSQL</li><li>Derby</li></ul><p>​   内存级的数据库</p><h4 id="4-1-3-1、H2"><a href="#4-1-3-1、H2" class="headerlink" title="4.1.3.1、H2"></a>4.1.3.1、H2</h4><p>导入两个坐标</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.h2database/h2 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>…</p><p>然后再yml中配置</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置一个控制台可视化h2</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">h2:</span></span><br><span class="line">    <span class="attr">console:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/h2</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:h2:~/test</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">sa</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">org.h2.Driver</span></span><br></pre></td></tr></table></figure><p>然后访问这个路径：</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220502211748161.png" alt="image-20220502211748161"></p><p>输入账号密码就可以去可视化的界面了</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220502211921383.png" alt="image-20220502211921383"></p><h2 id="4-2、NoSQL"><a href="#4-2、NoSQL" class="headerlink" title="4.2、NoSQL"></a>4.2、NoSQL</h2><p>市面上的常见的NoSQL</p><ul><li>Redis</li><li>Mongo</li><li>ES</li></ul><h3 id="4-2-1、Redis"><a href="#4-2-1、Redis" class="headerlink" title="4.2.1、Redis"></a>4.2.1、Redis</h3><p>Redis是一款key-value存储结构的内存级NoSQL数据库</p><ul><li>支持集群</li><li>支持持久化</li><li>支持多种数据存储格式</li></ul><p>安装Redis</p><p><a href="https://github.com/tporadowski/redis/releases">https://github.com/tporadowski/redis/releases</a></p><p>…</p><p>使用：</p><p>打开一个 <strong>cmd</strong> 窗口 使用 cd 命令切换目录到 D:\dayly\Redis-x64-5.0.14.1 运行：</p><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">redis-server.exe redis.windows.conf</span><br></pre></td></tr></table></figure><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220503124509459.png" alt="image-20220503124509459"></p><p>然后再客户端里连再起一个cmd</p><p>输入</p><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">redis-cli.exe</span><br></pre></td></tr></table></figure><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220503124637858.png" alt="image-20220503124637858"></p><h3 id="4-2-2、SpringBoot整合Redis"><a href="#4-2-2、SpringBoot整合Redis" class="headerlink" title="4.2.2、SpringBoot整合Redis"></a>4.2.2、SpringBoot整合Redis</h3><ol><li>SpringBoot整合Redis</li></ol><ul><li>导入redis对应的starter配置</li></ul>  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>写配置文件</li></ul>  <figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br></pre></td></tr></table></figure><ul><li>提供操作Redis接口对象RedisTemplate</li></ul><p>  <img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220503131333012.png" alt="image-20220503131333012"></p><ul><li>ops*:获取各种数据类型操作接口</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setRedis</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="type">ValueOperations</span> <span class="variable">ops</span> <span class="operator">=</span> redisTemplate.opsForValue();</span><br><span class="line">   ops.set(<span class="string">&quot;age&quot;</span>,<span class="number">41</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">getRedis</span><span class="params">()</span>&#123;</span><br><span class="line">   <span class="type">ValueOperations</span> <span class="variable">ops</span> <span class="operator">=</span> redisTemplate.opsForValue();</span><br><span class="line">   <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> (<span class="type">int</span>) ops.get(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">   System.out.println(age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">hsetRedis</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="type">HashOperations</span> <span class="variable">ops</span> <span class="operator">=</span> redisTemplate.opsForHash();</span><br><span class="line">   ops.put(<span class="string">&quot;info&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;dhj&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">hgetRedis</span><span class="params">()</span>&#123;</span><br><span class="line">   <span class="type">HashOperations</span> <span class="variable">ops</span> <span class="operator">=</span> redisTemplate.opsForHash();</span><br><span class="line">   <span class="type">String</span>  <span class="variable">o</span> <span class="operator">=</span> (String) ops.get(<span class="string">&quot;info&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">   System.out.println(o);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>还有个专门的<code>StringRedisTemplate</code>对象专门操作字符串的</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate StringRedisTemplate;</span><br></pre></td></tr></table></figure><p>SpringBoot整合Redis客户端选择</p><ul><li>jedis</li><li>lettuce （默认)</li></ul><h3 id="4-2-3、Mongodb"><a href="#4-2-3、Mongodb" class="headerlink" title="4.2.3、Mongodb"></a>4.2.3、Mongodb</h3><p>安装：</p><p><a href="https://www.mongodb.com/try/download/community">https://www.mongodb.com/try/download/community</a></p><p>然后解压到一个文件夹 创建一个data文件夹 然后在data中创建一个db的文件夹</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220504005221436.png" alt="image-20220504005221436"></p><p>然后cmd中输入  </p><p>这个是初始化的过程</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mongod --dbpath=..\data\db</span><br></pre></td></tr></table></figure><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220504005505384.png" alt="image-20220504005505384"></p><p>然后结束 再开启一次 就相当于起了服务</p><p>然后可以通过客户端来连接mongo 启动了服务之后</p><p>在bin目录下的cmd中输入</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mongo</span><br></pre></td></tr></table></figure><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220504010055414.png" alt="image-20220504010055414"></p><p>这就相当于连接成功了。但是操作麻烦建议用可视化的工具</p><h3 id="4-2-4、Studio3T"><a href="#4-2-4、Studio3T" class="headerlink" title="4.2.4、Studio3T"></a>4.2.4、Studio3T</h3><p>是一款叫<a href="https://so.csdn.net/so/search?q=mongodb&spm=1001.2101.3001.7020">mongodb</a> 可视化工具</p><p>Studio 3T下载地址：<a href="https://studio3t.com/download-thank-you/?OS=win64">https://studio3t.com/download-thank-you/?OS=win64</a></p><p>这里的数据库叫database 然后表叫做<strong>Collections</strong></p><p>创建一个集合然后增删改查的操作</p><p>增：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db.book.insert(&#123;name:&quot;雾都孤儿&quot;,type:&quot;小说&quot;,desc:&quot;讲述了...&quot;&#125;)</span><br><span class="line"></span><br><span class="line">db.book.save(&#123;name:&quot;雾都孤儿2&quot;,type:&quot;小说2&quot;,desc:&quot;讲述了...2&quot;&#125;)</span><br></pre></td></tr></table></figure><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220504140303392.png" alt="image-20220504140303392"></p><p>删：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db.book.remove(&#123;desc:&quot;讲述了...2&quot;&#125;)</span><br></pre></td></tr></table></figure><p>改：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db.book.update(&#123;name:&quot;雾都孤儿2&quot;&#125;,&#123;name:&quot;雾都孤儿3&quot;,type:&quot;小说3&quot;,desc:&quot;讲述了...3&quot;&#125;)</span><br></pre></td></tr></table></figure><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220504140706596.png" alt="image-20220504140706596"></p><p>查：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db.getCollection(&quot;book&quot;).find(&#123;条件&#125;)</span><br></pre></td></tr></table></figure><h3 id="4-2-5、SpringBoot整合mongodb"><a href="#4-2-5、SpringBoot整合mongodb" class="headerlink" title="4.2.5、SpringBoot整合mongodb"></a>4.2.5、SpringBoot整合mongodb</h3><ul><li>导入起步依赖</li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>写配置文件</li></ul><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">mongodb:</span></span><br><span class="line">      <span class="attr">database:</span> <span class="string">springboot</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">mongodb://localhost</span></span><br></pre></td></tr></table></figure><ul><li>测试</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">       book.setId(<span class="number">2</span>);</span><br><span class="line">       book.setType(<span class="string">&quot;故事&quot;</span>);</span><br><span class="line">       book.setName(<span class="string">&quot;一千零一夜&quot;</span>);</span><br><span class="line">       book.setDesc(<span class="string">&quot;好听的故事&quot;</span>);</span><br><span class="line">       mongoTemplate.save(book);</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">testFindAll</span><span class="params">()</span>&#123;</span><br><span class="line">            List&lt;Book&gt; all = mongoTemplate.findAll(Book.class);</span><br><span class="line">            System.out.println(all);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果：</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220504143013236.png" alt="image-20220504143013236"></p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220504143547088.png" alt="image-20220504143547088"></p><h3 id="4-2-6、Elasticseach-ES"><a href="#4-2-6、Elasticseach-ES" class="headerlink" title="4.2.6、Elasticseach(ES)"></a>4.2.6、Elasticseach(ES)</h3><ul><li>分布式的全文搜索引擎</li></ul><p>特点：</p><p>倒排索引</p><p>搜索的时候，先将你的关键字进行分词，每一个分出来的词，进行对应着一些id，每个id对应着一部分数据 </p><p>​</p><p>Windows版ES下载<br><a href="https://www.elastic.co/cn/downloads/elasticsearch">https://www.elastic.co/cn/downloads/elasticsearch</a></p><h4 id="1-received-plaintext-http-traffic-on-an-https-channel-closing-connection-Netty4HttpChannel"><a href="#1-received-plaintext-http-traffic-on-an-https-channel-closing-connection-Netty4HttpChannel" class="headerlink" title="1.received plaintext http traffic on an https channel, closing connection Netty4HttpChannel"></a><strong>1.received plaintext http traffic on an https channel, closing connection Netty4HttpChannel</strong></h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">received plaintext http traffic on an https channel, closing connection Netty4HttpChannel</span><br><span class="line">&#123;localAddress=/[0:0:0:0:0:0:0:1]:9200, remoteAddress=/[0:0:0:0:0:0:0:1]:55367&#125;</span><br></pre></td></tr></table></figure><p><strong>解决</strong></p><p>是因为开启了 <strong>SSL</strong>认证。<br>在 <strong>ES&#x2F;config&#x2F;elasticsearch.yml</strong> 文件中把 <code>xpack.security.http.ssl:enabled</code> 设置成 <code>false</code> 即可</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Enable encryption for HTTP API client connections, such as Kibana, Logstash, and Agents</span></span><br><span class="line"></span><br><span class="line"><span class="attr">xpack.security.http.ssl:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">keystore.path:</span> <span class="string">certs/http.p12</span></span><br></pre></td></tr></table></figure><h4 id="2-elasticsearch-账号密码"><a href="#2-elasticsearch-账号密码" class="headerlink" title="2.elasticsearch 账号密码"></a><strong>2.elasticsearch 账号密码</strong></h4><p>​    windows 下直接启动 <a href="https://so.csdn.net/so/search?q=ElasticSearch&spm=1001.2101.3001.7020">ElasticSearch</a> ，见到 started 为成功启动，访问 htttp:&#x2F;&#x2F;localhost:9200 需要输入密码，是因为开启了密码验证模式。<br>找了一轮没看到有账号密码，干脆就设置免密登录就好。</p><p><strong>解决</strong></p><p>找到 <code>elasticsearch.yml</code> 文件， 把 <code>xpack.security.enabled</code> 属性设置为 <code>false</code> 即可。</p><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Enable security features</span></span><br><span class="line">xpack.security.<span class="symbol">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h4 id="3-设置内存大小"><a href="#3-设置内存大小" class="headerlink" title="3. 设置内存大小"></a>3. 设置内存大小</h4><p>ES 的内存是自己调节的。在 <code>config/jvm.options</code> 文件中直接设置就好(追加):</p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-Xms512m</span></span><br><span class="line"><span class="deletion">-Xmx2048m</span></span><br></pre></td></tr></table></figure><h4 id="4、IK分词器-es-（插件）"><a href="#4、IK分词器-es-（插件）" class="headerlink" title="4、IK分词器 es （插件）"></a>4、IK分词器 es （插件）</h4><p>下载: <a href="https://github.com/medcl/elasticsearch-analysis-ik/releases">https://github.com/medcl/elasticsearch-analysis-ik/releases</a></p><p>解压到<strong>plugins</strong>下</p><h4 id="5、创建-x2F-查询-x2F-删除索引"><a href="#5、创建-x2F-查询-x2F-删除索引" class="headerlink" title="5、创建&#x2F;查询&#x2F;删除索引"></a>5、创建&#x2F;查询&#x2F;删除索引</h4><p>PUT<br><a href="http://localhost:9200/books">http://localhost:9200/books</a></p><p>GET<br><a href="http://localhost:9200/books">http://localhost:9200/books</a></p><p>DELETE</p><p><a href="http://localhost:9200/books">http://localhost:9200/books</a></p><h4 id="6、创建文档"><a href="#6、创建文档" class="headerlink" title="6、创建文档"></a>6、创建文档</h4><p>POST<br><a href="http://localhost:9200/books/">http://localhost:9200/books/</a> _doc<br>#使用系统生成id<br>POST<br><a href="http://localhost:9200/books/">http://localhost:9200/books/</a> _create&#x2F;1<br>#使用指定id,<br>POST<br><a href="http://localhost:9200/books/">http://localhost:9200/books/</a> _doc&#x2F;1<br>#使用指定id，不存在创建，存在更新（版本递增)</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span><span class="string">&quot;springboot&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span><span class="string">&quot;springboot&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span> <span class="punctuation">:</span><span class="string">&quot;springboot&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="7、查询文档"><a href="#7、查询文档" class="headerlink" title="7、查询文档"></a>7、查询文档</h4><p>GET<br><a href="http://localhost:9200/books/">http://localhost:9200/books/</a> _doc&#x2F;1<br>#查询单个文档</p><p>GET<br><a href="http://localhost:9200/books/search">http://localhost:9200/books/search</a><br>#查询全部文档</p><p>条件查询<br>GET<br><a href="http://localhost:9200/books/">http://localhost:9200/books/</a> _search?q&#x3D;name:springboot</p><h4 id="8、删除文档"><a href="#8、删除文档" class="headerlink" title="8、删除文档"></a>8、删除文档</h4><p>DELETE<br><a href="http://localhost:9200/books/">http://localhost:9200/books/</a> _doc&#x2F;1</p><h4 id="9-1、修改文档（全量修改"><a href="#9-1、修改文档（全量修改" class="headerlink" title="9.1、修改文档（全量修改)"></a>9.1、修改文档（全量修改)</h4><p>PUT<br><a href="http://localhost:9200/books/">http://localhost:9200/books/</a> _doc&#x2F;1</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span><span class="string">&quot;springboot&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span><span class="string">&quot;springboot&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;springboot&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="9-2、修改文档（部分修改"><a href="#9-2、修改文档（部分修改" class="headerlink" title="9.2、修改文档（部分修改)"></a>9.2、修改文档（部分修改)</h4><p>POST</p><p><a href="http://localhost:9200/books/">http://localhost:9200/books/</a> _update(_doc)&#x2F;1</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;doc&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span><span class="string">&quot;springboot&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="五、整合第三方技术"><a href="#五、整合第三方技术" class="headerlink" title="五、整合第三方技术"></a>五、整合第三方技术</h1><h2 id="缓存："><a href="#缓存：" class="headerlink" title="缓存："></a>缓存：</h2><h3 id="5-1、缓存"><a href="#5-1、缓存" class="headerlink" title="5.1、缓存"></a>5.1、缓存</h3><ul><li>先加入依赖</li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>启用缓存</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">启用缓存</span><br><span class="line"><span class="meta">@SpringBootApplication</span><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheApplication</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(CacheApplication.class，args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>使用缓存</li></ul><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220505234848921.png" alt="image-20220505234848921"></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Cacheable(value=&quot;cachespace&quot; ,key=&quot;#id&quot;&#x27;)</span></span><br><span class="line"><span class="keyword">public</span> Book <span class="title function_">getById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> bookDao.selectById(id);</span><br><span class="line">&#125;</span><br><span class="line">           <span class="comment">//@Cacheable(里的value是放到什么地方，第二个是通过什么来查这个缓存)</span></span><br></pre></td></tr></table></figure><p>SpringBoot提供的缓存技术除了提供默认的缓存方案，还可以对其他缓存技术进行整合，统一接口，方便缓存技术的开发与管理</p><p><strong>Generic、JCache、<code>Ehcache</code>、Hazelcast、lnfinispan、Couchbase、<code>Redis</code>、Caffenine、Simple(默认)、<code>Memcached</code></strong></p><h3 id="5-2、缓存使用案例——手机验证码"><a href="#5-2、缓存使用案例——手机验证码" class="headerlink" title="5.2、缓存使用案例——手机验证码"></a>5.2、缓存使用案例——手机验证码</h3><p>需求：</p><ul><li><p>输入手机号获取验证码，组织文档以短信形式发送给用户（页面模拟)</p></li><li><p>输入手机号和验证码验证结果</p></li></ul><p>需求分析</p><ul><li>提供controller，传入手机号，业务层通过手机号计算出独有的6位验证码数据，存入缓存后返回此数据</li><li>提供controller，传入手机号与验证码，业务层通过手机号从缓存中读取验证码与输入验证码进行比对，返回比对结果</li></ul><p>先写一个pojo</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSCode</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String tele;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>service</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SMSCodeService</span> &#123;</span><br><span class="line"></span><br><span class="line">     String <span class="title function_">sendCodeToSMS</span><span class="params">(String tele)</span>;</span><br><span class="line"></span><br><span class="line">     <span class="type">boolean</span> <span class="title function_">checkCode</span><span class="params">(SMSCode smsCode)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>service.impl</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SMSCodeService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CodeUtils codeUtils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line"><span class="comment">//    @Cacheable(value = &quot;smsCode&quot;,key = &quot;#tele&quot;)这个表示从缓存中拿值可以取出来的，我们用下一个，下面这个是不能从缓存中取，如果用这个的话就说明通过tele取出来的验证码是同一个，但是有一种场景是当登录完成的时候，需要新的验证码</span></span><br><span class="line">    <span class="meta">@CachePut(value = &quot;smsCode&quot;,key = &quot;#tele&quot;)</span><span class="comment">//只存不取</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sendCodeToSMS</span><span class="params">(String tele)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> codeUtils.generatorCode(tele);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//取出内存中的验证码和输出的验证码比对</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkCode</span><span class="params">(SMSCode smsCode)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> smsCode.getCode();</span><br><span class="line">        <span class="type">String</span> <span class="variable">cacheCode</span> <span class="operator">=</span> codeUtils.get(smsCode.getTele());</span><br><span class="line">        <span class="keyword">return</span> cacheCode.equals(code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>写一个util生成验证码：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeUtils</span> &#123;</span><br><span class="line"><span class="comment">//一种生成验证码的方式</span></span><br><span class="line">    <span class="keyword">public</span>  String <span class="title function_">generatorCode</span><span class="params">(String tele)</span>&#123;</span><br><span class="line">        String[] patch =  &#123;<span class="string">&quot;000000&quot;</span>,<span class="string">&quot;00000&quot;</span>,<span class="string">&quot;0000&quot;</span>,<span class="string">&quot;000&quot;</span>,<span class="string">&quot;00&quot;</span>,<span class="string">&quot;0&quot;</span>,<span class="string">&quot;&quot;</span>&#125;;</span><br><span class="line">        <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> tele.hashCode();</span><br><span class="line">        <span class="type">int</span> <span class="variable">encryption</span> <span class="operator">=</span> <span class="number">20206666</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">code</span> <span class="operator">=</span> hash ^ encryption;</span><br><span class="line">        <span class="type">long</span> <span class="variable">nowTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        code = code ^ nowTime;</span><br><span class="line">        code = code%<span class="number">100000</span>;</span><br><span class="line">        code = code &lt; <span class="number">0</span> ? -code : code;</span><br><span class="line">        <span class="type">String</span> <span class="variable">codeStr</span> <span class="operator">=</span> code+<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> codeStr.length();</span><br><span class="line">        <span class="keyword">return</span> patch[len] + codeStr;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//在这里通过key = &quot;tele&quot;来取出我们在smsCode存放的验证码有就返回 ，没有就返回null;</span></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;smsCode&quot;,key = &quot;#tele&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">(String tele)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>controller：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/sms&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SMSCodeService smsCodeService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCode</span><span class="params">(String  tele)</span>&#123;</span><br><span class="line">       <span class="keyword">return</span> smsCodeService.sendCodeToSMS(tele);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkCode</span><span class="params">(SMSCode smsCode)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> smsCodeService.checkCode(smsCode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试：</p><p>先像getCode发送请求，要传一个电话号码</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220506005144788.png" alt="image-20220506005144788"></p><p>验证的结果：</p><p>用返回的验证码来测试这里传的是两个参数其实是一个smsCode对象</p><p>验证码正确的时候：</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220506005216120.png" alt="image-20220506005216120"></p><p>如果写上错误的验证码：</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220506005243098.png" alt="image-20220506005243098"></p><h3 id="5-3、变更缓存供应商Ehcache"><a href="#5-3、变更缓存供应商Ehcache" class="headerlink" title="5.3、变更缓存供应商Ehcache"></a>5.3、变更缓存供应商Ehcache</h3><ul><li>导入依赖</li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.ehcache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>缓存淘汰的策略</p><ul><li>LFU：最少被使用，缓存的元素有一个hit属性，hit值最小的将会被清出缓存。</li><li>LRU：最近最少使用，缓存的元素有一个时间戳，当缓存容量满了，而又需要腾出地方来缓存新的元素的时候，那么现有缓存元素中时间戳离当前时间最远的元素将被清出缓存。</li><li>FIFO：先进先出</li></ul></li><li><p>配置文件说明</p></li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">&quot;http://ehcache.org/ehcache.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">updateCheck</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">&quot;D:\ehcache&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--默犬认缓存策略--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- eternal:是否永久存在，设置为true则不会被清除，此时与timeout冲突，通常设置为false--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- diskPersistent:是否启用磁盘持久化--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--maxElementsInMemory :最大缓存数量--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- overflowToDisk :超过最大缓存数量是否持久化到磁盘--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- timeToIdleSeconds:最大不活动间隔，设置过长缓存容易溢出，设置过短无效果--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- timeToLiveSeconds:最大存活时间--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- memoryStoreEvictionPolicy :缓存清除策略--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">defaultCache</span></span></span><br><span class="line"><span class="tag">            <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">diskPersistent</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">maxElementsInMemory</span>=<span class="string">&quot;1000&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">overflowToDisk</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;60&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;60&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">&quot;LRU&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>写配置文件</li></ul><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ehcache</span></span><br><span class="line">  <span class="attr">ehcache:</span></span><br><span class="line">    <span class="attr">config:</span> <span class="string">classpath:ehcache.xml</span></span><br></pre></td></tr></table></figure><h3 id="5-4、变更缓存供应商Redis"><a href="#5-4、变更缓存供应商Redis" class="headerlink" title="5.4、变更缓存供应商Redis"></a>5.4、变更缓存供应商Redis</h3><ul><li>导入依赖</li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>配置文件yml</li></ul><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">  <span class="comment">#是否缓存空值</span></span><br><span class="line">    <span class="attr">cache-null-values:</span></span><br><span class="line">    <span class="comment">#key的前缀</span></span><br><span class="line">    <span class="attr">key-prefix:</span> <span class="string">sms</span></span><br><span class="line">    <span class="comment">#缓存存活的时间</span></span><br><span class="line">    <span class="attr">time-to-live:</span> <span class="string">10s</span></span><br><span class="line">    <span class="comment">#是否使用前缀</span></span><br><span class="line">    <span class="attr">use-key-prefix:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">redis:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure><p>ok!</p><p>这样就开启了redis缓存</p><h3 id="5-5、变更缓存供应商为Memcached"><a href="#5-5、变更缓存供应商为Memcached" class="headerlink" title="5.5、变更缓存供应商为Memcached"></a>5.5、变更缓存供应商为Memcached</h3><ul><li>下载</li></ul><p><a href="http://static.runoob.com/download/memcached-win64-1.4.4-14.zip">http://static.runoob.com/download/memcached-win64-1.4.4-14.zip</a> 默认监听端口为<strong>11211</strong></p><p><strong>解压后在cmd中敲(以管理员的的身份)</strong></p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220509001219248.png" alt="image-20220509001219248"></p><p>安装服务的命令：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">memcached.exe -d install</span><br></pre></td></tr></table></figure><p>启动服务的命令：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">memcached.exe -d start</span><br></pre></td></tr></table></figure><p>关闭服务的命令：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">memcached.exe -d stop</span><br></pre></td></tr></table></figure><h4 id="5-5-1、memcached客户端选择"><a href="#5-5-1、memcached客户端选择" class="headerlink" title="5.5.1、memcached客户端选择"></a>5.5.1、memcached客户端选择</h4><ul><li><p>Memcached client for Java:最早期客户端，稳定可靠，用户群广</p></li><li><p>SpyMemcached:效率更高</p></li><li><p>xmemcached:并发处理更好</p></li></ul><p>SpringBoot未提供对memcached的整合，需要使用硬编码方式实现客户端初始化管理</p><ul><li><p>整合xmemcached</p><ul><li>导依赖</li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.googlecode.xmemcached<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xmemcached<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>构造client</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemcachedConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MemcachedClient <span class="title function_">getMemcached</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">MemcachedClientBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XMemcachedClientBuilder</span>(<span class="string">&quot;localhost:11211&quot;</span>);</span><br><span class="line">        <span class="type">MemcachedClient</span> <span class="variable">client</span> <span class="operator">=</span> builder.build();</span><br><span class="line">        <span class="keyword">return</span> client;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><p>在service中进行使用</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SMSCodeService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CodeUtils codeUtils;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MemcachedClient memcachedClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sendCodeToSMS</span><span class="params">(String tele)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> codeUtils.generatorCode(tele);</span><br><span class="line">        <span class="comment">//生成验证码的时候放入缓存</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//key 过期时间 0 代表永不过期，  value</span></span><br><span class="line">            memcachedClient.set(tele,<span class="number">120</span>,code);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (TimeoutException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException | MemcachedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkCode</span><span class="params">(SMSCode smsCode)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cacheCode</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            cacheCode = memcachedClient.get(smsCode.getTele());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//比对</span></span><br><span class="line">        <span class="keyword">return</span> cacheCode.equals(smsCode.getCode());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>写配置用springboot提供的技术,从配置文件中读取内容属性</p><p>写一个配置类</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;memcached&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemcachedProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String serverAddress;</span><br><span class="line">    <span class="keyword">private</span> Integer poolSize;</span><br><span class="line">    <span class="keyword">private</span> Integer outTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#-----------------memcached的配置-------------</span></span><br><span class="line"><span class="attr">memcached:</span></span><br><span class="line">  <span class="attr">serverAddress:</span> <span class="string">localhost:11211</span></span><br><span class="line">  <span class="attr">poolSize:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">outTime:</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure><p>在config中注入这个类</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220509004804995.png" alt="image-20220509004804995"></p><h3 id="5-6、缓存供应商变更-jetcache"><a href="#5-6、缓存供应商变更-jetcache" class="headerlink" title="5.6、缓存供应商变更 jetcache"></a>5.6、缓存供应商变更 jetcache</h3><p>jetlache对SpringCache进行了封装，在原有功能基础上实现了多级缓存、缓存统计、自动刷新、异步调用、数据报表等幼能</p><p>jetCache设定了本地缓存与远程缓存的多级缓存解决方案</p><ul><li>本地缓存（ local)<ul><li>LinkedHashMap</li><li>caffeine</li></ul></li><li>远程缓存（ remote)<ul><li>Redis</li><li>Tair</li></ul></li></ul><h4 id="5-6-1、整合jetcache"><a href="#5-6-1、整合jetcache" class="headerlink" title="5.6.1、整合jetcache"></a>5.6.1、整合jetcache</h4><ul><li>导入依赖</li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alicp.jetcache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jetcache-starter-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>做配置</li></ul><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在jetcache中</span></span><br><span class="line"><span class="attr">jetcache:</span></span><br><span class="line"><span class="comment">#  远程方案</span></span><br><span class="line">  <span class="attr">remote:</span></span><br><span class="line"><span class="comment">#    默认的的设定</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line"><span class="comment">#      使用redis</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">poolConfig:</span></span><br><span class="line">        <span class="attr">maxTotal:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><h4 id="5-6-2、如何使用jetcache"><a href="#5-6-2、如何使用jetcache" class="headerlink" title="5.6.2、如何使用jetcache"></a>5.6.2、如何使用jetcache</h4><ul><li>在主启动类中加上注解 <code>@EnableCreateCacheAnnotation</code></li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableCreateCacheAnnotation</span></span><br><span class="line"><span class="comment">//jet启动缓存的主开关</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application15JetCache</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">      SpringApplication.run(Application15JetCache.class, args);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>在你要是用缓存的地方加入一个<code>Cache</code></li></ul><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220509175344177.png" alt="image-20220509175344177"></p><p>打上注解<code>@CreateCache</code></p><p>在<code>@CreateCache</code>中最少要做两个配置 <code>name</code> 和 <code>expire</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CreateCache(area = &quot;default&quot;,name = &quot;jetcache&quot;,expire = 120,timeUnit = TimeUnit.SECONDS)</span></span><br><span class="line"><span class="comment">//area表示你要使用的配置，前面配置了一个default的方案，name就是名字，随便取，expire是过期时间默认的单位是秒，可以用timeUnit来设置单位</span></span><br><span class="line"><span class="keyword">private</span> Cache&lt;String ,String &gt; jetCache ;</span><br></pre></td></tr></table></figure><p>使用的时候就可以调API</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SMSCodeService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CodeUtils codeUtils;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CreateCache(area = &quot;default&quot;,name = &quot;jetcache_&quot;,expire = 30,timeUnit = TimeUnit.SECONDS)</span></span><br><span class="line">    <span class="comment">//area表示你要使用的配置，前面配置了一个default的方案，name就是名字，随便取，expire是过期时间默认的单位是秒，可以用timeUnit来设置单位</span></span><br><span class="line">    <span class="keyword">private</span> Cache&lt;String ,String &gt; cache ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sendCodeToSMS</span><span class="params">(String tele)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> codeUtils.generatorCode(tele);</span><br><span class="line">        <span class="comment">//将验证码放入缓存</span></span><br><span class="line">        cache.put(tele,code);</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkCode</span><span class="params">(SMSCode smsCode)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cacheCode</span> <span class="operator">=</span> cache.get(smsCode.getTele());</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> smsCode.getCode();</span><br><span class="line">        <span class="keyword">return</span> cacheCode.equals(code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-6-3、jetcache本地方案"><a href="#5-6-3、jetcache本地方案" class="headerlink" title="5.6.3、jetcache本地方案"></a>5.6.3、jetcache本地方案</h4><p>配置：</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">jetcache:</span>   </span><br><span class="line">  <span class="attr">local:</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">linkedhashmap</span></span><br><span class="line">      <span class="attr">keyConvertor:</span> <span class="string">fastjson</span></span><br></pre></td></tr></table></figure><p>在cache上写上 <code>cacheType=CacheType.LOCAL  </code>   这样就是本地的方案   不写的话默认是远程</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CreateCache(area = &quot;default&quot;, name = &quot;jetcache_&quot;, expire = 30, timeUnit = TimeUnit.SECONDS,cacheType = CacheType.LOCAL)</span></span><br><span class="line">   <span class="keyword">private</span> Cache&lt;String, String&gt; cache;</span><br></pre></td></tr></table></figure><h4 id="5-6-4、在方法上加上缓存"><a href="#5-6-4、在方法上加上缓存" class="headerlink" title="5.6.4、在方法上加上缓存"></a>5.6.4、在方法上加上缓存</h4><p>在controller中给每个方法加上缓存 这样就不用在发送请求了</p><ul><li><p>在主启动类上加上</p><p><code>@EnableMethodCache(basePackages = &quot;com.dhj&quot;)//开启方法注解</code></p></li><li><p>然后在方法上配上缓存，下次查询的时候就不用查数据库了</p><pre><code> `@Cached(area = &quot;default&quot;,name = &quot;getone_&quot;,key = &quot;#id&quot;,expire = 30)`</code></pre></li></ul><p>前提是：</p><p>你得R对象要序列化</p><p>比如我在这里加上了缓存</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Cached(area = &quot;default&quot;,name = &quot;book_&quot;,key = &quot;#id&quot;,expire = 30)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(<span class="literal">true</span>, service.getById(id));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后这里返回的是R对象，你得R对象就要实现序列化</p><p>你得controller调用了service层 service层返回的又是一个实体类对象，所以你的实体类也要实现序列化</p><p>用  <code>implement Serializable</code>来实现 </p><ul><li>还要再配置中写上类型转换的方法fastjson，告诉springboot使用这个来讲对象转换成数据</li><li>还要告诉sprigboot 解码方式和转码方式 都为java</li></ul><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在jetcache中</span></span><br><span class="line"><span class="attr">jetcache:</span></span><br><span class="line">  <span class="attr">statIntervalMinutes:</span> <span class="number">1</span></span><br><span class="line"><span class="comment">#  远程方案</span></span><br><span class="line">  <span class="attr">remote:</span></span><br><span class="line"><span class="comment">#    默认的的设定</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line"><span class="comment">#      使用redis</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">keyConvertor:</span> <span class="string">fastjson</span></span><br><span class="line">      <span class="attr">valueEncode:</span> <span class="string">java</span></span><br><span class="line">      <span class="attr">valueDecode:</span> <span class="string">java</span></span><br><span class="line">      <span class="attr">poolConfig:</span></span><br><span class="line">        <span class="attr">maxTotal:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">local:</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">linkedhashmap</span></span><br><span class="line">      <span class="attr">keyConvertor:</span> <span class="string">fastjson</span></span><br></pre></td></tr></table></figure><p><code>@cacheUpdate(key = &quot;#book.id&quot;,value=&quot;#book&quot;,name=&quot;book_&quot;)</code>更新缓存</p><p><code>@cacheInvalidate(name=&quot;book_&quot;,key=&quot;#id&quot;)</code> 删除缓存</p><p><code>@cacheRefresh(refresh = 120)</code>每过120秒更新一次</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Cached(area = &quot;default&quot;,name = &quot;book_&quot;,key = &quot;#id&quot;,expire = 30)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(<span class="literal">true</span>, service.getById(id));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@CacheInvalidate(name = &quot;book_&quot;,key = &quot;#id&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">deleteByid</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(service.removeById(id));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="meta">@CacheUpdate(name = &quot;book_&quot;,key = &quot;#book.id&quot;,value = &quot;#book&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> Book book)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(service.updateById(book));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在配置文件中写上</p><p><code>statIntervalMinutes: 1</code>就代表每过一分钟给你统计一次数量</p><h3 id="5-7、变更缓存为j2cache-多级缓存"><a href="#5-7、变更缓存为j2cache-多级缓存" class="headerlink" title="5.7、变更缓存为j2cache(多级缓存)"></a>5.7、变更缓存为j2cache(多级缓存)</h3><p>redis 和 ehcache整合 多级缓存的配置</p><ul><li><p>导入依赖</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/net.oschina.j2cache/j2cache-core --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.oschina.j2cache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>j2cache-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.2-release<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/net.oschina.j2cache/j2cache-spring-boot2-starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.oschina.j2cache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>j2cache-spring-boot2-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.0-release<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>做配置文件</p></li></ul><p>在resource中的配置文件</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220509204828678.png" alt="image-20220509204828678"></p><ul><li>&#96;&#96;&#96;java<br>j2cache:<br>  config-location: j2cache.properties<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">在resource下写一个`j2cache.properties`</span><br><span class="line"></span><br><span class="line">在j2cache的核心包里有所有的配置，因为是整合ehcache和redis 所以配置文件就这样写</span><br><span class="line"></span><br><span class="line">j2cache</span><br><span class="line"></span><br><span class="line">```properties</span><br><span class="line">#1级级存</span><br><span class="line">j2cache.L1.provider_class=ehcache</span><br><span class="line">ehcache.configxml=ehcache.xml</span><br><span class="line"></span><br><span class="line">#2级缓存</span><br><span class="line">j2cache.L2.provider_class=net.oschina.j2cache.cache.support.redis.SpringRedisProvider</span><br><span class="line">j2cache.L2.config_section=redis</span><br><span class="line"></span><br><span class="line">redis.hosts=localhost:6379</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#1级缓存中的数据如何到达2级锾存</span><br><span class="line">j2cache.broadcast=net.oschina.j2cache.cache.support.redis.SpringRedisPubSubPolicy</span><br></pre></td></tr></table></figure></li></ul><p>使用j2cache</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> CacheChannel cacheChannel;</span><br><span class="line"><span class="comment">//注入一个cacheChannel</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sendCodeToSMS</span><span class="params">(String tele)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> codeUtils.generatorCode(tele);</span><br><span class="line">        cacheChannel.set(<span class="string">&quot;code&quot;</span>,tele,code);</span><br><span class="line">        <span class="comment">//放入缓存</span></span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkCode</span><span class="params">(SMSCode smsCode)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cacheCode</span> <span class="operator">=</span> cacheChannel.get(<span class="string">&quot;code&quot;</span>, smsCode.getTele()).asString();</span><br><span class="line">        <span class="comment">//从缓存中取出</span></span><br><span class="line">        <span class="keyword">return</span> smsCode.getCode().equals(cacheCode);</span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure><h2 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h2><p>定时任务是企业级应用中的常见操作</p><p>◆年度报表</p><p>◆缓存统计报告</p><p>◆….</p><p>市面上流行的定时任务技术<br>◆Quartz</p><p>◆Spring Task</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Timer</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Timer</span>();</span><br><span class="line">    <span class="type">TimerTask</span> <span class="variable">task</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TimerTask</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;timer run...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//每过两秒就执行run方法</span></span><br><span class="line">    t.schedule(task,<span class="number">0</span>,<span class="number">2000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-8、SpringBoot整合Quartz"><a href="#5-8、SpringBoot整合Quartz" class="headerlink" title="5.8、SpringBoot整合Quartz"></a>5.8、SpringBoot整合Quartz</h3><p><strong>概念</strong>:</p><ul><li><p>工作(Job):用于定义具体执行的工作</p></li><li><p>工作明细(JobDetail):用于描述定时工作相关的信息</p></li><li><p>触发器（Trigger):用于描述触发工作的规则，通常使用cron表达式定义调度规则调度器( Scheduler):描述了工作明细与触发器的对应关系</p></li></ul><p>步骤：</p><p>1、导坐标</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2、创建具体执行的工作</p><p>创建一个类来表示你的具体工作，该类要继承<code>QuartzJobBean</code>类</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Myquartz</span> <span class="keyword">extends</span> <span class="title class_">QuartzJobBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//工作的上下文对象</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">executeInternal</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;run quartz ....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后写配置</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220510005406698.png" alt="image-20220510005406698"></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//定义成一个配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Quartz</span> &#123;</span><br><span class="line">    <span class="comment">//工作明细</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> JobDetail <span class="title function_">printJobDetail</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//storeDurably这里是表示是持久化你的工作</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="type">JobDetail</span> <span class="variable">detail</span> <span class="operator">=</span> JobBuilder.newJob(Myquartz.class).storeDurably().build();</span><br><span class="line">        <span class="keyword">return</span> detail;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//触发器</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Trigger <span class="title function_">printJobTrigger</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//second minute hour 日期 月份 星期 这里是每5秒执行一次</span></span><br><span class="line">        <span class="type">ScheduleBuilder</span> <span class="variable">scheduleBuilder</span> <span class="operator">=</span> CronScheduleBuilder.cronSchedule(<span class="string">&quot;0/5 * * * * ?&quot;</span>);</span><br><span class="line">        <span class="type">Trigger</span> <span class="variable">trigger</span> <span class="operator">=</span> TriggerBuilder.newTrigger().withSchedule(scheduleBuilder).forJob(printJobDetail()).build();</span><br><span class="line">        <span class="comment">//绑定对应的工作明细</span></span><br><span class="line">        <span class="keyword">return</span> trigger;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样就行了</p><h3 id="5-9、springboot整合Task"><a href="#5-9、springboot整合Task" class="headerlink" title="5.9、springboot整合Task"></a>5.9、springboot整合Task</h3><p>开启定时任务的开关</p><p><strong><code>@EnableScheduling</code></strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="comment">//开启定时任务的开关</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application17Task</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(Application17Task.class, args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>创建一个类代表你的任务</p><p>该类要定义成一个bean   用<code>@Component</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTask</span> &#123;</span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/1 * * * * ?&quot;)</span><span class="comment">//每秒执行一次</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;MyTask run ...&quot;</span>+ LocalTime.now());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后加上 **<code>@Scheduled(cron = &quot;0/1 * * * * ?&quot;)</code>**就代表你要执行这个定时任务</p><ul><li><p>cron表达式：</p><p>cron表达式是一个字符串,该字符串由6个空格分为7个域，每一个域代表一个时间含义。通常定义“年”的部分可以省略，实际常用的由前六部分组成其实我们还可以借助于一些可视化的工具来生成cron表达式，但是如果我们同样需要能够看得懂别人写的表达式。”</p></li></ul><p>每五分钟执行一次：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span> <span class="number">0</span>/<span class="number">5</span> * * * ?</span><br></pre></td></tr></table></figure><p>每小时执行一次：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">0</span>/<span class="number">1</span> * * ?</span><br></pre></td></tr></table></figure><p>每天的7：30执行一次：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span> <span class="number">30</span> <span class="number">7</span> * * ?</span><br></pre></td></tr></table></figure><p>工作日的早上6点30分（即是周一到周五，每天早上的6点30分）：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span> <span class="number">30</span> <span class="number">7</span> ? * MON-FRI</span><br></pre></td></tr></table></figure><p>每个月的最后一天早上的10点整</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">10</span> L * ?</span><br></pre></td></tr></table></figure><p>….</p><h2 id="邮件"><a href="#邮件" class="headerlink" title="邮件"></a>邮件</h2><p>1、SMTP (Simple Mail Transfer Protocol)∶简单邮件传输协议，用于发送电子邮件的传输协议</p><p>2、POP3 ( Post Office Protocol - Version 3):用于接收电子邮件的标准协议</p><p>3、IMAP ( Internet Mail Access Protocol):互联网消息协议，是POP3的替代协议</p><h3 id="5-10、Springboot整合JavaMail"><a href="#5-10、Springboot整合JavaMail" class="headerlink" title="5.10、Springboot整合JavaMail"></a>5.10、Springboot整合JavaMail</h3><ul><li>导坐标</li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>做配置</li></ul><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220511133315830.png" alt="image-20220511133315830"></p><p>这里的password不是登录密码，而是网页生成的授权码</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220511131846130.png" alt="image-20220511131846130"></p><p>写代码：</p><p>直接用JavaMailSender对象就可以来发邮件</p><h4 id="发送普通的邮箱"><a href="#发送普通的邮箱" class="headerlink" title="发送普通的邮箱"></a>发送普通的邮箱</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendMailServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SendMailService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JavaMailSender javaMailSender;</span><br><span class="line"><span class="comment">//    发件人用括号括起来的就说明在接受邮箱的时候可以显示你括号里的内容</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">from</span> <span class="operator">=</span> <span class="string">&quot;xxx@qq.com(小甜甜)&quot;</span>;</span><br><span class="line">    <span class="comment">//收件人</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">to</span>  <span class="operator">=</span> <span class="string">&quot;xxx@163.com&quot;</span>;</span><br><span class="line"><span class="comment">//    标题</span></span><br><span class="line">    String title=<span class="string">&quot;测试邮件&quot;</span>;</span><br><span class="line"><span class="comment">//    正文</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">text</span>  <span class="operator">=</span> <span class="string">&quot;这是测试邮件的正文&quot;</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendEmail</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SimpleMailMessage</span> <span class="variable">simpleMailMessage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleMailMessage</span>();</span><br><span class="line">        simpleMailMessage.setFrom(from);</span><br><span class="line">        simpleMailMessage.setTo(to);</span><br><span class="line">        simpleMailMessage.setText(text);</span><br><span class="line">        simpleMailMessage.setSubject(title);</span><br><span class="line">        javaMailSender.send(simpleMailMessage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220511133609458.png" alt="image-20220511133609458"></p><h4 id="发送带附件的邮箱"><a href="#发送带附件的邮箱" class="headerlink" title="发送带附件的邮箱"></a>发送带附件的邮箱</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这个发送邮件可以发送附件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendEmailPlus</span><span class="params">()</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;发送带邮件开始：&#123;&#125;,&#123;&#125;,&#123;&#125;&quot;</span>, to, from, title);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">MimeMessage</span> <span class="variable">mimeMessage</span> <span class="operator">=</span> javaMailSender.createMimeMessage();</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="type">MimeMessageHelper</span> <span class="variable">helper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MimeMessageHelper</span>(mimeMessage,<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//上传附件就要将multipart设置为true</span></span><br><span class="line">        helper.setFrom(from);</span><br><span class="line">        helper.setTo(to);</span><br><span class="line">        helper.setSubject(title);</span><br><span class="line">        helper.setText(text,<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//将html设置为true就可以解析正文中的html内容</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">f1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\software-rar\\清理软件.zip&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">f2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\python\\result\\jpg_from_wallhaven\\dpqjqg.jpg&quot;</span>);</span><br><span class="line">        helper.addAttachment(f1.getName(),f1);</span><br><span class="line">        helper.addAttachment(f2.getName(),f2);</span><br><span class="line">        javaMailSender.send(mimeMessage);</span><br><span class="line">        log.info(<span class="string">&quot;发送带附件邮件成功&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;发送带附件邮件失败&quot;</span>);</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220511141734575.png" alt="image-20220511141734575"></p><h2 id="消息"><a href="#消息" class="headerlink" title="消息"></a>消息</h2><p>企业级应用中广泛使用的三种异步消息传递技术</p><ul><li><p>JMS</p><ul><li>JMS(Java Message Service)∶一个规范，等同于JDBC规范，提供了与消息服务相关的API接口</li><li>.JMS消息模型<ul><li>peer-2-peer:点对点模型，消息发送到一个队列中，队列保存消息。队列的消息只能被一个消费者消费，或超时</li><li>publish-subscribe: 发布订阅模型，消息可以被多个消费者消费，生产者和消费者完全独立，不需要感知对方的存在</li></ul></li><li>JMS中的消息种类<ul><li>TextMessage</li><li>MapMessage</li><li>BytesMessage</li><li>StreamMessage</li><li>objectMessalge</li><li>Message(只有消息头和属性)</li></ul></li><li>JMS实现<ul><li>ActiveMQ、Redis、HornetMQ、RabbitMQ、RocketMQ（没有完全遵守JMS规范)</li></ul></li></ul></li><li><p>AMQP</p><ul><li>AMQP ( advanced message queuing protocol):一种协议（高级消息队列协议，也是消息代理规范），规范了网络交换的数据格式，兼容JMS</li><li>优点:具有跨平台性，服务器供应商，生产者，消费者可以使用不同的语言来实现</li><li>AMQP消息模型<ul><li><strong>direct exchange</strong></li><li>fanout exchange</li><li><strong>topic exchange</strong></li><li>headers exchange</li><li>system exchange</li></ul></li><li>AMQP消息种类:<strong>byte[]</strong></li><li>AMQP实现:RabbitMQ、StormMQ、<strong>RocketMQ</strong></li></ul></li><li><p>MQTT(了解)</p><p>MQTT(Message Queueing Telemetry Transport)消息队列遥测传输，专为小设备设计，是物联网（IOT）生态系统中主要成分之一<br>公</p></li><li><p>Kafka<br>Kafka，一种高吞吐量的分布式发布订阅消息系统，提供实时消息功能。</p></li></ul><h3 id="小案例：短信通知"><a href="#小案例：短信通知" class="headerlink" title="小案例：短信通知"></a>小案例：短信通知</h3><p>场景是：用户下单后处理玩订单后要发短信通知用户</p><p>订单Service</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MessageService messageService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">order</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="comment">//一系列的操作包换各种业务的调用</span></span><br><span class="line">        System.out.println(<span class="string">&quot;订单处理开始！&quot;</span>);</span><br><span class="line">        <span class="comment">//发短信的操作</span></span><br><span class="line">        messageService.sendMessage(id);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;订单处理结束！&quot;</span>);</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>消息service</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">MessageService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;待发送的短信订单已经纳入队列！&quot;</span>+id);</span><br><span class="line">        list.add(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从消息队列中取出来</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> list.remove(<span class="number">0</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;已发送短信的业务&quot;</span>+id);</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>订单controller</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/orders&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">order</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span>&#123;</span><br><span class="line">        orderService.order(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>消息controller</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/msgs&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MessageService messageService;</span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> messageService.doMessage();</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>每完成一次订单后就会有一个待发送的短信进入队列，这时需要调用短信的业务层。</p><h3 id="activeMQ"><a href="#activeMQ" class="headerlink" title="activeMQ:"></a>activeMQ:</h3><p>下载地址:<a href="https://activemq.apache.org/components/classic/download/">https://activemq.apache.org/components/classic/download/</a> </p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220512010652130.png" alt="image-20220512010652130"></p><p><strong>高版本的需要jdk11，下5.16.5只需要jkd8</strong></p><p>解压缩到bin里找到win64或者win32执行批处理文件就可以启动服务</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">activemq.bat</span><br></pre></td></tr></table></figure><p>访问服务器</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1:8161</span><br></pre></td></tr></table></figure><p>服务端口：61616 后台端口：8161</p><p><a href="http://127.0.0.1:8161/">http://127.0.0.1:8161</a></p><p>后台的用户名和密码：admin</p><h3 id="5-11、SpringBoot整合activeamq"><a href="#5-11、SpringBoot整合activeamq" class="headerlink" title="5.11、SpringBoot整合activeamq"></a>5.11、SpringBoot整合activeamq</h3><ul><li>导坐标</li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-activemq<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>做配置</li></ul><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">activemq:</span></span><br><span class="line">    <span class="comment">#ip端口</span></span><br><span class="line">    <span class="attr">broker-url:</span> <span class="string">tcp://localhost:61616</span></span><br><span class="line">  <span class="attr">jms:</span></span><br><span class="line">    <span class="attr">template:</span></span><br><span class="line">      <span class="attr">default-destination:</span> <span class="string">dhj</span></span><br></pre></td></tr></table></figure><ul><li>操作API</li></ul><p>使用<code>JmsTemplate或者JmsMessagingTemplate</code>对象</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageServiceActiveMqImpl</span> <span class="keyword">implements</span> <span class="title class_">MessageService</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line"><span class="comment">//    private JmsTemplate jmsTemplate;</span></span><br><span class="line">    <span class="keyword">private</span> JmsMessagingTemplate jmsTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;待发送的短信订单已经纳入队列！&quot;</span>+id);</span><br><span class="line">        <span class="comment">//将这个id放入消息队列</span></span><br><span class="line"><span class="comment">//        jmsTemplate.convertAndSend(id);</span></span><br><span class="line">        <span class="comment">//前面带一个参数就是指定他的位置</span></span><br><span class="line">        jmsTemplate.convertAndSend(<span class="string">&quot;order.quque.id&quot;</span>,id);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从消息队列中取出来</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doMessage</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//        String  id = (String) jmsTemplate.receiveAndConvert(String.class);</span></span><br><span class="line">        <span class="comment">//前面带一个参数就是指定他的位置，从这个位置取出来</span></span><br><span class="line">        <span class="type">String</span>  <span class="variable">id</span> <span class="operator">=</span> (String) jmsTemplate.receiveAndConvert(<span class="string">&quot;order.quque.id&quot;</span>,String.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;已发送短信的业务&quot;</span>+id);</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>监听器：</p><p>上面的操作，每有一个消息进入消息队列的时候我们需要手动处理，activemq给了我们一个listener监听这我们的消息，有消息的时候就会调用</p></li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageListener</span> &#123;</span><br><span class="line">    <span class="meta">@JmsListener(destination = &quot;order.quque.id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String id)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;已发送短信的业务&quot;</span>+id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样就不需要手动调用了</p><h3 id="5-12、SpringBoot整合RabbitMq"><a href="#5-12、SpringBoot整合RabbitMq" class="headerlink" title="5.12、SpringBoot整合RabbitMq"></a>5.12、SpringBoot整合RabbitMq</h3><p>RabbitMQ</p><ul><li>RabbitMQ基于Erlang语言编写，需要安装Erlang</li><li>Erlang<ul><li>下载地址: <a href="https://www.erlang.org/downloads">https://www.erlang.org/downloads</a></li><li>安装:一键傻瓜式安装，安装完毕需要重启，需要依赖Windows组件环境变量配置</li><li>ERLANG_HOME</li><li>PATH</li></ul></li><li>RabbitMq<ul><li>下载地址：<a href="https://www.rabbitmq.com/download.html">https://www.rabbitmq.com/download.html</a></li></ul></li></ul><p>​下载完毕后：在sbin目录下打开cmd窗口</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220512142342558.png" alt="image-20220512142342558"></p><p>启动服务：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rabbitmq-service.bat start</span><br></pre></td></tr></table></figure><p>关闭服务：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rabbitmq-service.bat stop</span><br></pre></td></tr></table></figure><p>开启一个后台界面 端口<code>15672</code>  </p><p>账号密码：guest</p><ul><li>先开启一个后台管理界面的插件</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rabbitmq-plugins.bat <span class="built_in">enable</span> rabbitmq_management</span><br></pre></td></tr></table></figure><p>查看服务状态</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rabbitmqctl status</span><br></pre></td></tr></table></figure><p>后台界面：<a href="http://localhost:15672/">http://localhost:15672</a></p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220512142657408.png" alt="image-20220512142657408"></p><ul><li>导坐标</li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>做配置</li></ul><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br></pre></td></tr></table></figure><ul><li>代码</li></ul><p>定义消息队列：直连模式</p><h4 id="直连模式"><a href="#直连模式" class="headerlink" title="直连模式"></a>直连模式</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitDirectConfig</span> &#123;</span><br><span class="line"><span class="comment">//    定义一个存储消息的对象</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">getQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//名字,是否持久化，是否专用，是否删除</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;direct_queue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">//交换机</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">getExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(<span class="string">&quot;direct_exchange&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">//队列绑定交换机</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(getQueue()).to(getExchange()).with(<span class="string">&quot;direct&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>生产与消费信息 使用**<code>amqpTemplate对象</code>**可以直接<code>Autowired</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageServiceRabbitMqImpl</span> <span class="keyword">implements</span> <span class="title class_">MessageService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AmqpTemplate amqpTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;待发送短信的订单已经纳入处理队列 ===&gt;rabbitmq_direct id: &quot;</span> + id);</span><br><span class="line">        <span class="comment">//交换机的名称，绑定的名称，发送的信息</span></span><br><span class="line">        amqpTemplate.convertAndSend(<span class="string">&quot;direct_exchange&quot;</span>,<span class="string">&quot;direct&quot;</span>,id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>监听器</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageListenerRabbitMq</span> &#123;</span><br><span class="line">    <span class="comment">//队列的名字</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;direct_queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;已发送短信的业务(rabbitmq quque direct)id: &quot;</span> + id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="topic模式"><a href="#topic模式" class="headerlink" title="topic模式"></a>topic模式</h4><p>配置：定义消息队列</p><p>绑定键匹配规则</p><ul><li><p>*(星号):用来表示一个单词，且该单词是必须出现的</p></li><li><p>#(井号):用来表示任意数量</p></li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitTopicConfig</span> &#123;</span><br><span class="line"><span class="comment">//    定义一个存储消息的对象</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">getQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//名字,是否持久化，是否专用，是否删除</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;topic_queue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">//交换机</span></span><br><span class="line">    <span class="keyword">public</span> TopicExchange <span class="title function_">getExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TopicExchange</span>(<span class="string">&quot;topic_exchange&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">//队列绑定交换机</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(getQueue()).to(getExchange()).with(<span class="string">&quot;topic.*.id&quot;</span>);</span><br><span class="line">        <span class="comment">//这里的with可以取别名</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>监听器：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageListenerRabbitMq</span> &#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;topic_queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;已发送短信的业务(rabbitmq quque topic)id: &quot;</span> + id);</span><br><span class="line">        System.out.println(<span class="string">&quot;=================================&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实现类：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageServiceRabbitMqImpl</span> <span class="keyword">implements</span> <span class="title class_">MessageService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AmqpTemplate amqpTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;待发送短信的订单已经纳入处理队列 ===&gt;rabbitmq_topic id: &quot;</span> + id);</span><br><span class="line">        amqpTemplate.convertAndSend(<span class="string">&quot;topic_exchange&quot;</span>,<span class="string">&quot;topic.order.id&quot;</span>,id);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-13、SpringBoot整合RocketMQ"><a href="#5-13、SpringBoot整合RocketMQ" class="headerlink" title="5.13、SpringBoot整合RocketMQ"></a>5.13、SpringBoot整合RocketMQ</h3><p>下载地址:<a href="https://rocketmq.apache.org/">https://rocketmq.apache.org</a></p><p>安装:解压缩</p><p>默认服务端口:9876</p><p>环境变量配置:</p><ul><li><strong>PATH</strong></li><li><strong>NAMESRV_ADDR</strong>（建议): 127.0.0.1:9876</li><li><strong>ROCKETMQ_HOME</strong></li></ul><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220513144359716.png" alt="image-20220513144359716"></p><p>先启动命名服务器：</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220513144628714.png" alt="image-20220513144628714"></p><p>再启动业务服务器</p><p><code>mqbroker.cmd</code></p><p>测试是否能正常运行</p><p>在lib下有一个专门测试的jar包<code>rocketmq-example-4.9.3.jar</code></p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220513145128980.png" alt="image-20220513145128980"></p><p>如何运行，用bin下的tools. 生产一千条消息</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">D:\mysoftware\rocketmq-4.9.3\bin&gt;tools org.apache.rocketmq.example.quickstart.Producer</span><br></pre></td></tr></table></figure><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220513150029316.png" alt="image-20220513150029316"></p><p>消费一些消息</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">D:\mysoftware\rocketmq-4.9.3\bin&gt;tools org.apache.rocketmq.example.quickstart.Consumer</span><br></pre></td></tr></table></figure><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220513150058438.png" alt="image-20220513150058438"></p><ul><li>导坐标</li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.rocketmq/rocketmq-spring-boot-starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.rocketmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rocketmq-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>配置：</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#rocketmq的配置</span></span><br><span class="line"><span class="attr">rocketmq:</span></span><br><span class="line">  <span class="attr">name-server:</span> <span class="string">localhost:9876</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  生产者的分组</span></span><br><span class="line">  <span class="attr">producer:</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">group_dhj</span></span><br></pre></td></tr></table></figure><p>代码：</p><p>主要是注入一个<code>RocketMQTemplate</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageRocketMqServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">MessageService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RocketMQTemplate rocketMQTemplate;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;待发送的短信订单已经纳入队列(rocketMq)！&quot;</span>+id);</span><br><span class="line"><span class="comment">//        rocketMQTemplate.convertAndSend(&quot;order_id&quot;,id);</span></span><br><span class="line">        <span class="type">SendCallback</span> <span class="variable">sendCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSuccess</span><span class="params">(SendResult sendResult)</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;消息发送成功===&gt;&quot;</span>+sendResult.toString());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onException</span><span class="params">(Throwable throwable)</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;消息发送失败！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//异步的方式来发送消息</span></span><br><span class="line">        rocketMQTemplate.asyncSend(<span class="string">&quot;order_id&quot;</span>,id,sendCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>监听：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RocketMQMessageListener(topic = &quot;order_id&quot;,consumerGroup = &quot;group_dhj&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RocketMqListener</span> <span class="keyword">implements</span> <span class="title class_">RocketMQListener</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;已发送短信的业务(RocketMq)&quot;</span> + id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-14、SpringBoot整合Kafka"><a href="#5-14、SpringBoot整合Kafka" class="headerlink" title="5.14、SpringBoot整合Kafka"></a>5.14、SpringBoot整合Kafka</h3><p>Kafka</p><p>文档：<a href="https://kafka.apachecn.org/">Kafka 中文文档 - ApacheCN</a></p><p>下载地址:<a href="https://kafka.apache.org/downloads">https://kafka.apache.org/downloads</a></p><p>国内的镜像源：<a href="https://mirrors.tuna.tsinghua.edu.cn/apache/kafka/2.8.1/">Index of &#x2F;apache&#x2F;kafka&#x2F;2.8.1 (tsinghua.edu.cn)</a></p><p>windows系统下3.0.0版本存在BUG，建议使用2.X版本</p><ul><li><p>启动kafka服务器</p></li><li><p>先启动注册中心</p></li></ul><p>端口：2181</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">D:\mysoftware\kafka_2.12-2.8.1\bin\windows&gt;zookeeper-server-start.bat ../../config/zookeeper.properties</span><br></pre></td></tr></table></figure><ul><li>在启动服务</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">D:\mysoftware\kafka_2.12-2.8.1\bin\windows&gt;kafka-server-start.bat ../../config/server.properties</span><br></pre></td></tr></table></figure><p>端口：9092</p><p>测试：</p><p>创建一个topic</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kafka-topics.bat --zookeeper localhost:2181 --create --replication-factor 1 --partitions 1 --topic dhj_topic</span><br></pre></td></tr></table></figure><p>查看topic分区</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kafka-topics.bat --zookeeper localhost:2181 --list</span><br></pre></td></tr></table></figure><p>删除topic</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kafka-topics.bat --delete --zookeeper localhost:2181 --topic dhj_topic</span><br></pre></td></tr></table></figure><p>Kafka</p><ul><li><p>生产者功能测试</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kafka-console-producer.bat --broker-list localhost:9092 --topic dhj_topic</span><br></pre></td></tr></table></figure></li><li><p>消费者功能测测试</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kafka-console-consumer.bat --bootstrap-server localhost:9092 --topic dhj_topic --from-beginning</span><br></pre></td></tr></table></figure></li></ul><p>导坐标</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--       kafka--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>做配置</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#kafka</span></span><br><span class="line"><span class="attr">kafka:</span></span><br><span class="line">  <span class="attr">bootstrap-servers:</span> <span class="string">localhost:9092</span></span><br><span class="line">  <span class="attr">consumer:</span></span><br><span class="line">    <span class="attr">group-id:</span> <span class="string">order</span></span><br></pre></td></tr></table></figure><p>service实现类：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageServiceKafkaImpl</span> <span class="keyword">implements</span> <span class="title class_">MessageService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> KafkaTemplate&lt;String,String&gt; kafkaTemplate;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;待发送的短信订单已经纳入队列！(kafka)&quot;</span>+id);</span><br><span class="line">        kafkaTemplate.send(<span class="string">&quot;dhj_topic&quot;</span>,id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>监听器：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageListener</span> &#123;</span><br><span class="line">    <span class="meta">@KafkaListener(topics = &quot;dhj_topic&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doMessage</span><span class="params">(ConsumerRecord&lt;String,String&gt; record)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;已发送短信的业务(kafka)&quot;</span>+record.value());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h2><p>监控的实施方式</p><ul><li>显示监控信息的服务器︰用于获取服务信息，并显示对应的信息</li><li>运行的服务:启动时主动上报，告知监控服务器自己需要受到监控</li></ul><h3 id="5-15、可视化监控平台"><a href="#5-15、可视化监控平台" class="headerlink" title="5.15、可视化监控平台"></a>5.15、可视化监控平台</h3><p>Spring Boot Admin，开源社区项目，用于管理和监控SpringBoot应用程序。客户端注册到服务端后，通过HTTP请求方式，服务端定期从客户端获取对应的信息，并通过UI界面展示对应信息。</p><ul><li>导坐标</li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-starter-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 这个版本要和你的springboot的版本对应--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>开启  用 <code>@EnableAdminServer</code>注解开启服务</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableAdminServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application20Server</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(Application20Server.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>创建一个被监控的应用</p><ul><li>导依赖</li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-starter-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 这个版本要和你的springboot的版本对应--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>配置</li></ul></li></ul><p>​<img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220515160620619.png" alt="image-20220515160620619"></p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">boot:</span></span><br><span class="line">    <span class="attr">admin:</span></span><br><span class="line">      <span class="attr">client:</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">http://localhost:8080</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="attr">health:</span></span><br><span class="line">      <span class="attr">show-details:</span> <span class="string">always</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure><h3 id="自定义端点信息"><a href="#自定义端点信息" class="headerlink" title="自定义端点信息"></a>自定义端点信息</h3><p>在客户端创建一个类实现<code>InfoContributor</code>将该类变为一个bean<code>@component</code>让springboot加载到，同时在配置文件中添加一个info开启</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220521145257619.png" alt="image-20220521145257619"></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Config</span> <span class="keyword">implements</span> <span class="title class_">InfoContributor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contribute</span><span class="params">(Info.Builder builder)</span> &#123;</span><br><span class="line">        builder.withDetail(<span class="string">&quot;nowTime&quot;</span>, LocalTime.now());</span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;buildTime&quot;</span>,<span class="string">&quot;2022&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;company&quot;</span>,<span class="string">&quot;Null&quot;</span>);</span><br><span class="line">        builder.withDetails(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>让后在web端就可以看到了！</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220521145337771.png" alt="image-20220521145337771"></p><h4 id="健康类的信息"><a href="#健康类的信息" class="headerlink" title="健康类的信息"></a>健康类的信息</h4><p>可以继承<code>AbstractHealthIndicator</code>类</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HealthConfig</span> <span class="keyword">extends</span> <span class="title class_">AbstractHealthIndicator</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doHealthCheck</span><span class="params">(Health.Builder builder)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="性能的信息meterRegist"><a href="#性能的信息meterRegist" class="headerlink" title="性能的信息meterRegist"></a>性能的信息meterRegist</h4><p>假设执行一次删除就是付款操作 我们要监控这个付款操作</p><p>在构造方法中注入一个meterRegist  </p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Counter counter;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">BookController</span><span class="params">(MeterRegistry registry)</span>&#123;</span><br><span class="line">    counter = registry.counter(<span class="string">&quot;用户付费次数&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@DeleteMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">deleteByid</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">        counter.increment();<span class="comment">//自增</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">R</span>(service.removeById(id));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>当然这个时业务层应当写在业务层</p><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220521151904450.png" alt="image-20220521151904450"></p><h4 id="自定义的端点"><a href="#自定义的端点" class="headerlink" title="自定义的端点"></a>自定义的端点</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Endpoint(id = &quot;pay&quot;,enableByDefault = true)</span><span class="comment">//到时候就访问这个端点http://localhost:81/actuator/pay</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayEndPoint</span> &#123;</span><br><span class="line">    <span class="meta">@ReadOperation</span><span class="comment">//到时候就访问这个端点http://localhost:81/actuator/pay就会运行这个方法返回这个值</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">pay</span><span class="params">()</span>&#123;</span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;level1&quot;</span>,<span class="number">100</span>);</span><br><span class="line">        map.put(<span class="string">&quot;level2&quot;</span>,<span class="number">1001</span>);</span><br><span class="line">        map.put(<span class="string">&quot;level3&quot;</span>,<span class="number">1003</span>);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">        <span class="comment">//map可以被转成json数据</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/29/SpringBoot%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E7%AF%87/image-20220521153001044.png" alt="image-20220521153001044"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;SpringBoot开发实用篇&quot;&gt;&lt;a href=&quot;#SpringBoot开发实用篇&quot; class=&quot;headerlink&quot; title=&quot;SpringBoot开发实用篇&quot;&gt;&lt;/a&gt;SpringBoot开发实用篇&lt;/h1&gt;&lt;h1 id=&quot;目录：&quot;&gt;&lt;a href=</summary>
      
    
    
    
    
    <category term="SpringBoot" scheme="http://daihaojun554.github.io/tags/SpringBoot/"/>
    
    <category term="开发使用篇" scheme="http://daihaojun554.github.io/tags/%E5%BC%80%E5%8F%91%E4%BD%BF%E7%94%A8%E7%AF%87/"/>
    
    <category term="整合第三方技术" scheme="http://daihaojun554.github.io/tags/%E6%95%B4%E5%90%88%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>springboot运维篇</title>
    <link href="http://daihaojun554.github.io/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/"/>
    <id>http://daihaojun554.github.io/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/</id>
    <published>2022-04-27T15:12:34.000Z</published>
    <updated>2022-04-28T13:49:48.853Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringBoot运维篇"><a href="#SpringBoot运维篇" class="headerlink" title="SpringBoot运维篇"></a>SpringBoot运维篇</h1><h1 id="一、springboot项目的打包"><a href="#一、springboot项目的打包" class="headerlink" title="一、springboot项目的打包"></a>一、springboot项目的打包</h1><h2 id="1-1、Window版："><a href="#1-1、Window版：" class="headerlink" title="1.1、Window版："></a>1.1、Window版：</h2><p>打包的方式：</p><p>jar,war</p><p>1、打包:spring-boot-maven-plugin 这个插件就是专门用来打包的</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.dhj.ssmp.Application<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427151705586.png" alt="image-20220427151705586"></p><p>点一下这个package这个就会再target里生成一个jar包</p><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427151932926.png" alt="image-20220427151932926"></p><p>执行这个的时候会进行测试，可以自行取消掉测试</p><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427152049555.png" alt="image-20220427152049555"></p><p>这个时候在打包，就不会执行测试了</p><p>注意打包出来后一定要看看jar包里的文件配置</p><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427152936672.png" alt="image-20220427152936672"></p><p>点开</p><p><strong><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427152956595.png" alt="image-20220427152956595"></strong></p><p>查看这个配置文件：</p><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427153017785.png" alt="image-20220427153017785"></p><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427153056574.png" alt="image-20220427153056574"></p><p>看这里面的Start-Class的值是不是为你的java代码的主程序的类名</p><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427153207480.png" alt="image-20220427153207480"></p><p>不是的话改一下，是的话就不用管</p><p>这样在控制台就可以，java -jar XXX.jar </p><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427153332244.png" alt="image-20220427153332244"></p><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427151338520.png" alt="image-20220427151338520"></p><ul><li>#查询端口</li></ul><p>​netstat -ano</p><ul><li><p>#查询指定端口<br>netstat -ano |findstr“端口号”</p></li><li><p>#根据进程PID查询进程名称<br>tasklist |findstr”进程PID号”</p></li><li><p>#根据PID杀死任务<br>taskkill &#x2F;F&#x2F;PID”进程PID号”</p></li><li><p>#根据进程名称杀死任务<br>taskkill -f -t -im”进程名称”</p></li></ul><h2 id="1-2、linux版："><a href="#1-2、linux版：" class="headerlink" title="1.2、linux版："></a>1.2、linux版：</h2><p>在linux中创建好环境</p><ul><li>java jdk1.8</li><li>mysql或者是mariadb</li></ul><p>然后将配置文件改一下:你的linux的ip地址和数据库的名字将打好的jar包上传到服务器</p><p>记得改一下yml的配置文件:</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.59.100:3306/springboot?useSSL=false&amp;characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">81</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">table-prefix:</span> <span class="string">tb_</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427161347732.png" alt="image-20220427161347732"></p><p>同样的java -jar XXX.jar 然后就可以运行了</p><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427161500963.png" alt="image-20220427161500963"></p><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427161534749.png" alt="image-20220427161534749"></p><p>功能都ok!</p><h3 id="1-2-1、后台启动的命令"><a href="#1-2-1、后台启动的命令" class="headerlink" title="1.2.1、后台启动的命令"></a>1.2.1、后台启动的命令</h3><p>nohup java -jar XXX.jar &gt;server.log 2&gt;&amp;1 &amp;</p><p>查询后台的进程:</p><p>ps -ef|grep “java -jar”</p><p>结束进程：</p><p>kill -9 pid</p><h3 id="1-2-2、临时的属性"><a href="#1-2-2、临时的属性" class="headerlink" title="1.2.2、临时的属性"></a>1.2.2、临时的属性</h3><p>1．使用jar命令启动SpringBoot工程时可以使用临时属性替换配置文件中的属性<br>2．临时属性添加方式:java -jar工程名.jar –属性名&#x3D;值<br>3．多个临时属性之间使用空格分隔<br>4．临时属性必须是当前boot工程支持的属性，否则设置无效</p><p>java -jar XXX.jar – server.port&#x3D;8080 – xx&#x3D;xx –</p><h3 id="1-2-3、临时属性在IDEA中设置"><a href="#1-2-3、临时属性在IDEA中设置" class="headerlink" title="1.2.3、临时属性在IDEA中设置"></a>1.2.3、临时属性在IDEA中设置</h3><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427164148344.png" alt="image-20220427164148344"></p><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427164248108.png" alt="image-20220427164248108"></p><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427164340508.png" alt="image-20220427164340508"></p><p>再次运行：</p><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427164408417.png" alt="image-20220427164408417"></p><p>可以在运行的主程序中不要args参数这样就设置了不接受外界传参</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    SpringApplication.run(SSMApplication.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="二、配置文件的四级分类"><a href="#二、配置文件的四级分类" class="headerlink" title="二、配置文件的四级分类"></a>二、配置文件的四级分类</h1><p>1、在resource目录下的：application.yml文件的等级最低</p><p>2、在resource目录下的：创建一个config 目录再把application.yml配置文件放到config目录,这个配置文件的等级比你在resource目录下的application.yml高一级</p><p>3、在你jar包的同级目录下的application.yml 里面的所有配置文件都会覆盖掉你开发时所用的配置文件</p><p>4、在你jar包的同级目录下的config目录下的application.yml配置文件是最高的</p><ol><li><p>SpringBoot中4级配置文件<br>   1级: file : config&#x2F; application.yml【最高】<br> 2级: file : application.yml<br> 3级: classpath: config&#x2F;application.yml<br> 4级: classpath: application.yml【最低】</p></li><li><p>作用:</p><ul><li>1级与2级留做系统打包后设置通用属性，1级常用于运维经理进行线上整体项目部署方案调控</li><li>3级与4级用于系统开发阶段设置通用属性，3级常用于项目经理进行整体项目属性调控</li></ul></li></ol><p>使用–spring.config.name&#x3D;文件名。可以让配置文件不再叫application.yml也能生效</p><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427171033676.png" alt="image-20220427171033676"></p><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427171054117.png" alt="image-20220427171054117"></p><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220427171116676.png" alt="image-20220427171116676"></p><p>也可以写：–spring.config.location&#x3D;”全路径名字”</p><h1 id="三、多环境开发"><a href="#三、多环境开发" class="headerlink" title="三、多环境开发"></a>三、多环境开发</h1><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">online</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">pro</span></span><br><span class="line"><span class="attr">server:</span> </span><br><span class="line">  <span class="attr">port:</span> <span class="number">81</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">82</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">activate:</span></span><br><span class="line">      <span class="attr">on-profile:</span> <span class="string">online</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">83</span></span><br><span class="line">  </span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-1、多环境注意事项-1-："><a href="#3-1、多环境注意事项-1-：" class="headerlink" title="3.1、多环境注意事项(1)："></a>3.1、多环境注意事项(1)：</h2><p>1.多环境开发需要设置若干种常用环境，例如开发、生产、测试环境</p><p>2.yaml(yml)格式中设置多环境使用”—“区分环境设置边界</p><p>3.每种环境的区别在于加载的配置属性不同</p><p>4.启用某种环境时需要指定启动时使用该环境</p><h2 id="3-2、多环境的独立配置文件书写技巧"><a href="#3-2、多环境的独立配置文件书写技巧" class="headerlink" title="3.2、多环境的独立配置文件书写技巧"></a>3.2、多环境的独立配置文件书写技巧</h2><p>根据功能对配置文件中的信息进行拆分，并制作成独立的配置文件，</p><p>命名规则如下：</p><ul><li><p>application-devDB.yml</p></li><li><p>application-devRedis.yml </p></li><li><p>application-devMVC.yml</p></li></ul><p>使用include属性在激活指定环境的情况下，同时对多个环境进行加载使其生效，多个环境间使用逗号分隔</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">profiles:</span></span><br><span class="line"><span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">include:</span> <span class="string">devDB,devRedis,devMVC</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">profiles:</span></span><br><span class="line"><span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">group:</span></span><br><span class="line"><span class="string">&quot;dev&quot;</span> <span class="string">:</span> <span class="string">devDB,</span> <span class="string">devRedis</span> <span class="string">,</span> <span class="string">devMVC</span></span><br><span class="line"><span class="string">&quot;pro&quot;</span> <span class="string">:</span> <span class="string">proDB</span> <span class="string">,</span> <span class="string">proRedis</span> <span class="string">,proMVC</span></span><br><span class="line"><span class="attr">&quot;test&quot;:</span> <span class="string">testDB,testRedis,testMVC</span></span><br></pre></td></tr></table></figure><h2 id="3-3、多环境配置的注意事项-2"><a href="#3-3、多环境配置的注意事项-2" class="headerlink" title="3.3、多环境配置的注意事项(2):"></a>3.3、多环境配置的注意事项(2):</h2><p>1．当Maven与SpringBoot同时对多环境进行控制时，以Mavn为主，SpringBoot使用@..@占位符读取Maven对应的配置属性值</p><p>2．基于SpringBoot读取Maven配置属性的前提下，如果在Idea下测试工程时pom. xml每次更新需要手动compile方可生效</p><h2 id="3-4、日志"><a href="#3-4、日志" class="headerlink" title="3.4、日志"></a>3.4、日志</h2><h3 id="3-4-1、日志基础"><a href="#3-4-1、日志基础" class="headerlink" title="3.4.1、日志基础"></a>3.4.1、日志基础</h3><p>日志（ log）作用：</p><ul><li>编程期调试代码运营期记录信息</li><li>记录运维过程数据(扩容、宕机、报警……)</li><li>记录日常运营重要信息（峰值流量、平均响应时长……)记录应用报错信息（错误堆栈)</li></ul><p>日志级别：</p><ul><li><p>TRACE:运行堆栈信息，使用率低</p></li><li><p>DEBUG:程序员调试代码使用</p></li><li><p>INFO:记录运维过程数据</p></li><li><p>WARN:记录运维过程报警数据</p></li><li><p>ERROR∶记录错误堆栈信息</p></li><li><p>FATAL:灾难信息，合并计入ERROR</p></li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line"><span class="comment">//创建记录日志的对象</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(BookController.class);</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Hello</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;info...&quot;</span>);</span><br><span class="line">        log.error(<span class="string">&quot;error...&quot;</span>);</span><br><span class="line">        log.debug(<span class="string">&quot;debug...&quot;</span>); </span><br><span class="line">        log.trace(<span class="string">&quot;trace...&quot;</span>); <span class="comment">//堆栈信息，级别太低没人用</span></span><br><span class="line">        log.warn(<span class="string">&quot;warn...&quot;</span>);    </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>建议这样配置：</p><p>在yml文件中写</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line"><span class="comment">#设置分组</span></span><br><span class="line">  <span class="attr">group:</span></span><br><span class="line">    <span class="attr">dhj:</span> <span class="string">com.dhj.controller,com.dhj.service,com.dhj.dao,com.dhj.pojo</span></span><br><span class="line">    <span class="attr">alibaba:</span> <span class="string">com.alibaba</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">  <span class="comment"># 设置日志的级别</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">debug</span></span><br><span class="line">    <span class="attr">dhj:</span> <span class="string">info</span></span><br><span class="line">    <span class="attr">ailibaba:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure><p>在类上加上<code>@Slf4j</code>注解可以快速添加日志对象</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;info...&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-2、日志输出格式控制"><a href="#3-4-2、日志输出格式控制" class="headerlink" title="3.4.2、日志输出格式控制"></a>3.4.2、日志输出格式控制</h3><p>在yml中配置</p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="comment">#时间-(clr:颜色) - (%5p)五个字符的日志级别---[%10t]十个字符的线程名 带颜色的40个字符的类名：消息，换行</span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">&quot;%d-%clr(%5p)---[%10t] %clr(%-40.40c)&#123;cyan&#125; : %msg:%n&quot;</span></span><br></pre></td></tr></table></figure><h3 id="3-4-3、日志文件"><a href="#3-4-3、日志文件" class="headerlink" title="3.4.3、日志文件"></a>3.4.3、日志文件</h3><p>直接在配置文件里配置：</p><p><strong><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220428203325426.png" alt="image-20220428203325426"></strong></p><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="comment">#时间-消息</span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">&quot;%d-%clr(%5p)---[%10t] %clr(%-40.40c)&#123;cyan&#125; : %msg:%n&quot;</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">server.log</span></span><br><span class="line">    <span class="comment">#日志的名字</span></span><br><span class="line">    <span class="attr">max-size:</span> <span class="string">4KB</span></span><br></pre></td></tr></table></figure><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220428203430129.png" alt="image-20220428203430129"></p><table><thead><tr><th>日志输出格式：<br>%d 表示日期时间，<br>%thread 表示线程名，<br>%-5level:级别从左显示5个字符宽度<br>%logger{50}  表示logger名字最长50个字符，否则按照句点分割。 <br>%msg: 日志消息，<br>%n 是换行符<br>   –&gt;<br>   %d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</th></tr></thead></table><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">server.log</span></span><br><span class="line">    <span class="comment">#时间-消息</span></span><br><span class="line">      <span class="attr">max-size:</span> <span class="string">3KB</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">&quot;%d-%clr(%5p)---[%10t] %clr(%-40.40c)&#123;cyan&#125; : %msg:%n&quot;</span></span><br><span class="line">    <span class="comment">#设置滚动的日志记录</span></span><br><span class="line">    <span class="comment">#当文件日志达到一定大小的时候就会重新创建一个文件存放日志</span></span><br><span class="line">    <span class="attr">rolling-file-name:</span> <span class="string">server.%d.%i.log</span></span><br></pre></td></tr></table></figure><p><img src="/2022/04/27/springboot%E8%BF%90%E7%BB%B4%E7%AF%87/image-20220428214340376.png" alt="image-20220428214340376"></p><p>运维篇告一段落;但是没完！</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;SpringBoot运维篇&quot;&gt;&lt;a href=&quot;#SpringBoot运维篇&quot; class=&quot;headerlink&quot; title=&quot;SpringBoot运维篇&quot;&gt;&lt;/a&gt;SpringBoot运维篇&lt;/h1&gt;&lt;h1 id=&quot;一、springboot项目的打包&quot;&gt;&lt;a</summary>
      
    
    
    
    
    <category term="springboot" scheme="http://daihaojun554.github.io/tags/springboot/"/>
    
    <category term="运维" scheme="http://daihaojun554.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
  </entry>
  
  <entry>
    <title>vue初识</title>
    <link href="http://daihaojun554.github.io/2022/04/25/vue%E5%88%9D%E8%AF%86/"/>
    <id>http://daihaojun554.github.io/2022/04/25/vue%E5%88%9D%E8%AF%86/</id>
    <published>2022-04-24T23:39:33.000Z</published>
    <updated>2022-06-17T06:46:51.722Z</updated>
    
    <content type="html"><![CDATA[<h1 id="一、vue"><a href="#一、vue" class="headerlink" title="一、vue"></a>一、vue</h1><h2 id="1-1、vue数据驱动试图"><a href="#1-1、vue数据驱动试图" class="headerlink" title="1.1、vue数据驱动试图"></a>1.1、vue数据驱动试图</h2><div id="counter">                        <br>            <span v-bind:title="message"> 鼠标悬停几秒钟查看此处动态绑定的提示信息！</span>            <button v-on:click="plus10">加10</button>        </div><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Counter</span> = &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">counter</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">message</span>:<span class="string">&#x27;You loaded this page on &#x27;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toLocaleString</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">counter</span>++</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>:&#123;</span><br><span class="line">  <span class="title function_">plus10</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">counter</span>=<span class="variable language_">this</span>.<span class="property">counter</span>+<span class="number">10</span></span><br><span class="line">  &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">createApp</span>(<span class="title class_">Counter</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#counter&#x27;</span>)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="1-2、Vue-还提供了-v-model-指令，它能轻松实现表单输入和应用状态之间的双向绑定。"><a href="#1-2、Vue-还提供了-v-model-指令，它能轻松实现表单输入和应用状态之间的双向绑定。" class="headerlink" title="1.2、Vue 还提供了 v-model 指令，它能轻松实现表单输入和应用状态之间的双向绑定。"></a>1.2、Vue 还提供了 <code>v-model</code> 指令，它能轻松实现表单输入和应用状态之间的双向绑定。</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">TwoWayBinding</span> = &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;Hello Vue!&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">createApp</span>(<span class="title class_">TwoWayBinding</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#two-way-binding&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;two-way-binding&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;message&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-3、三元运算和条件判断"><a href="#1-3、三元运算和条件判断" class="headerlink" title="1.3、三元运算和条件判断"></a>1.3、三元运算和条件判断</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;counter%2==0?true:false&quot;</span>&gt;</span>现在你看到我了<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-4、for循环"><a href="#1-4、for循环" class="headerlink" title="1.4、for循环"></a>1.4、for循环</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in todos&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span>&#123;&#123;item.text&#125;&#125;<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="attr">counter</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">message</span>: <span class="string">&#x27;You loaded this page on &#x27;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toLocaleString</span>(),</span><br><span class="line"><span class="attr">todos</span>: [</span><br><span class="line">&#123;<span class="attr">text</span>: <span class="string">&#x27;Learn JavaScript&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="attr">text</span>: <span class="string">&#x27;Learn Vue&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="attr">text</span>: <span class="string">&#x27;Build something awesome&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="attr">text</span>: <span class="string">&#x27;Learn JavaScript2&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="attr">text</span>: <span class="string">&#x27;Learn Vue2&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="attr">text</span>: <span class="string">&#x27;Build something awesome2&#x27;</span>&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><img src="/2022/04/25/vue%E5%88%9D%E8%AF%86/image-20220418200144503.png" alt="image-20220418200144503"></p><h2 id="1-5、渲染html"><a href="#1-5、渲染html" class="headerlink" title="1.5、渲染html"></a>1.5、渲染html</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">&#123;&#123;html1&#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-html</span>=<span class="string">&quot;html1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">const</span> root=&#123;   </span><br><span class="line"><span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">return</span>&#123;</span><br><span class="line"><span class="attr">data1</span>:<span class="string">&quot;data1111111111111&quot;</span>,</span><br><span class="line"><span class="attr">html1</span>:<span class="string">&quot;&lt;h1&gt;我是一级标题&lt;/h1&gt;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">methods</span>:&#123;</span><br><span class="line"><span class="title function_">method1</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> app=<span class="title class_">Vue</span>.<span class="title function_">createApp</span>(root)</span><br><span class="line"><span class="keyword">const</span> vm = app.<span class="title function_">mount</span>(<span class="string">&quot;#app&quot;</span>)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/25/vue%E5%88%9D%E8%AF%86/image-20220418213531941.png" alt="image-20220418213531941"></p><h1 id="二、组件化应用构建"><a href="#二、组件化应用构建" class="headerlink" title="二、组件化应用构建"></a>二、组件化应用构建</h1><p><img src="/2022/04/25/vue%E5%88%9D%E8%AF%86/image-20220418200501123.png" alt="image-20220418200501123"></p><h2 id="2-1、定义一个组件"><a href="#2-1、定义一个组件" class="headerlink" title="2.1、定义一个组件"></a>2.1、定义一个组件</h2><h1 id="三、计算属性"><a href="#三、计算属性" class="headerlink" title="三、计算属性"></a>三、计算属性</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">const</span> root = &#123;</span><br><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="attr">data1</span>: <span class="string">&quot;data1111111111111&quot;</span>,</span><br><span class="line"><span class="attr">html1</span>: <span class="string">&quot;&lt;h1&gt;我是一级标题&lt;/h1&gt;&quot;</span>,</span><br><span class="line"><span class="attr">author</span>: &#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;John Doe&#x27;</span>,</span><br><span class="line"><span class="attr">books</span>: [</span><br><span class="line"><span class="string">&#x27;Vue 2 - Advanced Guide&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Vue 3 - Basic Guide&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Vue 4 - The Mystery&#x27;</span></span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">author</span>.<span class="property">books</span>.<span class="property">length</span>++;</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line"><span class="title function_">publishBooks</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">author</span>.<span class="property">books</span>.<span class="property">length</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line"><span class="title function_">method1</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> app = <span class="title class_">Vue</span>.<span class="title function_">createApp</span>(root)</span><br><span class="line"><span class="keyword">const</span> vm = app.<span class="title function_">mount</span>(<span class="string">&quot;#app&quot;</span>)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><div id="app">                        <div v-html="html1"></div>            <hr>            <p>How Many books has he published :</p>            <span></span>        </div><p><img src="/2022/04/25/vue%E5%88%9D%E8%AF%86/image-20220418221653056.png" alt="image-20220418221653056"></p><p>&#x2F;&#x2F;computed有缓存</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;一、vue&quot;&gt;&lt;a href=&quot;#一、vue&quot; class=&quot;headerlink&quot; title=&quot;一、vue&quot;&gt;&lt;/a&gt;一、vue&lt;/h1&gt;&lt;h2 id=&quot;1-1、vue数据驱动试图&quot;&gt;&lt;a href=&quot;#1-1、vue数据驱动试图&quot; class=&quot;header</summary>
      
    
    
    
    
    <category term="框架" scheme="http://daihaojun554.github.io/tags/%E6%A1%86%E6%9E%B6/"/>
    
    <category term="vue" scheme="http://daihaojun554.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>Ajax请求</title>
    <link href="http://daihaojun554.github.io/2022/04/23/Ajax%E8%AF%B7%E6%B1%82/"/>
    <id>http://daihaojun554.github.io/2022/04/23/Ajax%E8%AF%B7%E6%B1%82/</id>
    <published>2022-04-22T23:50:03.000Z</published>
    <updated>2022-06-13T17:13:44.802Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Ajax请求："><a href="#Ajax请求：" class="headerlink" title="Ajax请求："></a>Ajax请求：</h1><h2 id="1、url参数"><a href="#1、url参数" class="headerlink" title="1、url参数"></a>1、url参数</h2><p>具体就是你的请求的地址，你需要向哪里发请求 sting类型</p><h2 id="2、type参数"><a href="#2、type参数" class="headerlink" title="2、type参数"></a>2、type参数</h2><p>就是你请求的类型 post还是get还是其他的某种 string类型</p><h2 id="3、data参数："><a href="#3、data参数：" class="headerlink" title="3、data参数："></a>3、data参数：</h2><p>是你在请求行中的带的参数 以？的形式传的参 是个列表**{key:value}**</p><p>这里的参数你可以通过后端的 **<code>req.getParameter(&quot;key&quot;)</code>**来获取</p><h2 id="4、success参数："><a href="#4、success参数：" class="headerlink" title="4、success参数："></a>4、success参数：</h2><p>请求成功后的操作，是个方法，方法里可以带参数，可以是从服务器中返回的数据</p><h2 id="5、error参数："><a href="#5、error参数：" class="headerlink" title="5、error参数："></a>5、error参数：</h2><p>请求失败后的操作，是个方法，里面可以有三个参数</p><p> 即:</p><ul><li>XMLHttpRequest对象，</li><li>错误信息</li><li>捕获的错误对象</li></ul><h2 id="6、contentType参数："><a href="#6、contentType参数：" class="headerlink" title="6、contentType参数："></a>6、contentType参数：</h2><p>给响应头里的类型设置值  </p><p>例如这种：</p><p><img src="/2022/04/23/Ajax%E8%AF%B7%E6%B1%82/image-20220423001027716.png" alt="image-20220423001027716"></p><h2 id="7、datatype参数："><a href="#7、datatype参数：" class="headerlink" title="7、datatype参数："></a>7、datatype参数：</h2><p>从服务器中返回来的数据的类型</p><p>有”json”,”text”,”xml”,”html”等等</p><h2 id="8、BeforSend参数："><a href="#8、BeforSend参数：" class="headerlink" title="8、BeforSend参数："></a>8、BeforSend参数：</h2><p>要求为function类型 用于在向服务器发送请求前添加一些处理函数。</p><p>这是一个ajax事件，在ajax请求开始之前就被触发，通常允许用户修改XMLHttpRequest对象（比如说设置附加的头部信息）如token</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="comment">//这里的参数有</span></span><br><span class="line">    <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/demo/testController&quot;</span>,</span><br><span class="line">    <span class="attr">type</span>:<span class="string">&quot;GET&quot;</span>or<span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>:&#123;<span class="string">&quot;key&quot;</span>:value&#125;,</span><br><span class="line">    <span class="attr">success</span>:<span class="keyword">function</span>(<span class="params">result,textStatus</span>)&#123;</span><br><span class="line">    <span class="comment">//这里的result是从服务器中获取的数据，具体是从controller层返回的</span></span><br><span class="line">    <span class="comment">//textStatus是描述状态的信息码</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">error</span>:<span class="keyword">function</span>(<span class="params">XMLHttpRequest,XMLHttpRequest,errorThrown</span>)&#123;&#125;,</span><br><span class="line"><span class="attr">contentType</span>:<span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">    <span class="attr">datatype</span>:<span class="string">&quot;json&quot;</span> </span><br><span class="line"><span class="attr">beforeSend</span>: <span class="keyword">function</span> (<span class="params">XMLHttpRequest</span>) &#123;</span><br><span class="line">                <span class="title class_">XMLHttpRequest</span>.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;token&quot;</span>, <span class="string">&quot;eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiIxOD.....&quot;</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>未完成！</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Ajax请求：&quot;&gt;&lt;a href=&quot;#Ajax请求：&quot; class=&quot;headerlink&quot; title=&quot;Ajax请求：&quot;&gt;&lt;/a&gt;Ajax请求：&lt;/h1&gt;&lt;h2 id=&quot;1、url参数&quot;&gt;&lt;a href=&quot;#1、url参数&quot; class=&quot;headerlink</summary>
      
    
    
    
    
    <category term="ajax" scheme="http://daihaojun554.github.io/tags/ajax/"/>
    
  </entry>
  
</feed>
